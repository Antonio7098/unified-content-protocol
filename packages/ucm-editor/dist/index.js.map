{"version":3,"file":"index.js","sources":["../src/types/errors.ts","../src/types/editor.ts","../src/types/events.ts","../src/core/Logger.ts","../node_modules/ucp-content/dist/index.js","../src/core/EditorStore.ts","../src/core/SelectionManager.ts","../src/core/DiffEngine.ts","../src/hooks/useEditor.ts","../src/components/MetadataTooltip.tsx","../src/components/BlockEditor.tsx","../src/components/BlockRenderer.tsx","../src/graph/GraphView.tsx","../src/diff/DiffViewer.tsx","../src/components/Editor.tsx"],"sourcesContent":["/**\n * Typed error system for UCM Editor.\n *\n * Uses discriminated unions for exhaustive error handling.\n * Each error has a unique code, category, and structured data.\n */\n\n// =============================================================================\n// ERROR CODES\n// =============================================================================\n\nexport const ErrorCode = {\n  // Block errors (E001-E009)\n  BLOCK_NOT_FOUND: 'UCM_E001',\n  INVALID_BLOCK_CONTENT: 'UCM_E002',\n  BLOCK_TYPE_MISMATCH: 'UCM_E003',\n  BLOCK_ALREADY_EXISTS: 'UCM_E004',\n  INVALID_BLOCK_ID: 'UCM_E005',\n\n  // Selection errors (E010-E019)\n  INVALID_SELECTION: 'UCM_E010',\n  SELECTION_TARGET_NOT_FOUND: 'UCM_E011',\n  SELECTION_OUT_OF_BOUNDS: 'UCM_E012',\n\n  // Edit errors (E020-E029)\n  EDIT_FAILED: 'UCM_E020',\n  CONCURRENT_EDIT_CONFLICT: 'UCM_E021',\n  EDIT_VALIDATION_FAILED: 'UCM_E022',\n  READONLY_BLOCK: 'UCM_E023',\n\n  // Drag/Drop errors (E030-E039)\n  INVALID_DROP_TARGET: 'UCM_E030',\n  CYCLE_WOULD_BE_CREATED: 'UCM_E031',\n  DROP_NOT_ALLOWED: 'UCM_E032',\n\n  // History errors (E040-E049)\n  NO_UNDO_AVAILABLE: 'UCM_E040',\n  NO_REDO_AVAILABLE: 'UCM_E041',\n  HISTORY_CORRUPTED: 'UCM_E042',\n\n  // Diff errors (E050-E059)\n  SNAPSHOT_NOT_FOUND: 'UCM_E050',\n  INCOMPATIBLE_SNAPSHOTS: 'UCM_E051',\n  DIFF_COMPUTATION_FAILED: 'UCM_E052',\n\n  // Graph errors (E060-E069)\n  LAYOUT_FAILED: 'UCM_E060',\n  INVALID_EDGE: 'UCM_E061',\n  NODE_NOT_FOUND: 'UCM_E062',\n\n  // Document errors (E070-E079)\n  DOCUMENT_NOT_LOADED: 'UCM_E070',\n  DOCUMENT_VALIDATION_FAILED: 'UCM_E071',\n  DOCUMENT_TOO_LARGE: 'UCM_E072',\n\n  // Internal errors (E090-E099)\n  INTERNAL_ERROR: 'UCM_E090',\n  INVALID_STATE: 'UCM_E091',\n  NOT_IMPLEMENTED: 'UCM_E092',\n} as const\n\nexport type ErrorCode = (typeof ErrorCode)[keyof typeof ErrorCode]\n\n// =============================================================================\n// ERROR CATEGORIES\n// =============================================================================\n\nexport type ErrorCategory =\n  | 'block'\n  | 'selection'\n  | 'edit'\n  | 'drag'\n  | 'history'\n  | 'diff'\n  | 'graph'\n  | 'document'\n  | 'internal'\n\nexport type ErrorSeverity = 'error' | 'warning' | 'info'\n\n// =============================================================================\n// ERROR DATA TYPES\n// =============================================================================\n\nexport interface BlockErrorData {\n  blockId?: string\n  expectedType?: string\n  actualType?: string\n  content?: string\n}\n\nexport interface SelectionErrorData {\n  targetId?: string\n  startOffset?: number\n  endOffset?: number\n}\n\nexport interface EditErrorData {\n  blockId?: string\n  operation?: string\n  reason?: string\n  conflictingVersion?: number\n}\n\nexport interface DragErrorData {\n  sourceId?: string\n  targetId?: string\n  reason?: string\n}\n\nexport interface HistoryErrorData {\n  action?: 'undo' | 'redo'\n  stackSize?: number\n}\n\nexport interface DiffErrorData {\n  snapshotId1?: string\n  snapshotId2?: string\n  reason?: string\n}\n\nexport interface GraphErrorData {\n  nodeId?: string\n  edgeId?: string\n  layout?: string\n  reason?: string\n}\n\nexport interface DocumentErrorData {\n  documentId?: string\n  blockCount?: number\n  maxBlocks?: number\n  validationErrors?: string[]\n}\n\nexport interface InternalErrorData {\n  component?: string\n  operation?: string\n  stack?: string\n}\n\n// =============================================================================\n// EDITOR ERROR CLASS\n// =============================================================================\n\nexport type EditorErrorData =\n  | BlockErrorData\n  | SelectionErrorData\n  | EditErrorData\n  | DragErrorData\n  | HistoryErrorData\n  | DiffErrorData\n  | GraphErrorData\n  | DocumentErrorData\n  | InternalErrorData\n\nexport interface EditorErrorOptions {\n  code: ErrorCode\n  message: string\n  category: ErrorCategory\n  severity?: ErrorSeverity\n  data?: EditorErrorData\n  cause?: Error\n  suggestion?: string\n}\n\n/**\n * Structured error for the UCM Editor.\n *\n * Provides rich error information for debugging and user feedback.\n *\n * @example\n * ```typescript\n * throw new EditorError({\n *   code: ErrorCode.BLOCK_NOT_FOUND,\n *   message: 'Block not found in document',\n *   category: 'block',\n *   data: { blockId: 'blk_123' },\n *   suggestion: 'Ensure the block exists before editing',\n * })\n * ```\n */\nexport class EditorError extends Error {\n  readonly code: ErrorCode\n  readonly category: ErrorCategory\n  readonly severity: ErrorSeverity\n  readonly data: EditorErrorData\n  readonly suggestion?: string\n  readonly timestamp: Date\n\n  constructor(options: EditorErrorOptions) {\n    super(options.message)\n    this.name = 'EditorError'\n    this.code = options.code\n    this.category = options.category\n    this.severity = options.severity ?? 'error'\n    this.data = options.data ?? {}\n    this.suggestion = options.suggestion\n    this.timestamp = new Date()\n\n    if (options.cause) {\n      this.cause = options.cause\n    }\n\n    // Capture stack trace\n    type CaptureStackTraceFn = (\n      target: object,\n      constructorOpt: new (...args: unknown[]) => unknown\n    ) => void\n    const captureStackTrace = (Error as ErrorConstructor & {\n      captureStackTrace?: CaptureStackTraceFn\n    }).captureStackTrace\n\n    if (captureStackTrace) {\n      captureStackTrace(\n        this,\n        EditorError as unknown as new (...args: unknown[]) => unknown\n      )\n    }\n  }\n\n  /**\n   * Create a JSON representation for logging/serialization.\n   */\n  toJSON(): Record<string, unknown> {\n    return {\n      name: this.name,\n      code: this.code,\n      message: this.message,\n      category: this.category,\n      severity: this.severity,\n      data: this.data,\n      suggestion: this.suggestion,\n      timestamp: this.timestamp.toISOString(),\n      stack: this.stack,\n    }\n  }\n\n  /**\n   * Format for display to users.\n   */\n  toUserMessage(): string {\n    const parts = [`[${this.code}] ${this.message}`]\n    if (this.suggestion) {\n      parts.push(`Suggestion: ${this.suggestion}`)\n    }\n    return parts.join('\\n')\n  }\n}\n\n// =============================================================================\n// ERROR FACTORIES\n// =============================================================================\n\n/**\n * Factory functions for creating common errors.\n */\nexport const Errors = {\n  // Block errors\n  blockNotFound(blockId: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.BLOCK_NOT_FOUND,\n      message: `Block not found: ${blockId}`,\n      category: 'block',\n      data: { blockId },\n      suggestion: 'Verify the block ID exists in the document',\n    })\n  },\n\n  invalidBlockContent(blockId: string, reason: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.INVALID_BLOCK_CONTENT,\n      message: `Invalid content for block ${blockId}: ${reason}`,\n      category: 'block',\n      data: { blockId },\n      suggestion: 'Check the content format matches the block type',\n    })\n  },\n\n  blockTypeMismatch(blockId: string, expected: string, actual: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.BLOCK_TYPE_MISMATCH,\n      message: `Block ${blockId} type mismatch: expected ${expected}, got ${actual}`,\n      category: 'block',\n      data: { blockId, expectedType: expected, actualType: actual },\n      suggestion: 'Use the correct editor for this block type',\n    })\n  },\n\n  // Selection errors\n  invalidSelection(reason: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.INVALID_SELECTION,\n      message: `Invalid selection: ${reason}`,\n      category: 'selection',\n      suggestion: 'Click on a block to select it',\n    })\n  },\n\n  selectionTargetNotFound(targetId: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.SELECTION_TARGET_NOT_FOUND,\n      message: `Selection target not found: ${targetId}`,\n      category: 'selection',\n      data: { targetId },\n    })\n  },\n\n  // Edit errors\n  editFailed(blockId: string, reason: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.EDIT_FAILED,\n      message: `Edit failed for block ${blockId}: ${reason}`,\n      category: 'edit',\n      data: { blockId, reason },\n    })\n  },\n\n  concurrentEditConflict(blockId: string, version: number): EditorError {\n    return new EditorError({\n      code: ErrorCode.CONCURRENT_EDIT_CONFLICT,\n      message: `Concurrent edit conflict on block ${blockId}`,\n      category: 'edit',\n      data: { blockId, conflictingVersion: version },\n      suggestion: 'Refresh the document and try again',\n    })\n  },\n\n  readonlyBlock(blockId: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.READONLY_BLOCK,\n      message: `Block ${blockId} is read-only`,\n      category: 'edit',\n      data: { blockId },\n      severity: 'warning',\n    })\n  },\n\n  // Drag/Drop errors\n  invalidDropTarget(sourceId: string, targetId: string, reason: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.INVALID_DROP_TARGET,\n      message: `Cannot drop ${sourceId} onto ${targetId}: ${reason}`,\n      category: 'drag',\n      data: { sourceId, targetId, reason },\n    })\n  },\n\n  cycleWouldBeCreated(sourceId: string, targetId: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.CYCLE_WOULD_BE_CREATED,\n      message: `Moving ${sourceId} to ${targetId} would create a cycle`,\n      category: 'drag',\n      data: { sourceId, targetId },\n      suggestion: 'Choose a different drop target',\n    })\n  },\n\n  // History errors\n  noUndoAvailable(): EditorError {\n    return new EditorError({\n      code: ErrorCode.NO_UNDO_AVAILABLE,\n      message: 'No undo action available',\n      category: 'history',\n      severity: 'info',\n      data: { action: 'undo' },\n    })\n  },\n\n  noRedoAvailable(): EditorError {\n    return new EditorError({\n      code: ErrorCode.NO_REDO_AVAILABLE,\n      message: 'No redo action available',\n      category: 'history',\n      severity: 'info',\n      data: { action: 'redo' },\n    })\n  },\n\n  // Diff errors\n  snapshotNotFound(snapshotId: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.SNAPSHOT_NOT_FOUND,\n      message: `Snapshot not found: ${snapshotId}`,\n      category: 'diff',\n      data: { snapshotId1: snapshotId },\n    })\n  },\n\n  incompatibleSnapshots(id1: string, id2: string, reason: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.INCOMPATIBLE_SNAPSHOTS,\n      message: `Snapshots ${id1} and ${id2} are incompatible: ${reason}`,\n      category: 'diff',\n      data: { snapshotId1: id1, snapshotId2: id2, reason },\n    })\n  },\n\n  // Graph errors\n  layoutFailed(layout: string, reason: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.LAYOUT_FAILED,\n      message: `Layout computation failed (${layout}): ${reason}`,\n      category: 'graph',\n      data: { layout, reason },\n    })\n  },\n\n  // Document errors\n  documentNotLoaded(): EditorError {\n    return new EditorError({\n      code: ErrorCode.DOCUMENT_NOT_LOADED,\n      message: 'No document is currently loaded',\n      category: 'document',\n      suggestion: 'Load a document before performing this action',\n    })\n  },\n\n  documentTooLarge(blockCount: number, maxBlocks: number): EditorError {\n    return new EditorError({\n      code: ErrorCode.DOCUMENT_TOO_LARGE,\n      message: `Document has ${blockCount} blocks, maximum is ${maxBlocks}`,\n      category: 'document',\n      data: { blockCount, maxBlocks },\n      suggestion: 'Split the document into smaller parts',\n    })\n  },\n\n  // Internal errors\n  internalError(message: string, component?: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.INTERNAL_ERROR,\n      message: `Internal error: ${message}`,\n      category: 'internal',\n      data: { component },\n    })\n  },\n\n  invalidState(message: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.INVALID_STATE,\n      message: `Invalid state: ${message}`,\n      category: 'internal',\n    })\n  },\n\n  notImplemented(feature: string): EditorError {\n    return new EditorError({\n      code: ErrorCode.NOT_IMPLEMENTED,\n      message: `Not implemented: ${feature}`,\n      category: 'internal',\n      severity: 'warning',\n    })\n  },\n} as const\n\n// =============================================================================\n// RESULT TYPE\n// =============================================================================\n\n/**\n * Result type for operations that can fail.\n *\n * @example\n * ```typescript\n * function getBlock(id: string): Result<Block, EditorError> {\n *   const block = doc.blocks.get(id)\n *   if (!block) {\n *     return { ok: false, error: Errors.blockNotFound(id) }\n *   }\n *   return { ok: true, value: block }\n * }\n *\n * const result = getBlock('blk_123')\n * if (result.ok) {\n *   console.log(result.value.content)\n * } else {\n *   console.error(result.error.message)\n * }\n * ```\n */\nexport type Result<T, E = EditorError> = { ok: true; value: T } | { ok: false; error: E }\n\n/**\n * Create a successful result.\n */\nexport function ok<T>(value: T): Result<T, never> {\n  return { ok: true, value }\n}\n\n/**\n * Create a failed result.\n */\nexport function err<E>(error: E): Result<never, E> {\n  return { ok: false, error }\n}\n\n/**\n * Unwrap a result, throwing if it's an error.\n */\nexport function unwrap<T, E extends Error>(result: Result<T, E>): T {\n  if (result.ok) {\n    return result.value\n  }\n  throw result.error\n}\n\n/**\n * Unwrap a result or return a default value.\n */\nexport function unwrapOr<T, E>(result: Result<T, E>, defaultValue: T): T {\n  return result.ok ? result.value : defaultValue\n}\n\n/**\n * Map a successful result.\n */\nexport function map<T, U, E>(result: Result<T, E>, fn: (value: T) => U): Result<U, E> {\n  if (result.ok) {\n    return ok(fn(result.value))\n  }\n  return result\n}\n\n/**\n * Chain results (flatMap).\n */\nexport function andThen<T, U, E>(\n  result: Result<T, E>,\n  fn: (value: T) => Result<U, E>\n): Result<U, E> {\n  if (result.ok) {\n    return fn(result.value)\n  }\n  return result\n}\n","/**\n * Core editor types for UCM Editor.\n */\n\nimport type { BlockId, Document, Block, ContentType, SemanticRole, EdgeType } from 'ucp-content'\n\n// =============================================================================\n// EDITOR STATE\n// =============================================================================\n\n/** Current view mode of the editor */\nexport type EditorView = 'document' | 'graph' | 'diff' | 'split'\n\n/** Editor operation mode */\nexport type EditorMode = 'view' | 'edit' | 'select' | 'drag'\n\n/** Block editing state */\nexport type BlockEditState = 'idle' | 'editing' | 'saving' | 'error'\n\n// =============================================================================\n// SELECTION\n// =============================================================================\n\n/** Selection within a single block */\nexport interface TextSelection {\n  blockId: BlockId\n  start: number\n  end: number\n}\n\n/** Multi-block selection */\nexport interface BlockSelection {\n  blockIds: BlockId[]\n  anchor?: BlockId\n  focus?: BlockId\n}\n\n/** Combined selection state */\nexport interface SelectionState {\n  type: 'none' | 'text' | 'block'\n  text?: TextSelection\n  blocks?: BlockSelection\n  focusedBlockId?: BlockId\n}\n\n// =============================================================================\n// DRAG AND DROP\n// =============================================================================\n\n/** Drag operation state */\nexport interface DragState {\n  isDragging: boolean\n  sourceId?: BlockId\n  targetId?: BlockId\n  position?: 'before' | 'after' | 'inside'\n  preview?: DragPreview\n}\n\n/** Visual preview during drag */\nexport interface DragPreview {\n  x: number\n  y: number\n  width: number\n  height: number\n  ghostElement?: HTMLElement\n}\n\n/** Drop zone configuration */\nexport interface DropZone {\n  id: string\n  blockId: BlockId\n  position: 'before' | 'after' | 'inside'\n  rect: DOMRect\n}\n\n// =============================================================================\n// BLOCK RENDERING\n// =============================================================================\n\n/** Props for block renderers */\nexport interface BlockRendererProps {\n  block: Block\n  document: Document\n  isSelected: boolean\n  isEditing: boolean\n  isFocused: boolean\n  isDropTarget: boolean\n  depth: number\n  path: BlockId[]\n  onSelect: (blockId: BlockId) => void\n  onEdit: (blockId: BlockId) => void\n  onContentChange: (blockId: BlockId, content: string) => void\n  onTypeChange: (blockId: BlockId, type: ContentType) => void\n  onDelete: (blockId: BlockId) => void\n  onAddChild: (parentId: BlockId) => void\n  onMoveBlock: (blockId: BlockId, targetId: BlockId, position: 'before' | 'after' | 'inside') => void\n}\n\n/** Props for content-type-specific editors */\nexport interface ContentEditorProps {\n  block: Block\n  isEditing: boolean\n  onChange: (content: string) => void\n  onSave: () => void\n  onCancel: () => void\n  onKeyDown?: (event: React.KeyboardEvent) => void\n}\n\n// =============================================================================\n// GRAPH VIEW\n// =============================================================================\n\n/** Graph layout algorithm */\nexport type GraphLayout = 'hierarchical' | 'force' | 'dagre' | 'radial'\n\n/** Graph node for visualization */\nexport interface GraphNode {\n  id: BlockId\n  x: number\n  y: number\n  width: number\n  height: number\n  block: Block\n  depth: number\n  isExpanded: boolean\n  isSelected: boolean\n  isHighlighted: boolean\n}\n\n/** Graph edge for visualization */\nexport interface GraphEdge {\n  id: string\n  sourceId: BlockId\n  targetId: BlockId\n  edgeType: EdgeType | 'parent_child'\n  points: Array<{ x: number; y: number }>\n  isHighlighted: boolean\n}\n\n/** Graph view state */\nexport interface GraphViewState {\n  layout: GraphLayout\n  nodes: Map<BlockId, GraphNode>\n  edges: GraphEdge[]\n  viewport: {\n    x: number\n    y: number\n    zoom: number\n  }\n  selectedNodeId?: BlockId\n  hoveredNodeId?: BlockId\n  showEdgeLabels: boolean\n  edgeFilter: EdgeType[]\n}\n\n// =============================================================================\n// DIFF VIEW\n// =============================================================================\n\n/** Type of change in a diff */\nexport type DiffChangeType = 'added' | 'removed' | 'modified' | 'moved' | 'unchanged'\n\n/** Diff for a single block */\nexport interface BlockDiff {\n  blockId: BlockId\n  changeType: DiffChangeType\n  oldBlock?: Block\n  newBlock?: Block\n  contentDiff?: TextDiff\n  metadataChanges?: MetadataChange[]\n}\n\n/** Text-level diff */\nexport interface TextDiff {\n  operations: Array<\n    | { type: 'equal'; text: string }\n    | { type: 'insert'; text: string }\n    | { type: 'delete'; text: string }\n  >\n}\n\n/** Metadata change */\nexport interface MetadataChange {\n  field: string\n  oldValue: unknown\n  newValue: unknown\n}\n\n/** Structural change in the document tree */\nexport interface StructuralChange {\n  type: 'added' | 'removed' | 'moved' | 'reordered'\n  blockId: BlockId\n  oldParentId?: BlockId\n  newParentId?: BlockId\n  oldIndex?: number\n  newIndex?: number\n}\n\n/** Complete document diff */\nexport interface DocumentDiff {\n  fromSnapshotId: string\n  toSnapshotId: string\n  blockDiffs: Map<BlockId, BlockDiff>\n  structuralChanges: StructuralChange[]\n  summary: {\n    added: number\n    removed: number\n    modified: number\n    moved: number\n    unchanged: number\n  }\n}\n\n/** Diff view state */\nexport interface DiffViewState {\n  isComparing: boolean\n  leftSnapshotId?: string\n  rightSnapshotId?: string\n  diff?: DocumentDiff\n  selectedChangeId?: BlockId\n  showUnchanged: boolean\n  viewMode: 'unified' | 'split'\n}\n\n// =============================================================================\n// HISTORY\n// =============================================================================\n\n/** A recorded action for undo/redo */\nexport interface HistoryEntry {\n  id: string\n  timestamp: Date\n  description: string\n  snapshotId: string\n  operations: HistoryOperation[]\n}\n\n/** Individual operation in history */\nexport interface HistoryOperation {\n  type:\n    | 'add_block'\n    | 'delete_block'\n    | 'edit_block'\n    | 'move_block'\n    | 'add_edge'\n    | 'remove_edge'\n    | 'change_type'\n    | 'batch'\n  blockId?: BlockId\n  data?: Record<string, unknown>\n}\n\n/** History state */\nexport interface HistoryState {\n  entries: HistoryEntry[]\n  currentIndex: number\n  maxEntries: number\n  canUndo: boolean\n  canRedo: boolean\n}\n\n// =============================================================================\n// METADATA TOOLTIP\n// =============================================================================\n\n/** Metadata to show in tooltip */\nexport interface BlockMetadataDisplay {\n  id: BlockId\n  type: ContentType\n  role?: SemanticRole\n  label?: string\n  tags: string[]\n  createdAt?: Date\n  modifiedAt?: Date\n  tokenEstimate?: number\n  edgeCount: number\n  childCount: number\n  custom: Record<string, unknown>\n}\n\n// =============================================================================\n// EDITOR CONFIGURATION\n// =============================================================================\n\n/** Editor configuration options */\nexport interface EditorConfig {\n  /** Maximum blocks to render before virtualization */\n  virtualizationThreshold: number\n  /** Debounce delay for auto-save (ms) */\n  autoSaveDelay: number\n  /** Maximum history entries to keep */\n  maxHistoryEntries: number\n  /** Enable keyboard shortcuts */\n  enableKeyboardShortcuts: boolean\n  /** Enable drag and drop */\n  enableDragDrop: boolean\n  /** Show block IDs in UI */\n  showBlockIds: boolean\n  /** Default graph layout */\n  defaultGraphLayout: GraphLayout\n  /** Log level */\n  logLevel: 'debug' | 'info' | 'warn' | 'error'\n}\n\n/** Default editor configuration */\nexport const DEFAULT_EDITOR_CONFIG: EditorConfig = {\n  virtualizationThreshold: 1000,\n  autoSaveDelay: 1000,\n  maxHistoryEntries: 100,\n  enableKeyboardShortcuts: true,\n  enableDragDrop: true,\n  showBlockIds: false,\n  defaultGraphLayout: 'hierarchical',\n  logLevel: 'info',\n}\n\n// =============================================================================\n// EDITOR STORE STATE\n// =============================================================================\n\n/** Complete editor store state */\nexport interface EditorStoreState {\n  // Document\n  document: Document | null\n  documentId: string | null\n  isLoading: boolean\n  isDirty: boolean\n  lastSaved?: Date\n\n  // View\n  view: EditorView\n  mode: EditorMode\n\n  // Selection\n  selection: SelectionState\n\n  // Editing\n  editingBlockId: BlockId | null\n  editState: BlockEditState\n  pendingContent: string | null\n\n  // Drag\n  drag: DragState\n\n  // Graph\n  graph: GraphViewState\n\n  // Diff\n  diff: DiffViewState\n\n  // History\n  history: HistoryState\n\n  // Config\n  config: EditorConfig\n\n  // Error state\n  lastError: Error | null\n}\n\n// =============================================================================\n// EDITOR STORE ACTIONS\n// =============================================================================\n\n/** Actions for the editor store */\nexport interface EditorStoreActions {\n  // Document operations\n  loadDocument: (doc: Document) => void\n  createDocument: (title?: string) => void\n  saveDocument: () => Promise<void>\n\n  // View operations\n  setView: (view: EditorView) => void\n  setMode: (mode: EditorMode) => void\n\n  // Block operations\n  addBlock: (parentId: BlockId, content: string, type?: ContentType) => BlockId\n  editBlock: (blockId: BlockId, content: string) => void\n  deleteBlock: (blockId: BlockId, cascade?: boolean) => void\n  moveBlock: (blockId: BlockId, targetId: BlockId, position: 'before' | 'after' | 'inside') => void\n  changeBlockType: (blockId: BlockId, type: ContentType) => void\n\n  // Selection operations\n  select: (blockId: BlockId) => void\n  selectMultiple: (blockIds: BlockId[]) => void\n  clearSelection: () => void\n  selectText: (blockId: BlockId, start: number, end: number) => void\n\n  // Edit operations\n  startEditing: (blockId: BlockId) => void\n  stopEditing: (save?: boolean) => void\n  updatePendingContent: (content: string) => void\n\n  // Drag operations\n  startDrag: (blockId: BlockId) => void\n  updateDragTarget: (targetId: BlockId, position: 'before' | 'after' | 'inside') => void\n  endDrag: (drop?: boolean) => void\n\n  // History operations\n  undo: () => void\n  redo: () => void\n  createSnapshot: (description: string) => void\n\n  // Graph operations\n  setGraphLayout: (layout: GraphLayout) => void\n  setGraphViewport: (x: number, y: number, zoom: number) => void\n  toggleNodeExpansion: (nodeId: BlockId) => void\n\n  // Diff operations\n  startCompare: (leftSnapshotId: string, rightSnapshotId: string) => void\n  stopCompare: () => void\n  applyChange: (blockId: BlockId) => void\n  rejectChange: (blockId: BlockId) => void\n\n  // Edge operations\n  addEdge: (sourceId: BlockId, targetId: BlockId, edgeType: EdgeType) => void\n  removeEdge: (sourceId: BlockId, targetId: BlockId, edgeType: EdgeType) => void\n\n  // Config\n  updateConfig: (config: Partial<EditorConfig>) => void\n\n  // Error handling\n  clearError: () => void\n}\n\n/** Complete editor store */\nexport type EditorStore = EditorStoreState & EditorStoreActions\n","/**\n * Event types for UCM Editor.\n *\n * Events are used for observability, logging, and extensibility.\n */\n\nimport type { BlockId, ContentType, EdgeType } from 'ucp-content'\nimport type { EditorView, EditorMode, DiffChangeType, GraphLayout } from './editor.js'\n\n// =============================================================================\n// EVENT TYPES\n// =============================================================================\n\nexport type EditorEventType =\n  // Document events\n  | 'document:loaded'\n  | 'document:created'\n  | 'document:saved'\n  | 'document:modified'\n  | 'document:validated'\n  // Block events\n  | 'block:added'\n  | 'block:deleted'\n  | 'block:edited'\n  | 'block:moved'\n  | 'block:type_changed'\n  // Selection events\n  | 'selection:changed'\n  | 'selection:cleared'\n  // Edit events\n  | 'edit:started'\n  | 'edit:saved'\n  | 'edit:cancelled'\n  // Drag events\n  | 'drag:started'\n  | 'drag:moved'\n  | 'drag:ended'\n  | 'drag:cancelled'\n  // History events\n  | 'history:undo'\n  | 'history:redo'\n  | 'history:snapshot_created'\n  // Edge events\n  | 'edge:added'\n  | 'edge:removed'\n  // View events\n  | 'view:changed'\n  | 'mode:changed'\n  // Graph events\n  | 'graph:layout_changed'\n  | 'graph:node_expanded'\n  | 'graph:node_collapsed'\n  | 'graph:viewport_changed'\n  // Diff events\n  | 'diff:started'\n  | 'diff:ended'\n  | 'diff:change_applied'\n  | 'diff:change_rejected'\n  // Error events\n  | 'error:occurred'\n  | 'error:cleared'\n\n// =============================================================================\n// EVENT DATA INTERFACES\n// =============================================================================\n\nexport interface DocumentEventData {\n  documentId: string\n  title?: string\n  blockCount?: number\n  version?: number\n}\n\nexport interface BlockEventData {\n  blockId: BlockId\n  parentId?: BlockId\n  content?: string\n  type?: ContentType\n  oldContent?: string\n  oldType?: ContentType\n  oldParentId?: BlockId\n  newParentId?: BlockId\n  position?: 'before' | 'after' | 'inside'\n}\n\nexport interface SelectionEventData {\n  blockIds: BlockId[]\n  focusedBlockId?: BlockId\n  anchor?: BlockId\n  textSelection?: {\n    blockId: BlockId\n    start: number\n    end: number\n  }\n}\n\nexport interface EditEventData {\n  blockId: BlockId\n  content?: string\n  previousContent?: string\n}\n\nexport interface DragEventData {\n  sourceId: BlockId\n  targetId?: BlockId\n  position?: 'before' | 'after' | 'inside'\n  x?: number\n  y?: number\n}\n\nexport interface HistoryEventData {\n  entryId: string\n  description: string\n  snapshotId: string\n  operationCount?: number\n}\n\nexport interface EdgeEventData {\n  sourceId: BlockId\n  targetId: BlockId\n  edgeType: EdgeType\n}\n\nexport interface ViewEventData {\n  view?: EditorView\n  previousView?: EditorView\n  mode?: EditorMode\n  previousMode?: EditorMode\n}\n\nexport interface GraphEventData {\n  layout?: GraphLayout\n  nodeId?: BlockId\n  viewport?: {\n    x: number\n    y: number\n    zoom: number\n  }\n}\n\nexport interface DiffEventData {\n  leftSnapshotId?: string\n  rightSnapshotId?: string\n  blockId?: BlockId\n  changeType?: DiffChangeType\n}\n\nexport interface ErrorEventData {\n  code: string\n  message: string\n  category: string\n  severity: string\n  data?: Record<string, unknown>\n}\n\n// =============================================================================\n// EVENT INTERFACE\n// =============================================================================\n\nexport type EditorEventData =\n  | DocumentEventData\n  | BlockEventData\n  | SelectionEventData\n  | EditEventData\n  | DragEventData\n  | HistoryEventData\n  | EdgeEventData\n  | ViewEventData\n  | GraphEventData\n  | DiffEventData\n  | ErrorEventData\n\nexport interface EditorEvent<T extends EditorEventType = EditorEventType> {\n  type: T\n  timestamp: Date\n  data: EditorEventData\n  source?: string\n}\n\n// =============================================================================\n// EVENT HANDLER\n// =============================================================================\n\nexport type EditorEventHandler<T extends EditorEventType = EditorEventType> = (\n  event: EditorEvent<T>\n) => void\n\n// =============================================================================\n// EVENT EMITTER INTERFACE\n// =============================================================================\n\nexport interface EditorEventEmitter {\n  on<T extends EditorEventType>(type: T, handler: EditorEventHandler<T>): () => void\n  once<T extends EditorEventType>(type: T, handler: EditorEventHandler<T>): () => void\n  off<T extends EditorEventType>(type: T, handler: EditorEventHandler<T>): void\n  emit<T extends EditorEventType>(type: T, data: EditorEventData): void\n  clear(): void\n}\n\n// =============================================================================\n// SIMPLE EVENT EMITTER IMPLEMENTATION\n// =============================================================================\n\n/**\n * Simple event emitter for editor events.\n *\n * @example\n * ```typescript\n * const emitter = new SimpleEventEmitter()\n *\n * const unsubscribe = emitter.on('block:added', (event) => {\n *   console.log('Block added:', event.data.blockId)\n * })\n *\n * emitter.emit('block:added', { blockId: 'blk_123' })\n *\n * unsubscribe()\n * ```\n */\nexport class SimpleEventEmitter implements EditorEventEmitter {\n  private handlers = new Map<EditorEventType, Set<EditorEventHandler>>()\n  private onceHandlers = new Map<EditorEventType, Set<EditorEventHandler>>()\n\n  on<T extends EditorEventType>(type: T, handler: EditorEventHandler<T>): () => void {\n    if (!this.handlers.has(type)) {\n      this.handlers.set(type, new Set())\n    }\n    this.handlers.get(type)!.add(handler as EditorEventHandler)\n    return () => this.off(type, handler)\n  }\n\n  once<T extends EditorEventType>(type: T, handler: EditorEventHandler<T>): () => void {\n    if (!this.onceHandlers.has(type)) {\n      this.onceHandlers.set(type, new Set())\n    }\n    this.onceHandlers.get(type)!.add(handler as EditorEventHandler)\n    return () => {\n      const handlers = this.onceHandlers.get(type)\n      if (handlers) {\n        handlers.delete(handler as EditorEventHandler)\n      }\n    }\n  }\n\n  off<T extends EditorEventType>(type: T, handler: EditorEventHandler<T>): void {\n    const handlers = this.handlers.get(type)\n    if (handlers) {\n      handlers.delete(handler as EditorEventHandler)\n    }\n    const onceHandlers = this.onceHandlers.get(type)\n    if (onceHandlers) {\n      onceHandlers.delete(handler as EditorEventHandler)\n    }\n  }\n\n  emit<T extends EditorEventType>(type: T, data: EditorEventData): void {\n    const event: EditorEvent<T> = {\n      type,\n      timestamp: new Date(),\n      data,\n    }\n\n    const handlers = this.handlers.get(type)\n    if (handlers) {\n      handlers.forEach((handler) => {\n        try {\n          handler(event)\n        } catch (error) {\n          console.error(`Error in event handler for ${type}:`, error)\n        }\n      })\n    }\n\n    const onceHandlers = this.onceHandlers.get(type)\n    if (onceHandlers) {\n      onceHandlers.forEach((handler) => {\n        try {\n          handler(event)\n        } catch (error) {\n          console.error(`Error in once handler for ${type}:`, error)\n        }\n      })\n      this.onceHandlers.delete(type)\n    }\n  }\n\n  clear(): void {\n    this.handlers.clear()\n    this.onceHandlers.clear()\n  }\n\n  /**\n   * Get the number of handlers for a specific event type.\n   */\n  listenerCount(type: EditorEventType): number {\n    const handlers = this.handlers.get(type)?.size ?? 0\n    const onceHandlers = this.onceHandlers.get(type)?.size ?? 0\n    return handlers + onceHandlers\n  }\n\n  /**\n   * Get all registered event types.\n   */\n  eventTypes(): EditorEventType[] {\n    const types = new Set<EditorEventType>()\n    this.handlers.forEach((_, type) => types.add(type))\n    this.onceHandlers.forEach((_, type) => types.add(type))\n    return Array.from(types)\n  }\n}\n","/**\n * Structured logging for UCM Editor.\n *\n * Provides consistent, level-based logging with context support.\n */\n\n// =============================================================================\n// LOG LEVELS\n// =============================================================================\n\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error'\n\nconst LOG_LEVEL_PRIORITY: Record<LogLevel, number> = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n}\n\n// =============================================================================\n// LOG ENTRY\n// =============================================================================\n\nexport interface LogEntry {\n  level: LogLevel\n  message: string\n  timestamp: Date\n  context?: string\n  data?: Record<string, unknown>\n  error?: Error\n}\n\n// =============================================================================\n// LOG HANDLER\n// =============================================================================\n\nexport type LogHandler = (entry: LogEntry) => void\n\n// =============================================================================\n// CONSOLE FORMATTER\n// =============================================================================\n\nconst LEVEL_COLORS: Record<LogLevel, string> = {\n  debug: '\\x1b[36m', // Cyan\n  info: '\\x1b[32m', // Green\n  warn: '\\x1b[33m', // Yellow\n  error: '\\x1b[31m', // Red\n}\n\nconst RESET = '\\x1b[0m'\n\nfunction formatLogEntry(entry: LogEntry, useColors: boolean): string {\n  const time = entry.timestamp.toISOString().slice(11, 23) // HH:mm:ss.SSS\n  const level = entry.level.toUpperCase().padEnd(5)\n  const context = entry.context ? `[${entry.context}]` : ''\n\n  if (useColors) {\n    const color = LEVEL_COLORS[entry.level]\n    return `${color}${time} ${level}${RESET} ${context} ${entry.message}`\n  }\n\n  return `${time} ${level} ${context} ${entry.message}`\n}\n\n// =============================================================================\n// DEFAULT HANDLERS\n// =============================================================================\n\n/**\n * Console log handler that outputs to console with appropriate methods.\n */\nexport const consoleHandler: LogHandler = (entry: LogEntry) => {\n  const formatted = formatLogEntry(entry, typeof window === 'undefined')\n  const args: unknown[] = [formatted]\n\n  if (entry.data && Object.keys(entry.data).length > 0) {\n    args.push(entry.data)\n  }\n\n  if (entry.error) {\n    args.push(entry.error)\n  }\n\n  switch (entry.level) {\n    case 'debug':\n      console.debug(...args)\n      break\n    case 'info':\n      console.info(...args)\n      break\n    case 'warn':\n      console.warn(...args)\n      break\n    case 'error':\n      console.error(...args)\n      break\n  }\n}\n\n/**\n * In-memory buffer handler for testing and inspection.\n */\nexport function createBufferHandler(maxEntries = 1000): {\n  handler: LogHandler\n  getEntries: () => LogEntry[]\n  clear: () => void\n} {\n  const entries: LogEntry[] = []\n\n  return {\n    handler: (entry: LogEntry) => {\n      entries.push(entry)\n      if (entries.length > maxEntries) {\n        entries.shift()\n      }\n    },\n    getEntries: () => [...entries],\n    clear: () => {\n      entries.length = 0\n    },\n  }\n}\n\n// =============================================================================\n// LOGGER CLASS\n// =============================================================================\n\nexport interface LoggerConfig {\n  level: LogLevel\n  handlers: LogHandler[]\n  context?: string\n}\n\nconst DEFAULT_CONFIG: LoggerConfig = {\n  level: 'info',\n  handlers: [consoleHandler],\n}\n\n/**\n * Structured logger for UCM Editor.\n *\n * @example\n * ```typescript\n * const logger = new Logger({ context: 'EditorStore' })\n *\n * logger.info('Document loaded', { blockCount: 42 })\n * logger.warn('Large document detected', { blockCount: 1000 })\n * logger.error('Failed to save', { error: err })\n *\n * // Child logger with additional context\n * const blockLogger = logger.child('BlockEditor')\n * blockLogger.debug('Editing block', { blockId: 'blk_123' })\n * ```\n */\nexport class Logger {\n  private config: LoggerConfig\n  private context?: string\n\n  constructor(config: Partial<LoggerConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config }\n    this.context = config.context\n  }\n\n  /**\n   * Create a child logger with additional context.\n   */\n  child(context: string): Logger {\n    const childContext = this.context ? `${this.context}:${context}` : context\n    return new Logger({\n      ...this.config,\n      context: childContext,\n    })\n  }\n\n  /**\n   * Set the log level.\n   */\n  setLevel(level: LogLevel): void {\n    this.config.level = level\n  }\n\n  /**\n   * Get the current log level.\n   */\n  getLevel(): LogLevel {\n    return this.config.level\n  }\n\n  /**\n   * Add a log handler.\n   */\n  addHandler(handler: LogHandler): void {\n    this.config.handlers.push(handler)\n  }\n\n  /**\n   * Remove a log handler.\n   */\n  removeHandler(handler: LogHandler): void {\n    const index = this.config.handlers.indexOf(handler)\n    if (index !== -1) {\n      this.config.handlers.splice(index, 1)\n    }\n  }\n\n  /**\n   * Clear all handlers.\n   */\n  clearHandlers(): void {\n    this.config.handlers = []\n  }\n\n  /**\n   * Check if a level would be logged.\n   */\n  isLevelEnabled(level: LogLevel): boolean {\n    return LOG_LEVEL_PRIORITY[level] >= LOG_LEVEL_PRIORITY[this.config.level]\n  }\n\n  /**\n   * Log a debug message.\n   */\n  debug(message: string, data?: Record<string, unknown>): void {\n    this.log('debug', message, data)\n  }\n\n  /**\n   * Log an info message.\n   */\n  info(message: string, data?: Record<string, unknown>): void {\n    this.log('info', message, data)\n  }\n\n  /**\n   * Log a warning message.\n   */\n  warn(message: string, data?: Record<string, unknown>): void {\n    this.log('warn', message, data)\n  }\n\n  /**\n   * Log an error message.\n   */\n  error(message: string, error?: Error | Record<string, unknown>, data?: Record<string, unknown>): void {\n    if (error instanceof Error) {\n      this.log('error', message, data, error)\n    } else {\n      this.log('error', message, error)\n    }\n  }\n\n  /**\n   * Log a message with timing.\n   */\n  time<T>(label: string, fn: () => T): T {\n    const start = performance.now()\n    try {\n      const result = fn()\n      const duration = performance.now() - start\n      this.debug(`${label} completed`, { durationMs: duration.toFixed(2) })\n      return result\n    } catch (error) {\n      const duration = performance.now() - start\n      this.error(`${label} failed`, error instanceof Error ? error : undefined, {\n        durationMs: duration.toFixed(2),\n      })\n      throw error\n    }\n  }\n\n  /**\n   * Log a message with async timing.\n   */\n  async timeAsync<T>(label: string, fn: () => Promise<T>): Promise<T> {\n    const start = performance.now()\n    try {\n      const result = await fn()\n      const duration = performance.now() - start\n      this.debug(`${label} completed`, { durationMs: duration.toFixed(2) })\n      return result\n    } catch (error) {\n      const duration = performance.now() - start\n      this.error(`${label} failed`, error instanceof Error ? error : undefined, {\n        durationMs: duration.toFixed(2),\n      })\n      throw error\n    }\n  }\n\n  /**\n   * Create a group of related log messages.\n   */\n  group(label: string): { end: () => void } {\n    this.debug(`${label} started`)\n    const start = performance.now()\n    return {\n      end: () => {\n        const duration = performance.now() - start\n        this.debug(`${label} ended`, { durationMs: duration.toFixed(2) })\n      },\n    }\n  }\n\n  private log(level: LogLevel, message: string, data?: Record<string, unknown>, error?: Error): void {\n    if (!this.isLevelEnabled(level)) {\n      return\n    }\n\n    const entry: LogEntry = {\n      level,\n      message,\n      timestamp: new Date(),\n      context: this.context,\n      data,\n      error,\n    }\n\n    for (const handler of this.config.handlers) {\n      try {\n        handler(entry)\n      } catch (e) {\n        // Prevent handler errors from breaking the application\n        console.error('Log handler error:', e)\n      }\n    }\n  }\n}\n\n// =============================================================================\n// GLOBAL LOGGER\n// =============================================================================\n\n/**\n * Global logger instance for the editor.\n */\nexport const logger = new Logger({ context: 'UCMEditor' })\n\n/**\n * Configure the global logger.\n */\nexport function configureLogger(config: Partial<LoggerConfig>): void {\n  if (config.level) {\n    logger.setLevel(config.level)\n  }\n  if (config.handlers) {\n    logger.clearHandlers()\n    config.handlers.forEach((h) => logger.addHandler(h))\n  }\n}\n","/**\n * ucp-js - Unified Content Protocol JavaScript SDK\n *\n * A developer-friendly SDK for building LLM-powered content manipulation.\n *\n * @example\n * ```typescript\n * import { ucp } from 'ucp-js'\n *\n * // Parse markdown into a document\n * const doc = ucp.parse('# Hello\\n\\nWorld')\n *\n * // Get a prompt builder for your LLM\n * const prompt = ucp.prompt()\n *   .edit()\n *   .append()\n *   .withShortIds()\n *   .build()\n *\n * // Map IDs for token efficiency\n * const mapper = ucp.mapIds(doc)\n * const shortPrompt = mapper.shorten(docDescription)\n * const expandedUcl = mapper.expand(llmResponse)\n * ```\n */\n// =============================================================================\n// DOCUMENT OPERATIONS\n// =============================================================================\nlet blockCounter = 0;\nfunction generateId() {\n    blockCounter++;\n    return `blk_${blockCounter.toString(16).padStart(12, '0')}`;\n}\n/** Create a new empty document */\nexport function createDocument(title) {\n    const rootId = generateId();\n    const now = new Date();\n    const root = {\n        id: rootId,\n        content: '',\n        type: 'text',\n        tags: [],\n        children: [],\n        edges: [],\n    };\n    return {\n        id: `doc_${Date.now().toString(16)}`,\n        root: rootId,\n        blocks: new Map([[rootId, root]]),\n        metadata: {\n            title,\n            authors: [],\n            createdAt: now,\n            modifiedAt: now,\n            custom: {},\n        },\n        version: 1,\n    };\n}\n/** Add a block to a document */\nexport function addBlock(doc, parentId, content, options = {}) {\n    const parent = doc.blocks.get(parentId);\n    if (!parent)\n        throw new Error(`Parent block not found: ${parentId}`);\n    const id = generateId();\n    const block = {\n        id,\n        content,\n        type: options.type ?? 'text',\n        role: options.role,\n        label: options.label,\n        tags: [],\n        children: [],\n        edges: [],\n        metadata: {\n            tags: [],\n            createdAt: new Date(),\n            modifiedAt: new Date(),\n            custom: {},\n        },\n    };\n    // Set semanticRole in metadata if role is provided\n    if (options.role) {\n        block.metadata.semanticRole = options.role;\n    }\n    doc.blocks.set(id, block);\n    parent.children.push(id);\n    return id;\n}\n/** Get a block by ID */\nexport function getBlock(doc, id) {\n    return doc.blocks.get(id);\n}\n/** Edit a block's textual content */\nexport function editBlock(doc, id, content) {\n    const block = doc.blocks.get(id);\n    if (!block)\n        throw new Error(`Block not found: ${id}`);\n    block.content = content;\n}\n/** Move a block (and its subtree) to a new parent */\nexport function moveBlock(doc, id, newParentId, index) {\n    if (id === doc.root)\n        throw new Error('Cannot move the root block');\n    const block = doc.blocks.get(id);\n    if (!block)\n        throw new Error(`Block not found: ${id}`);\n    const newParent = doc.blocks.get(newParentId);\n    if (!newParent)\n        throw new Error(`Parent block not found: ${newParentId}`);\n    if (newParentId === id || isDescendant(doc, id, newParentId)) {\n        throw new Error('Cannot move a block into itself or its descendants');\n    }\n    const oldParentId = findParent(doc, id);\n    if (!oldParentId)\n        throw new Error(`Parent block not found for: ${id}`);\n    const oldParent = doc.blocks.get(oldParentId);\n    const childIndex = oldParent.children.indexOf(id);\n    if (childIndex === -1)\n        throw new Error(`Block ${id} not linked to parent ${oldParentId}`);\n    oldParent.children.splice(childIndex, 1);\n    if (index === undefined || index < 0 || index > newParent.children.length) {\n        newParent.children.push(id);\n    }\n    else {\n        newParent.children.splice(index, 0, id);\n    }\n}\n/** Delete a block (with optional cascade to children) */\nexport function deleteBlock(doc, id, options = {}) {\n    if (id === doc.root)\n        throw new Error('Cannot delete the root block');\n    const block = doc.blocks.get(id);\n    if (!block)\n        throw new Error(`Block not found: ${id}`);\n    const parentId = findParent(doc, id);\n    if (!parentId)\n        throw new Error(`Parent block not found for: ${id}`);\n    const parent = doc.blocks.get(parentId);\n    const idx = parent.children.indexOf(id);\n    if (idx === -1)\n        throw new Error(`Block ${id} not linked to parent ${parentId}`);\n    parent.children.splice(idx, 1);\n    if (options.cascade ?? true) {\n        for (const childId of block.children) {\n            deleteSubtree(doc, childId);\n        }\n    }\n    else {\n        parent.children.splice(idx, 0, ...block.children);\n    }\n    doc.blocks.delete(id);\n}\nfunction findParent(doc, id) {\n    for (const [candidateId, block] of doc.blocks.entries()) {\n        if (block.children.includes(id)) {\n            return candidateId;\n        }\n    }\n    return undefined;\n}\nfunction isDescendant(doc, ancestorId, candidateId) {\n    const ancestor = doc.blocks.get(ancestorId);\n    if (!ancestor)\n        return false;\n    const queue = [...ancestor.children];\n    while (queue.length > 0) {\n        const current = queue.shift();\n        if (current === candidateId)\n            return true;\n        const block = doc.blocks.get(current);\n        if (block)\n            queue.push(...block.children);\n    }\n    return false;\n}\nfunction deleteSubtree(doc, id) {\n    const block = doc.blocks.get(id);\n    if (!block)\n        return;\n    for (const child of block.children) {\n        deleteSubtree(doc, child);\n    }\n    doc.blocks.delete(id);\n}\n/** Add a tag to a block */\nexport function addTag(doc, id, tag) {\n    const block = doc.blocks.get(id);\n    if (!block)\n        throw new Error(`Block not found: ${id}`);\n    if (!block.tags.includes(tag)) {\n        block.tags.push(tag);\n    }\n}\n/** Remove a tag from a block */\nexport function removeTag(doc, id, tag) {\n    const block = doc.blocks.get(id);\n    if (!block)\n        throw new Error(`Block not found: ${id}`);\n    block.tags = block.tags.filter(t => t !== tag);\n}\n/** Check if a block has a tag */\nexport function blockHasTag(doc, id, tag) {\n    const block = doc.blocks.get(id);\n    if (!block)\n        throw new Error(`Block not found: ${id}`);\n    return block.tags.includes(tag);\n}\n/** Find block IDs with a tag */\nexport function findBlocksByTag(doc, tag) {\n    const ids = [];\n    for (const [id, block] of doc.blocks.entries()) {\n        if (block.tags.includes(tag)) {\n            ids.push(id);\n        }\n    }\n    return ids;\n}\n// =============================================================================\n// DOCUMENT NAVIGATION & QUERY\n// =============================================================================\n/** Get children of a block */\nexport function getChildren(doc, parentId) {\n    return [...(doc.blocks.get(parentId)?.children ?? [])];\n}\n/** Get parent of a block */\nexport function getParent(doc, childId) {\n    return findParent(doc, childId);\n}\n/** Get all ancestors of a block (from immediate parent to root) */\nexport function getAncestors(doc, blockId) {\n    const ancestors = [];\n    let current = getParent(doc, blockId);\n    while (current) {\n        ancestors.push(current);\n        current = getParent(doc, current);\n    }\n    return ancestors;\n}\n/** Get all descendants of a block (breadth-first) */\nexport function getDescendants(doc, blockId) {\n    const descendants = [];\n    const queue = [...getChildren(doc, blockId)];\n    while (queue.length > 0) {\n        const current = queue.shift();\n        descendants.push(current);\n        queue.push(...getChildren(doc, current));\n    }\n    return descendants;\n}\n/** Get siblings of a block (excluding itself) */\nexport function getSiblings(doc, blockId) {\n    const parentId = getParent(doc, blockId);\n    if (!parentId)\n        return [];\n    return getChildren(doc, parentId).filter(id => id !== blockId);\n}\n/** Get depth of a block (root is 0) */\nexport function getDepth(doc, blockId) {\n    return getAncestors(doc, blockId).length;\n}\n/** Find blocks by content type */\nexport function findByType(doc, contentType) {\n    const ids = [];\n    for (const [id, block] of doc.blocks.entries()) {\n        if (block.type === contentType) {\n            ids.push(id);\n        }\n    }\n    return ids;\n}\n/** Find blocks by semantic role */\nexport function findByRole(doc, role) {\n    const ids = [];\n    for (const [id, block] of doc.blocks.entries()) {\n        if (block.role === role) {\n            ids.push(id);\n        }\n    }\n    return ids;\n}\n/** Find a block by label */\nexport function findByLabel(doc, label) {\n    for (const [id, block] of doc.blocks.entries()) {\n        if (block.label === label) {\n            return id;\n        }\n    }\n    return undefined;\n}\n/** Get block count */\nexport function getBlockCount(doc) {\n    return doc.blocks.size;\n}\n// =============================================================================\n// EDGE MANAGEMENT\n// =============================================================================\n/** Create a new edge */\nexport function createEdge(edgeType, target, metadata = {}) {\n    return {\n        edgeType,\n        target,\n        metadata,\n        createdAt: new Date(),\n    };\n}\n/** Add an edge to a block */\nexport function addEdge(doc, sourceId, edgeType, targetId, metadata = {}) {\n    const source = doc.blocks.get(sourceId);\n    if (!source)\n        throw new Error(`Source block not found: ${sourceId}`);\n    if (!doc.blocks.has(targetId))\n        throw new Error(`Target block not found: ${targetId}`);\n    const edge = createEdge(edgeType, targetId, metadata);\n    source.edges.push(edge);\n    touchDocument(doc);\n}\n/** Remove an edge from a block */\nexport function removeEdge(doc, sourceId, edgeType, targetId) {\n    const source = doc.blocks.get(sourceId);\n    if (!source)\n        throw new Error(`Source block not found: ${sourceId}`);\n    const initialLength = source.edges.length;\n    source.edges = source.edges.filter(e => !(e.edgeType === edgeType && e.target === targetId));\n    const removed = source.edges.length < initialLength;\n    if (removed)\n        touchDocument(doc);\n    return removed;\n}\n/** Check if an edge exists */\nexport function hasEdge(doc, sourceId, targetId, edgeType) {\n    const source = doc.blocks.get(sourceId);\n    if (!source)\n        return false;\n    return source.edges.some(e => e.target === targetId && (edgeType === undefined || e.edgeType === edgeType));\n}\n/** Get outgoing edges from a block */\nexport function getOutgoingEdges(doc, sourceId) {\n    const source = doc.blocks.get(sourceId);\n    return source ? [...source.edges] : [];\n}\n/** Get incoming edges to a block */\nexport function getIncomingEdges(doc, targetId) {\n    const result = [];\n    for (const [sourceId, block] of doc.blocks.entries()) {\n        for (const edge of block.edges) {\n            if (edge.target === targetId) {\n                result.push({ source: sourceId, edge });\n            }\n        }\n    }\n    return result;\n}\n/** Touch document to update modification time and version */\nfunction touchDocument(doc) {\n    if (doc.metadata) {\n        doc.metadata.modifiedAt = new Date();\n    }\n    doc.version++;\n}\n// =============================================================================\n// VALIDATION\n// =============================================================================\n/** Default resource limits */\nexport const DEFAULT_LIMITS = {\n    maxDocumentSize: 50 * 1024 * 1024, // 50MB\n    maxBlockCount: 100_000,\n    maxBlockSize: 5 * 1024 * 1024, // 5MB\n    maxNestingDepth: 50,\n    maxEdgesPerBlock: 1000,\n};\n/** Validate a document */\nexport function validateDocument(doc, limits = DEFAULT_LIMITS) {\n    const issues = [];\n    // Check block count\n    if (doc.blocks.size > limits.maxBlockCount) {\n        issues.push({\n            severity: 'error',\n            code: 'E400',\n            message: `Document has ${doc.blocks.size} blocks, max is ${limits.maxBlockCount}`,\n        });\n    }\n    // Check for cycles\n    if (hasCycles(doc)) {\n        issues.push({\n            severity: 'error',\n            code: 'E201',\n            message: 'Document structure contains a cycle',\n        });\n    }\n    // Check nesting depth\n    const maxDepth = computeMaxDepth(doc);\n    if (maxDepth > limits.maxNestingDepth) {\n        issues.push({\n            severity: 'error',\n            code: 'E403',\n            message: `Max nesting depth is ${limits.maxNestingDepth}, document has ${maxDepth}`,\n        });\n    }\n    // Validate each block\n    for (const [id, block] of doc.blocks.entries()) {\n        const blockIssues = validateBlock(doc, block, limits);\n        issues.push(...blockIssues);\n    }\n    // Check for orphans (warning)\n    const orphans = findOrphans(doc);\n    for (const orphan of orphans) {\n        issues.push({\n            severity: 'warning',\n            code: 'E203',\n            message: `Block ${orphan} is unreachable from root`,\n            blockId: orphan,\n        });\n    }\n    const hasErrors = issues.some(i => i.severity === 'error');\n    return { valid: !hasErrors, issues };\n}\nfunction validateBlock(doc, block, limits) {\n    const issues = [];\n    // Check block size\n    const size = new TextEncoder().encode(block.content).length;\n    if (size > limits.maxBlockSize) {\n        issues.push({\n            severity: 'error',\n            code: 'E402',\n            message: `Block ${block.id} has size ${size}, max is ${limits.maxBlockSize}`,\n            blockId: block.id,\n        });\n    }\n    // Check edge count\n    if (block.edges.length > limits.maxEdgesPerBlock) {\n        issues.push({\n            severity: 'error',\n            code: 'E404',\n            message: `Block ${block.id} has ${block.edges.length} edges, max is ${limits.maxEdgesPerBlock}`,\n            blockId: block.id,\n        });\n    }\n    // Check edge targets exist\n    for (const edge of block.edges) {\n        if (!doc.blocks.has(edge.target)) {\n            issues.push({\n                severity: 'error',\n                code: 'E001',\n                message: `Block ${block.id} has edge to non-existent block ${edge.target}`,\n                blockId: block.id,\n            });\n        }\n    }\n    return issues;\n}\nfunction hasCycles(doc) {\n    const visited = new Set();\n    const recStack = new Set();\n    function dfs(nodeId) {\n        visited.add(nodeId);\n        recStack.add(nodeId);\n        const node = doc.blocks.get(nodeId);\n        if (node) {\n            for (const child of node.children) {\n                if (!visited.has(child)) {\n                    if (dfs(child))\n                        return true;\n                }\n                else if (recStack.has(child)) {\n                    return true;\n                }\n            }\n        }\n        recStack.delete(nodeId);\n        return false;\n    }\n    return dfs(doc.root);\n}\nfunction computeMaxDepth(doc) {\n    function depthFrom(nodeId, current) {\n        const node = doc.blocks.get(nodeId);\n        if (!node || node.children.length === 0)\n            return current;\n        return Math.max(...node.children.map(c => depthFrom(c, current + 1)));\n    }\n    return depthFrom(doc.root, 1);\n}\n/** Find orphaned blocks (unreachable from root) */\nexport function findOrphans(doc) {\n    const reachable = new Set([doc.root]);\n    const queue = [doc.root];\n    while (queue.length > 0) {\n        const current = queue.shift();\n        const block = doc.blocks.get(current);\n        if (block) {\n            for (const child of block.children) {\n                if (!reachable.has(child)) {\n                    reachable.add(child);\n                    queue.push(child);\n                }\n            }\n        }\n    }\n    return Array.from(doc.blocks.keys()).filter(id => !reachable.has(id));\n}\n/** Remove all orphaned blocks */\nexport function pruneOrphans(doc) {\n    const orphans = findOrphans(doc);\n    for (const id of orphans) {\n        doc.blocks.delete(id);\n    }\n    if (orphans.length > 0)\n        touchDocument(doc);\n    return orphans;\n}\n// =============================================================================\n// MARKDOWN PARSING\n// =============================================================================\n/** Parse markdown into a UCM document */\nexport function parseMarkdown(markdown) {\n    const doc = createDocument();\n    const lines = markdown.split('\\n');\n    let currentParent = doc.root;\n    const headingStack = [{ level: 0, id: doc.root }];\n    let i = 0;\n    while (i < lines.length) {\n        const line = lines[i];\n        // Skip empty lines\n        if (line.trim() === '') {\n            i++;\n            continue;\n        }\n        // Heading\n        const headingMatch = line.match(/^(#{1,6})\\s+(.+)$/);\n        if (headingMatch) {\n            const level = headingMatch[1].length;\n            const text = headingMatch[2];\n            // Find parent (closest heading with lower level)\n            while (headingStack.length > 0 && headingStack[headingStack.length - 1].level >= level) {\n                headingStack.pop();\n            }\n            currentParent = headingStack[headingStack.length - 1]?.id ?? doc.root;\n            const id = addBlock(doc, currentParent, text, {\n                role: `heading${level}`,\n            });\n            headingStack.push({ level, id });\n            currentParent = id;\n            i++;\n            continue;\n        }\n        // Code block\n        if (line.startsWith('```')) {\n            const lang = line.slice(3).trim();\n            const codeLines = [];\n            i++;\n            while (i < lines.length && !lines[i].startsWith('```')) {\n                codeLines.push(lines[i]);\n                i++;\n            }\n            addBlock(doc, currentParent, codeLines.join('\\n'), { type: 'code', role: 'code' });\n            i++; // skip closing ```\n            continue;\n        }\n        // Quote\n        if (line.startsWith('> ')) {\n            const quoteLines = [];\n            while (i < lines.length && lines[i].startsWith('> ')) {\n                quoteLines.push(lines[i].slice(2));\n                i++;\n            }\n            addBlock(doc, currentParent, quoteLines.join('\\n'), { role: 'quote' });\n            continue;\n        }\n        // List item (unordered or ordered)\n        const unorderedMatch = line.match(/^(\\s*)[-*+]\\s+(.+)$/);\n        const orderedMatch = line.match(/^(\\s*)\\d+\\.\\s+(.+)$/);\n        if (unorderedMatch || orderedMatch) {\n            const isOrdered = orderedMatch !== null;\n            const listLines = [];\n            while (i < lines.length) {\n                const uMatch = lines[i].match(/^(\\s*)[-*+]\\s+(.+)$/);\n                const oMatch = lines[i].match(/^(\\s*)\\d+\\.\\s+(.+)$/);\n                const currentMatch = uMatch || oMatch;\n                if (!currentMatch) {\n                    if (lines[i].trim() === '') {\n                        i++;\n                        break;\n                    }\n                    break;\n                }\n                const marker = uMatch ? uMatch[0].charAt(0) : '1';\n                const content = uMatch ? uMatch[2] : oMatch[2];\n                listLines.push(content);\n                i++;\n            }\n            // Preserve original list marker type\n            let content;\n            if (isOrdered) {\n                content = listLines.map((item, idx) => `${idx + 1}. ${item}`).join('\\n');\n            }\n            else {\n                content = listLines.map(item => `- ${item}`).join('\\n');\n            }\n            const id = addBlock(doc, currentParent, content, { role: 'list' });\n            // Store list type in metadata for round-trip fidelity\n            const block = doc.blocks.get(id);\n            if (block) {\n                if (!block.metadata) {\n                    block.metadata = {\n                        tags: [],\n                        createdAt: new Date(),\n                        modifiedAt: new Date(),\n                        custom: {},\n                    };\n                }\n                if (!block.metadata.custom) {\n                    block.metadata.custom = {};\n                }\n                block.metadata.custom.listType = isOrdered ? 'ordered' : 'unordered';\n            }\n            continue;\n        }\n        // Paragraph\n        const paragraphLines = [];\n        while (i < lines.length && lines[i].trim() !== '' && !lines[i].startsWith('#') && !lines[i].startsWith('```')) {\n            paragraphLines.push(lines[i]);\n            i++;\n        }\n        if (paragraphLines.length > 0) {\n            addBlock(doc, currentParent, paragraphLines.join('\\n'), { role: 'paragraph' });\n        }\n    }\n    return doc;\n}\n/** Render a document to markdown */\nexport function renderMarkdown(doc) {\n    const lines = [];\n    function renderBlock(id) {\n        const block = doc.blocks.get(id);\n        if (!block)\n            return;\n        // Skip root block content\n        if (id !== doc.root) {\n            if (block.role?.startsWith('heading')) {\n                const level = parseInt(block.role.slice(7), 10);\n                lines.push('#'.repeat(level) + ' ' + block.content);\n                lines.push('');\n            }\n            else if (block.role === 'code') {\n                lines.push('```');\n                lines.push(block.content);\n                lines.push('```');\n                lines.push('');\n            }\n            else if (block.role === 'quote') {\n                block.content.split('\\n').forEach(l => lines.push('> ' + l));\n                lines.push('');\n            }\n            else if (block.role === 'list') {\n                const listType = block.metadata?.custom?.listType ?? 'unordered';\n                // Content might already have list markers\n                if (block.content.startsWith('-') || block.content.startsWith('*') || (block.content && /^\\d+\\./.test(block.content))) {\n                    lines.push(block.content);\n                }\n                else {\n                    // Apply appropriate markers based on list type\n                    const contentLines = block.content.split('\\n');\n                    if (listType === 'ordered') {\n                        contentLines.forEach((line, idx) => lines.push(`${idx + 1}. ${line}`));\n                    }\n                    else {\n                        contentLines.forEach(line => lines.push(`- ${line}`));\n                    }\n                }\n                lines.push('');\n            }\n            else {\n                lines.push(block.content);\n                lines.push('');\n            }\n        }\n        // Render children\n        for (const childId of block.children) {\n            renderBlock(childId);\n        }\n    }\n    renderBlock(doc.root);\n    return lines.join('\\n').trim() + '\\n';\n}\n// =============================================================================\n// PROMPT BUILDER\n// =============================================================================\nconst CAPABILITY_DOCS = {\n    edit: `### EDIT - Modify block content\n\\`\\`\\`\nEDIT <block_id> SET text = \"<new_content>\"\n\\`\\`\\``,\n    append: `### APPEND - Add new blocks\n\\`\\`\\`\nAPPEND <parent_id> text :: <content>\nAPPEND <parent_id> code WITH label = \"name\" :: <content>\n\\`\\`\\``,\n    move: `### MOVE - Relocate blocks\n\\`\\`\\`\nMOVE <block_id> TO <new_parent_id>\nMOVE <block_id> BEFORE <sibling_id>\nMOVE <block_id> AFTER <sibling_id>\n\\`\\`\\``,\n    delete: `### DELETE - Remove blocks\n\\`\\`\\`\nDELETE <block_id>\nDELETE <block_id> CASCADE\n\\`\\`\\``,\n    link: `### LINK - Manage relationships\n\\`\\`\\`\nLINK <source_id> references <target_id>\nUNLINK <source_id> references <target_id>\n\\`\\`\\``,\n    snapshot: `### SNAPSHOT - Version control\n\\`\\`\\`\nSNAPSHOT CREATE \"name\"\nSNAPSHOT RESTORE \"name\"\n\\`\\`\\``,\n    transaction: `### TRANSACTION - Atomic operations\n\\`\\`\\`\nATOMIC { <commands> }\n\\`\\`\\``,\n};\n/** Fluent prompt builder for LLM agents */\nexport class PromptBuilder {\n    capabilities = new Set();\n    shortIds = false;\n    customRules = [];\n    context;\n    /** Enable EDIT capability */\n    edit() {\n        this.capabilities.add('edit');\n        return this;\n    }\n    /** Enable APPEND capability */\n    append() {\n        this.capabilities.add('append');\n        return this;\n    }\n    /** Enable MOVE capability */\n    move() {\n        this.capabilities.add('move');\n        return this;\n    }\n    /** Enable DELETE capability */\n    delete() {\n        this.capabilities.add('delete');\n        return this;\n    }\n    /** Enable LINK capability */\n    link() {\n        this.capabilities.add('link');\n        return this;\n    }\n    /** Enable SNAPSHOT capability */\n    snapshot() {\n        this.capabilities.add('snapshot');\n        return this;\n    }\n    /** Enable TRANSACTION capability */\n    transaction() {\n        this.capabilities.add('transaction');\n        return this;\n    }\n    /** Enable all capabilities */\n    all() {\n        Object.keys(CAPABILITY_DOCS).forEach(c => this.capabilities.add(c));\n        return this;\n    }\n    /** Use short numeric IDs (1, 2, 3) instead of full block IDs */\n    withShortIds() {\n        this.shortIds = true;\n        return this;\n    }\n    /** Add a custom rule */\n    withRule(rule) {\n        this.customRules.push(rule);\n        return this;\n    }\n    /** Add context to the prompt */\n    withContext(ctx) {\n        this.context = ctx;\n        return this;\n    }\n    /** Build the system prompt */\n    build() {\n        const caps = Array.from(this.capabilities);\n        if (caps.length === 0) {\n            throw new Error('At least one capability must be enabled');\n        }\n        const parts = [];\n        // Header\n        parts.push('You are a UCL (Unified Content Language) command generator.');\n        parts.push('Generate valid UCL commands to manipulate documents.');\n        parts.push('');\n        // Context\n        if (this.context) {\n            parts.push(this.context);\n            parts.push('');\n        }\n        // Command reference\n        parts.push('## UCL Commands');\n        parts.push('');\n        for (const cap of caps) {\n            parts.push(CAPABILITY_DOCS[cap]);\n            parts.push('');\n        }\n        // Rules\n        parts.push('## Rules');\n        parts.push('1. Output ONLY UCL commands, no explanations');\n        parts.push('2. Use exact block IDs as provided');\n        parts.push('3. String values must be quoted');\n        if (this.shortIds) {\n            parts.push('4. Block IDs are short numbers (1, 2, 3, etc.)');\n        }\n        else {\n            parts.push('4. Block IDs have format: blk_XXXXXXXXXXXX');\n        }\n        // Custom rules\n        this.customRules.forEach((rule, i) => {\n            parts.push(`${5 + i}. ${rule}`);\n        });\n        return parts.join('\\n');\n    }\n    /** Build a complete prompt with document and task */\n    buildPrompt(documentDescription, task) {\n        return `${documentDescription}\n\n## Task\n${task}\n\nGenerate the UCL command:`;\n    }\n}\n/** Create a new prompt builder */\nexport function prompt() {\n    return new PromptBuilder();\n}\n// =============================================================================\n// ID MAPPER\n// =============================================================================\n/** Maps long block IDs to short numbers for token efficiency */\nexport class IdMapper {\n    toShort = new Map();\n    toLong = new Map();\n    nextId = 1;\n    /** Create a mapper from a document */\n    static fromDocument(doc) {\n        const mapper = new IdMapper();\n        // Add root first\n        mapper.register(doc.root);\n        // Add all blocks in sorted order for determinism\n        const ids = Array.from(doc.blocks.keys()).sort();\n        for (const id of ids) {\n            if (id !== doc.root) {\n                mapper.register(id);\n            }\n        }\n        return mapper;\n    }\n    /** Register a block ID */\n    register(id) {\n        if (this.toShort.has(id)) {\n            return this.toShort.get(id);\n        }\n        const shortId = this.nextId++;\n        this.toShort.set(id, shortId);\n        this.toLong.set(shortId, id);\n        return shortId;\n    }\n    /** Get short ID for a block */\n    getShort(id) {\n        return this.toShort.get(id);\n    }\n    /** Get long ID from short */\n    getLong(shortId) {\n        return this.toLong.get(shortId);\n    }\n    /** Shorten all block IDs in text */\n    shorten(text) {\n        let result = text;\n        // Process longer IDs first to avoid partial matches\n        const entries = Array.from(this.toShort.entries())\n            .sort((a, b) => b[0].length - a[0].length);\n        for (const [longId, shortId] of entries) {\n            result = result.replaceAll(longId, shortId.toString());\n        }\n        return result;\n    }\n    /** Expand short IDs back to long IDs in UCL commands */\n    expand(ucl) {\n        let result = ucl;\n        // Match UCL command patterns with numbers\n        const patterns = [\n            /\\b(EDIT|APPEND|MOVE|DELETE|LINK|UNLINK|TO|BEFORE|AFTER)\\s+(\\d+)/g,\n            /\\b(references|elaborates|summarizes|supports|requires)\\s+(\\d+)/g,\n        ];\n        for (const pattern of patterns) {\n            result = result.replace(pattern, (match, prefix, num) => {\n                const longId = this.toLong.get(parseInt(num, 10));\n                return longId ? `${prefix} ${longId}` : match;\n            });\n        }\n        return result;\n    }\n    /** Generate a normalized document description with structure and blocks */\n    describe(doc) {\n        const lines = ['Document structure:'];\n        // Collect all block IDs in BFS order\n        const allBlocks = [];\n        const queue = [doc.root];\n        while (queue.length > 0) {\n            const blockId = queue.shift();\n            allBlocks.push(blockId);\n            const block = doc.blocks.get(blockId);\n            if (block) {\n                queue.push(...block.children);\n            }\n        }\n        // Document structure section: parent: child1 child2 ...\n        for (const blockId of allBlocks) {\n            const shortId = this.toShort.get(blockId);\n            const block = doc.blocks.get(blockId);\n            const children = block?.children ?? [];\n            if (children.length > 0) {\n                const childIds = children.map(c => this.toShort.get(c)).join(' ');\n                lines.push(`${shortId}: ${childIds}`);\n            }\n            else {\n                lines.push(`${shortId}:`);\n            }\n        }\n        // Blocks section\n        lines.push('');\n        lines.push('Blocks:');\n        for (const blockId of allBlocks) {\n            const block = doc.blocks.get(blockId);\n            if (!block)\n                continue;\n            const shortId = this.toShort.get(blockId);\n            const contentType = block.type ?? 'text';\n            // Escape content for display\n            const escapedContent = block.content\n                .replace(/\\\\/g, '\\\\\\\\')\n                .replace(/\"/g, '\\\\\"')\n                .replace(/\\n/g, '\\\\n');\n            lines.push(`${shortId} type=${contentType} content=\"${escapedContent}\"`);\n        }\n        return lines.join('\\n');\n    }\n    /** Get the mapping table (for debugging) */\n    getMappings() {\n        return Array.from(this.toLong.entries())\n            .map(([short, long]) => ({ short, long }))\n            .sort((a, b) => a.short - b.short);\n    }\n}\n/** Create an ID mapper from a document */\nexport function mapIds(doc) {\n    return IdMapper.fromDocument(doc);\n}\n// =============================================================================\n// UCL BUILDER\n// =============================================================================\n/** Fluent builder for UCL commands */\nexport class UclBuilder {\n    commands = [];\n    /** Add an EDIT command */\n    edit(blockId, content) {\n        this.commands.push(`EDIT ${blockId} SET text = \"${this.escape(content)}\"`);\n        return this;\n    }\n    /** Add an APPEND command */\n    append(parentId, content, options) {\n        const type = options?.type ?? 'text';\n        const label = options?.label ? ` WITH label = \"${options.label}\"` : '';\n        this.commands.push(`APPEND ${parentId} ${type}${label} :: ${content}`);\n        return this;\n    }\n    /** Add a MOVE command */\n    moveTo(blockId, newParent) {\n        this.commands.push(`MOVE ${blockId} TO ${newParent}`);\n        return this;\n    }\n    /** Add a MOVE BEFORE command */\n    moveBefore(blockId, sibling) {\n        this.commands.push(`MOVE ${blockId} BEFORE ${sibling}`);\n        return this;\n    }\n    /** Add a MOVE AFTER command */\n    moveAfter(blockId, sibling) {\n        this.commands.push(`MOVE ${blockId} AFTER ${sibling}`);\n        return this;\n    }\n    /** Add a DELETE command */\n    delete(blockId, cascade = false) {\n        this.commands.push(`DELETE ${blockId}${cascade ? ' CASCADE' : ''}`);\n        return this;\n    }\n    /** Add a LINK command */\n    link(source, edgeType, target) {\n        this.commands.push(`LINK ${source} ${edgeType} ${target}`);\n        return this;\n    }\n    /** Wrap all commands in ATOMIC block */\n    atomic() {\n        if (this.commands.length > 0) {\n            const inner = this.commands.map(c => '  ' + c).join('\\n');\n            this.commands = [`ATOMIC {\\n${inner}\\n}`];\n        }\n        return this;\n    }\n    /** Build the final UCL string */\n    build() {\n        return this.commands.join('\\n');\n    }\n    /** Get commands as array */\n    toArray() {\n        return [...this.commands];\n    }\n    escape(s) {\n        return s.replace(/\"/g, '\\\\\"').replace(/\\n/g, '\\\\n');\n    }\n}\n/** Create a new UCL builder */\nexport function ucl() {\n    return new UclBuilder();\n}\n/** Serialize a document to JSON string */\nexport function serializeDocument(doc) {\n    const serializable = {\n        id: doc.id,\n        root: doc.root,\n        blocks: Array.from(doc.blocks.entries()).map(([id, block]) => [id, {\n                ...block,\n                edges: block.edges.map(e => ({ ...e, createdAt: e.createdAt.toISOString() })),\n            }]),\n        metadata: doc.metadata ? {\n            ...doc.metadata,\n            createdAt: doc.metadata.createdAt.toISOString(),\n            modifiedAt: doc.metadata.modifiedAt.toISOString(),\n        } : undefined,\n        version: doc.version,\n    };\n    return JSON.stringify(serializable);\n}\n/** Deserialize a document from JSON string */\nexport function deserializeDocument(data) {\n    const parsed = JSON.parse(data);\n    const blocks = new Map();\n    for (const [id, blockData] of parsed.blocks) {\n        blocks.set(id, {\n            ...blockData,\n            edges: blockData.edges.map((e) => ({\n                ...e,\n                createdAt: new Date(e.createdAt),\n            })),\n        });\n    }\n    return {\n        id: parsed.id,\n        root: parsed.root,\n        blocks,\n        metadata: parsed.metadata ? {\n            ...parsed.metadata,\n            createdAt: new Date(parsed.metadata.createdAt),\n            modifiedAt: new Date(parsed.metadata.modifiedAt),\n        } : undefined,\n        version: parsed.version,\n    };\n}\n/** Snapshot manager for document versioning */\nexport class SnapshotManager {\n    snapshots = new Map();\n    maxSnapshots;\n    constructor(maxSnapshots = 100) {\n        this.maxSnapshots = maxSnapshots;\n    }\n    /** Create a snapshot of the document */\n    create(name, doc, description) {\n        if (this.snapshots.size >= this.maxSnapshots) {\n            this.evictOldest();\n        }\n        const snapshot = {\n            id: name,\n            description,\n            createdAt: new Date(),\n            documentVersion: doc.version,\n            data: serializeDocument(doc),\n        };\n        this.snapshots.set(name, snapshot);\n        return name;\n    }\n    /** Restore a document from a snapshot */\n    restore(name) {\n        const snapshot = this.snapshots.get(name);\n        if (!snapshot)\n            throw new Error(`Snapshot not found: ${name}`);\n        return deserializeDocument(snapshot.data);\n    }\n    /** Get a snapshot by name */\n    get(name) {\n        return this.snapshots.get(name);\n    }\n    /** Get snapshot info without loading full data */\n    getInfo(name) {\n        const snapshot = this.snapshots.get(name);\n        if (!snapshot)\n            return undefined;\n        // Count blocks from serialized data\n        let blockCount = 0;\n        try {\n            const parsed = JSON.parse(snapshot.data);\n            blockCount = Object.keys(parsed.blocks ?? {}).length;\n        }\n        catch {\n            blockCount = 0;\n        }\n        return {\n            id: snapshot.id,\n            description: snapshot.description,\n            createdAt: snapshot.createdAt,\n            documentVersion: snapshot.documentVersion,\n            blockCount,\n        };\n    }\n    /** List all snapshots (newest first) */\n    list() {\n        return Array.from(this.snapshots.values())\n            .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n    }\n    /** Delete a snapshot */\n    delete(name) {\n        return this.snapshots.delete(name);\n    }\n    /** Check if a snapshot exists */\n    exists(name) {\n        return this.snapshots.has(name);\n    }\n    /** Get snapshot count */\n    count() {\n        return this.snapshots.size;\n    }\n    evictOldest() {\n        let oldest;\n        for (const snapshot of this.snapshots.values()) {\n            if (!oldest || snapshot.createdAt < oldest.createdAt) {\n                oldest = snapshot;\n            }\n        }\n        if (oldest)\n            this.snapshots.delete(oldest.id);\n    }\n}\n/** Transaction for atomic operations */\nexport class Transaction {\n    id;\n    name;\n    _state = 'active';\n    _startTime;\n    _timeout;\n    _initialState;\n    _doc;\n    _savepoints = new Map();\n    _operationCount = 0;\n    constructor(doc, timeoutMs = 30000, name) {\n        this.id = name ?? `txn_${Date.now().toString(16)}`;\n        this.name = name;\n        this._doc = doc;\n        this._startTime = Date.now();\n        this._timeout = timeoutMs;\n        this._initialState = serializeDocument(doc);\n    }\n    get state() {\n        if (this._state === 'active' && this.isTimedOut()) {\n            this._state = 'timed_out';\n        }\n        return this._state;\n    }\n    isActive() {\n        return this.state === 'active';\n    }\n    isTimedOut() {\n        return Date.now() - this._startTime > this._timeout;\n    }\n    elapsedMs() {\n        return Date.now() - this._startTime;\n    }\n    operationCount() {\n        return this._operationCount;\n    }\n    /** Create a savepoint for partial rollback */\n    savepoint(name) {\n        if (!this.isActive()) {\n            throw new Error(`Cannot create savepoint in ${this._state} transaction`);\n        }\n        this._savepoints.set(name, {\n            name,\n            operationIndex: this._operationCount,\n            documentState: serializeDocument(this._doc),\n            createdAt: new Date(),\n        });\n    }\n    /** Rollback to a named savepoint */\n    rollbackToSavepoint(name) {\n        if (!this.isActive()) {\n            throw new Error(`Cannot rollback to savepoint in ${this._state} transaction`);\n        }\n        const savepoint = this._savepoints.get(name);\n        if (!savepoint) {\n            throw new Error(`Savepoint not found: ${name}`);\n        }\n        // Restore document state\n        const restored = deserializeDocument(savepoint.documentState);\n        this._doc.blocks = restored.blocks;\n        this._doc.metadata = restored.metadata;\n        this._doc.version = restored.version;\n        // Note: In JS we don't track individual operations, so we can't trim them\n        // The operation count stays the same, but document state is restored\n    }\n    /** Get a savepoint by name */\n    getSavepoint(name) {\n        return this._savepoints.get(name);\n    }\n    commit() {\n        if (!this.isActive()) {\n            throw new Error(`Cannot commit ${this._state} transaction`);\n        }\n        this._state = 'committed';\n    }\n    rollback() {\n        if (this._state === 'committed') {\n            throw new Error('Cannot rollback a committed transaction');\n        }\n        // Restore initial state\n        const restored = deserializeDocument(this._initialState);\n        this._doc.blocks = restored.blocks;\n        this._doc.metadata = restored.metadata;\n        this._doc.version = restored.version;\n        this._state = 'rolled_back';\n    }\n}\n/** Transaction manager */\nexport class TransactionManager {\n    transactions = new Map();\n    defaultTimeout;\n    constructor(defaultTimeoutMs = 30000) {\n        this.defaultTimeout = defaultTimeoutMs;\n    }\n    begin(doc, name, timeoutMs) {\n        const txn = new Transaction(doc, timeoutMs ?? this.defaultTimeout, name);\n        this.transactions.set(txn.id, txn);\n        return txn;\n    }\n    get(id) {\n        return this.transactions.get(id);\n    }\n    commit(id) {\n        const txn = this.transactions.get(id);\n        if (!txn)\n            throw new Error(`Transaction not found: ${id}`);\n        txn.commit();\n    }\n    rollback(id) {\n        const txn = this.transactions.get(id);\n        if (!txn)\n            throw new Error(`Transaction not found: ${id}`);\n        txn.rollback();\n    }\n    activeCount() {\n        return Array.from(this.transactions.values()).filter(t => t.isActive()).length;\n    }\n    cleanup() {\n        const toRemove = [];\n        for (const [id, txn] of this.transactions) {\n            if (!txn.isActive())\n                toRemove.push(id);\n        }\n        toRemove.forEach(id => this.transactions.delete(id));\n        return toRemove.length;\n    }\n}\n// =============================================================================\n// UCL EXECUTOR\n// =============================================================================\n/** UCL execution error */\nexport class UclExecutionError extends Error {\n    command;\n    constructor(message, command) {\n        super(command ? `[${command}] ${message}` : message);\n        this.command = command;\n        this.name = 'UclExecutionError';\n    }\n}\n/** UCL parse error */\nexport class UclParseError extends Error {\n    line;\n    constructor(message, line) {\n        super(line !== undefined ? `Line ${line}: ${message}` : message);\n        this.line = line;\n        this.name = 'UclParseError';\n    }\n}\n/** Execute UCL commands on a document */\nexport function executeUcl(doc, uclText) {\n    const affectedBlocks = [];\n    const lines = extractUclLines(uclText);\n    for (let i = 0; i < lines.length; i++) {\n        const line = lines[i];\n        try {\n            const result = executeUclLine(doc, line);\n            affectedBlocks.push(...result);\n        }\n        catch (e) {\n            if (e instanceof Error) {\n                throw new UclExecutionError(e.message, line);\n            }\n            throw e;\n        }\n    }\n    return affectedBlocks;\n}\nfunction extractUclLines(ucl) {\n    const lines = [];\n    let atomicDepth = 0;\n    for (const raw of ucl.split('\\n')) {\n        const stripped = raw.trim();\n        if (!stripped || stripped.startsWith('#'))\n            continue;\n        if (stripped.toUpperCase() === 'ATOMIC {') {\n            atomicDepth++;\n            continue;\n        }\n        if (stripped === '}' && atomicDepth > 0) {\n            atomicDepth--;\n            continue;\n        }\n        lines.push(stripped);\n    }\n    return lines;\n}\nfunction executeUclLine(doc, line) {\n    const upper = line.toUpperCase();\n    if (upper.startsWith('EDIT ')) {\n        return executeEdit(doc, line);\n    }\n    else if (upper.startsWith('APPEND ')) {\n        return executeAppend(doc, line);\n    }\n    else if (upper.startsWith('MOVE ')) {\n        return executeMove(doc, line);\n    }\n    else if (upper.startsWith('DELETE ')) {\n        return executeDelete(doc, line);\n    }\n    else if (upper.startsWith('LINK ')) {\n        return executeLink(doc, line);\n    }\n    else if (upper.startsWith('UNLINK ')) {\n        return executeUnlink(doc, line);\n    }\n    else if (upper.startsWith('PRUNE')) {\n        return executePrune(doc, line);\n    }\n    else {\n        throw new UclParseError(`Unknown command: ${line}`);\n    }\n}\nfunction executeEdit(doc, line) {\n    const match = line.match(/^EDIT\\s+(\\S+)\\s+SET\\s+(\\S+)\\s*=\\s*\"((?:\\\\.|[^\"])*)\"/i);\n    if (!match)\n        throw new UclParseError(`Malformed EDIT command: ${line}`);\n    const [, blockId, path, value] = match;\n    const unescaped = value.replace(/\\\\(.)/g, '$1');\n    if (!doc.blocks.has(blockId)) {\n        throw new UclExecutionError(`Block not found: ${blockId}`);\n    }\n    if (path.toLowerCase() === 'text') {\n        editBlock(doc, blockId, unescaped);\n    }\n    else {\n        throw new UclExecutionError(`Unsupported edit path: ${path}`);\n    }\n    return [blockId];\n}\nfunction executeAppend(doc, line) {\n    const match = line.match(/^APPEND\\s+(\\S+)\\s+(\\w+)(?:\\s+WITH\\s+([^:]+))?\\s*::\\s*(.+)$/i);\n    if (!match)\n        throw new UclParseError(`Malformed APPEND command: ${line}`);\n    const [, parentId, contentType, propsStr, content] = match;\n    if (!doc.blocks.has(parentId)) {\n        throw new UclExecutionError(`Parent block not found: ${parentId}`);\n    }\n    const props = {};\n    if (propsStr) {\n        const propMatches = propsStr.matchAll(/(\\w+)\\s*=\\s*\"([^\"]*)\"/g);\n        for (const m of propMatches) {\n            props[m[1].toLowerCase()] = m[2];\n        }\n    }\n    const newId = addBlock(doc, parentId, content, {\n        type: contentType.toLowerCase(),\n        role: props.role,\n        label: props.label,\n    });\n    return [newId];\n}\nfunction executeMove(doc, line) {\n    const match = line.match(/^MOVE\\s+(\\S+)\\s+(TO|BEFORE|AFTER)\\s+(\\S+)(?:\\s+INDEX\\s+(\\d+))?$/i);\n    if (!match)\n        throw new UclParseError(`Malformed MOVE command: ${line}`);\n    const [, blockId, mode, targetId, indexStr] = match;\n    const index = indexStr ? parseInt(indexStr, 10) : undefined;\n    if (!doc.blocks.has(blockId)) {\n        throw new UclExecutionError(`Block not found: ${blockId}`);\n    }\n    if (!doc.blocks.has(targetId)) {\n        throw new UclExecutionError(`Target block not found: ${targetId}`);\n    }\n    if (mode.toUpperCase() === 'TO') {\n        moveBlock(doc, blockId, targetId, index);\n    }\n    else {\n        const parentId = findParent(doc, targetId);\n        if (!parentId)\n            throw new UclExecutionError(`Target ${targetId} has no parent`);\n        const parent = doc.blocks.get(parentId);\n        const siblingIndex = parent.children.indexOf(targetId);\n        if (siblingIndex === -1) {\n            throw new UclExecutionError(`Target ${targetId} not found in parent's children`);\n        }\n        const insertIndex = mode.toUpperCase() === 'AFTER' ? siblingIndex + 1 : siblingIndex;\n        moveBlock(doc, blockId, parentId, insertIndex);\n    }\n    return [blockId];\n}\nfunction executeDelete(doc, line) {\n    const match = line.match(/^DELETE\\s+(\\S+)(\\s+CASCADE)?$/i);\n    if (!match)\n        throw new UclParseError(`Malformed DELETE command: ${line}`);\n    const [, blockId, cascade] = match;\n    if (!doc.blocks.has(blockId)) {\n        throw new UclExecutionError(`Block not found: ${blockId}`);\n    }\n    deleteBlock(doc, blockId, { cascade: !!cascade });\n    return [blockId];\n}\nfunction executeLink(doc, line) {\n    const match = line.match(/^LINK\\s+(\\S+)\\s+(\\w+)\\s+(\\S+)$/i);\n    if (!match)\n        throw new UclParseError(`Malformed LINK command: ${line}`);\n    const [, sourceId, edgeTypeStr, targetId] = match;\n    if (!doc.blocks.has(sourceId)) {\n        throw new UclExecutionError(`Source block not found: ${sourceId}`);\n    }\n    if (!doc.blocks.has(targetId)) {\n        throw new UclExecutionError(`Target block not found: ${targetId}`);\n    }\n    addEdge(doc, sourceId, edgeTypeStr.toLowerCase(), targetId);\n    return [sourceId, targetId];\n}\nfunction executeUnlink(doc, line) {\n    const match = line.match(/^UNLINK\\s+(\\S+)\\s+(\\w+)\\s+(\\S+)$/i);\n    if (!match)\n        throw new UclParseError(`Malformed UNLINK command: ${line}`);\n    const [, sourceId, edgeTypeStr, targetId] = match;\n    if (!doc.blocks.has(sourceId)) {\n        throw new UclExecutionError(`Source block not found: ${sourceId}`);\n    }\n    removeEdge(doc, sourceId, edgeTypeStr.toLowerCase(), targetId);\n    return [sourceId, targetId];\n}\nfunction executePrune(doc, _line) {\n    return pruneOrphans(doc);\n}\n/** Simple event bus for observability */\nexport class EventBus {\n    static instance;\n    handlers = new Map();\n    globalHandlers = [];\n    static getInstance() {\n        if (!EventBus.instance) {\n            EventBus.instance = new EventBus();\n        }\n        return EventBus.instance;\n    }\n    subscribe(eventType, handler) {\n        const handlers = this.handlers.get(eventType) ?? [];\n        handlers.push(handler);\n        this.handlers.set(eventType, handlers);\n    }\n    subscribeAll(handler) {\n        this.globalHandlers.push(handler);\n    }\n    unsubscribe(eventType, handler) {\n        const handlers = this.handlers.get(eventType) ?? [];\n        this.handlers.set(eventType, handlers.filter(h => h !== handler));\n    }\n    unsubscribeAll(handler) {\n        this.globalHandlers = this.globalHandlers.filter(h => h !== handler);\n    }\n    publish(event) {\n        const handlers = this.handlers.get(event.type) ?? [];\n        handlers.forEach(h => {\n            try {\n                h(event);\n            }\n            catch (e) {\n                console.error('Event handler error:', e);\n            }\n        });\n        this.globalHandlers.forEach(h => {\n            try {\n                h(event);\n            }\n            catch (e) {\n                console.error('Global handler error:', e);\n            }\n        });\n    }\n    clear() {\n        this.handlers.clear();\n        this.globalHandlers = [];\n    }\n}\n/** Emit an event to the global event bus */\nexport function emitEvent(type, data = {}) {\n    EventBus.getInstance().publish({\n        type,\n        timestamp: new Date(),\n        data,\n    });\n}\n/** Simple metrics collector */\nexport class Metrics {\n    static instance;\n    counters = new Map();\n    gauges = new Map();\n    histograms = new Map();\n    static getInstance() {\n        if (!Metrics.instance) {\n            Metrics.instance = new Metrics();\n        }\n        return Metrics.instance;\n    }\n    increment(name, value = 1) {\n        this.counters.set(name, (this.counters.get(name) ?? 0) + value);\n    }\n    setGauge(name, value) {\n        this.gauges.set(name, value);\n    }\n    recordHistogram(name, value) {\n        const values = this.histograms.get(name) ?? [];\n        values.push(value);\n        this.histograms.set(name, values);\n    }\n    getCounter(name) {\n        return this.counters.get(name) ?? 0;\n    }\n    getGauge(name) {\n        return this.gauges.get(name);\n    }\n    getHistogram(name) {\n        return [...(this.histograms.get(name) ?? [])];\n    }\n    getAll() {\n        return {\n            counters: Object.fromEntries(this.counters),\n            gauges: Object.fromEntries(this.gauges),\n            histograms: Object.fromEntries(this.histograms),\n        };\n    }\n    reset() {\n        this.counters.clear();\n        this.gauges.clear();\n        this.histograms.clear();\n    }\n}\n// =============================================================================\n// MAIN API - Simple unified interface\n// =============================================================================\n/** Main UCP API - simple, unified interface */\nexport const ucp = {\n    /** Parse markdown into a document */\n    parse: parseMarkdown,\n    /** Render document to markdown */\n    render: renderMarkdown,\n    /** Execute UCL commands */\n    execute: executeUcl,\n    /** Validate a document */\n    validate: validateDocument,\n    /** Create an empty document */\n    create: createDocument,\n    /** Create a prompt builder */\n    prompt,\n    /** Create an ID mapper from a document */\n    mapIds,\n    /** Create a UCL command builder */\n    ucl,\n};\nexport default ucp;\n// =============================================================================\n// SECTION OPERATIONS\n// =============================================================================\nexport { writeSection, findSectionByPath, getAllSections, clearSectionWithUndo, restoreDeletedSection, } from './section.js';\n// =============================================================================\n// TRAVERSAL\n// =============================================================================\nexport { TraversalEngine, traverse, pathToRoot, expand, } from './traversal.js';\n// =============================================================================\n// CONTEXT MANAGEMENT\n// =============================================================================\nexport { ContextWindow, ContextManager, createContext, } from './context.js';\n// =============================================================================\n// EDGE INDEX\n// =============================================================================\nexport { EdgeIndex } from './edge_index.js';\n//# sourceMappingURL=index.js.map","/**\n * EditorStore - Core state management for UCM Editor.\n *\n * Uses a simple observable store pattern with immutable updates.\n * Implements SOLID principles with clear separation of concerns.\n */\n\nimport type { BlockId, Document, ContentType, EdgeType } from 'ucp-content'\nimport {\n  createDocument as createUcpDocument,\n  addBlock as addUcpBlock,\n  editBlock as editUcpBlock,\n  moveBlock as moveUcpBlock,\n  deleteBlock as deleteUcpBlock,\n  addEdge as addUcpEdge,\n  removeEdge as removeUcpEdge,\n  serializeDocument,\n  SnapshotManager,\n  validateDocument,\n} from 'ucp-content'\n\nimport type {\n  EditorStoreState,\n  EditorStore,\n  EditorView,\n  EditorMode,\n  SelectionState,\n  DragState,\n  GraphViewState,\n  DiffViewState,\n  HistoryState,\n  HistoryEntry,\n  HistoryOperation,\n  EditorConfig,\n  GraphLayout,\n} from '../types/editor.js'\nimport { DEFAULT_EDITOR_CONFIG } from '../types/editor.js'\nimport { Errors, EditorError } from '../types/errors.js'\nimport type { EditorEventEmitter, EditorEventData } from '../types/events.js'\nimport { SimpleEventEmitter } from '../types/events.js'\nimport { Logger } from './Logger.js'\n\n// =============================================================================\n// INITIAL STATE\n// =============================================================================\n\nfunction createInitialSelection(): SelectionState {\n  return {\n    type: 'none',\n  }\n}\n\nfunction createInitialDragState(): DragState {\n  return {\n    isDragging: false,\n  }\n}\n\nfunction createInitialGraphState(): GraphViewState {\n  return {\n    layout: 'hierarchical',\n    nodes: new Map(),\n    edges: [],\n    viewport: { x: 0, y: 0, zoom: 1 },\n    selectedNodeId: undefined,\n    hoveredNodeId: undefined,\n    showEdgeLabels: true,\n    edgeFilter: [],\n  }\n}\n\nfunction createInitialDiffState(): DiffViewState {\n  return {\n    isComparing: false,\n    leftSnapshotId: undefined,\n    rightSnapshotId: undefined,\n    diff: undefined,\n    selectedChangeId: undefined,\n    showUnchanged: false,\n    viewMode: 'unified',\n  }\n}\n\nfunction createInitialHistoryState(maxEntries: number): HistoryState {\n  return {\n    entries: [],\n    currentIndex: -1,\n    maxEntries,\n    canUndo: false,\n    canRedo: false,\n  }\n}\n\nfunction createInitialState(config: EditorConfig): EditorStoreState {\n  return {\n    document: null,\n    documentId: null,\n    isLoading: false,\n    isDirty: false,\n    lastSaved: undefined,\n    view: 'document',\n    mode: 'view',\n    selection: createInitialSelection(),\n    editingBlockId: null,\n    editState: 'idle',\n    pendingContent: null,\n    drag: createInitialDragState(),\n    graph: createInitialGraphState(),\n    diff: createInitialDiffState(),\n    history: createInitialHistoryState(config.maxHistoryEntries),\n    config,\n    lastError: null,\n  }\n}\n\n// =============================================================================\n// STORE SUBSCRIBER\n// =============================================================================\n\ntype StoreListener = (state: EditorStoreState, prevState: EditorStoreState) => void\n\n// =============================================================================\n// EDITOR STORE IMPLEMENTATION\n// =============================================================================\n\n/**\n * Create an editor store instance.\n *\n * @example\n * ```typescript\n * const store = createEditorStore()\n *\n * // Subscribe to state changes\n * const unsubscribe = store.subscribe((state, prevState) => {\n *   console.log('State changed:', state)\n * })\n *\n * // Load a document\n * store.loadDocument(myDocument)\n *\n * // Edit a block\n * store.startEditing('blk_123')\n * store.updatePendingContent('New content')\n * store.stopEditing(true) // save\n *\n * // Undo\n * store.undo()\n * ```\n */\nexport function createEditorStore(\n  initialConfig: Partial<EditorConfig> = {}\n): EditorStore & {\n  subscribe: (listener: StoreListener) => () => void\n  getState: () => EditorStoreState\n  events: EditorEventEmitter\n} {\n  const config = { ...DEFAULT_EDITOR_CONFIG, ...initialConfig }\n  const logger = new Logger({ context: 'EditorStore', level: config.logLevel })\n  const events: EditorEventEmitter = new SimpleEventEmitter()\n  const snapshotManager = new SnapshotManager(config.maxHistoryEntries)\n\n  let state = createInitialState(config)\n  const listeners = new Set<StoreListener>()\n\n  // ==========================================================================\n  // STATE MANAGEMENT\n  // ==========================================================================\n\n  function setState(updater: Partial<EditorStoreState> | ((s: EditorStoreState) => Partial<EditorStoreState>)): void {\n    const prevState = state\n    const updates = typeof updater === 'function' ? updater(state) : updater\n    state = { ...state, ...updates }\n\n    listeners.forEach((listener) => {\n      try {\n        listener(state, prevState)\n      } catch (error) {\n        logger.error('Listener error', error instanceof Error ? error : undefined)\n      }\n    })\n  }\n\n  function emitEvent(type: Parameters<typeof events.emit>[0], data: EditorEventData): void {\n    events.emit(type, data)\n  }\n\n  function handleError(error: Error | EditorError): void {\n    logger.error(error.message, error)\n    setState({ lastError: error })\n    if (error instanceof EditorError) {\n      emitEvent('error:occurred', {\n        code: error.code,\n        message: error.message,\n        category: error.category,\n        severity: error.severity,\n        data: error.data as Record<string, unknown>,\n      })\n    }\n  }\n\n  // ==========================================================================\n  // HISTORY HELPERS\n  // ==========================================================================\n\n  function pushHistory(description: string, operations: HistoryOperation[]): void {\n    if (!state.document) return\n\n    const snapshotId = `snapshot_${Date.now()}`\n    snapshotManager.create(snapshotId, state.document, description)\n\n    const entry: HistoryEntry = {\n      id: `entry_${Date.now()}`,\n      timestamp: new Date(),\n      description,\n      snapshotId,\n      operations,\n    }\n\n    const newEntries = [...state.history.entries.slice(0, state.history.currentIndex + 1), entry]\n    if (newEntries.length > state.history.maxEntries) {\n      newEntries.shift()\n    }\n\n    setState({\n      history: {\n        ...state.history,\n        entries: newEntries,\n        currentIndex: newEntries.length - 1,\n        canUndo: newEntries.length > 0,\n        canRedo: false,\n      },\n      isDirty: true,\n    })\n\n    emitEvent('history:snapshot_created', {\n      entryId: entry.id,\n      description,\n      snapshotId,\n      operationCount: operations.length,\n    })\n  }\n\n  // ==========================================================================\n  // DOCUMENT OPERATIONS\n  // ==========================================================================\n\n  function loadDocument(doc: Document): void {\n    logger.info('Loading document', { documentId: doc.id, blockCount: doc.blocks.size })\n\n    setState({\n      document: doc,\n      documentId: doc.id,\n      isLoading: false,\n      isDirty: false,\n      selection: createInitialSelection(),\n      editingBlockId: null,\n      editState: 'idle',\n      pendingContent: null,\n      history: createInitialHistoryState(state.config.maxHistoryEntries),\n      lastError: null,\n    })\n\n    // Create initial snapshot\n    snapshotManager.create('initial', doc, 'Initial state')\n\n    emitEvent('document:loaded', {\n      documentId: doc.id,\n      title: doc.metadata?.title,\n      blockCount: doc.blocks.size,\n      version: doc.version,\n    })\n  }\n\n  function createDocument(title?: string): void {\n    logger.info('Creating new document', { title })\n    const doc = createUcpDocument(title)\n    loadDocument(doc)\n    emitEvent('document:created', {\n      documentId: doc.id,\n      title,\n    })\n  }\n\n  async function saveDocument(): Promise<void> {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    logger.info('Saving document', { documentId: state.documentId })\n    setState({ isLoading: true })\n\n    try {\n      // Validate before saving\n      const validation = validateDocument(state.document)\n      if (!validation.valid) {\n        const errors = validation.issues.filter((i) => i.severity === 'error')\n        if (errors.length > 0) {\n          throw new EditorError({\n            code: 'UCM_E071',\n            message: 'Document validation failed',\n            category: 'document',\n            data: { validationErrors: errors.map((e) => e.message) },\n          })\n        }\n      }\n\n      // In a real implementation, this would persist to storage\n      // For now, we just update the state\n      setState({\n        isLoading: false,\n        isDirty: false,\n        lastSaved: new Date(),\n      })\n\n      emitEvent('document:saved', {\n        documentId: state.documentId!,\n        version: state.document.version,\n      })\n    } catch (error) {\n      setState({ isLoading: false })\n      handleError(error instanceof Error ? error : Errors.internalError(String(error)))\n      throw error\n    }\n  }\n\n  // ==========================================================================\n  // VIEW OPERATIONS\n  // ==========================================================================\n\n  function setView(view: EditorView): void {\n    const previousView = state.view\n    logger.debug('Setting view', { view, previousView })\n    setState({ view })\n    emitEvent('view:changed', { view, previousView })\n  }\n\n  function setMode(mode: EditorMode): void {\n    const previousMode = state.mode\n    logger.debug('Setting mode', { mode, previousMode })\n    setState({ mode })\n    emitEvent('mode:changed', { mode, previousMode })\n  }\n\n  // ==========================================================================\n  // BLOCK OPERATIONS\n  // ==========================================================================\n\n  function addBlock(parentId: BlockId, content: string, type?: ContentType): BlockId {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    logger.debug('Adding block', { parentId, contentLength: content.length, type })\n\n    const id = addUcpBlock(state.document, parentId, content, { type })\n\n    pushHistory(`Add block`, [{ type: 'add_block', blockId: id, data: { parentId, content, type } }])\n\n    emitEvent('block:added', { blockId: id, parentId, content, type })\n\n    // Trigger re-render\n    setState({ document: { ...state.document } })\n\n    return id\n  }\n\n  function editBlockContent(blockId: BlockId, content: string): void {\n    if (!state.document) {\n      const error = Errors.documentNotLoaded()\n      handleError(error)\n      throw error\n    }\n\n    const block = state.document.blocks.get(blockId)\n    if (!block) {\n      const error = Errors.blockNotFound(blockId)\n      handleError(error)\n      throw error\n    }\n\n    const oldContent = block.content\n    logger.debug('Editing block', { blockId, oldLength: oldContent.length, newLength: content.length })\n\n    editUcpBlock(state.document, blockId, content)\n\n    pushHistory(`Edit block`, [{ type: 'edit_block', blockId, data: { oldContent, newContent: content } }])\n\n    emitEvent('block:edited', { blockId, content, oldContent })\n\n    setState({ document: { ...state.document } })\n  }\n\n  function deleteBlockById(blockId: BlockId, cascade = true): void {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    const block = state.document.blocks.get(blockId)\n    if (!block) {\n      throw Errors.blockNotFound(blockId)\n    }\n\n    logger.debug('Deleting block', { blockId, cascade })\n\n    // Capture block data for history\n    const blockData = serializeDocument(state.document)\n\n    deleteUcpBlock(state.document, blockId, { cascade })\n\n    pushHistory(`Delete block`, [{ type: 'delete_block', blockId, data: { cascade, snapshot: blockData } }])\n\n    // Clear selection if deleted block was selected\n    if (state.selection.focusedBlockId === blockId) {\n      setState({\n        selection: createInitialSelection(),\n        document: { ...state.document },\n      })\n    } else {\n      setState({ document: { ...state.document } })\n    }\n\n    emitEvent('block:deleted', { blockId })\n  }\n\n  function moveBlockTo(\n    blockId: BlockId,\n    targetId: BlockId,\n    position: 'before' | 'after' | 'inside'\n  ): void {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    const block = state.document.blocks.get(blockId)\n    if (!block) {\n      throw Errors.blockNotFound(blockId)\n    }\n\n    const target = state.document.blocks.get(targetId)\n    if (!target) {\n      throw Errors.blockNotFound(targetId)\n    }\n\n    logger.debug('Moving block', { blockId, targetId, position })\n\n    // Find current parent for history\n    let oldParentId: BlockId | undefined\n    for (const [id, b] of state.document.blocks) {\n      if (b.children.includes(blockId)) {\n        oldParentId = id\n        break\n      }\n    }\n\n    // Determine new parent and index\n    let newParentId: BlockId\n    let index: number | undefined\n\n    if (position === 'inside') {\n      newParentId = targetId\n    } else {\n      // Find target's parent\n      for (const [id, b] of state.document.blocks) {\n        if (b.children.includes(targetId)) {\n          newParentId = id\n          const targetIndex = b.children.indexOf(targetId)\n          index = position === 'before' ? targetIndex : targetIndex + 1\n          break\n        }\n      }\n      if (!newParentId!) {\n        throw Errors.invalidDropTarget(blockId, targetId, 'Target has no parent')\n      }\n    }\n\n    moveUcpBlock(state.document, blockId, newParentId, index)\n\n    pushHistory(`Move block`, [\n      {\n        type: 'move_block',\n        blockId,\n        data: { oldParentId, newParentId, position },\n      },\n    ])\n\n    emitEvent('block:moved', { blockId, oldParentId, newParentId, position })\n\n    setState({ document: { ...state.document } })\n  }\n\n  function changeBlockType(blockId: BlockId, type: ContentType): void {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    const block = state.document.blocks.get(blockId)\n    if (!block) {\n      throw Errors.blockNotFound(blockId)\n    }\n\n    const oldType = block.type\n    logger.debug('Changing block type', { blockId, oldType, newType: type })\n\n    block.type = type\n\n    pushHistory(`Change block type`, [\n      { type: 'change_type', blockId, data: { oldType, newType: type } },\n    ])\n\n    emitEvent('block:type_changed', { blockId, type, oldType })\n\n    setState({ document: { ...state.document } })\n  }\n\n  // ==========================================================================\n  // SELECTION OPERATIONS\n  // ==========================================================================\n\n  function select(blockId: BlockId): void {\n    if (!state.document) return\n\n    const block = state.document.blocks.get(blockId)\n    if (!block) {\n      logger.warn('Attempted to select non-existent block', { blockId })\n      return\n    }\n\n    logger.debug('Selecting block', { blockId })\n\n    setState({\n      selection: {\n        type: 'block',\n        blocks: { blockIds: [blockId], anchor: blockId, focus: blockId },\n        focusedBlockId: blockId,\n      },\n    })\n\n    emitEvent('selection:changed', { blockIds: [blockId], focusedBlockId: blockId })\n  }\n\n  function selectMultiple(blockIds: BlockId[]): void {\n    if (!state.document) return\n\n    const validIds = blockIds.filter((id) => state.document!.blocks.has(id))\n    if (validIds.length === 0) {\n      clearSelection()\n      return\n    }\n\n    logger.debug('Selecting multiple blocks', { count: validIds.length })\n\n    setState({\n      selection: {\n        type: 'block',\n        blocks: {\n          blockIds: validIds,\n          anchor: validIds[0],\n          focus: validIds[validIds.length - 1],\n        },\n        focusedBlockId: validIds[0],\n      },\n    })\n\n    emitEvent('selection:changed', { blockIds: validIds, focusedBlockId: validIds[0] })\n  }\n\n  function clearSelection(): void {\n    logger.debug('Clearing selection')\n    setState({ selection: createInitialSelection() })\n    emitEvent('selection:cleared', { blockIds: [] })\n  }\n\n  function selectText(blockId: BlockId, start: number, end: number): void {\n    if (!state.document) return\n\n    const block = state.document.blocks.get(blockId)\n    if (!block) return\n\n    logger.debug('Selecting text', { blockId, start, end })\n\n    setState({\n      selection: {\n        type: 'text',\n        text: { blockId, start, end },\n        focusedBlockId: blockId,\n      },\n    })\n\n    emitEvent('selection:changed', {\n      blockIds: [blockId],\n      focusedBlockId: blockId,\n      textSelection: { blockId, start, end },\n    })\n  }\n\n  // ==========================================================================\n  // EDIT OPERATIONS\n  // ==========================================================================\n\n  function startEditing(blockId: BlockId): void {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    const block = state.document.blocks.get(blockId)\n    if (!block) {\n      throw Errors.blockNotFound(blockId)\n    }\n\n    logger.debug('Starting edit', { blockId })\n\n    setState({\n      editingBlockId: blockId,\n      editState: 'editing',\n      pendingContent: block.content,\n      mode: 'edit',\n    })\n\n    emitEvent('edit:started', { blockId, content: block.content })\n  }\n\n  function stopEditing(save = true): void {\n    if (!state.editingBlockId || !state.document) {\n      return\n    }\n\n    const blockId = state.editingBlockId\n    const content = state.pendingContent\n\n    logger.debug('Stopping edit', { blockId, save })\n\n    if (save && content !== null) {\n      const block = state.document.blocks.get(blockId)\n      if (block && block.content !== content) {\n        editBlockContent(blockId, content)\n        emitEvent('edit:saved', { blockId, content })\n      }\n    } else {\n      emitEvent('edit:cancelled', { blockId })\n    }\n\n    setState({\n      editingBlockId: null,\n      editState: 'idle',\n      pendingContent: null,\n      mode: 'view',\n    })\n  }\n\n  function updatePendingContent(content: string): void {\n    if (state.editingBlockId) {\n      setState({ pendingContent: content })\n    }\n  }\n\n  // ==========================================================================\n  // DRAG OPERATIONS\n  // ==========================================================================\n\n  function startDrag(blockId: BlockId): void {\n    if (!state.document) return\n\n    const block = state.document.blocks.get(blockId)\n    if (!block) return\n\n    logger.debug('Starting drag', { blockId })\n\n    setState({\n      drag: {\n        isDragging: true,\n        sourceId: blockId,\n        targetId: undefined,\n        position: undefined,\n      },\n      mode: 'drag',\n    })\n\n    emitEvent('drag:started', { sourceId: blockId })\n  }\n\n  function updateDragTarget(targetId: BlockId, position: 'before' | 'after' | 'inside'): void {\n    if (!state.drag.isDragging) return\n\n    setState({\n      drag: {\n        ...state.drag,\n        targetId,\n        position,\n      },\n    })\n\n    emitEvent('drag:moved', { sourceId: state.drag.sourceId!, targetId, position })\n  }\n\n  function endDrag(drop = true): void {\n    if (!state.drag.isDragging) return\n\n    const { sourceId, targetId, position } = state.drag\n\n    logger.debug('Ending drag', { sourceId, targetId, position, drop })\n\n    if (drop && sourceId && targetId && position) {\n      try {\n        moveBlockTo(sourceId, targetId, position)\n        emitEvent('drag:ended', { sourceId, targetId, position })\n      } catch (error) {\n        handleError(error instanceof Error ? error : Errors.internalError(String(error)))\n        emitEvent('drag:cancelled', { sourceId })\n      }\n    } else {\n      emitEvent('drag:cancelled', { sourceId: sourceId! })\n    }\n\n    setState({\n      drag: createInitialDragState(),\n      mode: 'view',\n    })\n  }\n\n  // ==========================================================================\n  // HISTORY OPERATIONS\n  // ==========================================================================\n\n  function undo(): void {\n    if (!state.history.canUndo || state.history.currentIndex < 0) {\n      throw Errors.noUndoAvailable()\n    }\n\n    const entry = state.history.entries[state.history.currentIndex]\n    if (!entry) return\n\n    logger.debug('Undoing', { entryId: entry.id, description: entry.description })\n\n    // Restore previous snapshot\n    const previousIndex = state.history.currentIndex - 1\n    const previousEntry = state.history.entries[previousIndex]\n    if (previousEntry) {\n      const doc = snapshotManager.restore(previousEntry.snapshotId)\n      setState({\n        document: doc,\n        history: {\n          ...state.history,\n          currentIndex: previousIndex,\n          canUndo: previousIndex >= 0,\n          canRedo: true,\n        },\n        isDirty: true,\n      })\n    } else {\n      // Restore initial state\n      const doc = snapshotManager.restore('initial')\n      setState({\n        document: doc,\n        history: {\n          ...state.history,\n          currentIndex: -1,\n          canUndo: false,\n          canRedo: true,\n        },\n        isDirty: true,\n      })\n    }\n\n    emitEvent('history:undo', {\n      entryId: entry.id,\n      description: entry.description,\n      snapshotId: entry.snapshotId,\n    })\n  }\n\n  function redo(): void {\n    if (!state.history.canRedo) {\n      throw Errors.noRedoAvailable()\n    }\n\n    const nextIndex = state.history.currentIndex + 1\n    const entry = state.history.entries[nextIndex]\n    if (!entry) return\n\n    logger.debug('Redoing', { entryId: entry.id, description: entry.description })\n\n    const doc = snapshotManager.restore(entry.snapshotId)\n    setState({\n      document: doc,\n      history: {\n        ...state.history,\n        currentIndex: nextIndex,\n        canUndo: true,\n        canRedo: nextIndex < state.history.entries.length - 1,\n      },\n      isDirty: true,\n    })\n\n    emitEvent('history:redo', {\n      entryId: entry.id,\n      description: entry.description,\n      snapshotId: entry.snapshotId,\n    })\n  }\n\n  function createSnapshot(description: string): void {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    const snapshotId = `snapshot_${Date.now()}`\n    snapshotManager.create(snapshotId, state.document, description)\n\n    logger.debug('Created snapshot', { snapshotId, description })\n\n    emitEvent('history:snapshot_created', {\n      entryId: snapshotId,\n      description,\n      snapshotId,\n    })\n  }\n\n  // ==========================================================================\n  // GRAPH OPERATIONS\n  // ==========================================================================\n\n  function setGraphLayout(layout: GraphLayout): void {\n    logger.debug('Setting graph layout', { layout })\n    setState({\n      graph: {\n        ...state.graph,\n        layout,\n      },\n    })\n    emitEvent('graph:layout_changed', { layout })\n  }\n\n  function setGraphViewport(x: number, y: number, zoom: number): void {\n    setState({\n      graph: {\n        ...state.graph,\n        viewport: { x, y, zoom },\n      },\n    })\n    emitEvent('graph:viewport_changed', { viewport: { x, y, zoom } })\n  }\n\n  function toggleNodeExpansion(nodeId: BlockId): void {\n    const node = state.graph.nodes.get(nodeId)\n    if (!node) return\n\n    const nodes = new Map(state.graph.nodes)\n    nodes.set(nodeId, { ...node, isExpanded: !node.isExpanded })\n\n    setState({\n      graph: {\n        ...state.graph,\n        nodes,\n      },\n    })\n\n    emitEvent(node.isExpanded ? 'graph:node_collapsed' : 'graph:node_expanded', { nodeId })\n  }\n\n  // ==========================================================================\n  // DIFF OPERATIONS\n  // ==========================================================================\n\n  function startCompare(leftSnapshotId: string, rightSnapshotId: string): void {\n    logger.debug('Starting diff comparison', { leftSnapshotId, rightSnapshotId })\n\n    // TODO: Implement diff computation using DiffEngine\n    setState({\n      diff: {\n        ...state.diff,\n        isComparing: true,\n        leftSnapshotId,\n        rightSnapshotId,\n      },\n    })\n\n    emitEvent('diff:started', { leftSnapshotId, rightSnapshotId })\n  }\n\n  function stopCompare(): void {\n    logger.debug('Stopping diff comparison')\n    setState({\n      diff: createInitialDiffState(),\n    })\n    emitEvent('diff:ended', {})\n  }\n\n  function applyChange(blockId: BlockId): void {\n    logger.debug('Applying diff change', { blockId })\n    // TODO: Implement change application\n    emitEvent('diff:change_applied', { blockId, changeType: 'modified' })\n  }\n\n  function rejectChange(blockId: BlockId): void {\n    logger.debug('Rejecting diff change', { blockId })\n    // TODO: Implement change rejection\n    emitEvent('diff:change_rejected', { blockId, changeType: 'modified' })\n  }\n\n  // ==========================================================================\n  // EDGE OPERATIONS\n  // ==========================================================================\n\n  function addEdgeToBlock(sourceId: BlockId, targetId: BlockId, edgeType: EdgeType): void {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    logger.debug('Adding edge', { sourceId, targetId, edgeType })\n\n    addUcpEdge(state.document, sourceId, edgeType, targetId)\n\n    pushHistory(`Add edge`, [{ type: 'add_edge', data: { sourceId, targetId, edgeType } }])\n\n    emitEvent('edge:added', { sourceId, targetId, edgeType })\n\n    setState({ document: { ...state.document } })\n  }\n\n  function removeEdgeFromBlock(sourceId: BlockId, targetId: BlockId, edgeType: EdgeType): void {\n    if (!state.document) {\n      throw Errors.documentNotLoaded()\n    }\n\n    logger.debug('Removing edge', { sourceId, targetId, edgeType })\n\n    removeUcpEdge(state.document, sourceId, edgeType, targetId)\n\n    pushHistory(`Remove edge`, [{ type: 'remove_edge', data: { sourceId, targetId, edgeType } }])\n\n    emitEvent('edge:removed', { sourceId, targetId, edgeType })\n\n    setState({ document: { ...state.document } })\n  }\n\n  // ==========================================================================\n  // CONFIG\n  // ==========================================================================\n\n  function updateConfig(configUpdate: Partial<EditorConfig>): void {\n    logger.debug('Updating config', configUpdate)\n    setState({\n      config: { ...state.config, ...configUpdate },\n    })\n  }\n\n  // ==========================================================================\n  // ERROR HANDLING\n  // ==========================================================================\n\n  function clearError(): void {\n    setState({ lastError: null })\n    emitEvent('error:cleared', { code: '', message: '', category: '', severity: '' })\n  }\n\n  // ==========================================================================\n  // STORE API\n  // ==========================================================================\n\n  return {\n    // State (getters)\n    get document() {\n      return state.document\n    },\n    get documentId() {\n      return state.documentId\n    },\n    get isLoading() {\n      return state.isLoading\n    },\n    get isDirty() {\n      return state.isDirty\n    },\n    get lastSaved() {\n      return state.lastSaved\n    },\n    get view() {\n      return state.view\n    },\n    get mode() {\n      return state.mode\n    },\n    get selection() {\n      return state.selection\n    },\n    get editingBlockId() {\n      return state.editingBlockId\n    },\n    get editState() {\n      return state.editState\n    },\n    get pendingContent() {\n      return state.pendingContent\n    },\n    get drag() {\n      return state.drag\n    },\n    get graph() {\n      return state.graph\n    },\n    get diff() {\n      return state.diff\n    },\n    get history() {\n      return state.history\n    },\n    get config() {\n      return state.config\n    },\n    get lastError() {\n      return state.lastError\n    },\n\n    // Actions\n    loadDocument,\n    createDocument,\n    saveDocument,\n    setView,\n    setMode,\n    addBlock,\n    editBlock: editBlockContent,\n    deleteBlock: deleteBlockById,\n    moveBlock: moveBlockTo,\n    changeBlockType,\n    select,\n    selectMultiple,\n    clearSelection,\n    selectText,\n    startEditing,\n    stopEditing,\n    updatePendingContent,\n    startDrag,\n    updateDragTarget,\n    endDrag,\n    undo,\n    redo,\n    createSnapshot,\n    setGraphLayout,\n    setGraphViewport,\n    toggleNodeExpansion,\n    startCompare,\n    stopCompare,\n    applyChange,\n    rejectChange,\n    addEdge: addEdgeToBlock,\n    removeEdge: removeEdgeFromBlock,\n    updateConfig,\n    clearError,\n\n    // Store utilities\n    subscribe: (listener: StoreListener) => {\n      listeners.add(listener)\n      return () => listeners.delete(listener)\n    },\n    getState: () => state,\n    events,\n  }\n}\n\n// =============================================================================\n// STORE TYPE\n// =============================================================================\n\nexport type EditorStoreInstance = ReturnType<typeof createEditorStore>\n","/**\n * SelectionManager - Handles selection state and navigation.\n *\n * Manages block selection, text selection, and keyboard navigation.\n */\n\nimport type { BlockId, Document } from 'ucp-content'\nimport type { SelectionState, TextSelection } from '../types/editor.js'\nimport { Logger } from './Logger.js'\n\nconst logger = new Logger({ context: 'SelectionManager' })\n\n// =============================================================================\n// SELECTION HELPERS\n// =============================================================================\n\n/**\n * Create an empty selection state.\n */\nexport function createEmptySelection(): SelectionState {\n  return {\n    type: 'none',\n    blocks: undefined,\n    text: undefined,\n    focusedBlockId: undefined,\n  }\n}\n\n/**\n * Create a single block selection.\n */\nexport function createBlockSelection(blockId: BlockId): SelectionState {\n  return {\n    type: 'block',\n    blocks: {\n      blockIds: [blockId],\n      anchor: blockId,\n      focus: blockId,\n    },\n    focusedBlockId: blockId,\n  }\n}\n\n/**\n * Create a multi-block selection.\n */\nexport function createMultiBlockSelection(\n  blockIds: BlockId[],\n  anchor?: BlockId,\n  focus?: BlockId\n): SelectionState {\n  if (blockIds.length === 0) {\n    return createEmptySelection()\n  }\n\n  return {\n    type: 'block',\n    blocks: {\n      blockIds,\n      anchor: anchor ?? blockIds[0],\n      focus: focus ?? blockIds[blockIds.length - 1],\n    },\n    focusedBlockId: focus ?? blockIds[blockIds.length - 1],\n  }\n}\n\n/**\n * Create a text selection within a block.\n */\nexport function createTextSelection(blockId: BlockId, start: number, end: number): SelectionState {\n  return {\n    type: 'text',\n    text: {\n      blockId,\n      start: Math.min(start, end),\n      end: Math.max(start, end),\n    },\n    focusedBlockId: blockId,\n  }\n}\n\n// =============================================================================\n// SELECTION QUERIES\n// =============================================================================\n\n/**\n * Check if a block is selected.\n */\nexport function isBlockSelected(selection: SelectionState, blockId: BlockId): boolean {\n  if (selection.type === 'none') return false\n  if (selection.type === 'text') return selection.text?.blockId === blockId\n  if (selection.type === 'block') return selection.blocks?.blockIds.includes(blockId) ?? false\n  return false\n}\n\n/**\n * Check if a block is the focused block.\n */\nexport function isBlockFocused(selection: SelectionState, blockId: BlockId): boolean {\n  return selection.focusedBlockId === blockId\n}\n\n/**\n * Get all selected block IDs.\n */\nexport function getSelectedBlockIds(selection: SelectionState): BlockId[] {\n  if (selection.type === 'none') return []\n  if (selection.type === 'text') return selection.text ? [selection.text.blockId] : []\n  if (selection.type === 'block') return selection.blocks?.blockIds ?? []\n  return []\n}\n\n/**\n * Get the primary selected block (anchor).\n */\nexport function getPrimarySelectedBlock(selection: SelectionState): BlockId | undefined {\n  if (selection.type === 'none') return undefined\n  if (selection.type === 'text') return selection.text?.blockId\n  if (selection.type === 'block') return selection.blocks?.anchor\n  return undefined\n}\n\n/**\n * Get text selection details.\n */\nexport function getTextSelection(selection: SelectionState): TextSelection | undefined {\n  return selection.type === 'text' ? selection.text : undefined\n}\n\n/**\n * Check if selection is empty.\n */\nexport function isSelectionEmpty(selection: SelectionState): boolean {\n  return selection.type === 'none'\n}\n\n/**\n * Check if selection is a text selection.\n */\nexport function isTextSelection(selection: SelectionState): boolean {\n  return selection.type === 'text'\n}\n\n/**\n * Check if selection is a block selection.\n */\nexport function isBlockSelectionType(selection: SelectionState): boolean {\n  return selection.type === 'block'\n}\n\n// =============================================================================\n// NAVIGATION\n// =============================================================================\n\n/**\n * Get the block order for navigation.\n */\nexport function getBlockOrder(doc: Document): BlockId[] {\n  const order: BlockId[] = []\n\n  function traverse(blockId: BlockId): void {\n    order.push(blockId)\n    const block = doc.blocks.get(blockId)\n    if (block) {\n      for (const childId of block.children) {\n        traverse(childId)\n      }\n    }\n  }\n\n  traverse(doc.root)\n  return order\n}\n\n/**\n * Get the next block in document order.\n */\nexport function getNextBlock(doc: Document, currentId: BlockId): BlockId | undefined {\n  const order = getBlockOrder(doc)\n  const currentIndex = order.indexOf(currentId)\n  if (currentIndex === -1 || currentIndex === order.length - 1) {\n    return undefined\n  }\n  return order[currentIndex + 1]\n}\n\n/**\n * Get the previous block in document order.\n */\nexport function getPreviousBlock(doc: Document, currentId: BlockId): BlockId | undefined {\n  const order = getBlockOrder(doc)\n  const currentIndex = order.indexOf(currentId)\n  if (currentIndex <= 0) {\n    return undefined\n  }\n  return order[currentIndex - 1]\n}\n\n/**\n * Get the parent block.\n */\nexport function getParentBlock(doc: Document, blockId: BlockId): BlockId | undefined {\n  for (const [id, block] of doc.blocks) {\n    if (block.children.includes(blockId)) {\n      return id\n    }\n  }\n  return undefined\n}\n\n/**\n * Get the first child block.\n */\nexport function getFirstChildBlock(doc: Document, blockId: BlockId): BlockId | undefined {\n  const block = doc.blocks.get(blockId)\n  return block?.children[0]\n}\n\n/**\n * Get sibling blocks.\n */\nexport function getSiblingBlocks(doc: Document, blockId: BlockId): BlockId[] {\n  const parentId = getParentBlock(doc, blockId)\n  if (!parentId) return []\n  const parent = doc.blocks.get(parentId)\n  return parent?.children ?? []\n}\n\n/**\n * Get the next sibling.\n */\nexport function getNextSibling(doc: Document, blockId: BlockId): BlockId | undefined {\n  const siblings = getSiblingBlocks(doc, blockId)\n  const index = siblings.indexOf(blockId)\n  if (index === -1 || index === siblings.length - 1) {\n    return undefined\n  }\n  return siblings[index + 1]\n}\n\n/**\n * Get the previous sibling.\n */\nexport function getPreviousSibling(doc: Document, blockId: BlockId): BlockId | undefined {\n  const siblings = getSiblingBlocks(doc, blockId)\n  const index = siblings.indexOf(blockId)\n  if (index <= 0) {\n    return undefined\n  }\n  return siblings[index - 1]\n}\n\n// =============================================================================\n// SELECTION EXPANSION\n// =============================================================================\n\n/**\n * Expand selection to include another block.\n */\nexport function expandSelection(\n  doc: Document,\n  selection: SelectionState,\n  targetId: BlockId\n): SelectionState {\n  if (selection.type === 'none') {\n    return createBlockSelection(targetId)\n  }\n\n  if (selection.type === 'text') {\n    // Convert to block selection\n    const currentBlockId = selection.text?.blockId\n    if (!currentBlockId) return createBlockSelection(targetId)\n\n    return expandBlockRange(doc, currentBlockId, targetId)\n  }\n\n  if (selection.type === 'block') {\n    const anchor = selection.blocks?.anchor\n    if (!anchor) return createBlockSelection(targetId)\n\n    return expandBlockRange(doc, anchor, targetId)\n  }\n\n  return selection\n}\n\n/**\n * Expand selection between two blocks.\n */\nfunction expandBlockRange(doc: Document, anchorId: BlockId, focusId: BlockId): SelectionState {\n  const order = getBlockOrder(doc)\n  const anchorIndex = order.indexOf(anchorId)\n  const focusIndex = order.indexOf(focusId)\n\n  if (anchorIndex === -1 || focusIndex === -1) {\n    return createBlockSelection(focusId)\n  }\n\n  const start = Math.min(anchorIndex, focusIndex)\n  const end = Math.max(anchorIndex, focusIndex)\n  const selectedIds = order.slice(start, end + 1)\n\n  return createMultiBlockSelection(selectedIds, anchorId, focusId)\n}\n\n// =============================================================================\n// SELECTION MANAGER CLASS\n// =============================================================================\n\nexport interface SelectionManagerConfig {\n  onSelectionChange?: (selection: SelectionState) => void\n}\n\n/**\n * Selection manager for handling selection state and navigation.\n *\n * @example\n * ```typescript\n * const manager = new SelectionManager(doc, {\n *   onSelectionChange: (selection) => {\n *     console.log('Selection changed:', selection)\n *   }\n * })\n *\n * manager.select('blk_123')\n * manager.moveNext()\n * manager.expandToBlock('blk_456')\n * ```\n */\nexport class SelectionManager {\n  private doc: Document\n  private selection: SelectionState\n  private config: SelectionManagerConfig\n\n  constructor(doc: Document, config: SelectionManagerConfig = {}) {\n    this.doc = doc\n    this.selection = createEmptySelection()\n    this.config = config\n  }\n\n  /**\n   * Update the document reference.\n   */\n  setDocument(doc: Document): void {\n    this.doc = doc\n    // Clear selection if document changed significantly\n    if (this.selection.focusedBlockId && !doc.blocks.has(this.selection.focusedBlockId)) {\n      this.clear()\n    }\n  }\n\n  /**\n   * Get current selection.\n   */\n  getSelection(): SelectionState {\n    return this.selection\n  }\n\n  /**\n   * Update selection and notify.\n   */\n  private setSelection(selection: SelectionState): void {\n    this.selection = selection\n    this.config.onSelectionChange?.(selection)\n  }\n\n  /**\n   * Select a single block.\n   */\n  select(blockId: BlockId): void {\n    if (!this.doc.blocks.has(blockId)) {\n      logger.warn('Attempted to select non-existent block', { blockId })\n      return\n    }\n    this.setSelection(createBlockSelection(blockId))\n  }\n\n  /**\n   * Select multiple blocks.\n   */\n  selectMultiple(blockIds: BlockId[]): void {\n    const validIds = blockIds.filter((id) => this.doc.blocks.has(id))\n    if (validIds.length === 0) {\n      this.clear()\n      return\n    }\n    this.setSelection(createMultiBlockSelection(validIds))\n  }\n\n  /**\n   * Clear selection.\n   */\n  clear(): void {\n    this.setSelection(createEmptySelection())\n  }\n\n  /**\n   * Select text within a block.\n   */\n  selectText(blockId: BlockId, start: number, end: number): void {\n    if (!this.doc.blocks.has(blockId)) {\n      logger.warn('Attempted to select text in non-existent block', { blockId })\n      return\n    }\n    this.setSelection(createTextSelection(blockId, start, end))\n  }\n\n  /**\n   * Expand selection to include another block.\n   */\n  expandTo(blockId: BlockId): void {\n    if (!this.doc.blocks.has(blockId)) return\n    this.setSelection(expandSelection(this.doc, this.selection, blockId))\n  }\n\n  /**\n   * Move selection to next block.\n   */\n  moveNext(): boolean {\n    const currentId = this.selection.focusedBlockId\n    if (!currentId) {\n      const order = getBlockOrder(this.doc)\n      if (order.length > 1) {\n        this.select(order[1]!) // Skip root\n        return true\n      }\n      return false\n    }\n\n    const nextId = getNextBlock(this.doc, currentId)\n    if (nextId) {\n      this.select(nextId)\n      return true\n    }\n    return false\n  }\n\n  /**\n   * Move selection to previous block.\n   */\n  movePrevious(): boolean {\n    const currentId = this.selection.focusedBlockId\n    if (!currentId) return false\n\n    const prevId = getPreviousBlock(this.doc, currentId)\n    if (prevId && prevId !== this.doc.root) {\n      this.select(prevId)\n      return true\n    }\n    return false\n  }\n\n  /**\n   * Move selection to parent block.\n   */\n  moveToParent(): boolean {\n    const currentId = this.selection.focusedBlockId\n    if (!currentId) return false\n\n    const parentId = getParentBlock(this.doc, currentId)\n    if (parentId && parentId !== this.doc.root) {\n      this.select(parentId)\n      return true\n    }\n    return false\n  }\n\n  /**\n   * Move selection to first child.\n   */\n  moveToFirstChild(): boolean {\n    const currentId = this.selection.focusedBlockId\n    if (!currentId) return false\n\n    const childId = getFirstChildBlock(this.doc, currentId)\n    if (childId) {\n      this.select(childId)\n      return true\n    }\n    return false\n  }\n\n  /**\n   * Expand selection to next block.\n   */\n  expandNext(): boolean {\n    const currentId = this.selection.focusedBlockId\n    if (!currentId) return this.moveNext()\n\n    const nextId = getNextBlock(this.doc, currentId)\n    if (nextId) {\n      this.expandTo(nextId)\n      return true\n    }\n    return false\n  }\n\n  /**\n   * Expand selection to previous block.\n   */\n  expandPrevious(): boolean {\n    const currentId = this.selection.focusedBlockId\n    if (!currentId) return this.movePrevious()\n\n    const prevId = getPreviousBlock(this.doc, currentId)\n    if (prevId && prevId !== this.doc.root) {\n      this.expandTo(prevId)\n      return true\n    }\n    return false\n  }\n\n  /**\n   * Select all blocks.\n   */\n  selectAll(): void {\n    const order = getBlockOrder(this.doc)\n    // Exclude root\n    const blockIds = order.slice(1)\n    if (blockIds.length > 0) {\n      this.setSelection(createMultiBlockSelection(blockIds))\n    }\n  }\n\n  /**\n   * Check if block is selected.\n   */\n  isSelected(blockId: BlockId): boolean {\n    return isBlockSelected(this.selection, blockId)\n  }\n\n  /**\n   * Check if block is focused.\n   */\n  isFocused(blockId: BlockId): boolean {\n    return isBlockFocused(this.selection, blockId)\n  }\n}\n","/**\n * DiffEngine - Computes differences between document snapshots.\n *\n * Provides block-level and text-level diffing for UCM documents.\n */\n\nimport type { BlockId, Document, Block } from 'ucp-content'\nimport type {\n  DocumentDiff,\n  BlockDiff,\n  TextDiff,\n  StructuralChange,\n  DiffChangeType,\n  MetadataChange,\n} from '../types/editor.js'\nimport { Logger } from './Logger.js'\n\nconst logger = new Logger({ context: 'DiffEngine' })\n\n// =============================================================================\n// TEXT DIFF ALGORITHM\n// =============================================================================\n\ntype DiffOperation =\n  | { type: 'equal'; text: string }\n  | { type: 'insert'; text: string }\n  | { type: 'delete'; text: string }\n\n/**\n * Simple line-based diff algorithm.\n * For production, consider using a more sophisticated algorithm like Myers diff.\n */\nfunction computeTextDiff(oldText: string, newText: string): TextDiff {\n  if (oldText === newText) {\n    return { operations: [{ type: 'equal', text: oldText }] }\n  }\n\n  const operations: DiffOperation[] = []\n\n  // Simple character-based diff for short texts\n  if (oldText.length < 1000 && newText.length < 1000) {\n    const result = computeCharacterDiff(oldText, newText)\n    return { operations: result }\n  }\n\n  // Line-based diff for longer texts\n  const oldLines = oldText.split('\\n')\n  const newLines = newText.split('\\n')\n\n  const lcs = computeLCS(oldLines, newLines)\n  let oldIdx = 0\n  let newIdx = 0\n  let lcsIdx = 0\n\n  while (oldIdx < oldLines.length || newIdx < newLines.length) {\n    if (lcsIdx < lcs.length && oldLines[oldIdx] === lcs[lcsIdx] && newLines[newIdx] === lcs[lcsIdx]) {\n      // Common line\n      operations.push({ type: 'equal', text: oldLines[oldIdx]! + '\\n' })\n      oldIdx++\n      newIdx++\n      lcsIdx++\n    } else if (oldIdx < oldLines.length && (lcsIdx >= lcs.length || oldLines[oldIdx] !== lcs[lcsIdx])) {\n      // Deleted line\n      operations.push({ type: 'delete', text: oldLines[oldIdx]! + '\\n' })\n      oldIdx++\n    } else if (newIdx < newLines.length) {\n      // Inserted line\n      operations.push({ type: 'insert', text: newLines[newIdx]! + '\\n' })\n      newIdx++\n    }\n  }\n\n  // Merge consecutive operations of the same type\n  return { operations: mergeOperations(operations) }\n}\n\n/**\n * Character-based diff for short strings.\n */\nfunction computeCharacterDiff(oldText: string, newText: string): DiffOperation[] {\n  const operations: DiffOperation[] = []\n\n  // Find common prefix\n  let prefixLen = 0\n  while (prefixLen < oldText.length && prefixLen < newText.length && oldText[prefixLen] === newText[prefixLen]) {\n    prefixLen++\n  }\n\n  // Find common suffix\n  let suffixLen = 0\n  while (\n    suffixLen < oldText.length - prefixLen &&\n    suffixLen < newText.length - prefixLen &&\n    oldText[oldText.length - 1 - suffixLen] === newText[newText.length - 1 - suffixLen]\n  ) {\n    suffixLen++\n  }\n\n  // Add prefix\n  if (prefixLen > 0) {\n    operations.push({ type: 'equal', text: oldText.slice(0, prefixLen) })\n  }\n\n  // Add middle (deleted and inserted)\n  const oldMiddle = oldText.slice(prefixLen, oldText.length - suffixLen)\n  const newMiddle = newText.slice(prefixLen, newText.length - suffixLen)\n\n  if (oldMiddle.length > 0) {\n    operations.push({ type: 'delete', text: oldMiddle })\n  }\n  if (newMiddle.length > 0) {\n    operations.push({ type: 'insert', text: newMiddle })\n  }\n\n  // Add suffix\n  if (suffixLen > 0) {\n    operations.push({ type: 'equal', text: oldText.slice(oldText.length - suffixLen) })\n  }\n\n  return operations\n}\n\n/**\n * Compute Longest Common Subsequence for line-based diff.\n */\nfunction computeLCS(a: string[], b: string[]): string[] {\n  const m = a.length\n  const n = b.length\n\n  // Use a space-optimized approach for large arrays\n  if (m > 1000 || n > 1000) {\n    return computeLCSOptimized(a, b)\n  }\n\n  const dp: number[][] = Array(m + 1)\n    .fill(null)\n    .map(() => Array(n + 1).fill(0))\n\n  for (let i = 1; i <= m; i++) {\n    for (let j = 1; j <= n; j++) {\n      if (a[i - 1] === b[j - 1]) {\n        dp[i]![j] = dp[i - 1]![j - 1]! + 1\n      } else {\n        dp[i]![j] = Math.max(dp[i - 1]![j]!, dp[i]![j - 1]!)\n      }\n    }\n  }\n\n  // Backtrack to find LCS\n  const lcs: string[] = []\n  let i = m\n  let j = n\n\n  while (i > 0 && j > 0) {\n    if (a[i - 1] === b[j - 1]) {\n      lcs.unshift(a[i - 1]!)\n      i--\n      j--\n    } else if (dp[i - 1]![j]! > dp[i]![j - 1]!) {\n      i--\n    } else {\n      j--\n    }\n  }\n\n  return lcs\n}\n\n/**\n * Space-optimized LCS for large arrays.\n */\nfunction computeLCSOptimized(a: string[], b: string[]): string[] {\n  // For very large arrays, use a simpler heuristic\n  // This trades accuracy for memory efficiency\n  const commonElements: string[] = []\n  const bSet = new Set(b)\n\n  for (const item of a) {\n    if (bSet.has(item)) {\n      commonElements.push(item)\n    }\n  }\n\n  return commonElements\n}\n\n/**\n * Merge consecutive operations of the same type.\n */\nfunction mergeOperations(operations: DiffOperation[]): DiffOperation[] {\n  if (operations.length === 0) return []\n\n  const merged: DiffOperation[] = []\n  let current = operations[0]!\n\n  for (let i = 1; i < operations.length; i++) {\n    const op = operations[i]!\n    if (op.type === current.type) {\n      current = { type: current.type, text: current.text + op.text }\n    } else {\n      merged.push(current)\n      current = op\n    }\n  }\n\n  merged.push(current)\n  return merged\n}\n\n// =============================================================================\n// STRUCTURE DIFF\n// =============================================================================\n\ninterface BlockInfo {\n  id: BlockId\n  parentId?: BlockId\n  index: number\n  content: string\n  type: string\n}\n\nfunction getBlockInfo(doc: Document, blockId: BlockId): BlockInfo | undefined {\n  const block = doc.blocks.get(blockId)\n  if (!block) return undefined\n\n  // Find parent\n  let parentId: BlockId | undefined\n  let index = 0\n\n  for (const [id, b] of doc.blocks) {\n    const childIndex = b.children.indexOf(blockId)\n    if (childIndex !== -1) {\n      parentId = id\n      index = childIndex\n      break\n    }\n  }\n\n  return {\n    id: blockId,\n    parentId,\n    index,\n    content: block.content,\n    type: block.type,\n  }\n}\n\n/**\n * Compute structural changes between two documents.\n */\nfunction computeStructuralChanges(\n  oldDoc: Document,\n  newDoc: Document,\n  commonBlockIds: Set<BlockId>\n): StructuralChange[] {\n  const changes: StructuralChange[] = []\n\n  // Check for moved/reordered blocks\n  for (const blockId of commonBlockIds) {\n    const oldInfo = getBlockInfo(oldDoc, blockId)\n    const newInfo = getBlockInfo(newDoc, blockId)\n\n    if (!oldInfo || !newInfo) continue\n\n    if (oldInfo.parentId !== newInfo.parentId) {\n      changes.push({\n        type: 'moved',\n        blockId,\n        oldParentId: oldInfo.parentId,\n        newParentId: newInfo.parentId,\n        oldIndex: oldInfo.index,\n        newIndex: newInfo.index,\n      })\n    } else if (oldInfo.index !== newInfo.index) {\n      changes.push({\n        type: 'reordered',\n        blockId,\n        oldParentId: oldInfo.parentId,\n        newParentId: newInfo.parentId,\n        oldIndex: oldInfo.index,\n        newIndex: newInfo.index,\n      })\n    }\n  }\n\n  // Check for added blocks (not in old doc)\n  for (const blockId of newDoc.blocks.keys()) {\n    if (!oldDoc.blocks.has(blockId)) {\n      const info = getBlockInfo(newDoc, blockId)\n      if (info) {\n        changes.push({\n          type: 'added',\n          blockId,\n          newParentId: info.parentId,\n          newIndex: info.index,\n        })\n      }\n    }\n  }\n\n  // Check for removed blocks (not in new doc)\n  for (const blockId of oldDoc.blocks.keys()) {\n    if (!newDoc.blocks.has(blockId)) {\n      const info = getBlockInfo(oldDoc, blockId)\n      if (info) {\n        changes.push({\n          type: 'removed',\n          blockId,\n          oldParentId: info.parentId,\n          oldIndex: info.index,\n        })\n      }\n    }\n  }\n\n  return changes\n}\n\n// =============================================================================\n// METADATA DIFF\n// =============================================================================\n\nfunction computeMetadataChanges(oldBlock: Block, newBlock: Block): MetadataChange[] {\n  const changes: MetadataChange[] = []\n\n  // Check type\n  if (oldBlock.type !== newBlock.type) {\n    changes.push({ field: 'type', oldValue: oldBlock.type, newValue: newBlock.type })\n  }\n\n  // Check role\n  if (oldBlock.role !== newBlock.role) {\n    changes.push({ field: 'role', oldValue: oldBlock.role, newValue: newBlock.role })\n  }\n\n  // Check label\n  if (oldBlock.label !== newBlock.label) {\n    changes.push({ field: 'label', oldValue: oldBlock.label, newValue: newBlock.label })\n  }\n\n  // Check tags\n  const oldTags = new Set(oldBlock.tags)\n  const newTags = new Set(newBlock.tags)\n  const addedTags = [...newTags].filter((t) => !oldTags.has(t))\n  const removedTags = [...oldTags].filter((t) => !newTags.has(t))\n\n  if (addedTags.length > 0 || removedTags.length > 0) {\n    changes.push({\n      field: 'tags',\n      oldValue: [...oldTags],\n      newValue: [...newTags],\n    })\n  }\n\n  // Check edges count (detailed edge diff is complex)\n  if (oldBlock.edges.length !== newBlock.edges.length) {\n    changes.push({\n      field: 'edges',\n      oldValue: oldBlock.edges.length,\n      newValue: newBlock.edges.length,\n    })\n  }\n\n  return changes\n}\n\n// =============================================================================\n// BLOCK DIFF\n// =============================================================================\n\nfunction computeBlockDiff(oldBlock: Block | undefined, newBlock: Block | undefined): BlockDiff {\n  // Added block\n  if (!oldBlock && newBlock) {\n    return {\n      blockId: newBlock.id,\n      changeType: 'added',\n      newBlock,\n    }\n  }\n\n  // Removed block\n  if (oldBlock && !newBlock) {\n    return {\n      blockId: oldBlock.id,\n      changeType: 'removed',\n      oldBlock,\n    }\n  }\n\n  // Both exist - check for modifications\n  if (oldBlock && newBlock) {\n    const contentChanged = oldBlock.content !== newBlock.content\n    const metadataChanges = computeMetadataChanges(oldBlock, newBlock)\n\n    if (!contentChanged && metadataChanges.length === 0) {\n      return {\n        blockId: oldBlock.id,\n        changeType: 'unchanged',\n        oldBlock,\n        newBlock,\n      }\n    }\n\n    return {\n      blockId: oldBlock.id,\n      changeType: 'modified',\n      oldBlock,\n      newBlock,\n      contentDiff: contentChanged ? computeTextDiff(oldBlock.content, newBlock.content) : undefined,\n      metadataChanges: metadataChanges.length > 0 ? metadataChanges : undefined,\n    }\n  }\n\n  // Should not reach here\n  throw new Error('Invalid block diff state')\n}\n\n// =============================================================================\n// DOCUMENT DIFF\n// =============================================================================\n\n/**\n * Compute a complete diff between two documents.\n *\n * @example\n * ```typescript\n * const oldDoc = parseMarkdown('# Hello\\n\\nWorld')\n * const newDoc = parseMarkdown('# Hello\\n\\nNew World')\n *\n * const diff = computeDocumentDiff(oldDoc, newDoc, 'snapshot1', 'snapshot2')\n *\n * console.log(diff.summary)\n * // { added: 0, removed: 0, modified: 1, moved: 0, unchanged: 2 }\n * ```\n */\nexport function computeDocumentDiff(\n  oldDoc: Document,\n  newDoc: Document,\n  fromSnapshotId: string,\n  toSnapshotId: string\n): DocumentDiff {\n  logger.debug('Computing document diff', {\n    fromSnapshot: fromSnapshotId,\n    toSnapshot: toSnapshotId,\n    oldBlockCount: oldDoc.blocks.size,\n    newBlockCount: newDoc.blocks.size,\n  })\n\n  const blockDiffs = new Map<BlockId, BlockDiff>()\n  const allBlockIds = new Set([...oldDoc.blocks.keys(), ...newDoc.blocks.keys()])\n  const commonBlockIds = new Set<BlockId>()\n\n  const summary = {\n    added: 0,\n    removed: 0,\n    modified: 0,\n    moved: 0,\n    unchanged: 0,\n  }\n\n  // Compute block diffs\n  for (const blockId of allBlockIds) {\n    const oldBlock = oldDoc.blocks.get(blockId)\n    const newBlock = newDoc.blocks.get(blockId)\n\n    if (oldBlock && newBlock) {\n      commonBlockIds.add(blockId)\n    }\n\n    const diff = computeBlockDiff(oldBlock, newBlock)\n    blockDiffs.set(blockId, diff)\n\n    switch (diff.changeType) {\n      case 'added':\n        summary.added++\n        break\n      case 'removed':\n        summary.removed++\n        break\n      case 'modified':\n        summary.modified++\n        break\n      case 'unchanged':\n        summary.unchanged++\n        break\n    }\n  }\n\n  // Compute structural changes\n  const structuralChanges = computeStructuralChanges(oldDoc, newDoc, commonBlockIds)\n  summary.moved = structuralChanges.filter((c) => c.type === 'moved').length\n\n  logger.debug('Diff computed', summary)\n\n  return {\n    fromSnapshotId,\n    toSnapshotId,\n    blockDiffs,\n    structuralChanges,\n    summary,\n  }\n}\n\n// =============================================================================\n// DIFF UTILITIES\n// =============================================================================\n\n/**\n * Get blocks that have changes.\n */\nexport function getChangedBlocks(diff: DocumentDiff): BlockDiff[] {\n  return Array.from(diff.blockDiffs.values()).filter((d) => d.changeType !== 'unchanged')\n}\n\n/**\n * Get blocks by change type.\n */\nexport function getBlocksByChangeType(diff: DocumentDiff, changeType: DiffChangeType): BlockDiff[] {\n  return Array.from(diff.blockDiffs.values()).filter((d) => d.changeType === changeType)\n}\n\n/**\n * Check if a specific block has changes.\n */\nexport function hasBlockChanged(diff: DocumentDiff, blockId: BlockId): boolean {\n  const blockDiff = diff.blockDiffs.get(blockId)\n  return blockDiff !== undefined && blockDiff.changeType !== 'unchanged'\n}\n\n/**\n * Get the text diff for a specific block.\n */\nexport function getBlockTextDiff(diff: DocumentDiff, blockId: BlockId): TextDiff | undefined {\n  const blockDiff = diff.blockDiffs.get(blockId)\n  return blockDiff?.contentDiff\n}\n\n/**\n * Format text diff as a string with markers.\n */\nexport function formatTextDiff(textDiff: TextDiff): string {\n  return textDiff.operations\n    .map((op) => {\n      switch (op.type) {\n        case 'equal':\n          return op.text\n        case 'insert':\n          return `[+${op.text}+]`\n        case 'delete':\n          return `[-${op.text}-]`\n      }\n    })\n    .join('')\n}\n\n/**\n * Check if diff has any changes.\n */\nexport function hasDiffChanges(diff: DocumentDiff): boolean {\n  return diff.summary.added > 0 || diff.summary.removed > 0 || diff.summary.modified > 0 || diff.summary.moved > 0\n}\n","/**\n * useEditor - Main React hook for the UCM Editor.\n *\n * Provides access to the editor store and reactive state updates.\n */\n\nimport { useRef, useEffect, useSyncExternalStore, useCallback } from 'react'\nimport type { Document } from 'ucp-content'\nimport { createEditorStore, type EditorStoreInstance } from '../core/EditorStore.js'\nimport type { EditorStoreState, EditorConfig } from '../types/editor.js'\n\ntype EditorEventTypeParam = Parameters<EditorStoreInstance['events']['on']>[0]\ntype EditorEventHandlerParam = Parameters<EditorStoreInstance['events']['on']>[1]\n\n// =============================================================================\n// EDITOR CONTEXT\n// =============================================================================\n\n/**\n * Hook to create and manage an editor store instance.\n *\n * @example\n * ```typescript\n * function MyEditor() {\n *   const editor = useEditorStore()\n *\n *   useEffect(() => {\n *     editor.loadDocument(myDocument)\n *   }, [])\n *\n *   return <Editor store={editor} />\n * }\n * ```\n */\nexport function useEditorStore(config?: Partial<EditorConfig>): EditorStoreInstance {\n  const storeRef = useRef<EditorStoreInstance | null>(null)\n\n  if (storeRef.current === null) {\n    storeRef.current = createEditorStore(config)\n  }\n\n  return storeRef.current\n}\n\n// =============================================================================\n// STATE SELECTOR HOOK\n// =============================================================================\n\n/**\n * Hook to subscribe to specific parts of the editor state.\n *\n * @example\n * ```typescript\n * function BlockList() {\n *   const document = useEditorState(store, (state) => state.document)\n *   const selection = useEditorState(store, (state) => state.selection)\n *\n *   // Component re-renders only when document or selection changes\n * }\n * ```\n */\nexport function useEditorState<T>(\n  store: EditorStoreInstance,\n  selector: (state: EditorStoreState) => T\n): T {\n  const subscribe = useCallback(\n    (callback: () => void) => store.subscribe(callback),\n    [store]\n  )\n\n  const getSnapshot = useCallback(() => selector(store.getState()), [store, selector])\n\n  return useSyncExternalStore(subscribe, getSnapshot, getSnapshot)\n}\n\n// =============================================================================\n// DOCUMENT HOOK\n// =============================================================================\n\n/**\n * Hook to access the current document.\n */\nexport function useDocument(store: EditorStoreInstance): Document | null {\n  return useEditorState(store, (state) => state.document)\n}\n\n// =============================================================================\n// SELECTION HOOK\n// =============================================================================\n\n/**\n * Hook to access selection state.\n */\nexport function useSelection(store: EditorStoreInstance) {\n  const selection = useEditorState(store, (state) => state.selection)\n  const editingBlockId = useEditorState(store, (state) => state.editingBlockId)\n\n  return {\n    selection,\n    editingBlockId,\n    isBlockSelected: (blockId: string) => {\n      if (selection.type === 'block') {\n        return selection.blocks?.blockIds.includes(blockId) ?? false\n      }\n      if (selection.type === 'text') {\n        return selection.text?.blockId === blockId\n      }\n      return false\n    },\n    isBlockFocused: (blockId: string) => selection.focusedBlockId === blockId,\n    isBlockEditing: (blockId: string) => editingBlockId === blockId,\n  }\n}\n\n// =============================================================================\n// HISTORY HOOK\n// =============================================================================\n\n/**\n * Hook to access history state and actions.\n */\nexport function useHistory(store: EditorStoreInstance) {\n  const history = useEditorState(store, (state) => state.history)\n\n  return {\n    canUndo: history.canUndo,\n    canRedo: history.canRedo,\n    entries: history.entries,\n    currentIndex: history.currentIndex,\n    undo: store.undo,\n    redo: store.redo,\n  }\n}\n\n// =============================================================================\n// DRAG HOOK\n// =============================================================================\n\n/**\n * Hook to access drag state.\n */\nexport function useDrag(store: EditorStoreInstance) {\n  const drag = useEditorState(store, (state) => state.drag)\n\n  return {\n    isDragging: drag.isDragging,\n    sourceId: drag.sourceId,\n    targetId: drag.targetId,\n    position: drag.position,\n    startDrag: store.startDrag,\n    updateTarget: store.updateDragTarget,\n    endDrag: store.endDrag,\n  }\n}\n\n// =============================================================================\n// VIEW HOOK\n// =============================================================================\n\n/**\n * Hook to access view state.\n */\nexport function useView(store: EditorStoreInstance) {\n  const view = useEditorState(store, (state) => state.view)\n  const mode = useEditorState(store, (state) => state.mode)\n\n  return {\n    view,\n    mode,\n    setView: store.setView,\n    setMode: store.setMode,\n  }\n}\n\n// =============================================================================\n// BLOCK ACTIONS HOOK\n// =============================================================================\n\n/**\n * Hook to access block manipulation actions.\n */\nexport function useBlockActions(store: EditorStoreInstance) {\n  return {\n    addBlock: store.addBlock,\n    editBlock: store.editBlock,\n    deleteBlock: store.deleteBlock,\n    moveBlock: store.moveBlock,\n    changeBlockType: store.changeBlockType,\n  }\n}\n\n// =============================================================================\n// EDIT ACTIONS HOOK\n// =============================================================================\n\n/**\n * Hook to access edit actions.\n */\nexport function useEditActions(store: EditorStoreInstance) {\n  const editingBlockId = useEditorState(store, (state) => state.editingBlockId)\n  const pendingContent = useEditorState(store, (state) => state.pendingContent)\n  const editState = useEditorState(store, (state) => state.editState)\n\n  return {\n    editingBlockId,\n    pendingContent,\n    editState,\n    startEditing: store.startEditing,\n    stopEditing: store.stopEditing,\n    updateContent: store.updatePendingContent,\n  }\n}\n\n// =============================================================================\n// EDITOR EVENTS HOOK\n// =============================================================================\n\n/**\n * Hook to subscribe to editor events.\n *\n * @example\n * ```typescript\n * function MyComponent({ store }) {\n *   useEditorEvent(store, 'block:added', (event) => {\n *     console.log('Block added:', event.data)\n *   })\n * }\n * ```\n */\nexport function useEditorEvent<T extends EditorEventTypeParam>(\n  store: EditorStoreInstance,\n  eventType: T,\n  handler: EditorEventHandlerParam\n): void {\n  useEffect(() => {\n    return store.events.on(eventType, handler)\n  }, [store, eventType, handler])\n}\n\n// =============================================================================\n// KEYBOARD SHORTCUTS HOOK\n// =============================================================================\n\nexport interface KeyboardShortcuts {\n  'mod+z': () => void\n  'mod+shift+z': () => void\n  'mod+y': () => void\n  'mod+s': () => void\n  'mod+a': () => void\n  escape: () => void\n  enter: () => void\n  delete: () => void\n  backspace: () => void\n  arrowUp: () => void\n  arrowDown: () => void\n  arrowLeft: () => void\n  arrowRight: () => void\n  tab: () => void\n  'shift+tab': () => void\n}\n\n/**\n * Hook to handle keyboard shortcuts.\n */\nexport function useKeyboardShortcuts(\n  store: EditorStoreInstance,\n  enabled = true\n): void {\n  useEffect(() => {\n    if (!enabled) return\n\n    const handleKeyDown = (event: KeyboardEvent) => {\n      const isMod = event.metaKey || event.ctrlKey\n      const isShift = event.shiftKey\n\n      // Undo: Cmd/Ctrl+Z\n      if (isMod && !isShift && event.key === 'z') {\n        event.preventDefault()\n        if (store.history.canUndo) {\n          store.undo()\n        }\n        return\n      }\n\n      // Redo: Cmd/Ctrl+Shift+Z or Cmd/Ctrl+Y\n      if ((isMod && isShift && event.key === 'z') || (isMod && event.key === 'y')) {\n        event.preventDefault()\n        if (store.history.canRedo) {\n          store.redo()\n        }\n        return\n      }\n\n      // Save: Cmd/Ctrl+S\n      if (isMod && event.key === 's') {\n        event.preventDefault()\n        store.saveDocument().catch(console.error)\n        return\n      }\n\n      // Select all: Cmd/Ctrl+A\n      if (isMod && event.key === 'a') {\n        event.preventDefault()\n        if (store.document) {\n          const blockIds = Array.from(store.document.blocks.keys()).filter(\n            (id) => id !== store.document!.root\n          )\n          store.selectMultiple(blockIds)\n        }\n        return\n      }\n\n      // Escape: Cancel editing or clear selection\n      if (event.key === 'Escape') {\n        if (store.editingBlockId) {\n          store.stopEditing(false)\n        } else if (store.drag.isDragging) {\n          store.endDrag(false)\n        } else {\n          store.clearSelection()\n        }\n        return\n      }\n\n      // Enter: Start editing selected block\n      if (event.key === 'Enter' && !isMod) {\n        const focusedId = store.selection.focusedBlockId\n        if (focusedId && !store.editingBlockId) {\n          event.preventDefault()\n          store.startEditing(focusedId)\n        }\n        return\n      }\n\n      // Delete/Backspace: Delete selected blocks\n      if ((event.key === 'Delete' || event.key === 'Backspace') && !store.editingBlockId) {\n        const selectedIds =\n          store.selection.type === 'block' ? store.selection.blocks?.blockIds : undefined\n        if (selectedIds && selectedIds.length > 0) {\n          event.preventDefault()\n          selectedIds.forEach((id) => {\n            try {\n              store.deleteBlock(id)\n            } catch {\n              // Ignore errors for already-deleted blocks\n            }\n          })\n        }\n        return\n      }\n\n      // Arrow keys: Navigation (only when not editing)\n      if (!store.editingBlockId) {\n        if (event.key === 'ArrowUp') {\n          event.preventDefault()\n          navigateUp(store, isShift)\n          return\n        }\n        if (event.key === 'ArrowDown') {\n          event.preventDefault()\n          navigateDown(store, isShift)\n          return\n        }\n      }\n    }\n\n    document.addEventListener('keydown', handleKeyDown)\n    return () => document.removeEventListener('keydown', handleKeyDown)\n  }, [store, enabled])\n}\n\nfunction navigateUp(store: EditorStoreInstance, expand: boolean): void {\n  if (!store.document) return\n\n  const currentId = store.selection.focusedBlockId\n  if (!currentId) {\n    // Select first non-root block\n    const firstChild = store.document.blocks.get(store.document.root)?.children[0]\n    if (firstChild) {\n      store.select(firstChild)\n    }\n    return\n  }\n\n  // Find previous block in document order\n  const order = getBlockOrder(store.document)\n  const currentIndex = order.indexOf(currentId)\n  if (currentIndex > 1) {\n    // Skip root at index 0\n    const prevId = order[currentIndex - 1]!\n    if (expand) {\n      const selectedIds = store.selection.blocks?.blockIds ?? [currentId]\n      if (!selectedIds.includes(prevId)) {\n        store.selectMultiple([...selectedIds, prevId])\n      }\n    } else {\n      store.select(prevId)\n    }\n  }\n}\n\nfunction navigateDown(store: EditorStoreInstance, expand: boolean): void {\n  if (!store.document) return\n\n  const currentId = store.selection.focusedBlockId\n  if (!currentId) {\n    const firstChild = store.document.blocks.get(store.document.root)?.children[0]\n    if (firstChild) {\n      store.select(firstChild)\n    }\n    return\n  }\n\n  const order = getBlockOrder(store.document)\n  const currentIndex = order.indexOf(currentId)\n  if (currentIndex < order.length - 1) {\n    const nextId = order[currentIndex + 1]!\n    if (expand) {\n      const selectedIds = store.selection.blocks?.blockIds ?? [currentId]\n      if (!selectedIds.includes(nextId)) {\n        store.selectMultiple([...selectedIds, nextId])\n      }\n    } else {\n      store.select(nextId)\n    }\n  }\n}\n\nfunction getBlockOrder(doc: Document): string[] {\n  const order: string[] = []\n\n  function traverse(blockId: string): void {\n    order.push(blockId)\n    const block = doc.blocks.get(blockId)\n    if (block) {\n      for (const childId of block.children) {\n        traverse(childId)\n      }\n    }\n  }\n\n  traverse(doc.root)\n  return order\n}\n","/**\n * MetadataTooltip - Displays block metadata on hover.\n *\n * Shows ID, type, role, tags, timestamps, and custom metadata.\n */\n\nimport React from 'react'\nimport type { Block } from 'ucp-content'\n\n// =============================================================================\n// STYLES\n// =============================================================================\n\nconst styles = {\n  overlay: {\n    position: 'absolute' as const,\n    top: '100%',\n    right: 0,\n    zIndex: 1000,\n    marginTop: '4px',\n    minWidth: '280px',\n    maxWidth: '400px',\n    backgroundColor: '#fff',\n    border: '1px solid #e5e5e5',\n    borderRadius: '8px',\n    boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',\n    overflow: 'hidden',\n  },\n  header: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: '8px 12px',\n    backgroundColor: '#fafafa',\n    borderBottom: '1px solid #e5e5e5',\n  },\n  headerTitle: {\n    fontSize: '12px',\n    fontWeight: 600,\n    color: '#333',\n  },\n  closeButton: {\n    padding: '2px 6px',\n    border: 'none',\n    backgroundColor: 'transparent',\n    cursor: 'pointer',\n    fontSize: '14px',\n    color: '#999',\n    lineHeight: 1,\n  },\n  content: {\n    padding: '8px 12px',\n    maxHeight: '300px',\n    overflow: 'auto',\n  },\n  section: {\n    marginBottom: '12px',\n  },\n  sectionLast: {\n    marginBottom: 0,\n  },\n  sectionTitle: {\n    fontSize: '10px',\n    fontWeight: 600,\n    color: '#999',\n    textTransform: 'uppercase' as const,\n    letterSpacing: '0.5px',\n    marginBottom: '4px',\n  },\n  row: {\n    display: 'flex',\n    alignItems: 'flex-start',\n    marginBottom: '4px',\n  },\n  label: {\n    flex: '0 0 80px',\n    fontSize: '11px',\n    color: '#666',\n  },\n  value: {\n    flex: 1,\n    fontSize: '11px',\n    color: '#333',\n    wordBreak: 'break-all' as const,\n  },\n  valueCode: {\n    fontFamily: 'Monaco, Consolas, monospace',\n    fontSize: '10px',\n    backgroundColor: '#f5f5f5',\n    padding: '1px 4px',\n    borderRadius: '2px',\n  },\n  tags: {\n    display: 'flex',\n    flexWrap: 'wrap' as const,\n    gap: '4px',\n  },\n  tag: {\n    display: 'inline-block',\n    padding: '2px 6px',\n    fontSize: '10px',\n    backgroundColor: '#e3f2fd',\n    color: '#1976d2',\n    borderRadius: '10px',\n  },\n  edge: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '4px',\n    marginBottom: '4px',\n    fontSize: '10px',\n  },\n  edgeType: {\n    padding: '1px 4px',\n    backgroundColor: '#f5f5f5',\n    borderRadius: '2px',\n    color: '#666',\n  },\n  edgeTarget: {\n    fontFamily: 'Monaco, Consolas, monospace',\n    fontSize: '9px',\n    color: '#999',\n  },\n  noData: {\n    fontSize: '11px',\n    color: '#999',\n    fontStyle: 'italic',\n  },\n  customValue: {\n    fontSize: '10px',\n    fontFamily: 'Monaco, Consolas, monospace',\n    backgroundColor: '#f9f9f9',\n    padding: '4px 6px',\n    borderRadius: '2px',\n    overflow: 'auto',\n    maxHeight: '80px',\n  },\n}\n\n// =============================================================================\n// METADATA TOOLTIP PROPS\n// =============================================================================\n\nexport interface MetadataTooltipProps {\n  block: Block\n  onClose: () => void\n}\n\n// =============================================================================\n// METADATA TOOLTIP COMPONENT\n// =============================================================================\n\n/**\n * Displays detailed metadata for a block.\n */\nexport function MetadataTooltip({ block, onClose }: MetadataTooltipProps): React.ReactElement {\n  const metadata = block.metadata\n\n  const formatDate = (date: Date | undefined): string => {\n    if (!date) return 'N/A'\n    if (typeof date === 'string') {\n      return new Date(date).toLocaleString()\n    }\n    return date.toLocaleString()\n  }\n\n  const truncateId = (id: string): string => {\n    if (id.length <= 20) return id\n    return `${id.slice(0, 10)}...${id.slice(-6)}`\n  }\n\n  return (\n    <div\n      style={styles.overlay}\n      onClick={(e) => e.stopPropagation()}\n      data-testid=\"metadata-tooltip\"\n    >\n      {/* Header */}\n      <div style={styles.header}>\n        <span style={styles.headerTitle}>Block Metadata</span>\n        <button style={styles.closeButton} onClick={onClose} title=\"Close\">\n          \n        </button>\n      </div>\n\n      {/* Content */}\n      <div style={styles.content}>\n        {/* Identity Section */}\n        <div style={styles.section}>\n          <div style={styles.sectionTitle}>Identity</div>\n\n          <div style={styles.row}>\n            <span style={styles.label}>ID</span>\n            <span style={styles.value}>\n              <code style={styles.valueCode} title={block.id}>\n                {truncateId(block.id)}\n              </code>\n            </span>\n          </div>\n\n          <div style={styles.row}>\n            <span style={styles.label}>Type</span>\n            <span style={styles.value}>{block.type}</span>\n          </div>\n\n          {(block.role || metadata?.semanticRole) && (\n            <div style={styles.row}>\n              <span style={styles.label}>Role</span>\n              <span style={styles.value}>\n                {block.role || metadata?.semanticRole}\n              </span>\n            </div>\n          )}\n\n          {block.label && (\n            <div style={styles.row}>\n              <span style={styles.label}>Label</span>\n              <span style={styles.value}>{block.label}</span>\n            </div>\n          )}\n        </div>\n\n        {/* Tags Section */}\n        <div style={styles.section}>\n          <div style={styles.sectionTitle}>Tags</div>\n          {block.tags.length > 0 ? (\n            <div style={styles.tags}>\n              {block.tags.map((tag, index) => (\n                <span key={index} style={styles.tag}>\n                  {tag}\n                </span>\n              ))}\n            </div>\n          ) : (\n            <span style={styles.noData}>No tags</span>\n          )}\n        </div>\n\n        {/* Timestamps Section */}\n        <div style={styles.section}>\n          <div style={styles.sectionTitle}>Timestamps</div>\n\n          <div style={styles.row}>\n            <span style={styles.label}>Created</span>\n            <span style={styles.value}>{formatDate(metadata?.createdAt)}</span>\n          </div>\n\n          <div style={styles.row}>\n            <span style={styles.label}>Modified</span>\n            <span style={styles.value}>{formatDate(metadata?.modifiedAt)}</span>\n          </div>\n        </div>\n\n        {/* Structure Section */}\n        <div style={styles.section}>\n          <div style={styles.sectionTitle}>Structure</div>\n\n          <div style={styles.row}>\n            <span style={styles.label}>Children</span>\n            <span style={styles.value}>{block.children.length}</span>\n          </div>\n\n          <div style={styles.row}>\n            <span style={styles.label}>Content</span>\n            <span style={styles.value}>\n              {block.content.length} chars\n            </span>\n          </div>\n        </div>\n\n        {/* Edges Section */}\n        <div style={styles.section}>\n          <div style={styles.sectionTitle}>Edges ({block.edges.length})</div>\n          {block.edges.length > 0 ? (\n            <div>\n              {block.edges.slice(0, 5).map((edge, index) => (\n                <div key={index} style={styles.edge}>\n                  <span style={styles.edgeType}>{edge.edgeType}</span>\n                  <span></span>\n                  <span style={styles.edgeTarget} title={edge.target}>\n                    {truncateId(edge.target)}\n                  </span>\n                </div>\n              ))}\n              {block.edges.length > 5 && (\n                <span style={styles.noData}>\n                  +{block.edges.length - 5} more edges\n                </span>\n              )}\n            </div>\n          ) : (\n            <span style={styles.noData}>No edges</span>\n          )}\n        </div>\n\n        {/* Custom Metadata Section */}\n        {metadata?.custom && Object.keys(metadata.custom).length > 0 && (\n          <div style={{ ...styles.section, ...styles.sectionLast }}>\n            <div style={styles.sectionTitle}>Custom Metadata</div>\n            <pre style={styles.customValue}>\n              {JSON.stringify(metadata.custom, null, 2)}\n            </pre>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default MetadataTooltip\n","/**\n * BlockEditor - Inline editing component for blocks.\n *\n * Provides a Notion-like editing experience with auto-growing textarea\n * and keyboard shortcuts.\n */\n\nimport React, { useCallback, useRef, useEffect, useState } from 'react'\nimport type { Block, ContentType } from 'ucp-content'\nimport type { EditorStoreInstance } from '../core/EditorStore.js'\nimport { useEditorState } from '../hooks/useEditor.js'\n\n// =============================================================================\n// STYLES\n// =============================================================================\n\nconst styles = {\n  container: {\n    position: 'relative' as const,\n  },\n  textarea: {\n    width: '100%',\n    minHeight: '24px',\n    padding: '0',\n    margin: '0',\n    border: 'none',\n    outline: 'none',\n    resize: 'none' as const,\n    backgroundColor: 'transparent',\n    fontFamily: 'inherit',\n    fontSize: 'inherit',\n    fontWeight: 'inherit',\n    lineHeight: 'inherit',\n    color: 'inherit',\n    overflow: 'hidden',\n  },\n  codeTextarea: {\n    fontFamily: 'Monaco, Consolas, \"Courier New\", monospace',\n    fontSize: '13px',\n    backgroundColor: '#f5f5f5',\n    padding: '12px',\n    borderRadius: '4px',\n    whiteSpace: 'pre' as const,\n  },\n  toolbar: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '4px',\n    padding: '4px 0',\n    marginBottom: '4px',\n    borderBottom: '1px solid #e5e5e5',\n  },\n  toolbarButton: {\n    padding: '2px 6px',\n    border: '1px solid #ddd',\n    borderRadius: '2px',\n    backgroundColor: '#fff',\n    cursor: 'pointer',\n    fontSize: '11px',\n    color: '#666',\n    transition: 'background-color 0.1s',\n  },\n  toolbarButtonHover: {\n    backgroundColor: '#f5f5f5',\n  },\n  typeSelector: {\n    padding: '2px 4px',\n    border: '1px solid #ddd',\n    borderRadius: '2px',\n    backgroundColor: '#fff',\n    fontSize: '11px',\n    cursor: 'pointer',\n  },\n  hint: {\n    fontSize: '10px',\n    color: '#999',\n    marginTop: '4px',\n  },\n}\n\n// =============================================================================\n// BLOCK EDITOR PROPS\n// =============================================================================\n\nexport interface BlockEditorProps {\n  block: Block\n  store: EditorStoreInstance\n}\n\n// =============================================================================\n// BLOCK EDITOR COMPONENT\n// =============================================================================\n\n/**\n * Inline editor for a single block.\n */\nexport function BlockEditor({ block, store }: BlockEditorProps): React.ReactElement {\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const [showToolbar, setShowToolbar] = useState(false)\n\n  const pendingContent = useEditorState(store, (s) => s.pendingContent)\n  const content = pendingContent ?? block.content\n\n  // Focus and select on mount\n  useEffect(() => {\n    if (textareaRef.current) {\n      textareaRef.current.focus()\n      // Place cursor at end\n      textareaRef.current.setSelectionRange(\n        textareaRef.current.value.length,\n        textareaRef.current.value.length\n      )\n    }\n  }, [])\n\n  // Auto-resize textarea\n  useEffect(() => {\n    if (textareaRef.current) {\n      textareaRef.current.style.height = 'auto'\n      textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`\n    }\n  }, [content])\n\n  // Handle content change\n  const handleChange = useCallback(\n    (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      store.updatePendingContent(e.target.value)\n    },\n    [store]\n  )\n\n  // Handle keyboard shortcuts\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n      // Save on Cmd/Ctrl+Enter\n      if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {\n        e.preventDefault()\n        store.stopEditing(true)\n        return\n      }\n\n      // Cancel on Escape\n      if (e.key === 'Escape') {\n        e.preventDefault()\n        store.stopEditing(false)\n        return\n      }\n\n      // Add new block on Enter (when at end and not Shift)\n      if (e.key === 'Enter' && !e.shiftKey && !e.metaKey && !e.ctrlKey) {\n        const textarea = textareaRef.current\n        if (textarea && textarea.selectionStart === textarea.value.length) {\n          // At end of content, create new sibling block\n          e.preventDefault()\n          store.stopEditing(true)\n\n          // Find parent and add sibling\n          const parent = findParent(store, block.id)\n          if (parent) {\n            const newId = store.addBlock(parent, '')\n            store.startEditing(newId)\n          }\n          return\n        }\n      }\n\n      // Tab for indentation in code blocks\n      if (e.key === 'Tab' && block.type === 'code') {\n        e.preventDefault()\n        const textarea = textareaRef.current\n        if (textarea) {\n          const start = textarea.selectionStart\n          const end = textarea.selectionEnd\n          const value = textarea.value\n          const newValue = value.substring(0, start) + '  ' + value.substring(end)\n          store.updatePendingContent(newValue)\n\n          // Restore cursor position\n          setTimeout(() => {\n            textarea.selectionStart = textarea.selectionEnd = start + 2\n          }, 0)\n        }\n        return\n      }\n\n      // Stop propagation for all other keys to prevent global shortcuts\n      e.stopPropagation()\n    },\n    [store, block.id, block.type]\n  )\n\n  // Handle blur (save on focus loss)\n  const handleBlur = useCallback(() => {\n    // Small delay to allow click on toolbar buttons\n    setTimeout(() => {\n      if (document.activeElement?.closest('[data-editor-toolbar]')) {\n        return\n      }\n      store.stopEditing(true)\n    }, 100)\n  }, [store])\n\n  // Handle type change\n  const handleTypeChange = useCallback(\n    (e: React.ChangeEvent<HTMLSelectElement>) => {\n      store.changeBlockType(block.id, e.target.value as ContentType)\n    },\n    [store, block.id]\n  )\n\n  // Determine textarea style\n  const getTextareaStyle = (): React.CSSProperties => {\n    const baseStyle = { ...styles.textarea }\n\n    if (block.type === 'code') {\n      Object.assign(baseStyle, styles.codeTextarea)\n    }\n\n    // Apply role-based styling\n    const role = block.role ?? block.metadata?.semanticRole\n    switch (role) {\n      case 'heading1':\n        baseStyle.fontSize = '28px'\n        baseStyle.fontWeight = '700'\n        break\n      case 'heading2':\n        baseStyle.fontSize = '24px'\n        baseStyle.fontWeight = '600'\n        break\n      case 'heading3':\n        baseStyle.fontSize = '20px'\n        baseStyle.fontWeight = '600'\n        break\n      case 'heading4':\n        baseStyle.fontSize = '18px'\n        baseStyle.fontWeight = '600'\n        break\n      case 'heading5':\n        baseStyle.fontSize = '16px'\n        baseStyle.fontWeight = '600'\n        break\n      case 'heading6':\n        baseStyle.fontSize = '14px'\n        baseStyle.fontWeight = '600'\n        break\n    }\n\n    return baseStyle\n  }\n\n  return (\n    <div\n      style={styles.container}\n      onMouseEnter={() => setShowToolbar(true)}\n      onMouseLeave={() => setShowToolbar(false)}\n    >\n      {/* Toolbar */}\n      {showToolbar && (\n        <div style={styles.toolbar} data-editor-toolbar>\n          <select\n            value={block.type}\n            onChange={handleTypeChange}\n            style={styles.typeSelector}\n            onClick={(e) => e.stopPropagation()}\n          >\n            <option value=\"text\">Text</option>\n            <option value=\"code\">Code</option>\n            <option value=\"table\">Table</option>\n            <option value=\"math\">Math</option>\n            <option value=\"json\">JSON</option>\n            <option value=\"media\">Media</option>\n          </select>\n\n          <button\n            style={styles.toolbarButton}\n            onClick={(e) => {\n              e.stopPropagation()\n              store.deleteBlock(block.id)\n            }}\n            title=\"Delete block\"\n          >\n            Delete\n          </button>\n        </div>\n      )}\n\n      {/* Textarea */}\n      <textarea\n        ref={textareaRef}\n        value={content}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        onBlur={handleBlur}\n        style={getTextareaStyle()}\n        placeholder=\"Type something...\"\n        rows={1}\n        spellCheck={block.type !== 'code'}\n        data-testid={`block-editor-${block.id}`}\n      />\n\n      {/* Hint */}\n      <div style={styles.hint}>\n        Press <kbd>Esc</kbd> to cancel, <kbd>Cmd+Enter</kbd> to save\n      </div>\n    </div>\n  )\n}\n\n// =============================================================================\n// HELPERS\n// =============================================================================\n\nfunction findParent(store: EditorStoreInstance, blockId: string): string | undefined {\n  const document = store.document\n  if (!document) return undefined\n\n  for (const [id, block] of document.blocks) {\n    if (block.children.includes(blockId)) {\n      return id\n    }\n  }\n  return undefined\n}\n\nexport default BlockEditor\n","/**\n * BlockRenderer - Renders a block based on its type and role.\n *\n * Handles selection, editing, drag-and-drop, and metadata display.\n */\n\nimport React, { useCallback, useState, useRef } from 'react'\nimport type { Block, Document, BlockId } from 'ucp-content'\nimport type { EditorStoreInstance } from '../core/EditorStore.js'\nimport { useEditorState } from '../hooks/useEditor.js'\nimport { MetadataTooltip } from './MetadataTooltip.js'\nimport { BlockEditor } from './BlockEditor.js'\n\n// =============================================================================\n// STYLES\n// =============================================================================\n\nconst styles = {\n  blockWrapper: {\n    position: 'relative' as const,\n    marginBottom: '4px',\n  },\n  block: {\n    position: 'relative' as const,\n    padding: '4px 8px',\n    borderRadius: '4px',\n    cursor: 'pointer',\n    transition: 'background-color 0.1s, box-shadow 0.1s',\n    minHeight: '24px',\n  },\n  blockHover: {\n    backgroundColor: '#f5f5f5',\n  },\n  blockSelected: {\n    backgroundColor: '#e3f2fd',\n    boxShadow: '0 0 0 2px #2196f3',\n  },\n  blockEditing: {\n    backgroundColor: '#fff',\n    boxShadow: '0 0 0 2px #4caf50',\n  },\n  blockDragTarget: {\n    backgroundColor: '#e8f5e9',\n  },\n  dragHandle: {\n    position: 'absolute' as const,\n    left: '-24px',\n    top: '50%',\n    transform: 'translateY(-50%)',\n    width: '16px',\n    height: '16px',\n    cursor: 'grab',\n    opacity: 0,\n    transition: 'opacity 0.1s',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    color: '#999',\n    fontSize: '10px',\n  },\n  dragHandleVisible: {\n    opacity: 1,\n  },\n  dropIndicator: {\n    position: 'absolute' as const,\n    left: 0,\n    right: 0,\n    height: '2px',\n    backgroundColor: '#2196f3',\n    pointerEvents: 'none' as const,\n  },\n  dropIndicatorBefore: {\n    top: '-2px',\n  },\n  dropIndicatorAfter: {\n    bottom: '-2px',\n  },\n  dropIndicatorInside: {\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n    height: 'auto',\n    border: '2px dashed #2196f3',\n    backgroundColor: 'rgba(33, 150, 243, 0.1)',\n  },\n  children: {\n    paddingLeft: '24px',\n    borderLeft: '1px solid #e5e5e5',\n    marginLeft: '8px',\n  },\n  addButton: {\n    padding: '2px 8px',\n    border: 'none',\n    backgroundColor: 'transparent',\n    color: '#999',\n    cursor: 'pointer',\n    fontSize: '12px',\n    opacity: 0,\n    transition: 'opacity 0.1s',\n  },\n  addButtonVisible: {\n    opacity: 1,\n  },\n  // Content type styles\n  heading1: {\n    fontSize: '28px',\n    fontWeight: 700,\n    marginTop: '16px',\n    marginBottom: '8px',\n  },\n  heading2: {\n    fontSize: '24px',\n    fontWeight: 600,\n    marginTop: '14px',\n    marginBottom: '6px',\n  },\n  heading3: {\n    fontSize: '20px',\n    fontWeight: 600,\n    marginTop: '12px',\n    marginBottom: '4px',\n  },\n  heading4: {\n    fontSize: '18px',\n    fontWeight: 600,\n    marginTop: '10px',\n    marginBottom: '4px',\n  },\n  heading5: {\n    fontSize: '16px',\n    fontWeight: 600,\n    marginTop: '8px',\n    marginBottom: '4px',\n  },\n  heading6: {\n    fontSize: '14px',\n    fontWeight: 600,\n    marginTop: '8px',\n    marginBottom: '4px',\n  },\n  paragraph: {\n    fontSize: '14px',\n    lineHeight: '1.6',\n  },\n  code: {\n    fontFamily: 'Monaco, Consolas, \"Courier New\", monospace',\n    fontSize: '13px',\n    backgroundColor: '#f5f5f5',\n    padding: '12px',\n    borderRadius: '4px',\n    overflow: 'auto',\n    whiteSpace: 'pre-wrap' as const,\n  },\n  quote: {\n    borderLeft: '3px solid #ddd',\n    paddingLeft: '12px',\n    color: '#666',\n    fontStyle: 'italic',\n  },\n  table: {\n    borderCollapse: 'collapse' as const,\n    width: '100%',\n    fontSize: '13px',\n  },\n}\n\n// =============================================================================\n// BLOCK RENDERER PROPS\n// =============================================================================\n\nexport interface BlockRendererProps {\n  block: Block\n  document: Document\n  store: EditorStoreInstance\n  depth: number\n  path: BlockId[]\n}\n\n// =============================================================================\n// BLOCK RENDERER COMPONENT\n// =============================================================================\n\n/**\n * Renders a single block with its children.\n */\nexport function BlockRenderer({\n  block,\n  document,\n  store,\n  depth,\n  path,\n}: BlockRendererProps): React.ReactElement {\n  const [isHovered, setIsHovered] = useState(false)\n  const [showTooltip, setShowTooltip] = useState(false)\n  const blockRef = useRef<HTMLDivElement>(null)\n\n  // Get state from store\n  const selection = useEditorState(store, (s) => s.selection)\n  const editingBlockId = useEditorState(store, (s) => s.editingBlockId)\n  const drag = useEditorState(store, (s) => s.drag)\n\n  const isSelected =\n    selection.type === 'block'\n      ? selection.blocks?.blockIds.includes(block.id) ?? false\n      : selection.focusedBlockId === block.id\n\n  const isEditing = editingBlockId === block.id\n  const isDragSource = drag.sourceId === block.id\n  const isDragTarget = drag.targetId === block.id\n\n  // Event handlers\n  const handleClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation()\n      if (!isEditing) {\n        if (e.shiftKey && selection.focusedBlockId) {\n          // Extend selection\n          const currentIds = selection.blocks?.blockIds ?? []\n          if (!currentIds.includes(block.id)) {\n            store.selectMultiple([...currentIds, block.id])\n          }\n        } else {\n          store.select(block.id)\n        }\n      }\n    },\n    [store, block.id, isEditing, selection]\n  )\n\n  const handleDoubleClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation()\n      if (!isEditing) {\n        store.startEditing(block.id)\n      }\n    },\n    [store, block.id, isEditing]\n  )\n\n  const handleMouseEnter = useCallback(() => {\n    setIsHovered(true)\n  }, [])\n\n  const handleMouseLeave = useCallback(() => {\n    setIsHovered(false)\n    setShowTooltip(false)\n  }, [])\n\n  // Drag handlers\n  const handleDragStart = useCallback(\n    (e: React.DragEvent) => {\n      e.dataTransfer.effectAllowed = 'move'\n      e.dataTransfer.setData('text/plain', block.id)\n      store.startDrag(block.id)\n    },\n    [store, block.id]\n  )\n\n  const handleDragOver = useCallback(\n    (e: React.DragEvent) => {\n      if (!drag.isDragging || drag.sourceId === block.id) return\n\n      e.preventDefault()\n      e.dataTransfer.dropEffect = 'move'\n\n      // Determine drop position based on mouse position\n      const rect = blockRef.current?.getBoundingClientRect()\n      if (!rect) return\n\n      const relativeY = e.clientY - rect.top\n      const height = rect.height\n\n      let position: 'before' | 'after' | 'inside'\n      if (relativeY < height * 0.25) {\n        position = 'before'\n      } else if (relativeY > height * 0.75) {\n        position = 'after'\n      } else {\n        position = 'inside'\n      }\n\n      store.updateDragTarget(block.id, position)\n    },\n    [store, block.id, drag.isDragging, drag.sourceId]\n  )\n\n  const handleDragLeave = useCallback(() => {\n    // Only clear if leaving this specific block\n  }, [])\n\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault()\n      if (drag.isDragging) {\n        store.endDrag(true)\n      }\n    },\n    [store, drag.isDragging]\n  )\n\n  const handleDragEnd = useCallback(() => {\n    store.endDrag(false)\n  }, [store])\n\n  // Add child handler\n  const handleAddChild = useCallback(() => {\n    const newId = store.addBlock(block.id, '')\n    store.startEditing(newId)\n  }, [store, block.id])\n\n  // Tooltip toggle\n  const handleTooltipToggle = useCallback(() => {\n    setShowTooltip((prev) => !prev)\n  }, [])\n\n  // Get block style based on role\n  const getBlockStyle = () => {\n    const baseStyle = { ...styles.block }\n\n    if (isHovered && !isEditing) {\n      Object.assign(baseStyle, styles.blockHover)\n    }\n    if (isSelected && !isEditing) {\n      Object.assign(baseStyle, styles.blockSelected)\n    }\n    if (isEditing) {\n      Object.assign(baseStyle, styles.blockEditing)\n    }\n    if (isDragTarget && !isDragSource) {\n      Object.assign(baseStyle, styles.blockDragTarget)\n    }\n\n    return baseStyle\n  }\n\n  // Render content based on type and role\n  const renderContent = () => {\n    if (isEditing) {\n      return <BlockEditor block={block} store={store} />\n    }\n\n    return <BlockContent block={block} />\n  }\n\n  // Render drop indicator\n  const renderDropIndicator = () => {\n    if (!isDragTarget || isDragSource) return null\n\n    switch (drag.position) {\n      case 'before':\n        return (\n          <div\n            style={{ ...styles.dropIndicator, ...styles.dropIndicatorBefore }}\n          />\n        )\n      case 'after':\n        return (\n          <div\n            style={{ ...styles.dropIndicator, ...styles.dropIndicatorAfter }}\n          />\n        )\n      case 'inside':\n        return <div style={{ ...styles.dropIndicator, ...styles.dropIndicatorInside }} />\n      default:\n        return null\n    }\n  }\n\n  return (\n    <div\n      style={styles.blockWrapper}\n      data-block-id={block.id}\n      data-testid={`block-${block.id}`}\n    >\n      <div\n        ref={blockRef}\n        style={getBlockStyle()}\n        onClick={handleClick}\n        onDoubleClick={handleDoubleClick}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n        draggable={!isEditing && store.config.enableDragDrop}\n        onDragStart={handleDragStart}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n        onDrop={handleDrop}\n        onDragEnd={handleDragEnd}\n      >\n        {/* Drag handle */}\n        <div\n          style={{\n            ...styles.dragHandle,\n            ...(isHovered ? styles.dragHandleVisible : {}),\n          }}\n          onMouseDown={(e) => e.stopPropagation()}\n        >\n          \n        </div>\n\n        {/* Content */}\n        {renderContent()}\n\n        {/* Drop indicator */}\n        {renderDropIndicator()}\n\n        {/* Metadata tooltip trigger */}\n        {isHovered && !isEditing && (\n          <button\n            style={{\n              position: 'absolute',\n              right: '4px',\n              top: '4px',\n              padding: '2px 6px',\n              fontSize: '10px',\n              border: '1px solid #ddd',\n              borderRadius: '2px',\n              backgroundColor: '#fff',\n              cursor: 'pointer',\n            }}\n            onClick={(e) => {\n              e.stopPropagation()\n              handleTooltipToggle()\n            }}\n            title=\"Show metadata\"\n          >\n            i\n          </button>\n        )}\n\n        {/* Metadata tooltip */}\n        {showTooltip && (\n          <MetadataTooltip block={block} onClose={() => setShowTooltip(false)} />\n        )}\n      </div>\n\n      {/* Children */}\n      {block.children.length > 0 && (\n        <div style={styles.children}>\n          {block.children.map((childId) => {\n            const child = document.blocks.get(childId)\n            if (!child) return null\n            return (\n              <BlockRenderer\n                key={childId}\n                block={child}\n                document={document}\n                store={store}\n                depth={depth + 1}\n                path={[...path, block.id]}\n              />\n            )\n          })}\n        </div>\n      )}\n\n      {/* Add child button */}\n      {isHovered && !isEditing && (\n        <button\n          style={{\n            ...styles.addButton,\n            ...(isHovered ? styles.addButtonVisible : {}),\n          }}\n          onClick={(e) => {\n            e.stopPropagation()\n            handleAddChild()\n          }}\n        >\n          + Add block\n        </button>\n      )}\n    </div>\n  )\n}\n\n// =============================================================================\n// BLOCK CONTENT\n// =============================================================================\n\ninterface BlockContentProps {\n  block: Block\n}\n\nfunction BlockContent({ block }: BlockContentProps): React.ReactElement {\n  const role = block.role ?? block.metadata?.semanticRole\n  const type = block.type\n\n  // Get style based on role\n  const getContentStyle = (): React.CSSProperties => {\n    switch (role) {\n      case 'heading1':\n        return styles.heading1\n      case 'heading2':\n        return styles.heading2\n      case 'heading3':\n        return styles.heading3\n      case 'heading4':\n        return styles.heading4\n      case 'heading5':\n        return styles.heading5\n      case 'heading6':\n        return styles.heading6\n      case 'code':\n        return styles.code\n      case 'quote':\n        return styles.quote\n      default:\n        return styles.paragraph\n    }\n  }\n\n  // Render based on type\n  switch (type) {\n    case 'code':\n      return (\n        <pre style={styles.code}>\n          <code>{block.content || '\\u00A0'}</code>\n        </pre>\n      )\n\n    case 'table':\n      // Simple table rendering\n      return (\n        <div style={{ overflow: 'auto' }}>\n          <pre style={{ ...styles.code, whiteSpace: 'pre' }}>\n            {block.content || 'Empty table'}\n          </pre>\n        </div>\n      )\n\n    case 'math':\n      return (\n        <div\n          style={{\n            fontFamily: 'serif',\n            fontStyle: 'italic',\n            textAlign: 'center',\n            padding: '8px',\n          }}\n        >\n          {block.content || 'Empty equation'}\n        </div>\n      )\n\n    case 'media':\n      return (\n        <div\n          style={{\n            padding: '8px',\n            backgroundColor: '#f5f5f5',\n            borderRadius: '4px',\n            textAlign: 'center',\n          }}\n        >\n          [Media: {block.content || 'No source'}]\n        </div>\n      )\n\n    case 'json':\n      return (\n        <pre style={styles.code}>\n          <code>{formatJson(block.content)}</code>\n        </pre>\n      )\n\n    default:\n      return (\n        <div style={getContentStyle()}>\n          {block.content || <span style={{ color: '#999' }}>Empty block</span>}\n        </div>\n      )\n  }\n}\n\nfunction formatJson(content: string): string {\n  try {\n    return JSON.stringify(JSON.parse(content), null, 2)\n  } catch {\n    return content\n  }\n}\n\nexport default BlockRenderer\n","/**\n * GraphView - Visual graph representation of the document structure.\n *\n * Displays blocks as nodes and relationships as edges in an interactive\n * DAG (Directed Acyclic Graph) visualization.\n */\n\nimport React, { useCallback, useMemo, useRef, useState, useEffect } from 'react'\nimport type { BlockId, Document } from 'ucp-content'\nimport type { EditorStoreInstance } from '../core/EditorStore.js'\nimport type { GraphLayout, GraphNode, GraphEdge } from '../types/editor.js'\nimport { useEditorState } from '../hooks/useEditor.js'\n\n// =============================================================================\n// STYLES\n// =============================================================================\n\nconst styles = {\n  container: {\n    position: 'relative' as const,\n    width: '100%',\n    height: '100%',\n    overflow: 'hidden',\n    backgroundColor: '#fafafa',\n  },\n  canvas: {\n    position: 'absolute' as const,\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n  },\n  controls: {\n    position: 'absolute' as const,\n    top: '16px',\n    right: '16px',\n    display: 'flex',\n    flexDirection: 'column' as const,\n    gap: '8px',\n    zIndex: 10,\n  },\n  controlGroup: {\n    display: 'flex',\n    gap: '4px',\n    backgroundColor: '#fff',\n    padding: '4px',\n    borderRadius: '4px',\n    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.1)',\n  },\n  controlButton: {\n    padding: '6px 12px',\n    border: '1px solid #ddd',\n    borderRadius: '4px',\n    backgroundColor: '#fff',\n    cursor: 'pointer',\n    fontSize: '12px',\n  },\n  controlButtonActive: {\n    backgroundColor: '#e3f2fd',\n    borderColor: '#2196f3',\n  },\n  legend: {\n    position: 'absolute' as const,\n    bottom: '16px',\n    left: '16px',\n    backgroundColor: '#fff',\n    padding: '12px',\n    borderRadius: '4px',\n    boxShadow: '0 2px 4px rgba(0, 0, 0, 0.1)',\n    fontSize: '11px',\n  },\n  legendTitle: {\n    fontWeight: 600,\n    marginBottom: '8px',\n  },\n  legendItem: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '8px',\n    marginBottom: '4px',\n  },\n  legendColor: {\n    width: '16px',\n    height: '3px',\n    borderRadius: '1px',\n  },\n  minimap: {\n    position: 'absolute' as const,\n    bottom: '16px',\n    right: '16px',\n    width: '150px',\n    height: '100px',\n    backgroundColor: '#fff',\n    border: '1px solid #ddd',\n    borderRadius: '4px',\n    overflow: 'hidden',\n  },\n  nodeTooltip: {\n    position: 'absolute' as const,\n    backgroundColor: '#333',\n    color: '#fff',\n    padding: '6px 10px',\n    borderRadius: '4px',\n    fontSize: '11px',\n    maxWidth: '200px',\n    zIndex: 100,\n    pointerEvents: 'none' as const,\n  },\n}\n\n// =============================================================================\n// EDGE COLORS\n// =============================================================================\n\nconst EDGE_COLORS: Record<string, string> = {\n  // Structural (default)\n  parent_child: '#9e9e9e',\n  // Derivation\n  derived_from: '#2196f3',\n  supersedes: '#1976d2',\n  transformed_from: '#1565c0',\n  // Reference\n  references: '#4caf50',\n  cited_by: '#388e3c',\n  links_to: '#2e7d32',\n  // Semantic\n  supports: '#9c27b0',\n  contradicts: '#f44336',\n  elaborates: '#7b1fa2',\n  summarizes: '#6a1b9a',\n  // Version\n  version_of: '#ff9800',\n  alternative_of: '#f57c00',\n  translation_of: '#ef6c00',\n}\n\n// =============================================================================\n// GRAPH VIEW PROPS\n// =============================================================================\n\nexport interface GraphViewProps {\n  store: EditorStoreInstance\n}\n\n// =============================================================================\n// GRAPH VIEW COMPONENT\n// =============================================================================\n\n/**\n * Interactive graph visualization of the document structure.\n */\nexport function GraphView({ store }: GraphViewProps): React.ReactElement {\n  const containerRef = useRef<HTMLDivElement>(null)\n  const canvasRef = useRef<HTMLCanvasElement>(null)\n\n  const document = useEditorState(store, (s) => s.document)\n  const graphState = useEditorState(store, (s) => s.graph)\n  const selection = useEditorState(store, (s) => s.selection)\n\n  const [viewport, setViewport] = useState({ x: 0, y: 0, zoom: 1 })\n  const [isDragging, setIsDragging] = useState(false)\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 })\n  const [hoveredNodeId, setHoveredNodeId] = useState<BlockId | null>(null)\n  const [tooltipPos, setTooltipPos] = useState({ x: 0, y: 0 })\n\n  // Compute graph layout\n  const { nodes, edges } = useMemo(() => {\n    if (!document) {\n      return { nodes: new Map<BlockId, GraphNode>(), edges: [] }\n    }\n\n    return computeLayout(document, graphState.layout, selection.focusedBlockId)\n  }, [document, graphState.layout, selection.focusedBlockId])\n\n  // Render canvas\n  useEffect(() => {\n    const canvas = canvasRef.current\n    const container = containerRef.current\n    if (!canvas || !container) return\n\n    const ctx = canvas.getContext('2d')\n    if (!ctx) return\n\n    // Set canvas size\n    const rect = container.getBoundingClientRect()\n    canvas.width = rect.width * window.devicePixelRatio\n    canvas.height = rect.height * window.devicePixelRatio\n    canvas.style.width = `${rect.width}px`\n    canvas.style.height = `${rect.height}px`\n    ctx.scale(window.devicePixelRatio, window.devicePixelRatio)\n\n    // Clear\n    ctx.clearRect(0, 0, rect.width, rect.height)\n\n    // Apply viewport transform\n    ctx.save()\n    ctx.translate(viewport.x + rect.width / 2, viewport.y + rect.height / 2)\n    ctx.scale(viewport.zoom, viewport.zoom)\n\n    // Draw edges\n    for (const edge of edges) {\n      drawEdge(ctx, edge, nodes, hoveredNodeId)\n    }\n\n    // Draw nodes\n    for (const node of nodes.values()) {\n      drawNode(ctx, node, selection.focusedBlockId === node.id, hoveredNodeId === node.id)\n    }\n\n    ctx.restore()\n  }, [nodes, edges, viewport, selection.focusedBlockId, hoveredNodeId])\n\n  // Mouse handlers\n  const handleMouseDown = useCallback((e: React.MouseEvent) => {\n    setIsDragging(true)\n    setDragStart({ x: e.clientX - viewport.x, y: e.clientY - viewport.y })\n  }, [viewport])\n\n  const handleMouseMove = useCallback(\n    (e: React.MouseEvent) => {\n      if (isDragging) {\n        setViewport({\n          ...viewport,\n          x: e.clientX - dragStart.x,\n          y: e.clientY - dragStart.y,\n        })\n      } else {\n        // Check for node hover\n        const container = containerRef.current\n        if (!container) return\n\n        const rect = container.getBoundingClientRect()\n        const mouseX = (e.clientX - rect.left - rect.width / 2 - viewport.x) / viewport.zoom\n        const mouseY = (e.clientY - rect.top - rect.height / 2 - viewport.y) / viewport.zoom\n\n        let found: BlockId | null = null\n        for (const node of nodes.values()) {\n          if (\n            mouseX >= node.x - node.width / 2 &&\n            mouseX <= node.x + node.width / 2 &&\n            mouseY >= node.y - node.height / 2 &&\n            mouseY <= node.y + node.height / 2\n          ) {\n            found = node.id\n            setTooltipPos({ x: e.clientX, y: e.clientY })\n            break\n          }\n        }\n        setHoveredNodeId(found)\n      }\n    },\n    [isDragging, dragStart, viewport, nodes]\n  )\n\n  const handleMouseUp = useCallback(() => {\n    setIsDragging(false)\n  }, [])\n\n  const handleClick = useCallback(() => {\n    if (hoveredNodeId) {\n      store.select(hoveredNodeId)\n    }\n  }, [store, hoveredNodeId])\n\n  const handleWheel = useCallback(\n    (e: React.WheelEvent) => {\n      e.preventDefault()\n      const delta = e.deltaY > 0 ? 0.9 : 1.1\n      setViewport((v) => ({\n        ...v,\n        zoom: Math.max(0.1, Math.min(3, v.zoom * delta)),\n      }))\n    },\n    []\n  )\n\n  // Control handlers\n  const handleLayoutChange = useCallback(\n    (layout: GraphLayout) => {\n      store.setGraphLayout(layout)\n    },\n    [store]\n  )\n\n  const handleZoomIn = useCallback(() => {\n    setViewport((v) => ({ ...v, zoom: Math.min(3, v.zoom * 1.2) }))\n  }, [])\n\n  const handleZoomOut = useCallback(() => {\n    setViewport((v) => ({ ...v, zoom: Math.max(0.1, v.zoom / 1.2) }))\n  }, [])\n\n  const handleResetView = useCallback(() => {\n    setViewport({ x: 0, y: 0, zoom: 1 })\n  }, [])\n\n  // Get hovered node for tooltip\n  const hoveredNode = hoveredNodeId ? nodes.get(hoveredNodeId) : null\n\n  return (\n    <div\n      ref={containerRef}\n      style={styles.container}\n      onMouseDown={handleMouseDown}\n      onMouseMove={handleMouseMove}\n      onMouseUp={handleMouseUp}\n      onMouseLeave={handleMouseUp}\n      onClick={handleClick}\n      onWheel={handleWheel}\n      data-testid=\"graph-view\"\n    >\n      <canvas ref={canvasRef} style={styles.canvas} />\n\n      {/* Controls */}\n      <div style={styles.controls}>\n        {/* Layout selector */}\n        <div style={styles.controlGroup}>\n          <LayoutButton\n            layout=\"hierarchical\"\n            currentLayout={graphState.layout}\n            onClick={handleLayoutChange}\n          />\n          <LayoutButton\n            layout=\"force\"\n            currentLayout={graphState.layout}\n            onClick={handleLayoutChange}\n          />\n          <LayoutButton\n            layout=\"radial\"\n            currentLayout={graphState.layout}\n            onClick={handleLayoutChange}\n          />\n        </div>\n\n        {/* Zoom controls */}\n        <div style={styles.controlGroup}>\n          <button onClick={handleZoomIn} style={styles.controlButton}>\n            +\n          </button>\n          <button onClick={handleZoomOut} style={styles.controlButton}>\n            -\n          </button>\n          <button onClick={handleResetView} style={styles.controlButton}>\n            Reset\n          </button>\n        </div>\n      </div>\n\n      {/* Legend */}\n      <div style={styles.legend}>\n        <div style={styles.legendTitle}>Edge Types</div>\n        <div style={styles.legendItem}>\n          <div style={{ ...styles.legendColor, backgroundColor: EDGE_COLORS.parent_child }} />\n          <span>Parent-Child</span>\n        </div>\n        <div style={styles.legendItem}>\n          <div style={{ ...styles.legendColor, backgroundColor: EDGE_COLORS.references }} />\n          <span>References</span>\n        </div>\n        <div style={styles.legendItem}>\n          <div style={{ ...styles.legendColor, backgroundColor: EDGE_COLORS.supports }} />\n          <span>Semantic</span>\n        </div>\n      </div>\n\n      {/* Node tooltip */}\n      {hoveredNode && (\n        <div\n          style={{\n            ...styles.nodeTooltip,\n            left: tooltipPos.x + 10,\n            top: tooltipPos.y + 10,\n          }}\n        >\n          <div><strong>{hoveredNode.block.type}</strong></div>\n          <div>\n            {hoveredNode.block.content.slice(0, 50)}\n            {hoveredNode.block.content.length > 50 ? '...' : ''}\n          </div>\n          <div style={{ color: '#aaa', fontSize: '9px' }}>\n            {hoveredNode.block.children.length} children, {hoveredNode.block.edges.length} edges\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// =============================================================================\n// LAYOUT BUTTON\n// =============================================================================\n\ninterface LayoutButtonProps {\n  layout: GraphLayout\n  currentLayout: GraphLayout\n  onClick: (layout: GraphLayout) => void\n}\n\nfunction LayoutButton({ layout, currentLayout, onClick }: LayoutButtonProps) {\n  const labels: Record<GraphLayout, string> = {\n    hierarchical: 'Tree',\n    force: 'Force',\n    dagre: 'DAG',\n    radial: 'Radial',\n  }\n\n  return (\n    <button\n      onClick={() => onClick(layout)}\n      style={{\n        ...styles.controlButton,\n        ...(layout === currentLayout ? styles.controlButtonActive : {}),\n      }}\n    >\n      {labels[layout]}\n    </button>\n  )\n}\n\n// =============================================================================\n// LAYOUT COMPUTATION\n// =============================================================================\n\nfunction computeLayout(\n  doc: Document,\n  layout: GraphLayout,\n  selectedId?: BlockId\n): { nodes: Map<BlockId, GraphNode>; edges: GraphEdge[] } {\n  const nodes = new Map<BlockId, GraphNode>()\n  const edges: GraphEdge[] = []\n\n  // Node dimensions\n  const NODE_WIDTH = 120\n  const NODE_HEIGHT = 40\n  const H_SPACING = 40\n  const V_SPACING = 60\n\n  // Compute node positions based on layout\n  switch (layout) {\n    case 'hierarchical':\n      computeHierarchicalLayout(doc, nodes, NODE_WIDTH, NODE_HEIGHT, H_SPACING, V_SPACING)\n      break\n    case 'force':\n      computeForceLayout(doc, nodes, NODE_WIDTH, NODE_HEIGHT)\n      break\n    case 'radial':\n      computeRadialLayout(doc, nodes, NODE_WIDTH, NODE_HEIGHT)\n      break\n    default:\n      computeHierarchicalLayout(doc, nodes, NODE_WIDTH, NODE_HEIGHT, H_SPACING, V_SPACING)\n  }\n\n  // Mark selected node\n  if (selectedId && nodes.has(selectedId)) {\n    const node = nodes.get(selectedId)!\n    nodes.set(selectedId, { ...node, isSelected: true })\n  }\n\n  // Create edges for parent-child relationships\n  for (const [blockId, block] of doc.blocks) {\n    for (const childId of block.children) {\n      const sourceNode = nodes.get(blockId)\n      const targetNode = nodes.get(childId)\n      if (sourceNode && targetNode) {\n        edges.push({\n          id: `${blockId}->${childId}`,\n          sourceId: blockId,\n          targetId: childId,\n          edgeType: 'parent_child',\n          points: [\n            { x: sourceNode.x, y: sourceNode.y + sourceNode.height / 2 },\n            { x: targetNode.x, y: targetNode.y - targetNode.height / 2 },\n          ],\n          isHighlighted: false,\n        })\n      }\n    }\n\n    // Create edges for explicit relationships\n    for (const edge of block.edges) {\n      const sourceNode = nodes.get(blockId)\n      const targetNode = nodes.get(edge.target)\n      if (sourceNode && targetNode) {\n        edges.push({\n          id: `${blockId}-${edge.edgeType}->${edge.target}`,\n          sourceId: blockId,\n          targetId: edge.target,\n          edgeType: edge.edgeType,\n          points: [\n            { x: sourceNode.x + sourceNode.width / 2, y: sourceNode.y },\n            { x: targetNode.x - targetNode.width / 2, y: targetNode.y },\n          ],\n          isHighlighted: false,\n        })\n      }\n    }\n  }\n\n  return { nodes, edges }\n}\n\nfunction computeHierarchicalLayout(\n  doc: Document,\n  nodes: Map<BlockId, GraphNode>,\n  nodeWidth: number,\n  nodeHeight: number,\n  hSpacing: number,\n  vSpacing: number\n): void {\n  // Compute depth of each node\n  const depths = new Map<BlockId, number>()\n  const childrenCounts = new Map<number, number>()\n\n  function computeDepth(blockId: BlockId, depth: number): void {\n    depths.set(blockId, depth)\n    childrenCounts.set(depth, (childrenCounts.get(depth) ?? 0) + 1)\n\n    const block = doc.blocks.get(blockId)\n    if (block) {\n      for (const childId of block.children) {\n        computeDepth(childId, depth + 1)\n      }\n    }\n  }\n\n  computeDepth(doc.root, 0)\n\n  // Position nodes\n  const xPositions = new Map<number, number>()\n\n  for (const [blockId, depth] of depths) {\n    const block = doc.blocks.get(blockId)\n    if (!block) continue\n\n    const xPos = xPositions.get(depth) ?? 0\n    const totalAtDepth = childrenCounts.get(depth) ?? 1\n    const x = xPos - ((totalAtDepth - 1) * (nodeWidth + hSpacing)) / 2\n\n    nodes.set(blockId, {\n      id: blockId,\n      x,\n      y: depth * (nodeHeight + vSpacing),\n      width: nodeWidth,\n      height: nodeHeight,\n      block,\n      depth,\n      isExpanded: true,\n      isSelected: false,\n      isHighlighted: false,\n    })\n\n    xPositions.set(depth, xPos + nodeWidth + hSpacing)\n  }\n}\n\nfunction computeForceLayout(\n  doc: Document,\n  nodes: Map<BlockId, GraphNode>,\n  nodeWidth: number,\n  nodeHeight: number\n): void {\n  // Simple force-directed layout simulation\n  const positions = new Map<BlockId, { x: number; y: number; vx: number; vy: number }>()\n\n  // Initialize with random positions\n  let i = 0\n  for (const blockId of doc.blocks.keys()) {\n    const angle = (i / doc.blocks.size) * 2 * Math.PI\n    const radius = 150\n    positions.set(blockId, {\n      x: Math.cos(angle) * radius,\n      y: Math.sin(angle) * radius,\n      vx: 0,\n      vy: 0,\n    })\n    i++\n  }\n\n  // Simple force simulation (reduced iterations for performance)\n  for (let iter = 0; iter < 50; iter++) {\n    // Repulsion between all nodes\n    for (const [id1, pos1] of positions) {\n      for (const [id2, pos2] of positions) {\n        if (id1 >= id2) continue\n        const dx = pos2.x - pos1.x\n        const dy = pos2.y - pos1.y\n        const dist = Math.max(1, Math.sqrt(dx * dx + dy * dy))\n        const force = 1000 / (dist * dist)\n        const fx = (dx / dist) * force\n        const fy = (dy / dist) * force\n        pos1.vx -= fx\n        pos1.vy -= fy\n        pos2.vx += fx\n        pos2.vy += fy\n      }\n    }\n\n    // Attraction along edges (parent-child)\n    for (const [blockId, block] of doc.blocks) {\n      const pos1 = positions.get(blockId)\n      if (!pos1) continue\n      for (const childId of block.children) {\n        const pos2 = positions.get(childId)\n        if (!pos2) continue\n        const dx = pos2.x - pos1.x\n        const dy = pos2.y - pos1.y\n        const dist = Math.max(1, Math.sqrt(dx * dx + dy * dy))\n        const force = dist * 0.01\n        const fx = (dx / dist) * force\n        const fy = (dy / dist) * force\n        pos1.vx += fx\n        pos1.vy += fy\n        pos2.vx -= fx\n        pos2.vy -= fy\n      }\n    }\n\n    // Apply velocities with damping\n    for (const pos of positions.values()) {\n      pos.x += pos.vx * 0.1\n      pos.y += pos.vy * 0.1\n      pos.vx *= 0.9\n      pos.vy *= 0.9\n    }\n  }\n\n  // Create nodes\n  for (const [blockId, pos] of positions) {\n    const block = doc.blocks.get(blockId)\n    if (!block) continue\n\n    nodes.set(blockId, {\n      id: blockId,\n      x: pos.x,\n      y: pos.y,\n      width: nodeWidth,\n      height: nodeHeight,\n      block,\n      depth: 0,\n      isExpanded: true,\n      isSelected: false,\n      isHighlighted: false,\n    })\n  }\n}\n\nfunction computeRadialLayout(\n  doc: Document,\n  nodes: Map<BlockId, GraphNode>,\n  nodeWidth: number,\n  nodeHeight: number\n): void {\n  // Radial layout with root at center\n  const depths = new Map<BlockId, number>()\n\n  function computeDepth(blockId: BlockId, depth: number): void {\n    depths.set(blockId, depth)\n    const block = doc.blocks.get(blockId)\n    if (block) {\n      for (const childId of block.children) {\n        computeDepth(childId, depth + 1)\n      }\n    }\n  }\n\n  computeDepth(doc.root, 0)\n\n  // Group by depth\n  const byDepth = new Map<number, BlockId[]>()\n  for (const [blockId, depth] of depths) {\n    if (!byDepth.has(depth)) {\n      byDepth.set(depth, [])\n    }\n    byDepth.get(depth)!.push(blockId)\n  }\n\n  // Position nodes in concentric circles\n  const radiusStep = 100\n\n  for (const [depth, blockIds] of byDepth) {\n    const radius = depth * radiusStep\n    const angleStep = (2 * Math.PI) / blockIds.length\n\n    blockIds.forEach((blockId, index) => {\n      const block = doc.blocks.get(blockId)\n      if (!block) return\n\n      const angle = index * angleStep - Math.PI / 2\n      nodes.set(blockId, {\n        id: blockId,\n        x: Math.cos(angle) * radius,\n        y: Math.sin(angle) * radius,\n        width: nodeWidth,\n        height: nodeHeight,\n        block,\n        depth,\n        isExpanded: true,\n        isSelected: false,\n        isHighlighted: false,\n      })\n    })\n  }\n}\n\n// =============================================================================\n// DRAWING FUNCTIONS\n// =============================================================================\n\nfunction drawNode(\n  ctx: CanvasRenderingContext2D,\n  node: GraphNode,\n  isSelected: boolean,\n  isHovered: boolean\n): void {\n  const { x, y, width, height, block } = node\n\n  // Background\n  ctx.fillStyle = isSelected ? '#e3f2fd' : isHovered ? '#f5f5f5' : '#fff'\n  ctx.strokeStyle = isSelected ? '#2196f3' : '#ddd'\n  ctx.lineWidth = isSelected ? 2 : 1\n\n  // Rounded rectangle\n  const radius = 6\n  ctx.beginPath()\n  ctx.moveTo(x - width / 2 + radius, y - height / 2)\n  ctx.lineTo(x + width / 2 - radius, y - height / 2)\n  ctx.quadraticCurveTo(x + width / 2, y - height / 2, x + width / 2, y - height / 2 + radius)\n  ctx.lineTo(x + width / 2, y + height / 2 - radius)\n  ctx.quadraticCurveTo(x + width / 2, y + height / 2, x + width / 2 - radius, y + height / 2)\n  ctx.lineTo(x - width / 2 + radius, y + height / 2)\n  ctx.quadraticCurveTo(x - width / 2, y + height / 2, x - width / 2, y + height / 2 - radius)\n  ctx.lineTo(x - width / 2, y - height / 2 + radius)\n  ctx.quadraticCurveTo(x - width / 2, y - height / 2, x - width / 2 + radius, y - height / 2)\n  ctx.closePath()\n  ctx.fill()\n  ctx.stroke()\n\n  // Type indicator\n  const typeColor = getTypeColor(block.type)\n  ctx.fillStyle = typeColor\n  ctx.fillRect(x - width / 2, y - height / 2, 4, height)\n\n  // Label\n  ctx.fillStyle = '#333'\n  ctx.font = '11px -apple-system, BlinkMacSystemFont, sans-serif'\n  ctx.textAlign = 'center'\n  ctx.textBaseline = 'middle'\n\n  const label = block.content.slice(0, 15) || block.type\n  ctx.fillText(label + (block.content.length > 15 ? '...' : ''), x, y)\n}\n\nfunction drawEdge(\n  ctx: CanvasRenderingContext2D,\n  edge: GraphEdge,\n  nodes: Map<BlockId, GraphNode>,\n  hoveredNodeId: BlockId | null\n): void {\n  const source = nodes.get(edge.sourceId)\n  const target = nodes.get(edge.targetId)\n  if (!source || !target) return\n\n  const isHighlighted = edge.sourceId === hoveredNodeId || edge.targetId === hoveredNodeId\n  const color = getEdgeColor(edge.edgeType)\n\n  ctx.strokeStyle = isHighlighted ? color : `${color}80`\n  ctx.lineWidth = isHighlighted ? 2 : 1\n\n  // Draw curved line\n  ctx.beginPath()\n  ctx.moveTo(edge.points[0]!.x, edge.points[0]!.y)\n\n  if (edge.points.length === 2) {\n    // Simple bezier curve\n    const midY = (edge.points[0]!.y + edge.points[1]!.y) / 2\n    ctx.bezierCurveTo(\n      edge.points[0]!.x,\n      midY,\n      edge.points[1]!.x,\n      midY,\n      edge.points[1]!.x,\n      edge.points[1]!.y\n    )\n  } else {\n    for (let i = 1; i < edge.points.length; i++) {\n      ctx.lineTo(edge.points[i]!.x, edge.points[i]!.y)\n    }\n  }\n\n  ctx.stroke()\n\n  // Draw arrow\n  const lastPoint = edge.points[edge.points.length - 1]!\n  const prevPoint = edge.points[edge.points.length - 2] ?? edge.points[0]!\n  const angle = Math.atan2(lastPoint.y - prevPoint.y, lastPoint.x - prevPoint.x)\n  const arrowSize = 6\n\n  ctx.fillStyle = isHighlighted ? color : `${color}80`\n  ctx.beginPath()\n  ctx.moveTo(lastPoint.x, lastPoint.y)\n  ctx.lineTo(\n    lastPoint.x - arrowSize * Math.cos(angle - Math.PI / 6),\n    lastPoint.y - arrowSize * Math.sin(angle - Math.PI / 6)\n  )\n  ctx.lineTo(\n    lastPoint.x - arrowSize * Math.cos(angle + Math.PI / 6),\n    lastPoint.y - arrowSize * Math.sin(angle + Math.PI / 6)\n  )\n  ctx.closePath()\n  ctx.fill()\n}\n\nfunction getTypeColor(type: string): string {\n  const colors: Record<string, string> = {\n    text: '#4caf50',\n    code: '#ff9800',\n    table: '#2196f3',\n    math: '#9c27b0',\n    json: '#795548',\n    media: '#e91e63',\n    binary: '#607d8b',\n    composite: '#00bcd4',\n  }\n  return colors[type] ?? '#9e9e9e'\n}\n\nfunction getEdgeColor(type: string): string {\n  return EDGE_COLORS[type] ?? '#9e9e9e'\n}\n\nexport default GraphView\n","/**\n * DiffViewer - Displays differences between document snapshots.\n *\n * Shows block-level and content-level diffs with accept/reject actions.\n */\n\nimport React, { useCallback, useMemo, useState } from 'react'\nimport type { BlockId, Block } from 'ucp-content'\nimport type { EditorStoreInstance } from '../core/EditorStore.js'\nimport type { DocumentDiff, BlockDiff, TextDiff, DiffChangeType } from '../types/editor.js'\nimport { useEditorState } from '../hooks/useEditor.js'\n\n// =============================================================================\n// STYLES\n// =============================================================================\n\nconst styles = {\n  container: {\n    display: 'flex',\n    flexDirection: 'column' as const,\n    height: '100%',\n    backgroundColor: '#fff',\n  },\n  header: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: '12px 16px',\n    borderBottom: '1px solid #e5e5e5',\n    backgroundColor: '#fafafa',\n  },\n  headerTitle: {\n    fontSize: '14px',\n    fontWeight: 600,\n  },\n  headerActions: {\n    display: 'flex',\n    gap: '8px',\n  },\n  button: {\n    padding: '6px 12px',\n    border: '1px solid #ddd',\n    borderRadius: '4px',\n    backgroundColor: '#fff',\n    cursor: 'pointer',\n    fontSize: '12px',\n  },\n  buttonPrimary: {\n    backgroundColor: '#4caf50',\n    borderColor: '#4caf50',\n    color: '#fff',\n  },\n  buttonDanger: {\n    backgroundColor: '#f44336',\n    borderColor: '#f44336',\n    color: '#fff',\n  },\n  snapshotSelector: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '12px',\n    padding: '12px 16px',\n    borderBottom: '1px solid #e5e5e5',\n  },\n  snapshotSelect: {\n    padding: '6px 8px',\n    border: '1px solid #ddd',\n    borderRadius: '4px',\n    fontSize: '12px',\n    minWidth: '150px',\n  },\n  content: {\n    flex: 1,\n    overflow: 'auto',\n    padding: '16px',\n  },\n  summary: {\n    display: 'flex',\n    gap: '16px',\n    padding: '12px 16px',\n    backgroundColor: '#f5f5f5',\n    borderRadius: '4px',\n    marginBottom: '16px',\n    fontSize: '12px',\n  },\n  summaryItem: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '4px',\n  },\n  summaryBadge: {\n    display: 'inline-block',\n    padding: '2px 8px',\n    borderRadius: '10px',\n    fontSize: '11px',\n    fontWeight: 500,\n  },\n  badgeAdded: {\n    backgroundColor: '#e8f5e9',\n    color: '#2e7d32',\n  },\n  badgeRemoved: {\n    backgroundColor: '#ffebee',\n    color: '#c62828',\n  },\n  badgeModified: {\n    backgroundColor: '#fff3e0',\n    color: '#ef6c00',\n  },\n  badgeMoved: {\n    backgroundColor: '#e3f2fd',\n    color: '#1565c0',\n  },\n  diffList: {\n    display: 'flex',\n    flexDirection: 'column' as const,\n    gap: '8px',\n  },\n  diffItem: {\n    border: '1px solid #e5e5e5',\n    borderRadius: '4px',\n    overflow: 'hidden',\n  },\n  diffItemHeader: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: '8px 12px',\n    backgroundColor: '#fafafa',\n    borderBottom: '1px solid #e5e5e5',\n    cursor: 'pointer',\n  },\n  diffItemHeaderLeft: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '8px',\n  },\n  diffItemId: {\n    fontFamily: 'Monaco, Consolas, monospace',\n    fontSize: '10px',\n    color: '#666',\n  },\n  diffItemType: {\n    fontSize: '11px',\n    color: '#333',\n  },\n  diffItemActions: {\n    display: 'flex',\n    gap: '4px',\n  },\n  diffItemContent: {\n    padding: '12px',\n  },\n  diffLine: {\n    fontFamily: 'Monaco, Consolas, monospace',\n    fontSize: '12px',\n    lineHeight: '1.5',\n    padding: '2px 4px',\n    borderRadius: '2px',\n  },\n  diffLineAdded: {\n    backgroundColor: '#e8f5e9',\n    color: '#1b5e20',\n  },\n  diffLineRemoved: {\n    backgroundColor: '#ffebee',\n    color: '#b71c1c',\n    textDecoration: 'line-through',\n  },\n  diffLineEqual: {\n    color: '#666',\n  },\n  splitView: {\n    display: 'grid',\n    gridTemplateColumns: '1fr 1fr',\n    gap: '1px',\n    backgroundColor: '#e5e5e5',\n  },\n  splitPane: {\n    backgroundColor: '#fff',\n    padding: '12px',\n  },\n  splitPaneTitle: {\n    fontSize: '11px',\n    fontWeight: 600,\n    color: '#666',\n    marginBottom: '8px',\n    textTransform: 'uppercase' as const,\n  },\n  emptyState: {\n    display: 'flex',\n    flexDirection: 'column' as const,\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: '200px',\n    color: '#666',\n    fontSize: '14px',\n  },\n  filterBar: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '12px',\n    padding: '8px 16px',\n    borderBottom: '1px solid #e5e5e5',\n  },\n  filterCheckbox: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '4px',\n    fontSize: '12px',\n  },\n}\n\n// =============================================================================\n// DIFF VIEWER PROPS\n// =============================================================================\n\nexport interface DiffViewerProps {\n  store: EditorStoreInstance\n}\n\n// =============================================================================\n// DIFF VIEWER COMPONENT\n// =============================================================================\n\n/**\n * Component for viewing and managing document diffs.\n */\nexport function DiffViewer({ store }: DiffViewerProps): React.ReactElement {\n  const diffState = useEditorState(store, (s) => s.diff)\n  const document = useEditorState(store, (s) => s.document)\n\n  const [showUnchanged, setShowUnchanged] = useState(false)\n  const [expandedItems, setExpandedItems] = useState<Set<BlockId>>(new Set())\n  const [filter, setFilter] = useState<DiffChangeType | 'all'>('all')\n\n  // Mock snapshots for demo (in real implementation, these come from store)\n  const snapshots = useMemo(() => {\n    return [\n      { id: 'current', description: 'Current state' },\n      { id: 'initial', description: 'Initial state' },\n    ]\n  }, [])\n\n  // Compute diff when comparing\n  const diff = useMemo((): DocumentDiff | null => {\n    if (!diffState.isComparing || !document) {\n      return null\n    }\n    // For demo, create a simple diff with current document\n    // In real implementation, compare actual snapshots\n    return {\n      fromSnapshotId: diffState.leftSnapshotId ?? 'initial',\n      toSnapshotId: diffState.rightSnapshotId ?? 'current',\n      blockDiffs: new Map(),\n      structuralChanges: [],\n      summary: { added: 0, removed: 0, modified: 0, moved: 0, unchanged: document.blocks.size },\n    }\n  }, [diffState.isComparing, diffState.leftSnapshotId, diffState.rightSnapshotId, document])\n\n  // Filter diffs\n  const filteredDiffs = useMemo(() => {\n    if (!diff) return []\n\n    const diffs = Array.from(diff.blockDiffs.values())\n\n    return diffs.filter((d) => {\n      if (!showUnchanged && d.changeType === 'unchanged') return false\n      if (filter !== 'all' && d.changeType !== filter) return false\n      return true\n    })\n  }, [diff, showUnchanged, filter])\n\n  // Handlers\n  const handleStartCompare = useCallback(() => {\n    store.startCompare('initial', 'current')\n  }, [store])\n\n  const handleStopCompare = useCallback(() => {\n    store.stopCompare()\n  }, [store])\n\n  const handleToggleExpand = useCallback((blockId: BlockId) => {\n    setExpandedItems((prev) => {\n      const next = new Set(prev)\n      if (next.has(blockId)) {\n        next.delete(blockId)\n      } else {\n        next.add(blockId)\n      }\n      return next\n    })\n  }, [])\n\n  const handleApplyChange = useCallback(\n    (blockId: BlockId) => {\n      store.applyChange(blockId)\n    },\n    [store]\n  )\n\n  const handleRejectChange = useCallback(\n    (blockId: BlockId) => {\n      store.rejectChange(blockId)\n    },\n    [store]\n  )\n\n  const handleApplyAll = useCallback(() => {\n    filteredDiffs.forEach((d) => {\n      if (d.changeType !== 'unchanged') {\n        store.applyChange(d.blockId)\n      }\n    })\n  }, [store, filteredDiffs])\n\n  if (!diffState.isComparing) {\n    return (\n      <div style={styles.container}>\n        <div style={styles.header}>\n          <span style={styles.headerTitle}>Diff Viewer</span>\n        </div>\n        <div style={styles.emptyState}>\n          <p>Select two snapshots to compare</p>\n          <button\n            style={{ ...styles.button, marginTop: '12px' }}\n            onClick={handleStartCompare}\n          >\n            Start Comparison\n          </button>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div style={styles.container} data-testid=\"diff-viewer\">\n      {/* Header */}\n      <div style={styles.header}>\n        <span style={styles.headerTitle}>Comparing Changes</span>\n        <div style={styles.headerActions}>\n          <button\n            style={{ ...styles.button, ...styles.buttonPrimary }}\n            onClick={handleApplyAll}\n          >\n            Apply All\n          </button>\n          <button style={styles.button} onClick={handleStopCompare}>\n            Close\n          </button>\n        </div>\n      </div>\n\n      {/* Snapshot selector */}\n      <div style={styles.snapshotSelector}>\n        <span>From:</span>\n        <select style={styles.snapshotSelect} value={diffState.leftSnapshotId ?? ''}>\n          {snapshots.map((s) => (\n            <option key={s.id} value={s.id}>\n              {s.description}\n            </option>\n          ))}\n        </select>\n        <span>To:</span>\n        <select style={styles.snapshotSelect} value={diffState.rightSnapshotId ?? ''}>\n          {snapshots.map((s) => (\n            <option key={s.id} value={s.id}>\n              {s.description}\n            </option>\n          ))}\n        </select>\n      </div>\n\n      {/* Filter bar */}\n      <div style={styles.filterBar}>\n        <label style={styles.filterCheckbox}>\n          <input\n            type=\"checkbox\"\n            checked={showUnchanged}\n            onChange={(e) => setShowUnchanged(e.target.checked)}\n          />\n          Show unchanged\n        </label>\n        <select\n          value={filter}\n          onChange={(e) => setFilter(e.target.value as DiffChangeType | 'all')}\n          style={{ ...styles.snapshotSelect, minWidth: '100px' }}\n        >\n          <option value=\"all\">All changes</option>\n          <option value=\"added\">Added</option>\n          <option value=\"removed\">Removed</option>\n          <option value=\"modified\">Modified</option>\n          <option value=\"moved\">Moved</option>\n        </select>\n      </div>\n\n      {/* Summary */}\n      {diff && (\n        <div style={styles.content}>\n          <div style={styles.summary}>\n            <div style={styles.summaryItem}>\n              <span style={{ ...styles.summaryBadge, ...styles.badgeAdded }}>\n                +{diff.summary.added}\n              </span>\n              <span>Added</span>\n            </div>\n            <div style={styles.summaryItem}>\n              <span style={{ ...styles.summaryBadge, ...styles.badgeRemoved }}>\n                -{diff.summary.removed}\n              </span>\n              <span>Removed</span>\n            </div>\n            <div style={styles.summaryItem}>\n              <span style={{ ...styles.summaryBadge, ...styles.badgeModified }}>\n                ~{diff.summary.modified}\n              </span>\n              <span>Modified</span>\n            </div>\n            <div style={styles.summaryItem}>\n              <span style={{ ...styles.summaryBadge, ...styles.badgeMoved }}>\n                {diff.summary.moved}\n              </span>\n              <span>Moved</span>\n            </div>\n          </div>\n\n          {/* Diff list */}\n          <div style={styles.diffList}>\n            {filteredDiffs.length === 0 ? (\n              <div style={styles.emptyState}>\n                <p>No changes to display</p>\n              </div>\n            ) : (\n              filteredDiffs.map((blockDiff) => (\n                <DiffItem\n                  key={blockDiff.blockId}\n                  blockDiff={blockDiff}\n                  isExpanded={expandedItems.has(blockDiff.blockId)}\n                  onToggle={() => handleToggleExpand(blockDiff.blockId)}\n                  onApply={() => handleApplyChange(blockDiff.blockId)}\n                  onReject={() => handleRejectChange(blockDiff.blockId)}\n                />\n              ))\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// =============================================================================\n// DIFF ITEM COMPONENT\n// =============================================================================\n\ninterface DiffItemProps {\n  blockDiff: BlockDiff\n  isExpanded: boolean\n  onToggle: () => void\n  onApply: () => void\n  onReject: () => void\n}\n\nfunction DiffItem({\n  blockDiff,\n  isExpanded,\n  onToggle,\n  onApply,\n  onReject,\n}: DiffItemProps): React.ReactElement {\n  const { blockId, changeType, oldBlock, newBlock, contentDiff } = blockDiff\n\n  const getBadgeStyle = () => {\n    switch (changeType) {\n      case 'added':\n        return styles.badgeAdded\n      case 'removed':\n        return styles.badgeRemoved\n      case 'modified':\n        return styles.badgeModified\n      case 'moved':\n        return styles.badgeMoved\n      default:\n        return {}\n    }\n  }\n\n  const getChangeLabel = () => {\n    switch (changeType) {\n      case 'added':\n        return 'Added'\n      case 'removed':\n        return 'Removed'\n      case 'modified':\n        return 'Modified'\n      case 'moved':\n        return 'Moved'\n      case 'unchanged':\n        return 'Unchanged'\n      default:\n        return changeType\n    }\n  }\n\n  return (\n    <div style={styles.diffItem}>\n      <div style={styles.diffItemHeader} onClick={onToggle}>\n        <div style={styles.diffItemHeaderLeft}>\n          <span style={{ ...styles.summaryBadge, ...getBadgeStyle() }}>\n            {getChangeLabel()}\n          </span>\n          <span style={styles.diffItemId}>{truncateId(blockId)}</span>\n          <span style={styles.diffItemType}>\n            {(newBlock ?? oldBlock)?.type ?? 'unknown'}\n          </span>\n        </div>\n        <div style={styles.diffItemActions}>\n          {changeType !== 'unchanged' && (\n            <>\n              <button\n                style={{ ...styles.button, padding: '2px 8px', fontSize: '11px' }}\n                onClick={(e) => {\n                  e.stopPropagation()\n                  onApply()\n                }}\n              >\n                Apply\n              </button>\n              <button\n                style={{ ...styles.button, padding: '2px 8px', fontSize: '11px' }}\n                onClick={(e) => {\n                  e.stopPropagation()\n                  onReject()\n                }}\n              >\n                Reject\n              </button>\n            </>\n          )}\n          <span style={{ fontSize: '12px', color: '#666' }}>\n            {isExpanded ? '' : ''}\n          </span>\n        </div>\n      </div>\n\n      {isExpanded && (\n        <div style={styles.diffItemContent}>\n          {changeType === 'modified' && contentDiff ? (\n            <TextDiffView textDiff={contentDiff} />\n          ) : changeType === 'added' && newBlock ? (\n            <div style={{ ...styles.diffLine, ...styles.diffLineAdded }}>\n              + {newBlock.content}\n            </div>\n          ) : changeType === 'removed' && oldBlock ? (\n            <div style={{ ...styles.diffLine, ...styles.diffLineRemoved }}>\n              - {oldBlock.content}\n            </div>\n          ) : (\n            <SplitBlockView oldBlock={oldBlock} newBlock={newBlock} />\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n\n// =============================================================================\n// TEXT DIFF VIEW\n// =============================================================================\n\ninterface TextDiffViewProps {\n  textDiff: TextDiff\n}\n\nfunction TextDiffView({ textDiff }: TextDiffViewProps): React.ReactElement {\n  return (\n    <div>\n      {textDiff.operations.map((op, index) => {\n        let style: React.CSSProperties = styles.diffLine\n\n        switch (op.type) {\n          case 'insert':\n            style = { ...styles.diffLine, ...styles.diffLineAdded }\n            break\n          case 'delete':\n            style = { ...styles.diffLine, ...styles.diffLineRemoved }\n            break\n          default:\n            style = { ...styles.diffLine, ...styles.diffLineEqual }\n        }\n\n        return (\n          <span key={index} style={style}>\n            {op.type === 'insert' && '+'}\n            {op.type === 'delete' && '-'}\n            {op.text}\n          </span>\n        )\n      })}\n    </div>\n  )\n}\n\n// =============================================================================\n// SPLIT BLOCK VIEW\n// =============================================================================\n\ninterface SplitBlockViewProps {\n  oldBlock?: Block\n  newBlock?: Block\n}\n\nfunction SplitBlockView({ oldBlock, newBlock }: SplitBlockViewProps): React.ReactElement {\n  return (\n    <div style={styles.splitView}>\n      <div style={styles.splitPane}>\n        <div style={styles.splitPaneTitle}>Before</div>\n        {oldBlock ? (\n          <pre style={{ margin: 0, fontSize: '12px', whiteSpace: 'pre-wrap' }}>\n            {oldBlock.content}\n          </pre>\n        ) : (\n          <span style={{ color: '#999', fontStyle: 'italic' }}>Not present</span>\n        )}\n      </div>\n      <div style={styles.splitPane}>\n        <div style={styles.splitPaneTitle}>After</div>\n        {newBlock ? (\n          <pre style={{ margin: 0, fontSize: '12px', whiteSpace: 'pre-wrap' }}>\n            {newBlock.content}\n          </pre>\n        ) : (\n          <span style={{ color: '#999', fontStyle: 'italic' }}>Not present</span>\n        )}\n      </div>\n    </div>\n  )\n}\n\n// =============================================================================\n// HELPERS\n// =============================================================================\n\nfunction truncateId(id: string): string {\n  if (id.length <= 16) return id\n  return `${id.slice(0, 8)}...${id.slice(-4)}`\n}\n\nexport default DiffViewer\n","/**\n * Editor - Main UCM Editor component.\n *\n * Provides the top-level editor container with view switching\n * and keyboard shortcut handling.\n */\n\nimport React, { useEffect, useCallback } from 'react'\nimport type { Document } from 'ucp-content'\nimport type { EditorStoreInstance } from '../core/EditorStore.js'\nimport type { EditorConfig, EditorView } from '../types/editor.js'\nimport {\n  useEditorStore,\n  useEditorState,\n  useKeyboardShortcuts,\n} from '../hooks/useEditor.js'\nimport { BlockRenderer } from './BlockRenderer.js'\nimport { GraphView } from '../graph/GraphView.js'\nimport { DiffViewer } from '../diff/DiffViewer.js'\n\n// =============================================================================\n// STYLES\n// =============================================================================\n\nconst styles = {\n  container: {\n    display: 'flex',\n    flexDirection: 'column' as const,\n    height: '100%',\n    width: '100%',\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    fontSize: '14px',\n    lineHeight: '1.5',\n    color: '#1a1a1a',\n    backgroundColor: '#ffffff',\n  },\n  toolbar: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '8px',\n    padding: '8px 16px',\n    borderBottom: '1px solid #e5e5e5',\n    backgroundColor: '#fafafa',\n  },\n  toolbarGroup: {\n    display: 'flex',\n    alignItems: 'center',\n    gap: '4px',\n  },\n  toolbarButton: {\n    padding: '4px 8px',\n    border: '1px solid #d1d1d1',\n    borderRadius: '4px',\n    backgroundColor: '#ffffff',\n    cursor: 'pointer',\n    fontSize: '12px',\n    transition: 'background-color 0.1s',\n  },\n  toolbarButtonActive: {\n    backgroundColor: '#e3f2fd',\n    borderColor: '#2196f3',\n  },\n  toolbarButtonDisabled: {\n    opacity: 0.5,\n    cursor: 'not-allowed',\n  },\n  toolbarDivider: {\n    width: '1px',\n    height: '20px',\n    backgroundColor: '#e5e5e5',\n    margin: '0 8px',\n  },\n  content: {\n    flex: 1,\n    overflow: 'auto',\n    padding: '24px',\n  },\n  documentView: {\n    maxWidth: '800px',\n    margin: '0 auto',\n  },\n  splitView: {\n    display: 'grid',\n    gridTemplateColumns: '1fr 1fr',\n    gap: '16px',\n    height: '100%',\n  },\n  splitPane: {\n    overflow: 'auto',\n    border: '1px solid #e5e5e5',\n    borderRadius: '4px',\n  },\n  emptyState: {\n    display: 'flex',\n    flexDirection: 'column' as const,\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: '200px',\n    color: '#666',\n  },\n  statusBar: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    padding: '4px 16px',\n    borderTop: '1px solid #e5e5e5',\n    backgroundColor: '#fafafa',\n    fontSize: '12px',\n    color: '#666',\n  },\n}\n\n// =============================================================================\n// EDITOR PROPS\n// =============================================================================\n\nexport interface EditorProps {\n  /** Initial document to load */\n  document?: Document\n  /** Editor configuration */\n  config?: Partial<EditorConfig>\n  /** Custom store instance (for external state management) */\n  store?: EditorStoreInstance\n  /** Callback when document changes */\n  onChange?: (document: Document) => void\n  /** Callback when document is saved */\n  onSave?: (document: Document) => Promise<void>\n  /** Additional class name */\n  className?: string\n  /** Additional styles */\n  style?: React.CSSProperties\n}\n\n// =============================================================================\n// EDITOR COMPONENT\n// =============================================================================\n\n/**\n * Main UCM Editor component.\n *\n * @example\n * ```tsx\n * import { Editor } from 'ucm-editor'\n * import { parseMarkdown } from 'ucp-content'\n *\n * function App() {\n *   const doc = parseMarkdown('# Hello\\n\\nWorld')\n *\n *   return (\n *     <Editor\n *       document={doc}\n *       onChange={(doc) => console.log('Changed:', doc)}\n *     />\n *   )\n * }\n * ```\n */\nexport function Editor({\n  document: initialDocument,\n  config,\n  store: externalStore,\n  onChange,\n  onSave,\n  className,\n  style,\n}: EditorProps): React.ReactElement {\n  // Use provided store or create a new one\n  const internalStore = useEditorStore(config)\n  const store = externalStore ?? internalStore\n\n  // Subscribe to state\n  const document = useEditorState(store, (s) => s.document)\n  const view = useEditorState(store, (s) => s.view)\n  const isDirty = useEditorState(store, (s) => s.isDirty)\n  const history = useEditorState(store, (s) => s.history)\n  const lastError = useEditorState(store, (s) => s.lastError)\n\n  // Enable keyboard shortcuts\n  useKeyboardShortcuts(store, store.config.enableKeyboardShortcuts)\n\n  // Load initial document\n  useEffect(() => {\n    if (initialDocument && !document) {\n      store.loadDocument(initialDocument)\n    }\n  }, [initialDocument, document, store])\n\n  // Notify on changes\n  useEffect(() => {\n    if (document && onChange) {\n      onChange(document)\n    }\n  }, [document, onChange])\n\n  // View handlers\n  const handleViewChange = useCallback(\n    (newView: EditorView) => {\n      store.setView(newView)\n    },\n    [store]\n  )\n\n  // History handlers\n  const handleUndo = useCallback(() => {\n    if (history.canUndo) {\n      store.undo()\n    }\n  }, [store, history.canUndo])\n\n  const handleRedo = useCallback(() => {\n    if (history.canRedo) {\n      store.redo()\n    }\n  }, [store, history.canRedo])\n\n  // Save handler\n  const handleSave = useCallback(async () => {\n    if (document && onSave) {\n      await onSave(document)\n    }\n    await store.saveDocument()\n  }, [store, document, onSave])\n\n  // Render content based on view\n  const renderContent = () => {\n    if (!document) {\n      return (\n        <div style={styles.emptyState}>\n          <p>No document loaded</p>\n          <button\n            onClick={() => store.createDocument('New Document')}\n            style={{ ...styles.toolbarButton, marginTop: '8px' }}\n          >\n            Create New Document\n          </button>\n        </div>\n      )\n    }\n\n    switch (view) {\n      case 'document':\n        return (\n          <div style={styles.documentView}>\n            <DocumentView store={store} />\n          </div>\n        )\n\n      case 'graph':\n        return <GraphView store={store} />\n\n      case 'diff':\n        return <DiffViewer store={store} />\n\n      case 'split':\n        return (\n          <div style={styles.splitView}>\n            <div style={styles.splitPane}>\n              <div style={{ padding: '16px' }}>\n                <DocumentView store={store} />\n              </div>\n            </div>\n            <div style={styles.splitPane}>\n              <GraphView store={store} />\n            </div>\n          </div>\n        )\n\n      default:\n        return <DocumentView store={store} />\n    }\n  }\n\n  return (\n    <div\n      className={className}\n      style={{ ...styles.container, ...style }}\n      data-testid=\"ucm-editor\"\n    >\n      {/* Toolbar */}\n      <div style={styles.toolbar}>\n        {/* View switcher */}\n        <div style={styles.toolbarGroup}>\n          <ViewButton\n            label=\"Document\"\n            view=\"document\"\n            currentView={view}\n            onClick={handleViewChange}\n          />\n          <ViewButton\n            label=\"Graph\"\n            view=\"graph\"\n            currentView={view}\n            onClick={handleViewChange}\n          />\n          <ViewButton\n            label=\"Diff\"\n            view=\"diff\"\n            currentView={view}\n            onClick={handleViewChange}\n          />\n          <ViewButton\n            label=\"Split\"\n            view=\"split\"\n            currentView={view}\n            onClick={handleViewChange}\n          />\n        </div>\n\n        <div style={styles.toolbarDivider} />\n\n        {/* History */}\n        <div style={styles.toolbarGroup}>\n          <button\n            onClick={handleUndo}\n            disabled={!history.canUndo}\n            style={{\n              ...styles.toolbarButton,\n              ...(history.canUndo ? {} : styles.toolbarButtonDisabled),\n            }}\n            title=\"Undo (Cmd+Z)\"\n          >\n            Undo\n          </button>\n          <button\n            onClick={handleRedo}\n            disabled={!history.canRedo}\n            style={{\n              ...styles.toolbarButton,\n              ...(history.canRedo ? {} : styles.toolbarButtonDisabled),\n            }}\n            title=\"Redo (Cmd+Shift+Z)\"\n          >\n            Redo\n          </button>\n        </div>\n\n        <div style={styles.toolbarDivider} />\n\n        {/* Save */}\n        <button\n          onClick={handleSave}\n          disabled={!isDirty}\n          style={{\n            ...styles.toolbarButton,\n            ...(isDirty ? {} : styles.toolbarButtonDisabled),\n          }}\n          title=\"Save (Cmd+S)\"\n        >\n          Save\n        </button>\n      </div>\n\n      {/* Content */}\n      <div style={styles.content}>{renderContent()}</div>\n\n      {/* Status bar */}\n      <div style={styles.statusBar}>\n        <div>\n          {document ? `${document.blocks.size} blocks` : 'No document'}\n          {isDirty && ' (unsaved changes)'}\n        </div>\n        <div>\n          {lastError && (\n            <span style={{ color: '#d32f2f' }}>\n              Error: {lastError.message}\n            </span>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// =============================================================================\n// VIEW BUTTON\n// =============================================================================\n\ninterface ViewButtonProps {\n  label: string\n  view: EditorView\n  currentView: EditorView\n  onClick: (view: EditorView) => void\n}\n\nfunction ViewButton({ label, view, currentView, onClick }: ViewButtonProps) {\n  const isActive = view === currentView\n  return (\n    <button\n      onClick={() => onClick(view)}\n      style={{\n        ...styles.toolbarButton,\n        ...(isActive ? styles.toolbarButtonActive : {}),\n      }}\n    >\n      {label}\n    </button>\n  )\n}\n\n// =============================================================================\n// DOCUMENT VIEW\n// =============================================================================\n\ninterface DocumentViewProps {\n  store: EditorStoreInstance\n}\n\nfunction DocumentView({ store }: DocumentViewProps): React.ReactElement {\n  const document = useEditorState(store, (s) => s.document)\n\n  if (!document) {\n    return <div>No document</div>\n  }\n\n  const rootBlock = document.blocks.get(document.root)\n  if (!rootBlock) {\n    return <div>Invalid document structure</div>\n  }\n\n  return (\n    <div data-testid=\"document-view\">\n      {rootBlock.children.map((childId) => {\n        const child = document.blocks.get(childId)\n        if (!child) return null\n        return (\n          <BlockRenderer\n            key={childId}\n            block={child}\n            document={document}\n            store={store}\n            depth={0}\n            path={[document.root]}\n          />\n        )\n      })}\n\n      {rootBlock.children.length === 0 && (\n        <div style={styles.emptyState}>\n          <p>Empty document</p>\n          <button\n            onClick={() => store.addBlock(document.root, 'Start typing...')}\n            style={{ ...styles.toolbarButton, marginTop: '8px' }}\n          >\n            Add Block\n          </button>\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport default Editor\n"],"names":["logger","findParent","createDocument","createUcpDocument","addBlock","addUcpBlock","editUcpBlock","deleteUcpBlock","moveUcpBlock","addUcpEdge","removeUcpEdge","getBlockOrder","i","j","styles","truncateId","document","_a"],"mappings":";;;;;AAWO,MAAM,YAAY;AAAA;AAAA,EAEvB,iBAAiB;AAAA,EACjB,uBAAuB;AAAA,EACvB,qBAAqB;AAAA;AAAA,EAKrB,mBAAmB;AAAA,EACnB,4BAA4B;AAAA;AAAA,EAI5B,aAAa;AAAA,EACb,0BAA0B;AAAA,EAE1B,gBAAgB;AAAA;AAAA,EAGhB,qBAAqB;AAAA,EACrB,wBAAwB;AAAA;AAAA,EAIxB,mBAAmB;AAAA,EACnB,mBAAmB;AAAA;AAAA,EAInB,oBAAoB;AAAA,EACpB,wBAAwB;AAAA;AAAA,EAIxB,eAAe;AAAA;AAAA,EAKf,qBAAqB;AAAA,EAErB,oBAAoB;AAAA;AAAA,EAGpB,gBAAgB;AAAA,EAChB,eAAe;AAAA,EACf,iBAAiB;AACnB;AA2HO,MAAM,oBAAoB,MAAM;AAAA,EAQrC,YAAY,SAA6B;AACvC,UAAM,QAAQ,OAAO;AARd;AACA;AACA;AACA;AACA;AACA;AAIP,SAAK,OAAO;AACZ,SAAK,OAAO,QAAQ;AACpB,SAAK,WAAW,QAAQ;AACxB,SAAK,WAAW,QAAQ,YAAY;AACpC,SAAK,OAAO,QAAQ,QAAQ,CAAA;AAC5B,SAAK,aAAa,QAAQ;AAC1B,SAAK,gCAAgB,KAAA;AAErB,QAAI,QAAQ,OAAO;AACjB,WAAK,QAAQ,QAAQ;AAAA,IACvB;AAOA,UAAM,oBAAqB,MAExB;AAEH,QAAI,mBAAmB;AACrB;AAAA,QACE;AAAA,QACA;AAAA,MAAA;AAAA,IAEJ;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,SAAkC;AAChC,WAAO;AAAA,MACL,MAAM,KAAK;AAAA,MACX,MAAM,KAAK;AAAA,MACX,SAAS,KAAK;AAAA,MACd,UAAU,KAAK;AAAA,MACf,UAAU,KAAK;AAAA,MACf,MAAM,KAAK;AAAA,MACX,YAAY,KAAK;AAAA,MACjB,WAAW,KAAK,UAAU,YAAA;AAAA,MAC1B,OAAO,KAAK;AAAA,IAAA;AAAA,EAEhB;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAwB;AACtB,UAAM,QAAQ,CAAC,IAAI,KAAK,IAAI,KAAK,KAAK,OAAO,EAAE;AAC/C,QAAI,KAAK,YAAY;AACnB,YAAM,KAAK,eAAe,KAAK,UAAU,EAAE;AAAA,IAC7C;AACA,WAAO,MAAM,KAAK,IAAI;AAAA,EACxB;AACF;AASO,MAAM,SAAS;AAAA;AAAA,EAEpB,cAAc,SAA8B;AAC1C,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,oBAAoB,OAAO;AAAA,MACpC,UAAU;AAAA,MACV,MAAM,EAAE,QAAA;AAAA,MACR,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AAAA,EAEA,oBAAoB,SAAiB,QAA6B;AAChE,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,6BAA6B,OAAO,KAAK,MAAM;AAAA,MACxD,UAAU;AAAA,MACV,MAAM,EAAE,QAAA;AAAA,MACR,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AAAA,EAEA,kBAAkB,SAAiB,UAAkB,QAA6B;AAChF,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,SAAS,OAAO,4BAA4B,QAAQ,SAAS,MAAM;AAAA,MAC5E,UAAU;AAAA,MACV,MAAM,EAAE,SAAS,cAAc,UAAU,YAAY,OAAA;AAAA,MACrD,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AAAA;AAAA,EAGA,iBAAiB,QAA6B;AAC5C,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,sBAAsB,MAAM;AAAA,MACrC,UAAU;AAAA,MACV,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AAAA,EAEA,wBAAwB,UAA+B;AACrD,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,+BAA+B,QAAQ;AAAA,MAChD,UAAU;AAAA,MACV,MAAM,EAAE,SAAA;AAAA,IAAS,CAClB;AAAA,EACH;AAAA;AAAA,EAGA,WAAW,SAAiB,QAA6B;AACvD,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,yBAAyB,OAAO,KAAK,MAAM;AAAA,MACpD,UAAU;AAAA,MACV,MAAM,EAAE,SAAS,OAAA;AAAA,IAAO,CACzB;AAAA,EACH;AAAA,EAEA,uBAAuB,SAAiB,SAA8B;AACpE,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,qCAAqC,OAAO;AAAA,MACrD,UAAU;AAAA,MACV,MAAM,EAAE,SAAS,oBAAoB,QAAA;AAAA,MACrC,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AAAA,EAEA,cAAc,SAA8B;AAC1C,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,SAAS,OAAO;AAAA,MACzB,UAAU;AAAA,MACV,MAAM,EAAE,QAAA;AAAA,MACR,UAAU;AAAA,IAAA,CACX;AAAA,EACH;AAAA;AAAA,EAGA,kBAAkB,UAAkB,UAAkB,QAA6B;AACjF,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,eAAe,QAAQ,SAAS,QAAQ,KAAK,MAAM;AAAA,MAC5D,UAAU;AAAA,MACV,MAAM,EAAE,UAAU,UAAU,OAAA;AAAA,IAAO,CACpC;AAAA,EACH;AAAA,EAEA,oBAAoB,UAAkB,UAA+B;AACnE,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,UAAU,QAAQ,OAAO,QAAQ;AAAA,MAC1C,UAAU;AAAA,MACV,MAAM,EAAE,UAAU,SAAA;AAAA,MAClB,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AAAA;AAAA,EAGA,kBAA+B;AAC7B,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,UAAU;AAAA,MACV,MAAM,EAAE,QAAQ,OAAA;AAAA,IAAO,CACxB;AAAA,EACH;AAAA,EAEA,kBAA+B;AAC7B,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,UAAU;AAAA,MACV,MAAM,EAAE,QAAQ,OAAA;AAAA,IAAO,CACxB;AAAA,EACH;AAAA;AAAA,EAGA,iBAAiB,YAAiC;AAChD,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,uBAAuB,UAAU;AAAA,MAC1C,UAAU;AAAA,MACV,MAAM,EAAE,aAAa,WAAA;AAAA,IAAW,CACjC;AAAA,EACH;AAAA,EAEA,sBAAsB,KAAa,KAAa,QAA6B;AAC3E,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,aAAa,GAAG,QAAQ,GAAG,sBAAsB,MAAM;AAAA,MAChE,UAAU;AAAA,MACV,MAAM,EAAE,aAAa,KAAK,aAAa,KAAK,OAAA;AAAA,IAAO,CACpD;AAAA,EACH;AAAA;AAAA,EAGA,aAAa,QAAgB,QAA6B;AACxD,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,8BAA8B,MAAM,MAAM,MAAM;AAAA,MACzD,UAAU;AAAA,MACV,MAAM,EAAE,QAAQ,OAAA;AAAA,IAAO,CACxB;AAAA,EACH;AAAA;AAAA,EAGA,oBAAiC;AAC/B,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS;AAAA,MACT,UAAU;AAAA,MACV,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AAAA,EAEA,iBAAiB,YAAoB,WAAgC;AACnE,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,gBAAgB,UAAU,uBAAuB,SAAS;AAAA,MACnE,UAAU;AAAA,MACV,MAAM,EAAE,YAAY,UAAA;AAAA,MACpB,YAAY;AAAA,IAAA,CACb;AAAA,EACH;AAAA;AAAA,EAGA,cAAc,SAAiB,WAAiC;AAC9D,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,mBAAmB,OAAO;AAAA,MACnC,UAAU;AAAA,MACV,MAAM,EAAE,UAAA;AAAA,IAAU,CACnB;AAAA,EACH;AAAA,EAEA,aAAa,SAA8B;AACzC,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,kBAAkB,OAAO;AAAA,MAClC,UAAU;AAAA,IAAA,CACX;AAAA,EACH;AAAA,EAEA,eAAe,SAA8B;AAC3C,WAAO,IAAI,YAAY;AAAA,MACrB,MAAM,UAAU;AAAA,MAChB,SAAS,oBAAoB,OAAO;AAAA,MACpC,UAAU;AAAA,MACV,UAAU;AAAA,IAAA,CACX;AAAA,EACH;AACF;AAgCO,SAAS,GAAM,OAA4B;AAChD,SAAO,EAAE,IAAI,MAAM,MAAA;AACrB;AAKO,SAAS,IAAO,OAA4B;AACjD,SAAO,EAAE,IAAI,OAAO,MAAA;AACtB;AAKO,SAAS,OAA2B,QAAyB;AAClE,MAAI,OAAO,IAAI;AACb,WAAO,OAAO;AAAA,EAChB;AACA,QAAM,OAAO;AACf;AAKO,SAAS,SAAe,QAAsB,cAAoB;AACvE,SAAO,OAAO,KAAK,OAAO,QAAQ;AACpC;AAKO,SAAS,IAAa,QAAsB,IAAmC;AACpF,MAAI,OAAO,IAAI;AACb,WAAO,GAAG,GAAG,OAAO,KAAK,CAAC;AAAA,EAC5B;AACA,SAAO;AACT;AAKO,SAAS,QACd,QACA,IACc;AACd,MAAI,OAAO,IAAI;AACb,WAAO,GAAG,OAAO,KAAK;AAAA,EACxB;AACA,SAAO;AACT;ACtOO,MAAM,wBAAsC;AAAA,EACjD,yBAAyB;AAAA,EACzB,eAAe;AAAA,EACf,mBAAmB;AAAA,EACnB,yBAAyB;AAAA,EACzB,gBAAgB;AAAA,EAChB,cAAc;AAAA,EACd,oBAAoB;AAAA,EACpB,UAAU;AACZ;AC/FO,MAAM,mBAAiD;AAAA,EAAvD;AACG,wDAAe,IAAA;AACf,4DAAmB,IAAA;AAAA;AAAA,EAE3B,GAA8B,MAAS,SAA4C;AACjF,QAAI,CAAC,KAAK,SAAS,IAAI,IAAI,GAAG;AAC5B,WAAK,SAAS,IAAI,MAAM,oBAAI,KAAK;AAAA,IACnC;AACA,SAAK,SAAS,IAAI,IAAI,EAAG,IAAI,OAA6B;AAC1D,WAAO,MAAM,KAAK,IAAI,MAAM,OAAO;AAAA,EACrC;AAAA,EAEA,KAAgC,MAAS,SAA4C;AACnF,QAAI,CAAC,KAAK,aAAa,IAAI,IAAI,GAAG;AAChC,WAAK,aAAa,IAAI,MAAM,oBAAI,KAAK;AAAA,IACvC;AACA,SAAK,aAAa,IAAI,IAAI,EAAG,IAAI,OAA6B;AAC9D,WAAO,MAAM;AACX,YAAM,WAAW,KAAK,aAAa,IAAI,IAAI;AAC3C,UAAI,UAAU;AACZ,iBAAS,OAAO,OAA6B;AAAA,MAC/C;AAAA,IACF;AAAA,EACF;AAAA,EAEA,IAA+B,MAAS,SAAsC;AAC5E,UAAM,WAAW,KAAK,SAAS,IAAI,IAAI;AACvC,QAAI,UAAU;AACZ,eAAS,OAAO,OAA6B;AAAA,IAC/C;AACA,UAAM,eAAe,KAAK,aAAa,IAAI,IAAI;AAC/C,QAAI,cAAc;AAChB,mBAAa,OAAO,OAA6B;AAAA,IACnD;AAAA,EACF;AAAA,EAEA,KAAgC,MAAS,MAA6B;AACpE,UAAM,QAAwB;AAAA,MAC5B;AAAA,MACA,+BAAe,KAAA;AAAA,MACf;AAAA,IAAA;AAGF,UAAM,WAAW,KAAK,SAAS,IAAI,IAAI;AACvC,QAAI,UAAU;AACZ,eAAS,QAAQ,CAAC,YAAY;AAC5B,YAAI;AACF,kBAAQ,KAAK;AAAA,QACf,SAAS,OAAO;AACd,kBAAQ,MAAM,8BAA8B,IAAI,KAAK,KAAK;AAAA,QAC5D;AAAA,MACF,CAAC;AAAA,IACH;AAEA,UAAM,eAAe,KAAK,aAAa,IAAI,IAAI;AAC/C,QAAI,cAAc;AAChB,mBAAa,QAAQ,CAAC,YAAY;AAChC,YAAI;AACF,kBAAQ,KAAK;AAAA,QACf,SAAS,OAAO;AACd,kBAAQ,MAAM,6BAA6B,IAAI,KAAK,KAAK;AAAA,QAC3D;AAAA,MACF,CAAC;AACD,WAAK,aAAa,OAAO,IAAI;AAAA,IAC/B;AAAA,EACF;AAAA,EAEA,QAAc;AACZ,SAAK,SAAS,MAAA;AACd,SAAK,aAAa,MAAA;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,MAA+B;;AAC3C,UAAM,aAAW,UAAK,SAAS,IAAI,IAAI,MAAtB,mBAAyB,SAAQ;AAClD,UAAM,iBAAe,UAAK,aAAa,IAAI,IAAI,MAA1B,mBAA6B,SAAQ;AAC1D,WAAO,WAAW;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,aAAgC;AAC9B,UAAM,4BAAY,IAAA;AAClB,SAAK,SAAS,QAAQ,CAAC,GAAG,SAAS,MAAM,IAAI,IAAI,CAAC;AAClD,SAAK,aAAa,QAAQ,CAAC,GAAG,SAAS,MAAM,IAAI,IAAI,CAAC;AACtD,WAAO,MAAM,KAAK,KAAK;AAAA,EACzB;AACF;ACzSA,MAAM,qBAA+C;AAAA,EACnD,OAAO;AAAA,EACP,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AACT;AAyBA,MAAM,eAAyC;AAAA,EAC7C,OAAO;AAAA;AAAA,EACP,MAAM;AAAA;AAAA,EACN,MAAM;AAAA;AAAA,EACN,OAAO;AAAA;AACT;AAEA,MAAM,QAAQ;AAEd,SAAS,eAAe,OAAiB,WAA4B;AACnE,QAAM,OAAO,MAAM,UAAU,cAAc,MAAM,IAAI,EAAE;AACvD,QAAM,QAAQ,MAAM,MAAM,YAAA,EAAc,OAAO,CAAC;AAChD,QAAM,UAAU,MAAM,UAAU,IAAI,MAAM,OAAO,MAAM;AAEvD,MAAI,WAAW;AACb,UAAM,QAAQ,aAAa,MAAM,KAAK;AACtC,WAAO,GAAG,KAAK,GAAG,IAAI,IAAI,KAAK,GAAG,KAAK,IAAI,OAAO,IAAI,MAAM,OAAO;AAAA,EACrE;AAEA,SAAO,GAAG,IAAI,IAAI,KAAK,IAAI,OAAO,IAAI,MAAM,OAAO;AACrD;AASO,MAAM,iBAA6B,CAAC,UAAoB;AAC7D,QAAM,YAAY,eAAe,OAAO,OAAO,WAAW,WAAW;AACrE,QAAM,OAAkB,CAAC,SAAS;AAElC,MAAI,MAAM,QAAQ,OAAO,KAAK,MAAM,IAAI,EAAE,SAAS,GAAG;AACpD,SAAK,KAAK,MAAM,IAAI;AAAA,EACtB;AAEA,MAAI,MAAM,OAAO;AACf,SAAK,KAAK,MAAM,KAAK;AAAA,EACvB;AAEA,UAAQ,MAAM,OAAA;AAAA,IACZ,KAAK;AACH,cAAQ,MAAM,GAAG,IAAI;AACrB;AAAA,IACF,KAAK;AACH,cAAQ,KAAK,GAAG,IAAI;AACpB;AAAA,IACF,KAAK;AACH,cAAQ,KAAK,GAAG,IAAI;AACpB;AAAA,IACF,KAAK;AACH,cAAQ,MAAM,GAAG,IAAI;AACrB;AAAA,EAAA;AAEN;AAKO,SAAS,oBAAoB,aAAa,KAI/C;AACA,QAAM,UAAsB,CAAA;AAE5B,SAAO;AAAA,IACL,SAAS,CAAC,UAAoB;AAC5B,cAAQ,KAAK,KAAK;AAClB,UAAI,QAAQ,SAAS,YAAY;AAC/B,gBAAQ,MAAA;AAAA,MACV;AAAA,IACF;AAAA,IACA,YAAY,MAAM,CAAC,GAAG,OAAO;AAAA,IAC7B,OAAO,MAAM;AACX,cAAQ,SAAS;AAAA,IACnB;AAAA,EAAA;AAEJ;AAYA,MAAM,iBAA+B;AAAA,EACnC,OAAO;AAAA,EACP,UAAU,CAAC,cAAc;AAC3B;AAkBO,MAAM,OAAO;AAAA,EAIlB,YAAY,SAAgC,IAAI;AAHxC;AACA;AAGN,SAAK,SAAS,EAAE,GAAG,gBAAgB,GAAG,OAAA;AACtC,SAAK,UAAU,OAAO;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAyB;AAC7B,UAAM,eAAe,KAAK,UAAU,GAAG,KAAK,OAAO,IAAI,OAAO,KAAK;AACnE,WAAO,IAAI,OAAO;AAAA,MAChB,GAAG,KAAK;AAAA,MACR,SAAS;AAAA,IAAA,CACV;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,OAAuB;AAC9B,SAAK,OAAO,QAAQ;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAqB;AACnB,WAAO,KAAK,OAAO;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,SAA2B;AACpC,SAAK,OAAO,SAAS,KAAK,OAAO;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,SAA2B;AACvC,UAAM,QAAQ,KAAK,OAAO,SAAS,QAAQ,OAAO;AAClD,QAAI,UAAU,IAAI;AAChB,WAAK,OAAO,SAAS,OAAO,OAAO,CAAC;AAAA,IACtC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAsB;AACpB,SAAK,OAAO,WAAW,CAAA;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,OAA0B;AACvC,WAAO,mBAAmB,KAAK,KAAK,mBAAmB,KAAK,OAAO,KAAK;AAAA,EAC1E;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAiB,MAAsC;AAC3D,SAAK,IAAI,SAAS,SAAS,IAAI;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,KAAK,SAAiB,MAAsC;AAC1D,SAAK,IAAI,QAAQ,SAAS,IAAI;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,KAAK,SAAiB,MAAsC;AAC1D,SAAK,IAAI,QAAQ,SAAS,IAAI;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,SAAiB,OAAyC,MAAsC;AACpG,QAAI,iBAAiB,OAAO;AAC1B,WAAK,IAAI,SAAS,SAAS,MAAM,KAAK;AAAA,IACxC,OAAO;AACL,WAAK,IAAI,SAAS,SAAS,KAAK;AAAA,IAClC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,KAAQ,OAAe,IAAgB;AACrC,UAAM,QAAQ,YAAY,IAAA;AAC1B,QAAI;AACF,YAAM,SAAS,GAAA;AACf,YAAM,WAAW,YAAY,IAAA,IAAQ;AACrC,WAAK,MAAM,GAAG,KAAK,cAAc,EAAE,YAAY,SAAS,QAAQ,CAAC,EAAA,CAAG;AACpE,aAAO;AAAA,IACT,SAAS,OAAO;AACd,YAAM,WAAW,YAAY,IAAA,IAAQ;AACrC,WAAK,MAAM,GAAG,KAAK,WAAW,iBAAiB,QAAQ,QAAQ,QAAW;AAAA,QACxE,YAAY,SAAS,QAAQ,CAAC;AAAA,MAAA,CAC/B;AACD,YAAM;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAa,OAAe,IAAkC;AAClE,UAAM,QAAQ,YAAY,IAAA;AAC1B,QAAI;AACF,YAAM,SAAS,MAAM,GAAA;AACrB,YAAM,WAAW,YAAY,IAAA,IAAQ;AACrC,WAAK,MAAM,GAAG,KAAK,cAAc,EAAE,YAAY,SAAS,QAAQ,CAAC,EAAA,CAAG;AACpE,aAAO;AAAA,IACT,SAAS,OAAO;AACd,YAAM,WAAW,YAAY,IAAA,IAAQ;AACrC,WAAK,MAAM,GAAG,KAAK,WAAW,iBAAiB,QAAQ,QAAQ,QAAW;AAAA,QACxE,YAAY,SAAS,QAAQ,CAAC;AAAA,MAAA,CAC/B;AACD,YAAM;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAoC;AACxC,SAAK,MAAM,GAAG,KAAK,UAAU;AAC7B,UAAM,QAAQ,YAAY,IAAA;AAC1B,WAAO;AAAA,MACL,KAAK,MAAM;AACT,cAAM,WAAW,YAAY,IAAA,IAAQ;AACrC,aAAK,MAAM,GAAG,KAAK,UAAU,EAAE,YAAY,SAAS,QAAQ,CAAC,EAAA,CAAG;AAAA,MAClE;AAAA,IAAA;AAAA,EAEJ;AAAA,EAEQ,IAAI,OAAiB,SAAiB,MAAgC,OAAqB;AACjG,QAAI,CAAC,KAAK,eAAe,KAAK,GAAG;AAC/B;AAAA,IACF;AAEA,UAAM,QAAkB;AAAA,MACtB;AAAA,MACA;AAAA,MACA,+BAAe,KAAA;AAAA,MACf,SAAS,KAAK;AAAA,MACd;AAAA,MACA;AAAA,IAAA;AAGF,eAAW,WAAW,KAAK,OAAO,UAAU;AAC1C,UAAI;AACF,gBAAQ,KAAK;AAAA,MACf,SAAS,GAAG;AAEV,gBAAQ,MAAM,sBAAsB,CAAC;AAAA,MACvC;AAAA,IACF;AAAA,EACF;AACF;AASO,MAAMA,WAAS,IAAI,OAAO,EAAE,SAAS,aAAa;AAKlD,SAAS,gBAAgB,QAAqC;AACnE,MAAI,OAAO,OAAO;AAChBA,aAAO,SAAS,OAAO,KAAK;AAAA,EAC9B;AACA,MAAI,OAAO,UAAU;AACnBA,aAAO,cAAA;AACP,WAAO,SAAS,QAAQ,CAAC,MAAMA,SAAO,WAAW,CAAC,CAAC;AAAA,EACrD;AACF;AChUA,IAAI,eAAe;AACnB,SAAS,aAAa;AAClB;AACA,SAAO,OAAO,aAAa,SAAS,EAAE,EAAE,SAAS,IAAI,GAAG,CAAC;AAC7D;AAEO,SAAS,eAAe,OAAO;AAClC,QAAM,SAAS,WAAU;AACzB,QAAM,MAAM,oBAAI,KAAI;AACpB,QAAM,OAAO;AAAA,IACT,IAAI;AAAA,IACJ,SAAS;AAAA,IACT,MAAM;AAAA,IACN,MAAM,CAAA;AAAA,IACN,UAAU,CAAA;AAAA,IACV,OAAO,CAAA;AAAA,EACf;AACI,SAAO;AAAA,IACH,IAAI,OAAO,KAAK,IAAG,EAAG,SAAS,EAAE,CAAC;AAAA,IAClC,MAAM;AAAA,IACN,QAAQ,oBAAI,IAAI,CAAC,CAAC,QAAQ,IAAI,CAAC,CAAC;AAAA,IAChC,UAAU;AAAA,MACN;AAAA,MACA,SAAS,CAAA;AAAA,MACT,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,QAAQ,CAAA;AAAA,IACpB;AAAA,IACQ,SAAS;AAAA,EACjB;AACA;AAEO,SAAS,SAAS,KAAK,UAAU,SAAS,UAAU,CAAA,GAAI;AAC3D,QAAM,SAAS,IAAI,OAAO,IAAI,QAAQ;AACtC,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,2BAA2B,QAAQ,EAAE;AACzD,QAAM,KAAK,WAAU;AACrB,QAAM,QAAQ;AAAA,IACV;AAAA,IACA;AAAA,IACA,MAAM,QAAQ,QAAQ;AAAA,IACtB,MAAM,QAAQ;AAAA,IACd,OAAO,QAAQ;AAAA,IACf,MAAM,CAAA;AAAA,IACN,UAAU,CAAA;AAAA,IACV,OAAO,CAAA;AAAA,IACP,UAAU;AAAA,MACN,MAAM,CAAA;AAAA,MACN,WAAW,oBAAI,KAAI;AAAA,MACnB,YAAY,oBAAI,KAAI;AAAA,MACpB,QAAQ,CAAA;AAAA,IACpB;AAAA,EACA;AAEI,MAAI,QAAQ,MAAM;AACd,UAAM,SAAS,eAAe,QAAQ;AAAA,EAC1C;AACA,MAAI,OAAO,IAAI,IAAI,KAAK;AACxB,SAAO,SAAS,KAAK,EAAE;AACvB,SAAO;AACX;AAMO,SAAS,UAAU,KAAK,IAAI,SAAS;AACxC,QAAM,QAAQ,IAAI,OAAO,IAAI,EAAE;AAC/B,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,oBAAoB,EAAE,EAAE;AAC5C,QAAM,UAAU;AACpB;AAEO,SAAS,UAAU,KAAK,IAAI,aAAa,OAAO;AACnD,MAAI,OAAO,IAAI;AACX,UAAM,IAAI,MAAM,4BAA4B;AAChD,QAAM,QAAQ,IAAI,OAAO,IAAI,EAAE;AAC/B,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,oBAAoB,EAAE,EAAE;AAC5C,QAAM,YAAY,IAAI,OAAO,IAAI,WAAW;AAC5C,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,2BAA2B,WAAW,EAAE;AAC5D,MAAI,gBAAgB,MAAM,aAAa,KAAK,IAAI,WAAW,GAAG;AAC1D,UAAM,IAAI,MAAM,oDAAoD;AAAA,EACxE;AACA,QAAM,cAAcC,aAAW,KAAK,EAAE;AACtC,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,+BAA+B,EAAE,EAAE;AACvD,QAAM,YAAY,IAAI,OAAO,IAAI,WAAW;AAC5C,QAAM,aAAa,UAAU,SAAS,QAAQ,EAAE;AAChD,MAAI,eAAe;AACf,UAAM,IAAI,MAAM,SAAS,EAAE,yBAAyB,WAAW,EAAE;AACrE,YAAU,SAAS,OAAO,YAAY,CAAC;AACvC,MAAI,UAAU,UAAa,QAAQ,KAAK,QAAQ,UAAU,SAAS,QAAQ;AACvE,cAAU,SAAS,KAAK,EAAE;AAAA,EAC9B,OACK;AACD,cAAU,SAAS,OAAO,OAAO,GAAG,EAAE;AAAA,EAC1C;AACJ;AAEO,SAAS,YAAY,KAAK,IAAI,UAAU,CAAA,GAAI;AAC/C,MAAI,OAAO,IAAI;AACX,UAAM,IAAI,MAAM,8BAA8B;AAClD,QAAM,QAAQ,IAAI,OAAO,IAAI,EAAE;AAC/B,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,oBAAoB,EAAE,EAAE;AAC5C,QAAM,WAAWA,aAAW,KAAK,EAAE;AACnC,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,+BAA+B,EAAE,EAAE;AACvD,QAAM,SAAS,IAAI,OAAO,IAAI,QAAQ;AACtC,QAAM,MAAM,OAAO,SAAS,QAAQ,EAAE;AACtC,MAAI,QAAQ;AACR,UAAM,IAAI,MAAM,SAAS,EAAE,yBAAyB,QAAQ,EAAE;AAClE,SAAO,SAAS,OAAO,KAAK,CAAC;AAC7B,MAAI,QAAQ,WAAW,MAAM;AACzB,eAAW,WAAW,MAAM,UAAU;AAClC,oBAAc,KAAK,OAAO;AAAA,IAC9B;AAAA,EACJ,OACK;AACD,WAAO,SAAS,OAAO,KAAK,GAAG,GAAG,MAAM,QAAQ;AAAA,EACpD;AACA,MAAI,OAAO,OAAO,EAAE;AACxB;AACA,SAASA,aAAW,KAAK,IAAI;AACzB,aAAW,CAAC,aAAa,KAAK,KAAK,IAAI,OAAO,WAAW;AACrD,QAAI,MAAM,SAAS,SAAS,EAAE,GAAG;AAC7B,aAAO;AAAA,IACX;AAAA,EACJ;AACA,SAAO;AACX;AACA,SAAS,aAAa,KAAK,YAAY,aAAa;AAChD,QAAM,WAAW,IAAI,OAAO,IAAI,UAAU;AAC1C,MAAI,CAAC;AACD,WAAO;AACX,QAAM,QAAQ,CAAC,GAAG,SAAS,QAAQ;AACnC,SAAO,MAAM,SAAS,GAAG;AACrB,UAAM,UAAU,MAAM,MAAK;AAC3B,QAAI,YAAY;AACZ,aAAO;AACX,UAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,QAAI;AACA,YAAM,KAAK,GAAG,MAAM,QAAQ;AAAA,EACpC;AACA,SAAO;AACX;AACA,SAAS,cAAc,KAAK,IAAI;AAC5B,QAAM,QAAQ,IAAI,OAAO,IAAI,EAAE;AAC/B,MAAI,CAAC;AACD;AACJ,aAAW,SAAS,MAAM,UAAU;AAChC,kBAAc,KAAK,KAAK;AAAA,EAC5B;AACA,MAAI,OAAO,OAAO,EAAE;AACxB;AAkHO,SAAS,WAAW,UAAU,QAAQ,WAAW,CAAA,GAAI;AACxD,SAAO;AAAA,IACH;AAAA,IACA;AAAA,IACA;AAAA,IACA,WAAW,oBAAI,KAAI;AAAA,EAC3B;AACA;AAEO,SAAS,QAAQ,KAAK,UAAU,UAAU,UAAU,WAAW,IAAI;AACtE,QAAM,SAAS,IAAI,OAAO,IAAI,QAAQ;AACtC,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,2BAA2B,QAAQ,EAAE;AACzD,MAAI,CAAC,IAAI,OAAO,IAAI,QAAQ;AACxB,UAAM,IAAI,MAAM,2BAA2B,QAAQ,EAAE;AACzD,QAAM,OAAO,WAAW,UAAU,UAAU,QAAQ;AACpD,SAAO,MAAM,KAAK,IAAI;AACtB,gBAAc,GAAG;AACrB;AAEO,SAAS,WAAW,KAAK,UAAU,UAAU,UAAU;AAC1D,QAAM,SAAS,IAAI,OAAO,IAAI,QAAQ;AACtC,MAAI,CAAC;AACD,UAAM,IAAI,MAAM,2BAA2B,QAAQ,EAAE;AACzD,QAAM,gBAAgB,OAAO,MAAM;AACnC,SAAO,QAAQ,OAAO,MAAM,OAAO,OAAK,EAAE,EAAE,aAAa,YAAY,EAAE,WAAW,SAAS;AAC3F,QAAM,UAAU,OAAO,MAAM,SAAS;AACtC,MAAI;AACA,kBAAc,GAAG;AACrB,SAAO;AACX;AA0BA,SAAS,cAAc,KAAK;AACxB,MAAI,IAAI,UAAU;AACd,QAAI,SAAS,aAAa,oBAAI,KAAI;AAAA,EACtC;AACA,MAAI;AACR;AAKO,MAAM,iBAAiB;AAAA,EAC1B,iBAAiB,KAAK,OAAO;AAAA;AAAA,EAC7B,eAAe;AAAA,EACf,cAAc,IAAI,OAAO;AAAA;AAAA,EACzB,iBAAiB;AAAA,EACjB,kBAAkB;AACtB;AAEO,SAAS,iBAAiB,KAAK,SAAS,gBAAgB;AAC3D,QAAM,SAAS,CAAA;AAEf,MAAI,IAAI,OAAO,OAAO,OAAO,eAAe;AACxC,WAAO,KAAK;AAAA,MACR,UAAU;AAAA,MACV,MAAM;AAAA,MACN,SAAS,gBAAgB,IAAI,OAAO,IAAI,mBAAmB,OAAO,aAAa;AAAA,IAC3F,CAAS;AAAA,EACL;AAEA,MAAI,UAAU,GAAG,GAAG;AAChB,WAAO,KAAK;AAAA,MACR,UAAU;AAAA,MACV,MAAM;AAAA,MACN,SAAS;AAAA,IACrB,CAAS;AAAA,EACL;AAEA,QAAM,WAAW,gBAAgB,GAAG;AACpC,MAAI,WAAW,OAAO,iBAAiB;AACnC,WAAO,KAAK;AAAA,MACR,UAAU;AAAA,MACV,MAAM;AAAA,MACN,SAAS,wBAAwB,OAAO,eAAe,kBAAkB,QAAQ;AAAA,IAC7F,CAAS;AAAA,EACL;AAEA,aAAW,CAAC,IAAI,KAAK,KAAK,IAAI,OAAO,WAAW;AAC5C,UAAM,cAAc,cAAc,KAAK,OAAO,MAAM;AACpD,WAAO,KAAK,GAAG,WAAW;AAAA,EAC9B;AAEA,QAAM,UAAU,YAAY,GAAG;AAC/B,aAAW,UAAU,SAAS;AAC1B,WAAO,KAAK;AAAA,MACR,UAAU;AAAA,MACV,MAAM;AAAA,MACN,SAAS,SAAS,MAAM;AAAA,MACxB,SAAS;AAAA,IACrB,CAAS;AAAA,EACL;AACA,QAAM,YAAY,OAAO,KAAK,OAAK,EAAE,aAAa,OAAO;AACzD,SAAO,EAAE,OAAO,CAAC,WAAW,OAAM;AACtC;AACA,SAAS,cAAc,KAAK,OAAO,QAAQ;AACvC,QAAM,SAAS,CAAA;AAEf,QAAM,OAAO,IAAI,YAAW,EAAG,OAAO,MAAM,OAAO,EAAE;AACrD,MAAI,OAAO,OAAO,cAAc;AAC5B,WAAO,KAAK;AAAA,MACR,UAAU;AAAA,MACV,MAAM;AAAA,MACN,SAAS,SAAS,MAAM,EAAE,aAAa,IAAI,YAAY,OAAO,YAAY;AAAA,MAC1E,SAAS,MAAM;AAAA,IAC3B,CAAS;AAAA,EACL;AAEA,MAAI,MAAM,MAAM,SAAS,OAAO,kBAAkB;AAC9C,WAAO,KAAK;AAAA,MACR,UAAU;AAAA,MACV,MAAM;AAAA,MACN,SAAS,SAAS,MAAM,EAAE,QAAQ,MAAM,MAAM,MAAM,kBAAkB,OAAO,gBAAgB;AAAA,MAC7F,SAAS,MAAM;AAAA,IAC3B,CAAS;AAAA,EACL;AAEA,aAAW,QAAQ,MAAM,OAAO;AAC5B,QAAI,CAAC,IAAI,OAAO,IAAI,KAAK,MAAM,GAAG;AAC9B,aAAO,KAAK;AAAA,QACR,UAAU;AAAA,QACV,MAAM;AAAA,QACN,SAAS,SAAS,MAAM,EAAE,mCAAmC,KAAK,MAAM;AAAA,QACxE,SAAS,MAAM;AAAA,MAC/B,CAAa;AAAA,IACL;AAAA,EACJ;AACA,SAAO;AACX;AACA,SAAS,UAAU,KAAK;AACpB,QAAM,UAAU,oBAAI,IAAG;AACvB,QAAM,WAAW,oBAAI,IAAG;AACxB,WAAS,IAAI,QAAQ;AACjB,YAAQ,IAAI,MAAM;AAClB,aAAS,IAAI,MAAM;AACnB,UAAM,OAAO,IAAI,OAAO,IAAI,MAAM;AAClC,QAAI,MAAM;AACN,iBAAW,SAAS,KAAK,UAAU;AAC/B,YAAI,CAAC,QAAQ,IAAI,KAAK,GAAG;AACrB,cAAI,IAAI,KAAK;AACT,mBAAO;AAAA,QACf,WACS,SAAS,IAAI,KAAK,GAAG;AAC1B,iBAAO;AAAA,QACX;AAAA,MACJ;AAAA,IACJ;AACA,aAAS,OAAO,MAAM;AACtB,WAAO;AAAA,EACX;AACA,SAAO,IAAI,IAAI,IAAI;AACvB;AACA,SAAS,gBAAgB,KAAK;AAC1B,WAAS,UAAU,QAAQ,SAAS;AAChC,UAAM,OAAO,IAAI,OAAO,IAAI,MAAM;AAClC,QAAI,CAAC,QAAQ,KAAK,SAAS,WAAW;AAClC,aAAO;AACX,WAAO,KAAK,IAAI,GAAG,KAAK,SAAS,IAAI,OAAK,UAAU,GAAG,UAAU,CAAC,CAAC,CAAC;AAAA,EACxE;AACA,SAAO,UAAU,IAAI,MAAM,CAAC;AAChC;AAEO,SAAS,YAAY,KAAK;AAC7B,QAAM,YAAY,oBAAI,IAAI,CAAC,IAAI,IAAI,CAAC;AACpC,QAAM,QAAQ,CAAC,IAAI,IAAI;AACvB,SAAO,MAAM,SAAS,GAAG;AACrB,UAAM,UAAU,MAAM,MAAK;AAC3B,UAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,QAAI,OAAO;AACP,iBAAW,SAAS,MAAM,UAAU;AAChC,YAAI,CAAC,UAAU,IAAI,KAAK,GAAG;AACvB,oBAAU,IAAI,KAAK;AACnB,gBAAM,KAAK,KAAK;AAAA,QACpB;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AACA,SAAO,MAAM,KAAK,IAAI,OAAO,KAAI,CAAE,EAAE,OAAO,QAAM,CAAC,UAAU,IAAI,EAAE,CAAC;AACxE;AAkhBO,SAAS,kBAAkB,KAAK;AACnC,QAAM,eAAe;AAAA,IACjB,IAAI,IAAI;AAAA,IACR,MAAM,IAAI;AAAA,IACV,QAAQ,MAAM,KAAK,IAAI,OAAO,QAAO,CAAE,EAAE,IAAI,CAAC,CAAC,IAAI,KAAK,MAAM,CAAC,IAAI;AAAA,MAC3D,GAAG;AAAA,MACH,OAAO,MAAM,MAAM,IAAI,QAAM,EAAE,GAAG,GAAG,WAAW,EAAE,UAAU,YAAW,EAAE,EAAG;AAAA,IAC5F,CAAa,CAAC;AAAA,IACN,UAAU,IAAI,WAAW;AAAA,MACrB,GAAG,IAAI;AAAA,MACP,WAAW,IAAI,SAAS,UAAU,YAAW;AAAA,MAC7C,YAAY,IAAI,SAAS,WAAW,YAAW;AAAA,IAC3D,IAAY;AAAA,IACJ,SAAS,IAAI;AAAA,EACrB;AACI,SAAO,KAAK,UAAU,YAAY;AACtC;AAEO,SAAS,oBAAoB,MAAM;AACtC,QAAM,SAAS,KAAK,MAAM,IAAI;AAC9B,QAAM,SAAS,oBAAI,IAAG;AACtB,aAAW,CAAC,IAAI,SAAS,KAAK,OAAO,QAAQ;AACzC,WAAO,IAAI,IAAI;AAAA,MACX,GAAG;AAAA,MACH,OAAO,UAAU,MAAM,IAAI,CAAC,OAAO;AAAA,QAC/B,GAAG;AAAA,QACH,WAAW,IAAI,KAAK,EAAE,SAAS;AAAA,MAC/C,EAAc;AAAA,IACd,CAAS;AAAA,EACL;AACA,SAAO;AAAA,IACH,IAAI,OAAO;AAAA,IACX,MAAM,OAAO;AAAA,IACb;AAAA,IACA,UAAU,OAAO,WAAW;AAAA,MACxB,GAAG,OAAO;AAAA,MACV,WAAW,IAAI,KAAK,OAAO,SAAS,SAAS;AAAA,MAC7C,YAAY,IAAI,KAAK,OAAO,SAAS,UAAU;AAAA,IAC3D,IAAY;AAAA,IACJ,SAAS,OAAO;AAAA,EACxB;AACA;AAEO,MAAM,gBAAgB;AAAA,EAGzB,YAAY,eAAe,KAAK;AAFhC,qCAAY,oBAAI,IAAG;AACnB;AAEI,SAAK,eAAe;AAAA,EACxB;AAAA;AAAA,EAEA,OAAO,MAAM,KAAK,aAAa;AAC3B,QAAI,KAAK,UAAU,QAAQ,KAAK,cAAc;AAC1C,WAAK,YAAW;AAAA,IACpB;AACA,UAAM,WAAW;AAAA,MACb,IAAI;AAAA,MACJ;AAAA,MACA,WAAW,oBAAI,KAAI;AAAA,MACnB,iBAAiB,IAAI;AAAA,MACrB,MAAM,kBAAkB,GAAG;AAAA,IACvC;AACQ,SAAK,UAAU,IAAI,MAAM,QAAQ;AACjC,WAAO;AAAA,EACX;AAAA;AAAA,EAEA,QAAQ,MAAM;AACV,UAAM,WAAW,KAAK,UAAU,IAAI,IAAI;AACxC,QAAI,CAAC;AACD,YAAM,IAAI,MAAM,uBAAuB,IAAI,EAAE;AACjD,WAAO,oBAAoB,SAAS,IAAI;AAAA,EAC5C;AAAA;AAAA,EAEA,IAAI,MAAM;AACN,WAAO,KAAK,UAAU,IAAI,IAAI;AAAA,EAClC;AAAA;AAAA,EAEA,QAAQ,MAAM;AACV,UAAM,WAAW,KAAK,UAAU,IAAI,IAAI;AACxC,QAAI,CAAC;AACD,aAAO;AAEX,QAAI,aAAa;AACjB,QAAI;AACA,YAAM,SAAS,KAAK,MAAM,SAAS,IAAI;AACvC,mBAAa,OAAO,KAAK,OAAO,UAAU,CAAA,CAAE,EAAE;AAAA,IAClD,QACM;AACF,mBAAa;AAAA,IACjB;AACA,WAAO;AAAA,MACH,IAAI,SAAS;AAAA,MACb,aAAa,SAAS;AAAA,MACtB,WAAW,SAAS;AAAA,MACpB,iBAAiB,SAAS;AAAA,MAC1B;AAAA,IACZ;AAAA,EACI;AAAA;AAAA,EAEA,OAAO;AACH,WAAO,MAAM,KAAK,KAAK,UAAU,OAAM,CAAE,EACpC,KAAK,CAAC,GAAG,MAAM,EAAE,UAAU,QAAO,IAAK,EAAE,UAAU,SAAS;AAAA,EACrE;AAAA;AAAA,EAEA,OAAO,MAAM;AACT,WAAO,KAAK,UAAU,OAAO,IAAI;AAAA,EACrC;AAAA;AAAA,EAEA,OAAO,MAAM;AACT,WAAO,KAAK,UAAU,IAAI,IAAI;AAAA,EAClC;AAAA;AAAA,EAEA,QAAQ;AACJ,WAAO,KAAK,UAAU;AAAA,EAC1B;AAAA,EACA,cAAc;AACV,QAAI;AACJ,eAAW,YAAY,KAAK,UAAU,OAAM,GAAI;AAC5C,UAAI,CAAC,UAAU,SAAS,YAAY,OAAO,WAAW;AAClD,iBAAS;AAAA,MACb;AAAA,IACJ;AACA,QAAI;AACA,WAAK,UAAU,OAAO,OAAO,EAAE;AAAA,EACvC;AACJ;ACplCA,SAAS,yBAAyC;AAChD,SAAO;AAAA,IACL,MAAM;AAAA,EAAA;AAEV;AAEA,SAAS,yBAAoC;AAC3C,SAAO;AAAA,IACL,YAAY;AAAA,EAAA;AAEhB;AAEA,SAAS,0BAA0C;AACjD,SAAO;AAAA,IACL,QAAQ;AAAA,IACR,2BAAW,IAAA;AAAA,IACX,OAAO,CAAA;AAAA,IACP,UAAU,EAAE,GAAG,GAAG,GAAG,GAAG,MAAM,EAAA;AAAA,IAC9B,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,gBAAgB;AAAA,IAChB,YAAY,CAAA;AAAA,EAAC;AAEjB;AAEA,SAAS,yBAAwC;AAC/C,SAAO;AAAA,IACL,aAAa;AAAA,IACb,gBAAgB;AAAA,IAChB,iBAAiB;AAAA,IACjB,MAAM;AAAA,IACN,kBAAkB;AAAA,IAClB,eAAe;AAAA,IACf,UAAU;AAAA,EAAA;AAEd;AAEA,SAAS,0BAA0B,YAAkC;AACnE,SAAO;AAAA,IACL,SAAS,CAAA;AAAA,IACT,cAAc;AAAA,IACd;AAAA,IACA,SAAS;AAAA,IACT,SAAS;AAAA,EAAA;AAEb;AAEA,SAAS,mBAAmB,QAAwC;AAClE,SAAO;AAAA,IACL,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,SAAS;AAAA,IACT,WAAW;AAAA,IACX,MAAM;AAAA,IACN,MAAM;AAAA,IACN,WAAW,uBAAA;AAAA,IACX,gBAAgB;AAAA,IAChB,WAAW;AAAA,IACX,gBAAgB;AAAA,IAChB,MAAM,uBAAA;AAAA,IACN,OAAO,wBAAA;AAAA,IACP,MAAM,uBAAA;AAAA,IACN,SAAS,0BAA0B,OAAO,iBAAiB;AAAA,IAC3D;AAAA,IACA,WAAW;AAAA,EAAA;AAEf;AAoCO,SAAS,kBACd,gBAAuC,IAKvC;AACA,QAAM,SAAS,EAAE,GAAG,uBAAuB,GAAG,cAAA;AAC9C,QAAMD,UAAS,IAAI,OAAO,EAAE,SAAS,eAAe,OAAO,OAAO,UAAU;AAC5E,QAAM,SAA6B,IAAI,mBAAA;AACvC,QAAM,kBAAkB,IAAI,gBAAgB,OAAO,iBAAiB;AAEpE,MAAI,QAAQ,mBAAmB,MAAM;AACrC,QAAM,gCAAgB,IAAA;AAMtB,WAAS,SAAS,SAAiG;AACjH,UAAM,YAAY;AAClB,UAAM,UAAU,OAAO,YAAY,aAAa,QAAQ,KAAK,IAAI;AACjE,YAAQ,EAAE,GAAG,OAAO,GAAG,QAAA;AAEvB,cAAU,QAAQ,CAAC,aAAa;AAC9B,UAAI;AACF,iBAAS,OAAO,SAAS;AAAA,MAC3B,SAAS,OAAO;AACd,QAAAA,QAAO,MAAM,kBAAkB,iBAAiB,QAAQ,QAAQ,MAAS;AAAA,MAC3E;AAAA,IACF,CAAC;AAAA,EACH;AAEA,WAAS,UAAU,MAAyC,MAA6B;AACvF,WAAO,KAAK,MAAM,IAAI;AAAA,EACxB;AAEA,WAAS,YAAY,OAAkC;AACrD,IAAAA,QAAO,MAAM,MAAM,SAAS,KAAK;AACjC,aAAS,EAAE,WAAW,OAAO;AAC7B,QAAI,iBAAiB,aAAa;AAChC,gBAAU,kBAAkB;AAAA,QAC1B,MAAM,MAAM;AAAA,QACZ,SAAS,MAAM;AAAA,QACf,UAAU,MAAM;AAAA,QAChB,UAAU,MAAM;AAAA,QAChB,MAAM,MAAM;AAAA,MAAA,CACb;AAAA,IACH;AAAA,EACF;AAMA,WAAS,YAAY,aAAqB,YAAsC;AAC9E,QAAI,CAAC,MAAM,SAAU;AAErB,UAAM,aAAa,YAAY,KAAK,IAAA,CAAK;AACzC,oBAAgB,OAAO,YAAY,MAAM,UAAU,WAAW;AAE9D,UAAM,QAAsB;AAAA,MAC1B,IAAI,SAAS,KAAK,IAAA,CAAK;AAAA,MACvB,+BAAe,KAAA;AAAA,MACf;AAAA,MACA;AAAA,MACA;AAAA,IAAA;AAGF,UAAM,aAAa,CAAC,GAAG,MAAM,QAAQ,QAAQ,MAAM,GAAG,MAAM,QAAQ,eAAe,CAAC,GAAG,KAAK;AAC5F,QAAI,WAAW,SAAS,MAAM,QAAQ,YAAY;AAChD,iBAAW,MAAA;AAAA,IACb;AAEA,aAAS;AAAA,MACP,SAAS;AAAA,QACP,GAAG,MAAM;AAAA,QACT,SAAS;AAAA,QACT,cAAc,WAAW,SAAS;AAAA,QAClC,SAAS,WAAW,SAAS;AAAA,QAC7B,SAAS;AAAA,MAAA;AAAA,MAEX,SAAS;AAAA,IAAA,CACV;AAED,cAAU,4BAA4B;AAAA,MACpC,SAAS,MAAM;AAAA,MACf;AAAA,MACA;AAAA,MACA,gBAAgB,WAAW;AAAA,IAAA,CAC5B;AAAA,EACH;AAMA,WAAS,aAAa,KAAqB;;AACzC,IAAAA,QAAO,KAAK,oBAAoB,EAAE,YAAY,IAAI,IAAI,YAAY,IAAI,OAAO,KAAA,CAAM;AAEnF,aAAS;AAAA,MACP,UAAU;AAAA,MACV,YAAY,IAAI;AAAA,MAChB,WAAW;AAAA,MACX,SAAS;AAAA,MACT,WAAW,uBAAA;AAAA,MACX,gBAAgB;AAAA,MAChB,WAAW;AAAA,MACX,gBAAgB;AAAA,MAChB,SAAS,0BAA0B,MAAM,OAAO,iBAAiB;AAAA,MACjE,WAAW;AAAA,IAAA,CACZ;AAGD,oBAAgB,OAAO,WAAW,KAAK,eAAe;AAEtD,cAAU,mBAAmB;AAAA,MAC3B,YAAY,IAAI;AAAA,MAChB,QAAO,SAAI,aAAJ,mBAAc;AAAA,MACrB,YAAY,IAAI,OAAO;AAAA,MACvB,SAAS,IAAI;AAAA,IAAA,CACd;AAAA,EACH;AAEA,WAASE,iBAAe,OAAsB;AAC5C,IAAAF,QAAO,KAAK,yBAAyB,EAAE,MAAA,CAAO;AAC9C,UAAM,MAAMG,eAAkB,KAAK;AACnC,iBAAa,GAAG;AAChB,cAAU,oBAAoB;AAAA,MAC5B,YAAY,IAAI;AAAA,MAChB;AAAA,IAAA,CACD;AAAA,EACH;AAEA,iBAAe,eAA8B;AAC3C,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,IAAAH,QAAO,KAAK,mBAAmB,EAAE,YAAY,MAAM,YAAY;AAC/D,aAAS,EAAE,WAAW,MAAM;AAE5B,QAAI;AAEF,YAAM,aAAa,iBAAiB,MAAM,QAAQ;AAClD,UAAI,CAAC,WAAW,OAAO;AACrB,cAAM,SAAS,WAAW,OAAO,OAAO,CAAC,MAAM,EAAE,aAAa,OAAO;AACrE,YAAI,OAAO,SAAS,GAAG;AACrB,gBAAM,IAAI,YAAY;AAAA,YACpB,MAAM;AAAA,YACN,SAAS;AAAA,YACT,UAAU;AAAA,YACV,MAAM,EAAE,kBAAkB,OAAO,IAAI,CAAC,MAAM,EAAE,OAAO,EAAA;AAAA,UAAE,CACxD;AAAA,QACH;AAAA,MACF;AAIA,eAAS;AAAA,QACP,WAAW;AAAA,QACX,SAAS;AAAA,QACT,+BAAe,KAAA;AAAA,MAAK,CACrB;AAED,gBAAU,kBAAkB;AAAA,QAC1B,YAAY,MAAM;AAAA,QAClB,SAAS,MAAM,SAAS;AAAA,MAAA,CACzB;AAAA,IACH,SAAS,OAAO;AACd,eAAS,EAAE,WAAW,OAAO;AAC7B,kBAAY,iBAAiB,QAAQ,QAAQ,OAAO,cAAc,OAAO,KAAK,CAAC,CAAC;AAChF,YAAM;AAAA,IACR;AAAA,EACF;AAMA,WAAS,QAAQ,MAAwB;AACvC,UAAM,eAAe,MAAM;AAC3B,IAAAA,QAAO,MAAM,gBAAgB,EAAE,MAAM,cAAc;AACnD,aAAS,EAAE,MAAM;AACjB,cAAU,gBAAgB,EAAE,MAAM,aAAA,CAAc;AAAA,EAClD;AAEA,WAAS,QAAQ,MAAwB;AACvC,UAAM,eAAe,MAAM;AAC3B,IAAAA,QAAO,MAAM,gBAAgB,EAAE,MAAM,cAAc;AACnD,aAAS,EAAE,MAAM;AACjB,cAAU,gBAAgB,EAAE,MAAM,aAAA,CAAc;AAAA,EAClD;AAMA,WAASI,WAAS,UAAmB,SAAiB,MAA6B;AACjF,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,IAAAJ,QAAO,MAAM,gBAAgB,EAAE,UAAU,eAAe,QAAQ,QAAQ,MAAM;AAE9E,UAAM,KAAKK,SAAY,MAAM,UAAU,UAAU,SAAS,EAAE,MAAM;AAElE,gBAAY,aAAa,CAAC,EAAE,MAAM,aAAa,SAAS,IAAI,MAAM,EAAE,UAAU,SAAS,KAAA,EAAK,CAAG,CAAC;AAEhG,cAAU,eAAe,EAAE,SAAS,IAAI,UAAU,SAAS,MAAM;AAGjE,aAAS,EAAE,UAAU,EAAE,GAAG,MAAM,SAAA,GAAY;AAE5C,WAAO;AAAA,EACT;AAEA,WAAS,iBAAiB,SAAkB,SAAuB;AACjE,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,QAAQ,OAAO,kBAAA;AACrB,kBAAY,KAAK;AACjB,YAAM;AAAA,IACR;AAEA,UAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,QAAI,CAAC,OAAO;AACV,YAAM,QAAQ,OAAO,cAAc,OAAO;AAC1C,kBAAY,KAAK;AACjB,YAAM;AAAA,IACR;AAEA,UAAM,aAAa,MAAM;AACzB,IAAAL,QAAO,MAAM,iBAAiB,EAAE,SAAS,WAAW,WAAW,QAAQ,WAAW,QAAQ,OAAA,CAAQ;AAElGM,cAAa,MAAM,UAAU,SAAS,OAAO;AAE7C,gBAAY,cAAc,CAAC,EAAE,MAAM,cAAc,SAAS,MAAM,EAAE,YAAY,YAAY,QAAA,EAAQ,CAAG,CAAC;AAEtG,cAAU,gBAAgB,EAAE,SAAS,SAAS,YAAY;AAE1D,aAAS,EAAE,UAAU,EAAE,GAAG,MAAM,SAAA,GAAY;AAAA,EAC9C;AAEA,WAAS,gBAAgB,SAAkB,UAAU,MAAY;AAC/D,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,UAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,QAAI,CAAC,OAAO;AACV,YAAM,OAAO,cAAc,OAAO;AAAA,IACpC;AAEA,IAAAN,QAAO,MAAM,kBAAkB,EAAE,SAAS,SAAS;AAGnD,UAAM,YAAY,kBAAkB,MAAM,QAAQ;AAElDO,gBAAe,MAAM,UAAU,SAAS,EAAE,SAAS;AAEnD,gBAAY,gBAAgB,CAAC,EAAE,MAAM,gBAAgB,SAAS,MAAM,EAAE,SAAS,UAAU,UAAA,EAAU,CAAG,CAAC;AAGvG,QAAI,MAAM,UAAU,mBAAmB,SAAS;AAC9C,eAAS;AAAA,QACP,WAAW,uBAAA;AAAA,QACX,UAAU,EAAE,GAAG,MAAM,SAAA;AAAA,MAAS,CAC/B;AAAA,IACH,OAAO;AACL,eAAS,EAAE,UAAU,EAAE,GAAG,MAAM,SAAA,GAAY;AAAA,IAC9C;AAEA,cAAU,iBAAiB,EAAE,SAAS;AAAA,EACxC;AAEA,WAAS,YACP,SACA,UACA,UACM;AACN,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,UAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,QAAI,CAAC,OAAO;AACV,YAAM,OAAO,cAAc,OAAO;AAAA,IACpC;AAEA,UAAM,SAAS,MAAM,SAAS,OAAO,IAAI,QAAQ;AACjD,QAAI,CAAC,QAAQ;AACX,YAAM,OAAO,cAAc,QAAQ;AAAA,IACrC;AAEA,IAAAP,QAAO,MAAM,gBAAgB,EAAE,SAAS,UAAU,UAAU;AAG5D,QAAI;AACJ,eAAW,CAAC,IAAI,CAAC,KAAK,MAAM,SAAS,QAAQ;AAC3C,UAAI,EAAE,SAAS,SAAS,OAAO,GAAG;AAChC,sBAAc;AACd;AAAA,MACF;AAAA,IACF;AAGA,QAAI;AACJ,QAAI;AAEJ,QAAI,aAAa,UAAU;AACzB,oBAAc;AAAA,IAChB,OAAO;AAEL,iBAAW,CAAC,IAAI,CAAC,KAAK,MAAM,SAAS,QAAQ;AAC3C,YAAI,EAAE,SAAS,SAAS,QAAQ,GAAG;AACjC,wBAAc;AACd,gBAAM,cAAc,EAAE,SAAS,QAAQ,QAAQ;AAC/C,kBAAQ,aAAa,WAAW,cAAc,cAAc;AAC5D;AAAA,QACF;AAAA,MACF;AACA,UAAI,CAAC,aAAc;AACjB,cAAM,OAAO,kBAAkB,SAAS,UAAU,sBAAsB;AAAA,MAC1E;AAAA,IACF;AAEAQ,cAAa,MAAM,UAAU,SAAS,aAAa,KAAK;AAExD,gBAAY,cAAc;AAAA,MACxB;AAAA,QACE,MAAM;AAAA,QACN;AAAA,QACA,MAAM,EAAE,aAAa,aAAa,SAAA;AAAA,MAAS;AAAA,IAC7C,CACD;AAED,cAAU,eAAe,EAAE,SAAS,aAAa,aAAa,UAAU;AAExE,aAAS,EAAE,UAAU,EAAE,GAAG,MAAM,SAAA,GAAY;AAAA,EAC9C;AAEA,WAAS,gBAAgB,SAAkB,MAAyB;AAClE,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,UAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,QAAI,CAAC,OAAO;AACV,YAAM,OAAO,cAAc,OAAO;AAAA,IACpC;AAEA,UAAM,UAAU,MAAM;AACtB,IAAAR,QAAO,MAAM,uBAAuB,EAAE,SAAS,SAAS,SAAS,MAAM;AAEvE,UAAM,OAAO;AAEb,gBAAY,qBAAqB;AAAA,MAC/B,EAAE,MAAM,eAAe,SAAS,MAAM,EAAE,SAAS,SAAS,KAAA,EAAK;AAAA,IAAE,CAClE;AAED,cAAU,sBAAsB,EAAE,SAAS,MAAM,SAAS;AAE1D,aAAS,EAAE,UAAU,EAAE,GAAG,MAAM,SAAA,GAAY;AAAA,EAC9C;AAMA,WAAS,OAAO,SAAwB;AACtC,QAAI,CAAC,MAAM,SAAU;AAErB,UAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,QAAI,CAAC,OAAO;AACV,MAAAA,QAAO,KAAK,0CAA0C,EAAE,QAAA,CAAS;AACjE;AAAA,IACF;AAEA,IAAAA,QAAO,MAAM,mBAAmB,EAAE,QAAA,CAAS;AAE3C,aAAS;AAAA,MACP,WAAW;AAAA,QACT,MAAM;AAAA,QACN,QAAQ,EAAE,UAAU,CAAC,OAAO,GAAG,QAAQ,SAAS,OAAO,QAAA;AAAA,QACvD,gBAAgB;AAAA,MAAA;AAAA,IAClB,CACD;AAED,cAAU,qBAAqB,EAAE,UAAU,CAAC,OAAO,GAAG,gBAAgB,SAAS;AAAA,EACjF;AAEA,WAAS,eAAe,UAA2B;AACjD,QAAI,CAAC,MAAM,SAAU;AAErB,UAAM,WAAW,SAAS,OAAO,CAAC,OAAO,MAAM,SAAU,OAAO,IAAI,EAAE,CAAC;AACvE,QAAI,SAAS,WAAW,GAAG;AACzB,qBAAA;AACA;AAAA,IACF;AAEA,IAAAA,QAAO,MAAM,6BAA6B,EAAE,OAAO,SAAS,QAAQ;AAEpE,aAAS;AAAA,MACP,WAAW;AAAA,QACT,MAAM;AAAA,QACN,QAAQ;AAAA,UACN,UAAU;AAAA,UACV,QAAQ,SAAS,CAAC;AAAA,UAClB,OAAO,SAAS,SAAS,SAAS,CAAC;AAAA,QAAA;AAAA,QAErC,gBAAgB,SAAS,CAAC;AAAA,MAAA;AAAA,IAC5B,CACD;AAED,cAAU,qBAAqB,EAAE,UAAU,UAAU,gBAAgB,SAAS,CAAC,GAAG;AAAA,EACpF;AAEA,WAAS,iBAAuB;AAC9B,IAAAA,QAAO,MAAM,oBAAoB;AACjC,aAAS,EAAE,WAAW,uBAAA,GAA0B;AAChD,cAAU,qBAAqB,EAAE,UAAU,CAAA,GAAI;AAAA,EACjD;AAEA,WAAS,WAAW,SAAkB,OAAe,KAAmB;AACtE,QAAI,CAAC,MAAM,SAAU;AAErB,UAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,QAAI,CAAC,MAAO;AAEZ,IAAAA,QAAO,MAAM,kBAAkB,EAAE,SAAS,OAAO,KAAK;AAEtD,aAAS;AAAA,MACP,WAAW;AAAA,QACT,MAAM;AAAA,QACN,MAAM,EAAE,SAAS,OAAO,IAAA;AAAA,QACxB,gBAAgB;AAAA,MAAA;AAAA,IAClB,CACD;AAED,cAAU,qBAAqB;AAAA,MAC7B,UAAU,CAAC,OAAO;AAAA,MAClB,gBAAgB;AAAA,MAChB,eAAe,EAAE,SAAS,OAAO,IAAA;AAAA,IAAI,CACtC;AAAA,EACH;AAMA,WAAS,aAAa,SAAwB;AAC5C,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,UAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,QAAI,CAAC,OAAO;AACV,YAAM,OAAO,cAAc,OAAO;AAAA,IACpC;AAEA,IAAAA,QAAO,MAAM,iBAAiB,EAAE,QAAA,CAAS;AAEzC,aAAS;AAAA,MACP,gBAAgB;AAAA,MAChB,WAAW;AAAA,MACX,gBAAgB,MAAM;AAAA,MACtB,MAAM;AAAA,IAAA,CACP;AAED,cAAU,gBAAgB,EAAE,SAAS,SAAS,MAAM,SAAS;AAAA,EAC/D;AAEA,WAAS,YAAY,OAAO,MAAY;AACtC,QAAI,CAAC,MAAM,kBAAkB,CAAC,MAAM,UAAU;AAC5C;AAAA,IACF;AAEA,UAAM,UAAU,MAAM;AACtB,UAAM,UAAU,MAAM;AAEtB,IAAAA,QAAO,MAAM,iBAAiB,EAAE,SAAS,MAAM;AAE/C,QAAI,QAAQ,YAAY,MAAM;AAC5B,YAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,UAAI,SAAS,MAAM,YAAY,SAAS;AACtC,yBAAiB,SAAS,OAAO;AACjC,kBAAU,cAAc,EAAE,SAAS,QAAA,CAAS;AAAA,MAC9C;AAAA,IACF,OAAO;AACL,gBAAU,kBAAkB,EAAE,SAAS;AAAA,IACzC;AAEA,aAAS;AAAA,MACP,gBAAgB;AAAA,MAChB,WAAW;AAAA,MACX,gBAAgB;AAAA,MAChB,MAAM;AAAA,IAAA,CACP;AAAA,EACH;AAEA,WAAS,qBAAqB,SAAuB;AACnD,QAAI,MAAM,gBAAgB;AACxB,eAAS,EAAE,gBAAgB,SAAS;AAAA,IACtC;AAAA,EACF;AAMA,WAAS,UAAU,SAAwB;AACzC,QAAI,CAAC,MAAM,SAAU;AAErB,UAAM,QAAQ,MAAM,SAAS,OAAO,IAAI,OAAO;AAC/C,QAAI,CAAC,MAAO;AAEZ,IAAAA,QAAO,MAAM,iBAAiB,EAAE,QAAA,CAAS;AAEzC,aAAS;AAAA,MACP,MAAM;AAAA,QACJ,YAAY;AAAA,QACZ,UAAU;AAAA,QACV,UAAU;AAAA,QACV,UAAU;AAAA,MAAA;AAAA,MAEZ,MAAM;AAAA,IAAA,CACP;AAED,cAAU,gBAAgB,EAAE,UAAU,QAAA,CAAS;AAAA,EACjD;AAEA,WAAS,iBAAiB,UAAmB,UAA+C;AAC1F,QAAI,CAAC,MAAM,KAAK,WAAY;AAE5B,aAAS;AAAA,MACP,MAAM;AAAA,QACJ,GAAG,MAAM;AAAA,QACT;AAAA,QACA;AAAA,MAAA;AAAA,IACF,CACD;AAED,cAAU,cAAc,EAAE,UAAU,MAAM,KAAK,UAAW,UAAU,UAAU;AAAA,EAChF;AAEA,WAAS,QAAQ,OAAO,MAAY;AAClC,QAAI,CAAC,MAAM,KAAK,WAAY;AAE5B,UAAM,EAAE,UAAU,UAAU,SAAA,IAAa,MAAM;AAE/C,IAAAA,QAAO,MAAM,eAAe,EAAE,UAAU,UAAU,UAAU,MAAM;AAElE,QAAI,QAAQ,YAAY,YAAY,UAAU;AAC5C,UAAI;AACF,oBAAY,UAAU,UAAU,QAAQ;AACxC,kBAAU,cAAc,EAAE,UAAU,UAAU,UAAU;AAAA,MAC1D,SAAS,OAAO;AACd,oBAAY,iBAAiB,QAAQ,QAAQ,OAAO,cAAc,OAAO,KAAK,CAAC,CAAC;AAChF,kBAAU,kBAAkB,EAAE,UAAU;AAAA,MAC1C;AAAA,IACF,OAAO;AACL,gBAAU,kBAAkB,EAAE,UAAqB;AAAA,IACrD;AAEA,aAAS;AAAA,MACP,MAAM,uBAAA;AAAA,MACN,MAAM;AAAA,IAAA,CACP;AAAA,EACH;AAMA,WAAS,OAAa;AACpB,QAAI,CAAC,MAAM,QAAQ,WAAW,MAAM,QAAQ,eAAe,GAAG;AAC5D,YAAM,OAAO,gBAAA;AAAA,IACf;AAEA,UAAM,QAAQ,MAAM,QAAQ,QAAQ,MAAM,QAAQ,YAAY;AAC9D,QAAI,CAAC,MAAO;AAEZ,IAAAA,QAAO,MAAM,WAAW,EAAE,SAAS,MAAM,IAAI,aAAa,MAAM,aAAa;AAG7E,UAAM,gBAAgB,MAAM,QAAQ,eAAe;AACnD,UAAM,gBAAgB,MAAM,QAAQ,QAAQ,aAAa;AACzD,QAAI,eAAe;AACjB,YAAM,MAAM,gBAAgB,QAAQ,cAAc,UAAU;AAC5D,eAAS;AAAA,QACP,UAAU;AAAA,QACV,SAAS;AAAA,UACP,GAAG,MAAM;AAAA,UACT,cAAc;AAAA,UACd,SAAS,iBAAiB;AAAA,UAC1B,SAAS;AAAA,QAAA;AAAA,QAEX,SAAS;AAAA,MAAA,CACV;AAAA,IACH,OAAO;AAEL,YAAM,MAAM,gBAAgB,QAAQ,SAAS;AAC7C,eAAS;AAAA,QACP,UAAU;AAAA,QACV,SAAS;AAAA,UACP,GAAG,MAAM;AAAA,UACT,cAAc;AAAA,UACd,SAAS;AAAA,UACT,SAAS;AAAA,QAAA;AAAA,QAEX,SAAS;AAAA,MAAA,CACV;AAAA,IACH;AAEA,cAAU,gBAAgB;AAAA,MACxB,SAAS,MAAM;AAAA,MACf,aAAa,MAAM;AAAA,MACnB,YAAY,MAAM;AAAA,IAAA,CACnB;AAAA,EACH;AAEA,WAAS,OAAa;AACpB,QAAI,CAAC,MAAM,QAAQ,SAAS;AAC1B,YAAM,OAAO,gBAAA;AAAA,IACf;AAEA,UAAM,YAAY,MAAM,QAAQ,eAAe;AAC/C,UAAM,QAAQ,MAAM,QAAQ,QAAQ,SAAS;AAC7C,QAAI,CAAC,MAAO;AAEZ,IAAAA,QAAO,MAAM,WAAW,EAAE,SAAS,MAAM,IAAI,aAAa,MAAM,aAAa;AAE7E,UAAM,MAAM,gBAAgB,QAAQ,MAAM,UAAU;AACpD,aAAS;AAAA,MACP,UAAU;AAAA,MACV,SAAS;AAAA,QACP,GAAG,MAAM;AAAA,QACT,cAAc;AAAA,QACd,SAAS;AAAA,QACT,SAAS,YAAY,MAAM,QAAQ,QAAQ,SAAS;AAAA,MAAA;AAAA,MAEtD,SAAS;AAAA,IAAA,CACV;AAED,cAAU,gBAAgB;AAAA,MACxB,SAAS,MAAM;AAAA,MACf,aAAa,MAAM;AAAA,MACnB,YAAY,MAAM;AAAA,IAAA,CACnB;AAAA,EACH;AAEA,WAAS,eAAe,aAA2B;AACjD,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,UAAM,aAAa,YAAY,KAAK,IAAA,CAAK;AACzC,oBAAgB,OAAO,YAAY,MAAM,UAAU,WAAW;AAE9D,IAAAA,QAAO,MAAM,oBAAoB,EAAE,YAAY,aAAa;AAE5D,cAAU,4BAA4B;AAAA,MACpC,SAAS;AAAA,MACT;AAAA,MACA;AAAA,IAAA,CACD;AAAA,EACH;AAMA,WAAS,eAAe,QAA2B;AACjD,IAAAA,QAAO,MAAM,wBAAwB,EAAE,OAAA,CAAQ;AAC/C,aAAS;AAAA,MACP,OAAO;AAAA,QACL,GAAG,MAAM;AAAA,QACT;AAAA,MAAA;AAAA,IACF,CACD;AACD,cAAU,wBAAwB,EAAE,QAAQ;AAAA,EAC9C;AAEA,WAAS,iBAAiB,GAAW,GAAW,MAAoB;AAClE,aAAS;AAAA,MACP,OAAO;AAAA,QACL,GAAG,MAAM;AAAA,QACT,UAAU,EAAE,GAAG,GAAG,KAAA;AAAA,MAAK;AAAA,IACzB,CACD;AACD,cAAU,0BAA0B,EAAE,UAAU,EAAE,GAAG,GAAG,KAAA,GAAQ;AAAA,EAClE;AAEA,WAAS,oBAAoB,QAAuB;AAClD,UAAM,OAAO,MAAM,MAAM,MAAM,IAAI,MAAM;AACzC,QAAI,CAAC,KAAM;AAEX,UAAM,QAAQ,IAAI,IAAI,MAAM,MAAM,KAAK;AACvC,UAAM,IAAI,QAAQ,EAAE,GAAG,MAAM,YAAY,CAAC,KAAK,YAAY;AAE3D,aAAS;AAAA,MACP,OAAO;AAAA,QACL,GAAG,MAAM;AAAA,QACT;AAAA,MAAA;AAAA,IACF,CACD;AAED,cAAU,KAAK,aAAa,yBAAyB,uBAAuB,EAAE,QAAQ;AAAA,EACxF;AAMA,WAAS,aAAa,gBAAwB,iBAA+B;AAC3E,IAAAA,QAAO,MAAM,4BAA4B,EAAE,gBAAgB,iBAAiB;AAG5E,aAAS;AAAA,MACP,MAAM;AAAA,QACJ,GAAG,MAAM;AAAA,QACT,aAAa;AAAA,QACb;AAAA,QACA;AAAA,MAAA;AAAA,IACF,CACD;AAED,cAAU,gBAAgB,EAAE,gBAAgB,gBAAA,CAAiB;AAAA,EAC/D;AAEA,WAAS,cAAoB;AAC3B,IAAAA,QAAO,MAAM,0BAA0B;AACvC,aAAS;AAAA,MACP,MAAM,uBAAA;AAAA,IAAuB,CAC9B;AACD,cAAU,cAAc,EAAE;AAAA,EAC5B;AAEA,WAAS,YAAY,SAAwB;AAC3C,IAAAA,QAAO,MAAM,wBAAwB,EAAE,QAAA,CAAS;AAEhD,cAAU,uBAAuB,EAAE,SAAS,YAAY,YAAY;AAAA,EACtE;AAEA,WAAS,aAAa,SAAwB;AAC5C,IAAAA,QAAO,MAAM,yBAAyB,EAAE,QAAA,CAAS;AAEjD,cAAU,wBAAwB,EAAE,SAAS,YAAY,YAAY;AAAA,EACvE;AAMA,WAAS,eAAe,UAAmB,UAAmB,UAA0B;AACtF,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,IAAAA,QAAO,MAAM,eAAe,EAAE,UAAU,UAAU,UAAU;AAE5DS,YAAW,MAAM,UAAU,UAAU,UAAU,QAAQ;AAEvD,gBAAY,YAAY,CAAC,EAAE,MAAM,YAAY,MAAM,EAAE,UAAU,UAAU,SAAA,EAAS,CAAG,CAAC;AAEtF,cAAU,cAAc,EAAE,UAAU,UAAU,UAAU;AAExD,aAAS,EAAE,UAAU,EAAE,GAAG,MAAM,SAAA,GAAY;AAAA,EAC9C;AAEA,WAAS,oBAAoB,UAAmB,UAAmB,UAA0B;AAC3F,QAAI,CAAC,MAAM,UAAU;AACnB,YAAM,OAAO,kBAAA;AAAA,IACf;AAEA,IAAAT,QAAO,MAAM,iBAAiB,EAAE,UAAU,UAAU,UAAU;AAE9DU,eAAc,MAAM,UAAU,UAAU,UAAU,QAAQ;AAE1D,gBAAY,eAAe,CAAC,EAAE,MAAM,eAAe,MAAM,EAAE,UAAU,UAAU,SAAA,EAAS,CAAG,CAAC;AAE5F,cAAU,gBAAgB,EAAE,UAAU,UAAU,UAAU;AAE1D,aAAS,EAAE,UAAU,EAAE,GAAG,MAAM,SAAA,GAAY;AAAA,EAC9C;AAMA,WAAS,aAAa,cAA2C;AAC/D,IAAAV,QAAO,MAAM,mBAAmB,YAAY;AAC5C,aAAS;AAAA,MACP,QAAQ,EAAE,GAAG,MAAM,QAAQ,GAAG,aAAA;AAAA,IAAa,CAC5C;AAAA,EACH;AAMA,WAAS,aAAmB;AAC1B,aAAS,EAAE,WAAW,MAAM;AAC5B,cAAU,iBAAiB,EAAE,MAAM,IAAI,SAAS,IAAI,UAAU,IAAI,UAAU,GAAA,CAAI;AAAA,EAClF;AAMA,SAAO;AAAA;AAAA,IAEL,IAAI,WAAW;AACb,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,aAAa;AACf,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,YAAY;AACd,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,UAAU;AACZ,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,YAAY;AACd,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,OAAO;AACT,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,OAAO;AACT,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,YAAY;AACd,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,iBAAiB;AACnB,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,YAAY;AACd,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,iBAAiB;AACnB,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,OAAO;AACT,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,QAAQ;AACV,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,OAAO;AACT,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,UAAU;AACZ,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,SAAS;AACX,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,YAAY;AACd,aAAO,MAAM;AAAA,IACf;AAAA;AAAA,IAGA;AAAA,IAAA,gBACAE;AAAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IAAA,UACAE;AAAAA,IACA,WAAW;AAAA,IACX,aAAa;AAAA,IACb,WAAW;AAAA,IACX;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,SAAS;AAAA,IACT,YAAY;AAAA,IACZ;AAAA,IACA;AAAA;AAAA,IAGA,WAAW,CAAC,aAA4B;AACtC,gBAAU,IAAI,QAAQ;AACtB,aAAO,MAAM,UAAU,OAAO,QAAQ;AAAA,IACxC;AAAA,IACA,UAAU,MAAM;AAAA,IAChB;AAAA,EAAA;AAEJ;ACvhCA,MAAMJ,WAAS,IAAI,OAAO,EAAE,SAAS,oBAAoB;AASlD,SAAS,uBAAuC;AACrD,SAAO;AAAA,IACL,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,gBAAgB;AAAA,EAAA;AAEpB;AAKO,SAAS,qBAAqB,SAAkC;AACrE,SAAO;AAAA,IACL,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,UAAU,CAAC,OAAO;AAAA,MAClB,QAAQ;AAAA,MACR,OAAO;AAAA,IAAA;AAAA,IAET,gBAAgB;AAAA,EAAA;AAEpB;AAKO,SAAS,0BACd,UACA,QACA,OACgB;AAChB,MAAI,SAAS,WAAW,GAAG;AACzB,WAAO,qBAAA;AAAA,EACT;AAEA,SAAO;AAAA,IACL,MAAM;AAAA,IACN,QAAQ;AAAA,MACN;AAAA,MACA,QAAQ,UAAU,SAAS,CAAC;AAAA,MAC5B,OAAO,SAAS,SAAS,SAAS,SAAS,CAAC;AAAA,IAAA;AAAA,IAE9C,gBAAgB,SAAS,SAAS,SAAS,SAAS,CAAC;AAAA,EAAA;AAEzD;AAKO,SAAS,oBAAoB,SAAkB,OAAe,KAA6B;AAChG,SAAO;AAAA,IACL,MAAM;AAAA,IACN,MAAM;AAAA,MACJ;AAAA,MACA,OAAO,KAAK,IAAI,OAAO,GAAG;AAAA,MAC1B,KAAK,KAAK,IAAI,OAAO,GAAG;AAAA,IAAA;AAAA,IAE1B,gBAAgB;AAAA,EAAA;AAEpB;AASO,SAAS,gBAAgB,WAA2B,SAA2B;;AACpF,MAAI,UAAU,SAAS,OAAQ,QAAO;AACtC,MAAI,UAAU,SAAS,OAAQ,UAAO,eAAU,SAAV,mBAAgB,aAAY;AAClE,MAAI,UAAU,SAAS,QAAS,UAAO,eAAU,WAAV,mBAAkB,SAAS,SAAS,aAAY;AACvF,SAAO;AACT;AAKO,SAAS,eAAe,WAA2B,SAA2B;AACnF,SAAO,UAAU,mBAAmB;AACtC;AAKO,SAAS,oBAAoB,WAAsC;;AACxE,MAAI,UAAU,SAAS,OAAQ,QAAO,CAAA;AACtC,MAAI,UAAU,SAAS,OAAQ,QAAO,UAAU,OAAO,CAAC,UAAU,KAAK,OAAO,IAAI,CAAA;AAClF,MAAI,UAAU,SAAS,kBAAgB,eAAU,WAAV,mBAAkB,aAAY,CAAA;AACrE,SAAO,CAAA;AACT;AAKO,SAAS,wBAAwB,WAAgD;;AACtF,MAAI,UAAU,SAAS,OAAQ,QAAO;AACtC,MAAI,UAAU,SAAS,OAAQ,SAAO,eAAU,SAAV,mBAAgB;AACtD,MAAI,UAAU,SAAS,QAAS,SAAO,eAAU,WAAV,mBAAkB;AACzD,SAAO;AACT;AAKO,SAAS,iBAAiB,WAAsD;AACrF,SAAO,UAAU,SAAS,SAAS,UAAU,OAAO;AACtD;AAKO,SAAS,iBAAiB,WAAoC;AACnE,SAAO,UAAU,SAAS;AAC5B;AAKO,SAAS,gBAAgB,WAAoC;AAClE,SAAO,UAAU,SAAS;AAC5B;AAKO,SAAS,qBAAqB,WAAoC;AACvE,SAAO,UAAU,SAAS;AAC5B;AASO,SAASW,gBAAc,KAA0B;AACtD,QAAM,QAAmB,CAAA;AAEzB,WAAS,SAAS,SAAwB;AACxC,UAAM,KAAK,OAAO;AAClB,UAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,QAAI,OAAO;AACT,iBAAW,WAAW,MAAM,UAAU;AACpC,iBAAS,OAAO;AAAA,MAClB;AAAA,IACF;AAAA,EACF;AAEA,WAAS,IAAI,IAAI;AACjB,SAAO;AACT;AAKO,SAAS,aAAa,KAAe,WAAyC;AACnF,QAAM,QAAQA,gBAAc,GAAG;AAC/B,QAAM,eAAe,MAAM,QAAQ,SAAS;AAC5C,MAAI,iBAAiB,MAAM,iBAAiB,MAAM,SAAS,GAAG;AAC5D,WAAO;AAAA,EACT;AACA,SAAO,MAAM,eAAe,CAAC;AAC/B;AAKO,SAAS,iBAAiB,KAAe,WAAyC;AACvF,QAAM,QAAQA,gBAAc,GAAG;AAC/B,QAAM,eAAe,MAAM,QAAQ,SAAS;AAC5C,MAAI,gBAAgB,GAAG;AACrB,WAAO;AAAA,EACT;AACA,SAAO,MAAM,eAAe,CAAC;AAC/B;AAKO,SAAS,eAAe,KAAe,SAAuC;AACnF,aAAW,CAAC,IAAI,KAAK,KAAK,IAAI,QAAQ;AACpC,QAAI,MAAM,SAAS,SAAS,OAAO,GAAG;AACpC,aAAO;AAAA,IACT;AAAA,EACF;AACA,SAAO;AACT;AAKO,SAAS,mBAAmB,KAAe,SAAuC;AACvF,QAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,SAAO,+BAAO,SAAS;AACzB;AAKO,SAAS,iBAAiB,KAAe,SAA6B;AAC3E,QAAM,WAAW,eAAe,KAAK,OAAO;AAC5C,MAAI,CAAC,SAAU,QAAO,CAAA;AACtB,QAAM,SAAS,IAAI,OAAO,IAAI,QAAQ;AACtC,UAAO,iCAAQ,aAAY,CAAA;AAC7B;AAKO,SAAS,eAAe,KAAe,SAAuC;AACnF,QAAM,WAAW,iBAAiB,KAAK,OAAO;AAC9C,QAAM,QAAQ,SAAS,QAAQ,OAAO;AACtC,MAAI,UAAU,MAAM,UAAU,SAAS,SAAS,GAAG;AACjD,WAAO;AAAA,EACT;AACA,SAAO,SAAS,QAAQ,CAAC;AAC3B;AAKO,SAAS,mBAAmB,KAAe,SAAuC;AACvF,QAAM,WAAW,iBAAiB,KAAK,OAAO;AAC9C,QAAM,QAAQ,SAAS,QAAQ,OAAO;AACtC,MAAI,SAAS,GAAG;AACd,WAAO;AAAA,EACT;AACA,SAAO,SAAS,QAAQ,CAAC;AAC3B;AASO,SAAS,gBACd,KACA,WACA,UACgB;;AAChB,MAAI,UAAU,SAAS,QAAQ;AAC7B,WAAO,qBAAqB,QAAQ;AAAA,EACtC;AAEA,MAAI,UAAU,SAAS,QAAQ;AAE7B,UAAM,kBAAiB,eAAU,SAAV,mBAAgB;AACvC,QAAI,CAAC,eAAgB,QAAO,qBAAqB,QAAQ;AAEzD,WAAO,iBAAiB,KAAK,gBAAgB,QAAQ;AAAA,EACvD;AAEA,MAAI,UAAU,SAAS,SAAS;AAC9B,UAAM,UAAS,eAAU,WAAV,mBAAkB;AACjC,QAAI,CAAC,OAAQ,QAAO,qBAAqB,QAAQ;AAEjD,WAAO,iBAAiB,KAAK,QAAQ,QAAQ;AAAA,EAC/C;AAEA,SAAO;AACT;AAKA,SAAS,iBAAiB,KAAe,UAAmB,SAAkC;AAC5F,QAAM,QAAQA,gBAAc,GAAG;AAC/B,QAAM,cAAc,MAAM,QAAQ,QAAQ;AAC1C,QAAM,aAAa,MAAM,QAAQ,OAAO;AAExC,MAAI,gBAAgB,MAAM,eAAe,IAAI;AAC3C,WAAO,qBAAqB,OAAO;AAAA,EACrC;AAEA,QAAM,QAAQ,KAAK,IAAI,aAAa,UAAU;AAC9C,QAAM,MAAM,KAAK,IAAI,aAAa,UAAU;AAC5C,QAAM,cAAc,MAAM,MAAM,OAAO,MAAM,CAAC;AAE9C,SAAO,0BAA0B,aAAa,UAAU,OAAO;AACjE;AA0BO,MAAM,iBAAiB;AAAA,EAK5B,YAAY,KAAe,SAAiC,IAAI;AAJxD;AACA;AACA;AAGN,SAAK,MAAM;AACX,SAAK,YAAY,qBAAA;AACjB,SAAK,SAAS;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKA,YAAY,KAAqB;AAC/B,SAAK,MAAM;AAEX,QAAI,KAAK,UAAU,kBAAkB,CAAC,IAAI,OAAO,IAAI,KAAK,UAAU,cAAc,GAAG;AACnF,WAAK,MAAA;AAAA,IACP;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,eAA+B;AAC7B,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,WAAiC;;AACpD,SAAK,YAAY;AACjB,qBAAK,QAAO,sBAAZ,4BAAgC;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,SAAwB;AAC7B,QAAI,CAAC,KAAK,IAAI,OAAO,IAAI,OAAO,GAAG;AACjCX,eAAO,KAAK,0CAA0C,EAAE,QAAA,CAAS;AACjE;AAAA,IACF;AACA,SAAK,aAAa,qBAAqB,OAAO,CAAC;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,UAA2B;AACxC,UAAM,WAAW,SAAS,OAAO,CAAC,OAAO,KAAK,IAAI,OAAO,IAAI,EAAE,CAAC;AAChE,QAAI,SAAS,WAAW,GAAG;AACzB,WAAK,MAAA;AACL;AAAA,IACF;AACA,SAAK,aAAa,0BAA0B,QAAQ,CAAC;AAAA,EACvD;AAAA;AAAA;AAAA;AAAA,EAKA,QAAc;AACZ,SAAK,aAAa,sBAAsB;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,SAAkB,OAAe,KAAmB;AAC7D,QAAI,CAAC,KAAK,IAAI,OAAO,IAAI,OAAO,GAAG;AACjCA,eAAO,KAAK,kDAAkD,EAAE,QAAA,CAAS;AACzE;AAAA,IACF;AACA,SAAK,aAAa,oBAAoB,SAAS,OAAO,GAAG,CAAC;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA,EAKA,SAAS,SAAwB;AAC/B,QAAI,CAAC,KAAK,IAAI,OAAO,IAAI,OAAO,EAAG;AACnC,SAAK,aAAa,gBAAgB,KAAK,KAAK,KAAK,WAAW,OAAO,CAAC;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA,EAKA,WAAoB;AAClB,UAAM,YAAY,KAAK,UAAU;AACjC,QAAI,CAAC,WAAW;AACd,YAAM,QAAQW,gBAAc,KAAK,GAAG;AACpC,UAAI,MAAM,SAAS,GAAG;AACpB,aAAK,OAAO,MAAM,CAAC,CAAE;AACrB,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACT;AAEA,UAAM,SAAS,aAAa,KAAK,KAAK,SAAS;AAC/C,QAAI,QAAQ;AACV,WAAK,OAAO,MAAM;AAClB,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,eAAwB;AACtB,UAAM,YAAY,KAAK,UAAU;AACjC,QAAI,CAAC,UAAW,QAAO;AAEvB,UAAM,SAAS,iBAAiB,KAAK,KAAK,SAAS;AACnD,QAAI,UAAU,WAAW,KAAK,IAAI,MAAM;AACtC,WAAK,OAAO,MAAM;AAClB,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,eAAwB;AACtB,UAAM,YAAY,KAAK,UAAU;AACjC,QAAI,CAAC,UAAW,QAAO;AAEvB,UAAM,WAAW,eAAe,KAAK,KAAK,SAAS;AACnD,QAAI,YAAY,aAAa,KAAK,IAAI,MAAM;AAC1C,WAAK,OAAO,QAAQ;AACpB,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,mBAA4B;AAC1B,UAAM,YAAY,KAAK,UAAU;AACjC,QAAI,CAAC,UAAW,QAAO;AAEvB,UAAM,UAAU,mBAAmB,KAAK,KAAK,SAAS;AACtD,QAAI,SAAS;AACX,WAAK,OAAO,OAAO;AACnB,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,aAAsB;AACpB,UAAM,YAAY,KAAK,UAAU;AACjC,QAAI,CAAC,UAAW,QAAO,KAAK,SAAA;AAE5B,UAAM,SAAS,aAAa,KAAK,KAAK,SAAS;AAC/C,QAAI,QAAQ;AACV,WAAK,SAAS,MAAM;AACpB,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,iBAA0B;AACxB,UAAM,YAAY,KAAK,UAAU;AACjC,QAAI,CAAC,UAAW,QAAO,KAAK,aAAA;AAE5B,UAAM,SAAS,iBAAiB,KAAK,KAAK,SAAS;AACnD,QAAI,UAAU,WAAW,KAAK,IAAI,MAAM;AACtC,WAAK,SAAS,MAAM;AACpB,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,YAAkB;AAChB,UAAM,QAAQA,gBAAc,KAAK,GAAG;AAEpC,UAAM,WAAW,MAAM,MAAM,CAAC;AAC9B,QAAI,SAAS,SAAS,GAAG;AACvB,WAAK,aAAa,0BAA0B,QAAQ,CAAC;AAAA,IACvD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,WAAW,SAA2B;AACpC,WAAO,gBAAgB,KAAK,WAAW,OAAO;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,SAA2B;AACnC,WAAO,eAAe,KAAK,WAAW,OAAO;AAAA,EAC/C;AACF;ACxgBA,MAAM,SAAS,IAAI,OAAO,EAAE,SAAS,cAAc;AAenD,SAAS,gBAAgB,SAAiB,SAA2B;AACnE,MAAI,YAAY,SAAS;AACvB,WAAO,EAAE,YAAY,CAAC,EAAE,MAAM,SAAS,MAAM,QAAA,CAAS,EAAA;AAAA,EACxD;AAEA,QAAM,aAA8B,CAAA;AAGpC,MAAI,QAAQ,SAAS,OAAQ,QAAQ,SAAS,KAAM;AAClD,UAAM,SAAS,qBAAqB,SAAS,OAAO;AACpD,WAAO,EAAE,YAAY,OAAA;AAAA,EACvB;AAGA,QAAM,WAAW,QAAQ,MAAM,IAAI;AACnC,QAAM,WAAW,QAAQ,MAAM,IAAI;AAEnC,QAAM,MAAM,WAAW,UAAU,QAAQ;AACzC,MAAI,SAAS;AACb,MAAI,SAAS;AACb,MAAI,SAAS;AAEb,SAAO,SAAS,SAAS,UAAU,SAAS,SAAS,QAAQ;AAC3D,QAAI,SAAS,IAAI,UAAU,SAAS,MAAM,MAAM,IAAI,MAAM,KAAK,SAAS,MAAM,MAAM,IAAI,MAAM,GAAG;AAE/F,iBAAW,KAAK,EAAE,MAAM,SAAS,MAAM,SAAS,MAAM,IAAK,MAAM;AACjE;AACA;AACA;AAAA,IACF,WAAW,SAAS,SAAS,WAAW,UAAU,IAAI,UAAU,SAAS,MAAM,MAAM,IAAI,MAAM,IAAI;AAEjG,iBAAW,KAAK,EAAE,MAAM,UAAU,MAAM,SAAS,MAAM,IAAK,MAAM;AAClE;AAAA,IACF,WAAW,SAAS,SAAS,QAAQ;AAEnC,iBAAW,KAAK,EAAE,MAAM,UAAU,MAAM,SAAS,MAAM,IAAK,MAAM;AAClE;AAAA,IACF;AAAA,EACF;AAGA,SAAO,EAAE,YAAY,gBAAgB,UAAU,EAAA;AACjD;AAKA,SAAS,qBAAqB,SAAiB,SAAkC;AAC/E,QAAM,aAA8B,CAAA;AAGpC,MAAI,YAAY;AAChB,SAAO,YAAY,QAAQ,UAAU,YAAY,QAAQ,UAAU,QAAQ,SAAS,MAAM,QAAQ,SAAS,GAAG;AAC5G;AAAA,EACF;AAGA,MAAI,YAAY;AAChB,SACE,YAAY,QAAQ,SAAS,aAC7B,YAAY,QAAQ,SAAS,aAC7B,QAAQ,QAAQ,SAAS,IAAI,SAAS,MAAM,QAAQ,QAAQ,SAAS,IAAI,SAAS,GAClF;AACA;AAAA,EACF;AAGA,MAAI,YAAY,GAAG;AACjB,eAAW,KAAK,EAAE,MAAM,SAAS,MAAM,QAAQ,MAAM,GAAG,SAAS,GAAG;AAAA,EACtE;AAGA,QAAM,YAAY,QAAQ,MAAM,WAAW,QAAQ,SAAS,SAAS;AACrE,QAAM,YAAY,QAAQ,MAAM,WAAW,QAAQ,SAAS,SAAS;AAErE,MAAI,UAAU,SAAS,GAAG;AACxB,eAAW,KAAK,EAAE,MAAM,UAAU,MAAM,WAAW;AAAA,EACrD;AACA,MAAI,UAAU,SAAS,GAAG;AACxB,eAAW,KAAK,EAAE,MAAM,UAAU,MAAM,WAAW;AAAA,EACrD;AAGA,MAAI,YAAY,GAAG;AACjB,eAAW,KAAK,EAAE,MAAM,SAAS,MAAM,QAAQ,MAAM,QAAQ,SAAS,SAAS,EAAA,CAAG;AAAA,EACpF;AAEA,SAAO;AACT;AAKA,SAAS,WAAW,GAAa,GAAuB;AACtD,QAAM,IAAI,EAAE;AACZ,QAAM,IAAI,EAAE;AAGZ,MAAI,IAAI,OAAQ,IAAI,KAAM;AACxB,WAAO,oBAAoB,GAAG,CAAC;AAAA,EACjC;AAEA,QAAM,KAAiB,MAAM,IAAI,CAAC,EAC/B,KAAK,IAAI,EACT,IAAI,MAAM,MAAM,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;AAEjC,WAASC,KAAI,GAAGA,MAAK,GAAGA,MAAK;AAC3B,aAASC,KAAI,GAAGA,MAAK,GAAGA,MAAK;AAC3B,UAAI,EAAED,KAAI,CAAC,MAAM,EAAEC,KAAI,CAAC,GAAG;AACzB,WAAGD,EAAC,EAAGC,EAAC,IAAI,GAAGD,KAAI,CAAC,EAAGC,KAAI,CAAC,IAAK;AAAA,MACnC,OAAO;AACL,WAAGD,EAAC,EAAGC,EAAC,IAAI,KAAK,IAAI,GAAGD,KAAI,CAAC,EAAGC,EAAC,GAAI,GAAGD,EAAC,EAAGC,KAAI,CAAC,CAAE;AAAA,MACrD;AAAA,IACF;AAAA,EACF;AAGA,QAAM,MAAgB,CAAA;AACtB,MAAI,IAAI;AACR,MAAI,IAAI;AAER,SAAO,IAAI,KAAK,IAAI,GAAG;AACrB,QAAI,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,GAAG;AACzB,UAAI,QAAQ,EAAE,IAAI,CAAC,CAAE;AACrB;AACA;AAAA,IACF,WAAW,GAAG,IAAI,CAAC,EAAG,CAAC,IAAK,GAAG,CAAC,EAAG,IAAI,CAAC,GAAI;AAC1C;AAAA,IACF,OAAO;AACL;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AACT;AAKA,SAAS,oBAAoB,GAAa,GAAuB;AAG/D,QAAM,iBAA2B,CAAA;AACjC,QAAM,OAAO,IAAI,IAAI,CAAC;AAEtB,aAAW,QAAQ,GAAG;AACpB,QAAI,KAAK,IAAI,IAAI,GAAG;AAClB,qBAAe,KAAK,IAAI;AAAA,IAC1B;AAAA,EACF;AAEA,SAAO;AACT;AAKA,SAAS,gBAAgB,YAA8C;AACrE,MAAI,WAAW,WAAW,EAAG,QAAO,CAAA;AAEpC,QAAM,SAA0B,CAAA;AAChC,MAAI,UAAU,WAAW,CAAC;AAE1B,WAAS,IAAI,GAAG,IAAI,WAAW,QAAQ,KAAK;AAC1C,UAAM,KAAK,WAAW,CAAC;AACvB,QAAI,GAAG,SAAS,QAAQ,MAAM;AAC5B,gBAAU,EAAE,MAAM,QAAQ,MAAM,MAAM,QAAQ,OAAO,GAAG,KAAA;AAAA,IAC1D,OAAO;AACL,aAAO,KAAK,OAAO;AACnB,gBAAU;AAAA,IACZ;AAAA,EACF;AAEA,SAAO,KAAK,OAAO;AACnB,SAAO;AACT;AAcA,SAAS,aAAa,KAAe,SAAyC;AAC5E,QAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,MAAI,CAAC,MAAO,QAAO;AAGnB,MAAI;AACJ,MAAI,QAAQ;AAEZ,aAAW,CAAC,IAAI,CAAC,KAAK,IAAI,QAAQ;AAChC,UAAM,aAAa,EAAE,SAAS,QAAQ,OAAO;AAC7C,QAAI,eAAe,IAAI;AACrB,iBAAW;AACX,cAAQ;AACR;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AAAA,IACL,IAAI;AAAA,IACJ;AAAA,IACA;AAAA,IACA,SAAS,MAAM;AAAA,IACf,MAAM,MAAM;AAAA,EAAA;AAEhB;AAKA,SAAS,yBACP,QACA,QACA,gBACoB;AACpB,QAAM,UAA8B,CAAA;AAGpC,aAAW,WAAW,gBAAgB;AACpC,UAAM,UAAU,aAAa,QAAQ,OAAO;AAC5C,UAAM,UAAU,aAAa,QAAQ,OAAO;AAE5C,QAAI,CAAC,WAAW,CAAC,QAAS;AAE1B,QAAI,QAAQ,aAAa,QAAQ,UAAU;AACzC,cAAQ,KAAK;AAAA,QACX,MAAM;AAAA,QACN;AAAA,QACA,aAAa,QAAQ;AAAA,QACrB,aAAa,QAAQ;AAAA,QACrB,UAAU,QAAQ;AAAA,QAClB,UAAU,QAAQ;AAAA,MAAA,CACnB;AAAA,IACH,WAAW,QAAQ,UAAU,QAAQ,OAAO;AAC1C,cAAQ,KAAK;AAAA,QACX,MAAM;AAAA,QACN;AAAA,QACA,aAAa,QAAQ;AAAA,QACrB,aAAa,QAAQ;AAAA,QACrB,UAAU,QAAQ;AAAA,QAClB,UAAU,QAAQ;AAAA,MAAA,CACnB;AAAA,IACH;AAAA,EACF;AAGA,aAAW,WAAW,OAAO,OAAO,KAAA,GAAQ;AAC1C,QAAI,CAAC,OAAO,OAAO,IAAI,OAAO,GAAG;AAC/B,YAAM,OAAO,aAAa,QAAQ,OAAO;AACzC,UAAI,MAAM;AACR,gBAAQ,KAAK;AAAA,UACX,MAAM;AAAA,UACN;AAAA,UACA,aAAa,KAAK;AAAA,UAClB,UAAU,KAAK;AAAA,QAAA,CAChB;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAGA,aAAW,WAAW,OAAO,OAAO,KAAA,GAAQ;AAC1C,QAAI,CAAC,OAAO,OAAO,IAAI,OAAO,GAAG;AAC/B,YAAM,OAAO,aAAa,QAAQ,OAAO;AACzC,UAAI,MAAM;AACR,gBAAQ,KAAK;AAAA,UACX,MAAM;AAAA,UACN;AAAA,UACA,aAAa,KAAK;AAAA,UAClB,UAAU,KAAK;AAAA,QAAA,CAChB;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AACT;AAMA,SAAS,uBAAuB,UAAiB,UAAmC;AAClF,QAAM,UAA4B,CAAA;AAGlC,MAAI,SAAS,SAAS,SAAS,MAAM;AACnC,YAAQ,KAAK,EAAE,OAAO,QAAQ,UAAU,SAAS,MAAM,UAAU,SAAS,KAAA,CAAM;AAAA,EAClF;AAGA,MAAI,SAAS,SAAS,SAAS,MAAM;AACnC,YAAQ,KAAK,EAAE,OAAO,QAAQ,UAAU,SAAS,MAAM,UAAU,SAAS,KAAA,CAAM;AAAA,EAClF;AAGA,MAAI,SAAS,UAAU,SAAS,OAAO;AACrC,YAAQ,KAAK,EAAE,OAAO,SAAS,UAAU,SAAS,OAAO,UAAU,SAAS,MAAA,CAAO;AAAA,EACrF;AAGA,QAAM,UAAU,IAAI,IAAI,SAAS,IAAI;AACrC,QAAM,UAAU,IAAI,IAAI,SAAS,IAAI;AACrC,QAAM,YAAY,CAAC,GAAG,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,QAAQ,IAAI,CAAC,CAAC;AAC5D,QAAM,cAAc,CAAC,GAAG,OAAO,EAAE,OAAO,CAAC,MAAM,CAAC,QAAQ,IAAI,CAAC,CAAC;AAE9D,MAAI,UAAU,SAAS,KAAK,YAAY,SAAS,GAAG;AAClD,YAAQ,KAAK;AAAA,MACX,OAAO;AAAA,MACP,UAAU,CAAC,GAAG,OAAO;AAAA,MACrB,UAAU,CAAC,GAAG,OAAO;AAAA,IAAA,CACtB;AAAA,EACH;AAGA,MAAI,SAAS,MAAM,WAAW,SAAS,MAAM,QAAQ;AACnD,YAAQ,KAAK;AAAA,MACX,OAAO;AAAA,MACP,UAAU,SAAS,MAAM;AAAA,MACzB,UAAU,SAAS,MAAM;AAAA,IAAA,CAC1B;AAAA,EACH;AAEA,SAAO;AACT;AAMA,SAAS,iBAAiB,UAA6B,UAAwC;AAE7F,MAAI,CAAC,YAAY,UAAU;AACzB,WAAO;AAAA,MACL,SAAS,SAAS;AAAA,MAClB,YAAY;AAAA,MACZ;AAAA,IAAA;AAAA,EAEJ;AAGA,MAAI,YAAY,CAAC,UAAU;AACzB,WAAO;AAAA,MACL,SAAS,SAAS;AAAA,MAClB,YAAY;AAAA,MACZ;AAAA,IAAA;AAAA,EAEJ;AAGA,MAAI,YAAY,UAAU;AACxB,UAAM,iBAAiB,SAAS,YAAY,SAAS;AACrD,UAAM,kBAAkB,uBAAuB,UAAU,QAAQ;AAEjE,QAAI,CAAC,kBAAkB,gBAAgB,WAAW,GAAG;AACnD,aAAO;AAAA,QACL,SAAS,SAAS;AAAA,QAClB,YAAY;AAAA,QACZ;AAAA,QACA;AAAA,MAAA;AAAA,IAEJ;AAEA,WAAO;AAAA,MACL,SAAS,SAAS;AAAA,MAClB,YAAY;AAAA,MACZ;AAAA,MACA;AAAA,MACA,aAAa,iBAAiB,gBAAgB,SAAS,SAAS,SAAS,OAAO,IAAI;AAAA,MACpF,iBAAiB,gBAAgB,SAAS,IAAI,kBAAkB;AAAA,IAAA;AAAA,EAEpE;AAGA,QAAM,IAAI,MAAM,0BAA0B;AAC5C;AAoBO,SAAS,oBACd,QACA,QACA,gBACA,cACc;AACd,SAAO,MAAM,2BAA2B;AAAA,IACtC,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,eAAe,OAAO,OAAO;AAAA,IAC7B,eAAe,OAAO,OAAO;AAAA,EAAA,CAC9B;AAED,QAAM,iCAAiB,IAAA;AACvB,QAAM,cAAc,oBAAI,IAAI,CAAC,GAAG,OAAO,OAAO,KAAA,GAAQ,GAAG,OAAO,OAAO,KAAA,CAAM,CAAC;AAC9E,QAAM,qCAAqB,IAAA;AAE3B,QAAM,UAAU;AAAA,IACd,OAAO;AAAA,IACP,SAAS;AAAA,IACT,UAAU;AAAA,IACV,OAAO;AAAA,IACP,WAAW;AAAA,EAAA;AAIb,aAAW,WAAW,aAAa;AACjC,UAAM,WAAW,OAAO,OAAO,IAAI,OAAO;AAC1C,UAAM,WAAW,OAAO,OAAO,IAAI,OAAO;AAE1C,QAAI,YAAY,UAAU;AACxB,qBAAe,IAAI,OAAO;AAAA,IAC5B;AAEA,UAAM,OAAO,iBAAiB,UAAU,QAAQ;AAChD,eAAW,IAAI,SAAS,IAAI;AAE5B,YAAQ,KAAK,YAAA;AAAA,MACX,KAAK;AACH,gBAAQ;AACR;AAAA,MACF,KAAK;AACH,gBAAQ;AACR;AAAA,MACF,KAAK;AACH,gBAAQ;AACR;AAAA,MACF,KAAK;AACH,gBAAQ;AACR;AAAA,IAAA;AAAA,EAEN;AAGA,QAAM,oBAAoB,yBAAyB,QAAQ,QAAQ,cAAc;AACjF,UAAQ,QAAQ,kBAAkB,OAAO,CAAC,MAAM,EAAE,SAAS,OAAO,EAAE;AAEpE,SAAO,MAAM,iBAAiB,OAAO;AAErC,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ;AASO,SAAS,iBAAiB,MAAiC;AAChE,SAAO,MAAM,KAAK,KAAK,WAAW,OAAA,CAAQ,EAAE,OAAO,CAAC,MAAM,EAAE,eAAe,WAAW;AACxF;AAKO,SAAS,sBAAsB,MAAoB,YAAyC;AACjG,SAAO,MAAM,KAAK,KAAK,WAAW,OAAA,CAAQ,EAAE,OAAO,CAAC,MAAM,EAAE,eAAe,UAAU;AACvF;AAKO,SAAS,gBAAgB,MAAoB,SAA2B;AAC7E,QAAM,YAAY,KAAK,WAAW,IAAI,OAAO;AAC7C,SAAO,cAAc,UAAa,UAAU,eAAe;AAC7D;AAKO,SAAS,iBAAiB,MAAoB,SAAwC;AAC3F,QAAM,YAAY,KAAK,WAAW,IAAI,OAAO;AAC7C,SAAO,uCAAW;AACpB;AAKO,SAAS,eAAe,UAA4B;AACzD,SAAO,SAAS,WACb,IAAI,CAAC,OAAO;AACX,YAAQ,GAAG,MAAA;AAAA,MACT,KAAK;AACH,eAAO,GAAG;AAAA,MACZ,KAAK;AACH,eAAO,KAAK,GAAG,IAAI;AAAA,MACrB,KAAK;AACH,eAAO,KAAK,GAAG,IAAI;AAAA,IAAA;AAAA,EAEzB,CAAC,EACA,KAAK,EAAE;AACZ;AAKO,SAAS,eAAe,MAA6B;AAC1D,SAAO,KAAK,QAAQ,QAAQ,KAAK,KAAK,QAAQ,UAAU,KAAK,KAAK,QAAQ,WAAW,KAAK,KAAK,QAAQ,QAAQ;AACjH;AC9gBO,SAAS,eAAe,QAAqD;AAClF,QAAM,WAAW,OAAmC,IAAI;AAExD,MAAI,SAAS,YAAY,MAAM;AAC7B,aAAS,UAAU,kBAAkB,MAAM;AAAA,EAC7C;AAEA,SAAO,SAAS;AAClB;AAmBO,SAAS,eACd,OACA,UACG;AACH,QAAM,YAAY;AAAA,IAChB,CAAC,aAAyB,MAAM,UAAU,QAAQ;AAAA,IAClD,CAAC,KAAK;AAAA,EAAA;AAGR,QAAM,cAAc,YAAY,MAAM,SAAS,MAAM,SAAA,CAAU,GAAG,CAAC,OAAO,QAAQ,CAAC;AAEnF,SAAO,qBAAqB,WAAW,aAAa,WAAW;AACjE;AASO,SAAS,YAAY,OAA6C;AACvE,SAAO,eAAe,OAAO,CAAC,UAAU,MAAM,QAAQ;AACxD;AASO,SAAS,aAAa,OAA4B;AACvD,QAAM,YAAY,eAAe,OAAO,CAAC,UAAU,MAAM,SAAS;AAClE,QAAM,iBAAiB,eAAe,OAAO,CAAC,UAAU,MAAM,cAAc;AAE5E,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA,iBAAiB,CAAC,YAAoB;;AACpC,UAAI,UAAU,SAAS,SAAS;AAC9B,iBAAO,eAAU,WAAV,mBAAkB,SAAS,SAAS,aAAY;AAAA,MACzD;AACA,UAAI,UAAU,SAAS,QAAQ;AAC7B,iBAAO,eAAU,SAAV,mBAAgB,aAAY;AAAA,MACrC;AACA,aAAO;AAAA,IACT;AAAA,IACA,gBAAgB,CAAC,YAAoB,UAAU,mBAAmB;AAAA,IAClE,gBAAgB,CAAC,YAAoB,mBAAmB;AAAA,EAAA;AAE5D;AASO,SAAS,WAAW,OAA4B;AACrD,QAAM,UAAU,eAAe,OAAO,CAAC,UAAU,MAAM,OAAO;AAE9D,SAAO;AAAA,IACL,SAAS,QAAQ;AAAA,IACjB,SAAS,QAAQ;AAAA,IACjB,SAAS,QAAQ;AAAA,IACjB,cAAc,QAAQ;AAAA,IACtB,MAAM,MAAM;AAAA,IACZ,MAAM,MAAM;AAAA,EAAA;AAEhB;AASO,SAAS,QAAQ,OAA4B;AAClD,QAAM,OAAO,eAAe,OAAO,CAAC,UAAU,MAAM,IAAI;AAExD,SAAO;AAAA,IACL,YAAY,KAAK;AAAA,IACjB,UAAU,KAAK;AAAA,IACf,UAAU,KAAK;AAAA,IACf,UAAU,KAAK;AAAA,IACf,WAAW,MAAM;AAAA,IACjB,cAAc,MAAM;AAAA,IACpB,SAAS,MAAM;AAAA,EAAA;AAEnB;AASO,SAAS,QAAQ,OAA4B;AAClD,QAAM,OAAO,eAAe,OAAO,CAAC,UAAU,MAAM,IAAI;AACxD,QAAM,OAAO,eAAe,OAAO,CAAC,UAAU,MAAM,IAAI;AAExD,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA,SAAS,MAAM;AAAA,IACf,SAAS,MAAM;AAAA,EAAA;AAEnB;AASO,SAAS,gBAAgB,OAA4B;AAC1D,SAAO;AAAA,IACL,UAAU,MAAM;AAAA,IAChB,WAAW,MAAM;AAAA,IACjB,aAAa,MAAM;AAAA,IACnB,WAAW,MAAM;AAAA,IACjB,iBAAiB,MAAM;AAAA,EAAA;AAE3B;AASO,SAAS,eAAe,OAA4B;AACzD,QAAM,iBAAiB,eAAe,OAAO,CAAC,UAAU,MAAM,cAAc;AAC5E,QAAM,iBAAiB,eAAe,OAAO,CAAC,UAAU,MAAM,cAAc;AAC5E,QAAM,YAAY,eAAe,OAAO,CAAC,UAAU,MAAM,SAAS;AAElE,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc,MAAM;AAAA,IACpB,aAAa,MAAM;AAAA,IACnB,eAAe,MAAM;AAAA,EAAA;AAEzB;AAkBO,SAAS,eACd,OACA,WACA,SACM;AACN,YAAU,MAAM;AACd,WAAO,MAAM,OAAO,GAAG,WAAW,OAAO;AAAA,EAC3C,GAAG,CAAC,OAAO,WAAW,OAAO,CAAC;AAChC;AA2BO,SAAS,qBACd,OACA,UAAU,MACJ;AACN,YAAU,MAAM;AACd,QAAI,CAAC,QAAS;AAEd,UAAM,gBAAgB,CAAC,UAAyB;;AAC9C,YAAM,QAAQ,MAAM,WAAW,MAAM;AACrC,YAAM,UAAU,MAAM;AAGtB,UAAI,SAAS,CAAC,WAAW,MAAM,QAAQ,KAAK;AAC1C,cAAM,eAAA;AACN,YAAI,MAAM,QAAQ,SAAS;AACzB,gBAAM,KAAA;AAAA,QACR;AACA;AAAA,MACF;AAGA,UAAK,SAAS,WAAW,MAAM,QAAQ,OAAS,SAAS,MAAM,QAAQ,KAAM;AAC3E,cAAM,eAAA;AACN,YAAI,MAAM,QAAQ,SAAS;AACzB,gBAAM,KAAA;AAAA,QACR;AACA;AAAA,MACF;AAGA,UAAI,SAAS,MAAM,QAAQ,KAAK;AAC9B,cAAM,eAAA;AACN,cAAM,aAAA,EAAe,MAAM,QAAQ,KAAK;AACxC;AAAA,MACF;AAGA,UAAI,SAAS,MAAM,QAAQ,KAAK;AAC9B,cAAM,eAAA;AACN,YAAI,MAAM,UAAU;AAClB,gBAAM,WAAW,MAAM,KAAK,MAAM,SAAS,OAAO,KAAA,CAAM,EAAE;AAAA,YACxD,CAAC,OAAO,OAAO,MAAM,SAAU;AAAA,UAAA;AAEjC,gBAAM,eAAe,QAAQ;AAAA,QAC/B;AACA;AAAA,MACF;AAGA,UAAI,MAAM,QAAQ,UAAU;AAC1B,YAAI,MAAM,gBAAgB;AACxB,gBAAM,YAAY,KAAK;AAAA,QACzB,WAAW,MAAM,KAAK,YAAY;AAChC,gBAAM,QAAQ,KAAK;AAAA,QACrB,OAAO;AACL,gBAAM,eAAA;AAAA,QACR;AACA;AAAA,MACF;AAGA,UAAI,MAAM,QAAQ,WAAW,CAAC,OAAO;AACnC,cAAM,YAAY,MAAM,UAAU;AAClC,YAAI,aAAa,CAAC,MAAM,gBAAgB;AACtC,gBAAM,eAAA;AACN,gBAAM,aAAa,SAAS;AAAA,QAC9B;AACA;AAAA,MACF;AAGA,WAAK,MAAM,QAAQ,YAAY,MAAM,QAAQ,gBAAgB,CAAC,MAAM,gBAAgB;AAClF,cAAM,cACJ,MAAM,UAAU,SAAS,WAAU,WAAM,UAAU,WAAhB,mBAAwB,WAAW;AACxE,YAAI,eAAe,YAAY,SAAS,GAAG;AACzC,gBAAM,eAAA;AACN,sBAAY,QAAQ,CAAC,OAAO;AAC1B,gBAAI;AACF,oBAAM,YAAY,EAAE;AAAA,YACtB,QAAQ;AAAA,YAER;AAAA,UACF,CAAC;AAAA,QACH;AACA;AAAA,MACF;AAGA,UAAI,CAAC,MAAM,gBAAgB;AACzB,YAAI,MAAM,QAAQ,WAAW;AAC3B,gBAAM,eAAA;AACN,qBAAW,OAAO,OAAO;AACzB;AAAA,QACF;AACA,YAAI,MAAM,QAAQ,aAAa;AAC7B,gBAAM,eAAA;AACN,uBAAa,OAAO,OAAO;AAC3B;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,aAAS,iBAAiB,WAAW,aAAa;AAClD,WAAO,MAAM,SAAS,oBAAoB,WAAW,aAAa;AAAA,EACpE,GAAG,CAAC,OAAO,OAAO,CAAC;AACrB;AAEA,SAAS,WAAW,OAA4B,QAAuB;;AACrE,MAAI,CAAC,MAAM,SAAU;AAErB,QAAM,YAAY,MAAM,UAAU;AAClC,MAAI,CAAC,WAAW;AAEd,UAAM,cAAa,WAAM,SAAS,OAAO,IAAI,MAAM,SAAS,IAAI,MAA7C,mBAAgD,SAAS;AAC5E,QAAI,YAAY;AACd,YAAM,OAAO,UAAU;AAAA,IACzB;AACA;AAAA,EACF;AAGA,QAAM,QAAQ,cAAc,MAAM,QAAQ;AAC1C,QAAM,eAAe,MAAM,QAAQ,SAAS;AAC5C,MAAI,eAAe,GAAG;AAEpB,UAAM,SAAS,MAAM,eAAe,CAAC;AACrC,QAAI,QAAQ;AACV,YAAM,gBAAc,WAAM,UAAU,WAAhB,mBAAwB,aAAY,CAAC,SAAS;AAClE,UAAI,CAAC,YAAY,SAAS,MAAM,GAAG;AACjC,cAAM,eAAe,CAAC,GAAG,aAAa,MAAM,CAAC;AAAA,MAC/C;AAAA,IACF,OAAO;AACL,YAAM,OAAO,MAAM;AAAA,IACrB;AAAA,EACF;AACF;AAEA,SAAS,aAAa,OAA4B,QAAuB;;AACvE,MAAI,CAAC,MAAM,SAAU;AAErB,QAAM,YAAY,MAAM,UAAU;AAClC,MAAI,CAAC,WAAW;AACd,UAAM,cAAa,WAAM,SAAS,OAAO,IAAI,MAAM,SAAS,IAAI,MAA7C,mBAAgD,SAAS;AAC5E,QAAI,YAAY;AACd,YAAM,OAAO,UAAU;AAAA,IACzB;AACA;AAAA,EACF;AAEA,QAAM,QAAQ,cAAc,MAAM,QAAQ;AAC1C,QAAM,eAAe,MAAM,QAAQ,SAAS;AAC5C,MAAI,eAAe,MAAM,SAAS,GAAG;AACnC,UAAM,SAAS,MAAM,eAAe,CAAC;AACrC,QAAI,QAAQ;AACV,YAAM,gBAAc,WAAM,UAAU,WAAhB,mBAAwB,aAAY,CAAC,SAAS;AAClE,UAAI,CAAC,YAAY,SAAS,MAAM,GAAG;AACjC,cAAM,eAAe,CAAC,GAAG,aAAa,MAAM,CAAC;AAAA,MAC/C;AAAA,IACF,OAAO;AACL,YAAM,OAAO,MAAM;AAAA,IACrB;AAAA,EACF;AACF;AAEA,SAAS,cAAc,KAAyB;AAC9C,QAAM,QAAkB,CAAA;AAExB,WAAS,SAAS,SAAuB;AACvC,UAAM,KAAK,OAAO;AAClB,UAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,QAAI,OAAO;AACT,iBAAW,WAAW,MAAM,UAAU;AACpC,iBAAS,OAAO;AAAA,MAClB;AAAA,IACF;AAAA,EACF;AAEA,WAAS,IAAI,IAAI;AACjB,SAAO;AACT;AC9aA,MAAMC,WAAS;AAAA,EACb,SAAS;AAAA,IACP,UAAU;AAAA,IACV,KAAK;AAAA,IACL,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,UAAU;AAAA,IACV,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,QAAQ;AAAA,IACN,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,SAAS;AAAA,IACT,iBAAiB;AAAA,IACjB,cAAc;AAAA,EAAA;AAAA,EAEhB,aAAa;AAAA,IACX,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,OAAO;AAAA,EAAA;AAAA,EAET,aAAa;AAAA,IACX,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,OAAO;AAAA,IACP,YAAY;AAAA,EAAA;AAAA,EAEd,SAAS;AAAA,IACP,SAAS;AAAA,IACT,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,SAAS;AAAA,IACP,cAAc;AAAA,EAAA;AAAA,EAEhB,aAAa;AAAA,IACX,cAAc;AAAA,EAAA;AAAA,EAEhB,cAAc;AAAA,IACZ,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,eAAe;AAAA,IACf,eAAe;AAAA,IACf,cAAc;AAAA,EAAA;AAAA,EAEhB,KAAK;AAAA,IACH,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,cAAc;AAAA,EAAA;AAAA,EAEhB,OAAO;AAAA,IACL,MAAM;AAAA,IACN,UAAU;AAAA,IACV,OAAO;AAAA,EAAA;AAAA,EAET,OAAO;AAAA,IACL,MAAM;AAAA,IACN,UAAU;AAAA,IACV,OAAO;AAAA,IACP,WAAW;AAAA,EAAA;AAAA,EAEb,WAAW;AAAA,IACT,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,SAAS;AAAA,IACT,cAAc;AAAA,EAAA;AAAA,EAEhB,MAAM;AAAA,IACJ,SAAS;AAAA,IACT,UAAU;AAAA,IACV,KAAK;AAAA,EAAA;AAAA,EAEP,KAAK;AAAA,IACH,SAAS;AAAA,IACT,SAAS;AAAA,IACT,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,cAAc;AAAA,EAAA;AAAA,EAEhB,MAAM;AAAA,IACJ,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,cAAc;AAAA,IACd,UAAU;AAAA,EAAA;AAAA,EAEZ,UAAU;AAAA,IACR,SAAS;AAAA,IACT,iBAAiB;AAAA,IACjB,cAAc;AAAA,IACd,OAAO;AAAA,EAAA;AAAA,EAET,YAAY;AAAA,IACV,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,OAAO;AAAA,EAAA;AAAA,EAET,QAAQ;AAAA,IACN,UAAU;AAAA,IACV,OAAO;AAAA,IACP,WAAW;AAAA,EAAA;AAAA,EAEb,aAAa;AAAA,IACX,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,iBAAiB;AAAA,IACjB,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,WAAW;AAAA,EAAA;AAEf;AAkBO,SAAS,gBAAgB,EAAE,OAAO,WAAqD;AAC5F,QAAM,WAAW,MAAM;AAEvB,QAAM,aAAa,CAAC,SAAmC;AACrD,QAAI,CAAC,KAAM,QAAO;AAClB,QAAI,OAAO,SAAS,UAAU;AAC5B,aAAO,IAAI,KAAK,IAAI,EAAE,eAAA;AAAA,IACxB;AACA,WAAO,KAAK,eAAA;AAAA,EACd;AAEA,QAAMC,cAAa,CAAC,OAAuB;AACzC,QAAI,GAAG,UAAU,GAAI,QAAO;AAC5B,WAAO,GAAG,GAAG,MAAM,GAAG,EAAE,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC;AAAA,EAC7C;AAEA,SACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAOD,SAAO;AAAA,MACd,SAAS,CAAC,MAAM,EAAE,gBAAA;AAAA,MAClB,eAAY;AAAA,MAGZ,UAAA;AAAA,QAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,QACjB,UAAA;AAAA,UAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,aAAa,UAAA,kBAAc;AAAA,UAC/C,oBAAC,YAAO,OAAOA,SAAO,aAAa,SAAS,SAAS,OAAM,SAAQ,UAAA,IAAA,CAEnE;AAAA,QAAA,GACF;AAAA,QAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,SAEjB,UAAA;AAAA,UAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,SACjB,UAAA;AAAA,YAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,cAAc,UAAA,YAAQ;AAAA,YAEzC,qBAAC,OAAA,EAAI,OAAOA,SAAO,KACjB,UAAA;AAAA,cAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,OAAO,UAAA,MAAE;AAAA,kCAC5B,QAAA,EAAK,OAAOA,SAAO,OAClB,8BAAC,QAAA,EAAK,OAAOA,SAAO,WAAW,OAAO,MAAM,IACzC,sBAAW,MAAM,EAAE,GACtB,EAAA,CACF;AAAA,YAAA,GACF;AAAA,YAEA,qBAAC,OAAA,EAAI,OAAOA,SAAO,KACjB,UAAA;AAAA,cAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,OAAO,UAAA,QAAI;AAAA,kCAC9B,QAAA,EAAK,OAAOA,SAAO,OAAQ,gBAAM,KAAA,CAAK;AAAA,YAAA,GACzC;AAAA,aAEE,MAAM,SAAQ,qCAAU,uCACvB,OAAA,EAAI,OAAOA,SAAO,KACjB,UAAA;AAAA,cAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,OAAO,UAAA,QAAI;AAAA,cAC/B,oBAAC,UAAK,OAAOA,SAAO,OACjB,UAAA,MAAM,SAAQ,qCAAU,cAAA,CAC3B;AAAA,YAAA,GACF;AAAA,YAGD,MAAM,SACL,qBAAC,OAAA,EAAI,OAAOA,SAAO,KACjB,UAAA;AAAA,cAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,OAAO,UAAA,SAAK;AAAA,kCAC/B,QAAA,EAAK,OAAOA,SAAO,OAAQ,gBAAM,MAAA,CAAM;AAAA,YAAA,EAAA,CAC1C;AAAA,UAAA,GAEJ;AAAA,UAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,SACjB,UAAA;AAAA,YAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,cAAc,UAAA,QAAI;AAAA,YACpC,MAAM,KAAK,SAAS,IACnB,oBAAC,OAAA,EAAI,OAAOA,SAAO,MAChB,UAAA,MAAM,KAAK,IAAI,CAAC,KAAK,UACpB,oBAAC,QAAA,EAAiB,OAAOA,SAAO,KAC7B,UAAA,IAAA,GADQ,KAEX,CACD,EAAA,CACH,IAEA,oBAAC,QAAA,EAAK,OAAOA,SAAO,QAAQ,UAAA,UAAA,CAAO;AAAA,UAAA,GAEvC;AAAA,UAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,SACjB,UAAA;AAAA,YAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,cAAc,UAAA,cAAU;AAAA,YAE3C,qBAAC,OAAA,EAAI,OAAOA,SAAO,KACjB,UAAA;AAAA,cAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,OAAO,UAAA,WAAO;AAAA,cAClC,oBAAC,UAAK,OAAOA,SAAO,OAAQ,UAAA,WAAW,qCAAU,SAAS,EAAA,CAAE;AAAA,YAAA,GAC9D;AAAA,YAEA,qBAAC,OAAA,EAAI,OAAOA,SAAO,KACjB,UAAA;AAAA,cAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,OAAO,UAAA,YAAQ;AAAA,cACnC,oBAAC,UAAK,OAAOA,SAAO,OAAQ,UAAA,WAAW,qCAAU,UAAU,EAAA,CAAE;AAAA,YAAA,EAAA,CAC/D;AAAA,UAAA,GACF;AAAA,UAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,SACjB,UAAA;AAAA,YAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,cAAc,UAAA,aAAS;AAAA,YAE1C,qBAAC,OAAA,EAAI,OAAOA,SAAO,KACjB,UAAA;AAAA,cAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,OAAO,UAAA,YAAQ;AAAA,kCAClC,QAAA,EAAK,OAAOA,SAAO,OAAQ,UAAA,MAAM,SAAS,OAAA,CAAO;AAAA,YAAA,GACpD;AAAA,YAEA,qBAAC,OAAA,EAAI,OAAOA,SAAO,KACjB,UAAA;AAAA,cAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,OAAO,UAAA,WAAO;AAAA,cAClC,qBAAC,QAAA,EAAK,OAAOA,SAAO,OACjB,UAAA;AAAA,gBAAA,MAAM,QAAQ;AAAA,gBAAO;AAAA,cAAA,EAAA,CACxB;AAAA,YAAA,EAAA,CACF;AAAA,UAAA,GACF;AAAA,UAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,SACjB,UAAA;AAAA,YAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,cAAc,UAAA;AAAA,cAAA;AAAA,cAAQ,MAAM,MAAM;AAAA,cAAO;AAAA,YAAA,GAAC;AAAA,YAC5D,MAAM,MAAM,SAAS,yBACnB,OAAA,EACE,UAAA;AAAA,cAAA,MAAM,MAAM,MAAM,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,UAClC,qBAAC,OAAA,EAAgB,OAAOA,SAAO,MAC7B,UAAA;AAAA,gBAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,UAAW,eAAK,UAAS;AAAA,gBAC7C,oBAAC,UAAK,UAAA,IAAA,CAAC;AAAA,gBACP,oBAAC,QAAA,EAAK,OAAOA,SAAO,YAAY,OAAO,KAAK,QACzC,UAAAC,YAAW,KAAK,MAAM,EAAA,CACzB;AAAA,cAAA,EAAA,GALQ,KAMV,CACD;AAAA,cACA,MAAM,MAAM,SAAS,0BACnB,QAAA,EAAK,OAAOD,SAAO,QAAQ,UAAA;AAAA,gBAAA;AAAA,gBACxB,MAAM,MAAM,SAAS;AAAA,gBAAE;AAAA,cAAA,EAAA,CAC3B;AAAA,YAAA,GAEJ,IAEA,oBAAC,QAAA,EAAK,OAAOA,SAAO,QAAQ,UAAA,WAAA,CAAQ;AAAA,UAAA,GAExC;AAAA,WAGC,qCAAU,WAAU,OAAO,KAAK,SAAS,MAAM,EAAE,SAAS,0BACxD,OAAA,EAAI,OAAO,EAAE,GAAGA,SAAO,SAAS,GAAGA,SAAO,eACzC,UAAA;AAAA,YAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,cAAc,UAAA,mBAAe;AAAA,YAChD,oBAAC,OAAA,EAAI,OAAOA,SAAO,aAChB,UAAA,KAAK,UAAU,SAAS,QAAQ,MAAM,CAAC,EAAA,CAC1C;AAAA,UAAA,EAAA,CACF;AAAA,QAAA,EAAA,CAEJ;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;ACnSA,MAAMA,WAAS;AAAA,EACb,WAAW;AAAA,IACT,UAAU;AAAA,EAAA;AAAA,EAEZ,UAAU;AAAA,IACR,OAAO;AAAA,IACP,WAAW;AAAA,IACX,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,iBAAiB;AAAA,IACjB,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,UAAU;AAAA,EAAA;AAAA,EAEZ,cAAc;AAAA,IACZ,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,SAAS;AAAA,IACT,cAAc;AAAA,IACd,YAAY;AAAA,EAAA;AAAA,EAEd,SAAS;AAAA,IACP,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,cAAc;AAAA,IACd,cAAc;AAAA,EAAA;AAAA,EAEhB,eAAe;AAAA,IACb,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,OAAO;AAAA,IACP,YAAY;AAAA,EAAA;AAAA,EAKd,cAAc;AAAA,IACZ,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,iBAAiB;AAAA,IACjB,UAAU;AAAA,IACV,QAAQ;AAAA,EAAA;AAAA,EAEV,MAAM;AAAA,IACJ,UAAU;AAAA,IACV,OAAO;AAAA,IACP,WAAW;AAAA,EAAA;AAEf;AAkBO,SAAS,YAAY,EAAE,OAAO,SAA+C;AAClF,QAAM,cAAc,OAA4B,IAAI;AACpD,QAAM,CAAC,aAAa,cAAc,IAAI,SAAS,KAAK;AAEpD,QAAM,iBAAiB,eAAe,OAAO,CAAC,MAAM,EAAE,cAAc;AACpE,QAAM,UAAU,kBAAkB,MAAM;AAGxC,YAAU,MAAM;AACd,QAAI,YAAY,SAAS;AACvB,kBAAY,QAAQ,MAAA;AAEpB,kBAAY,QAAQ;AAAA,QAClB,YAAY,QAAQ,MAAM;AAAA,QAC1B,YAAY,QAAQ,MAAM;AAAA,MAAA;AAAA,IAE9B;AAAA,EACF,GAAG,CAAA,CAAE;AAGL,YAAU,MAAM;AACd,QAAI,YAAY,SAAS;AACvB,kBAAY,QAAQ,MAAM,SAAS;AACnC,kBAAY,QAAQ,MAAM,SAAS,GAAG,YAAY,QAAQ,YAAY;AAAA,IACxE;AAAA,EACF,GAAG,CAAC,OAAO,CAAC;AAGZ,QAAM,eAAe;AAAA,IACnB,CAAC,MAA8C;AAC7C,YAAM,qBAAqB,EAAE,OAAO,KAAK;AAAA,IAC3C;AAAA,IACA,CAAC,KAAK;AAAA,EAAA;AAIR,QAAM,gBAAgB;AAAA,IACpB,CAAC,MAAgD;AAE/C,WAAK,EAAE,WAAW,EAAE,YAAY,EAAE,QAAQ,SAAS;AACjD,UAAE,eAAA;AACF,cAAM,YAAY,IAAI;AACtB;AAAA,MACF;AAGA,UAAI,EAAE,QAAQ,UAAU;AACtB,UAAE,eAAA;AACF,cAAM,YAAY,KAAK;AACvB;AAAA,MACF;AAGA,UAAI,EAAE,QAAQ,WAAW,CAAC,EAAE,YAAY,CAAC,EAAE,WAAW,CAAC,EAAE,SAAS;AAChE,cAAM,WAAW,YAAY;AAC7B,YAAI,YAAY,SAAS,mBAAmB,SAAS,MAAM,QAAQ;AAEjE,YAAE,eAAA;AACF,gBAAM,YAAY,IAAI;AAGtB,gBAAM,SAAS,WAAW,OAAO,MAAM,EAAE;AACzC,cAAI,QAAQ;AACV,kBAAM,QAAQ,MAAM,SAAS,QAAQ,EAAE;AACvC,kBAAM,aAAa,KAAK;AAAA,UAC1B;AACA;AAAA,QACF;AAAA,MACF;AAGA,UAAI,EAAE,QAAQ,SAAS,MAAM,SAAS,QAAQ;AAC5C,UAAE,eAAA;AACF,cAAM,WAAW,YAAY;AAC7B,YAAI,UAAU;AACZ,gBAAM,QAAQ,SAAS;AACvB,gBAAM,MAAM,SAAS;AACrB,gBAAM,QAAQ,SAAS;AACvB,gBAAM,WAAW,MAAM,UAAU,GAAG,KAAK,IAAI,OAAO,MAAM,UAAU,GAAG;AACvE,gBAAM,qBAAqB,QAAQ;AAGnC,qBAAW,MAAM;AACf,qBAAS,iBAAiB,SAAS,eAAe,QAAQ;AAAA,UAC5D,GAAG,CAAC;AAAA,QACN;AACA;AAAA,MACF;AAGA,QAAE,gBAAA;AAAA,IACJ;AAAA,IACA,CAAC,OAAO,MAAM,IAAI,MAAM,IAAI;AAAA,EAAA;AAI9B,QAAM,aAAa,YAAY,MAAM;AAEnC,eAAW,MAAM;;AACf,WAAI,cAAS,kBAAT,mBAAwB,QAAQ,0BAA0B;AAC5D;AAAA,MACF;AACA,YAAM,YAAY,IAAI;AAAA,IACxB,GAAG,GAAG;AAAA,EACR,GAAG,CAAC,KAAK,CAAC;AAGV,QAAM,mBAAmB;AAAA,IACvB,CAAC,MAA4C;AAC3C,YAAM,gBAAgB,MAAM,IAAI,EAAE,OAAO,KAAoB;AAAA,IAC/D;AAAA,IACA,CAAC,OAAO,MAAM,EAAE;AAAA,EAAA;AAIlB,QAAM,mBAAmB,MAA2B;;AAClD,UAAM,YAAY,EAAE,GAAGA,SAAO,SAAA;AAE9B,QAAI,MAAM,SAAS,QAAQ;AACzB,aAAO,OAAO,WAAWA,SAAO,YAAY;AAAA,IAC9C;AAGA,UAAM,OAAO,MAAM,UAAQ,WAAM,aAAN,mBAAgB;AAC3C,YAAQ,MAAA;AAAA,MACN,KAAK;AACH,kBAAU,WAAW;AACrB,kBAAU,aAAa;AACvB;AAAA,MACF,KAAK;AACH,kBAAU,WAAW;AACrB,kBAAU,aAAa;AACvB;AAAA,MACF,KAAK;AACH,kBAAU,WAAW;AACrB,kBAAU,aAAa;AACvB;AAAA,MACF,KAAK;AACH,kBAAU,WAAW;AACrB,kBAAU,aAAa;AACvB;AAAA,MACF,KAAK;AACH,kBAAU,WAAW;AACrB,kBAAU,aAAa;AACvB;AAAA,MACF,KAAK;AACH,kBAAU,WAAW;AACrB,kBAAU,aAAa;AACvB;AAAA,IAAA;AAGJ,WAAO;AAAA,EACT;AAEA,SACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAOA,SAAO;AAAA,MACd,cAAc,MAAM,eAAe,IAAI;AAAA,MACvC,cAAc,MAAM,eAAe,KAAK;AAAA,MAGvC,UAAA;AAAA,QAAA,oCACE,OAAA,EAAI,OAAOA,SAAO,SAAS,uBAAmB,MAC7C,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAO,MAAM;AAAA,cACb,UAAU;AAAA,cACV,OAAOA,SAAO;AAAA,cACd,SAAS,CAAC,MAAM,EAAE,gBAAA;AAAA,cAElB,UAAA;AAAA,gBAAA,oBAAC,UAAA,EAAO,OAAM,QAAO,UAAA,QAAI;AAAA,gBACzB,oBAAC,UAAA,EAAO,OAAM,QAAO,UAAA,QAAI;AAAA,gBACzB,oBAAC,UAAA,EAAO,OAAM,SAAQ,UAAA,SAAK;AAAA,gBAC3B,oBAAC,UAAA,EAAO,OAAM,QAAO,UAAA,QAAI;AAAA,gBACzB,oBAAC,UAAA,EAAO,OAAM,QAAO,UAAA,QAAI;AAAA,gBACzB,oBAAC,UAAA,EAAO,OAAM,SAAQ,UAAA,QAAA,CAAK;AAAA,cAAA;AAAA,YAAA;AAAA,UAAA;AAAA,UAG7B;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAOA,SAAO;AAAA,cACd,SAAS,CAAC,MAAM;AACd,kBAAE,gBAAA;AACF,sBAAM,YAAY,MAAM,EAAE;AAAA,cAC5B;AAAA,cACA,OAAM;AAAA,cACP,UAAA;AAAA,YAAA;AAAA,UAAA;AAAA,QAED,GACF;AAAA,QAIF;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,KAAK;AAAA,YACL,OAAO;AAAA,YACP,UAAU;AAAA,YACV,WAAW;AAAA,YACX,QAAQ;AAAA,YACR,OAAO,iBAAA;AAAA,YACP,aAAY;AAAA,YACZ,MAAM;AAAA,YACN,YAAY,MAAM,SAAS;AAAA,YAC3B,eAAa,gBAAgB,MAAM,EAAE;AAAA,UAAA;AAAA,QAAA;AAAA,QAIvC,qBAAC,OAAA,EAAI,OAAOA,SAAO,MAAM,UAAA;AAAA,UAAA;AAAA,UACjB,oBAAC,SAAI,UAAA,MAAA,CAAG;AAAA,UAAM;AAAA,UAAY,oBAAC,SAAI,UAAA,YAAA,CAAS;AAAA,UAAM;AAAA,QAAA,EAAA,CACtD;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AAMA,SAAS,WAAW,OAA4B,SAAqC;AACnF,QAAME,YAAW,MAAM;AACvB,MAAI,CAACA,UAAU,QAAO;AAEtB,aAAW,CAAC,IAAI,KAAK,KAAKA,UAAS,QAAQ;AACzC,QAAI,MAAM,SAAS,SAAS,OAAO,GAAG;AACpC,aAAO;AAAA,IACT;AAAA,EACF;AACA,SAAO;AACT;ACjTA,MAAMF,WAAS;AAAA,EACb,cAAc;AAAA,IACZ,UAAU;AAAA,IACV,cAAc;AAAA,EAAA;AAAA,EAEhB,OAAO;AAAA,IACL,UAAU;AAAA,IACV,SAAS;AAAA,IACT,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,WAAW;AAAA,EAAA;AAAA,EAEb,YAAY;AAAA,IACV,iBAAiB;AAAA,EAAA;AAAA,EAEnB,eAAe;AAAA,IACb,iBAAiB;AAAA,IACjB,WAAW;AAAA,EAAA;AAAA,EAEb,cAAc;AAAA,IACZ,iBAAiB;AAAA,IACjB,WAAW;AAAA,EAAA;AAAA,EAEb,iBAAiB;AAAA,IACf,iBAAiB;AAAA,EAAA;AAAA,EAEnB,YAAY;AAAA,IACV,UAAU;AAAA,IACV,MAAM;AAAA,IACN,KAAK;AAAA,IACL,WAAW;AAAA,IACX,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,OAAO;AAAA,IACP,UAAU;AAAA,EAAA;AAAA,EAEZ,mBAAmB;AAAA,IACjB,SAAS;AAAA,EAAA;AAAA,EAEX,eAAe;AAAA,IACb,UAAU;AAAA,IACV,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,iBAAiB;AAAA,IACjB,eAAe;AAAA,EAAA;AAAA,EAEjB,qBAAqB;AAAA,IACnB,KAAK;AAAA,EAAA;AAAA,EAEP,oBAAoB;AAAA,IAClB,QAAQ;AAAA,EAAA;AAAA,EAEV,qBAAqB;AAAA,IACnB,KAAK;AAAA,IACL,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,iBAAiB;AAAA,EAAA;AAAA,EAEnB,UAAU;AAAA,IACR,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,YAAY;AAAA,EAAA;AAAA,EAEd,WAAW;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,SAAS;AAAA,IACT,YAAY;AAAA,EAAA;AAAA,EAEd,kBAAkB;AAAA,IAChB,SAAS;AAAA,EAAA;AAAA;AAAA,EAGX,UAAU;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,cAAc;AAAA,EAAA;AAAA,EAEhB,UAAU;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,cAAc;AAAA,EAAA;AAAA,EAEhB,UAAU;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,cAAc;AAAA,EAAA;AAAA,EAEhB,UAAU;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,cAAc;AAAA,EAAA;AAAA,EAEhB,UAAU;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,cAAc;AAAA,EAAA;AAAA,EAEhB,UAAU;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,cAAc;AAAA,EAAA;AAAA,EAEhB,WAAW;AAAA,IACT,UAAU;AAAA,IACV,YAAY;AAAA,EAAA;AAAA,EAEd,MAAM;AAAA,IACJ,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,YAAY;AAAA,EAAA;AAAA,EAEd,OAAO;AAAA,IACL,YAAY;AAAA,IACZ,aAAa;AAAA,IACb,OAAO;AAAA,IACP,WAAW;AAAA,EAAA;AAOf;AAqBO,SAAS,cAAc;AAAA,EAC5B;AAAA,EACA,UAAAE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAA2C;;AACzC,QAAM,CAAC,WAAW,YAAY,IAAI,SAAS,KAAK;AAChD,QAAM,CAAC,aAAa,cAAc,IAAI,SAAS,KAAK;AACpD,QAAM,WAAW,OAAuB,IAAI;AAG5C,QAAM,YAAY,eAAe,OAAO,CAAC,MAAM,EAAE,SAAS;AAC1D,QAAM,iBAAiB,eAAe,OAAO,CAAC,MAAM,EAAE,cAAc;AACpE,QAAM,OAAO,eAAe,OAAO,CAAC,MAAM,EAAE,IAAI;AAEhD,QAAM,aACJ,UAAU,SAAS,YACf,eAAU,WAAV,mBAAkB,SAAS,SAAS,MAAM,QAAO,QACjD,UAAU,mBAAmB,MAAM;AAEzC,QAAM,YAAY,mBAAmB,MAAM;AAC3C,QAAM,eAAe,KAAK,aAAa,MAAM;AAC7C,QAAM,eAAe,KAAK,aAAa,MAAM;AAG7C,QAAM,cAAc;AAAA,IAClB,CAAC,MAAwB;;AACvB,QAAE,gBAAA;AACF,UAAI,CAAC,WAAW;AACd,YAAI,EAAE,YAAY,UAAU,gBAAgB;AAE1C,gBAAM,eAAaC,MAAA,UAAU,WAAV,gBAAAA,IAAkB,aAAY,CAAA;AACjD,cAAI,CAAC,WAAW,SAAS,MAAM,EAAE,GAAG;AAClC,kBAAM,eAAe,CAAC,GAAG,YAAY,MAAM,EAAE,CAAC;AAAA,UAChD;AAAA,QACF,OAAO;AACL,gBAAM,OAAO,MAAM,EAAE;AAAA,QACvB;AAAA,MACF;AAAA,IACF;AAAA,IACA,CAAC,OAAO,MAAM,IAAI,WAAW,SAAS;AAAA,EAAA;AAGxC,QAAM,oBAAoB;AAAA,IACxB,CAAC,MAAwB;AACvB,QAAE,gBAAA;AACF,UAAI,CAAC,WAAW;AACd,cAAM,aAAa,MAAM,EAAE;AAAA,MAC7B;AAAA,IACF;AAAA,IACA,CAAC,OAAO,MAAM,IAAI,SAAS;AAAA,EAAA;AAG7B,QAAM,mBAAmB,YAAY,MAAM;AACzC,iBAAa,IAAI;AAAA,EACnB,GAAG,CAAA,CAAE;AAEL,QAAM,mBAAmB,YAAY,MAAM;AACzC,iBAAa,KAAK;AAClB,mBAAe,KAAK;AAAA,EACtB,GAAG,CAAA,CAAE;AAGL,QAAM,kBAAkB;AAAA,IACtB,CAAC,MAAuB;AACtB,QAAE,aAAa,gBAAgB;AAC/B,QAAE,aAAa,QAAQ,cAAc,MAAM,EAAE;AAC7C,YAAM,UAAU,MAAM,EAAE;AAAA,IAC1B;AAAA,IACA,CAAC,OAAO,MAAM,EAAE;AAAA,EAAA;AAGlB,QAAM,iBAAiB;AAAA,IACrB,CAAC,MAAuB;;AACtB,UAAI,CAAC,KAAK,cAAc,KAAK,aAAa,MAAM,GAAI;AAEpD,QAAE,eAAA;AACF,QAAE,aAAa,aAAa;AAG5B,YAAM,QAAOA,MAAA,SAAS,YAAT,gBAAAA,IAAkB;AAC/B,UAAI,CAAC,KAAM;AAEX,YAAM,YAAY,EAAE,UAAU,KAAK;AACnC,YAAM,SAAS,KAAK;AAEpB,UAAI;AACJ,UAAI,YAAY,SAAS,MAAM;AAC7B,mBAAW;AAAA,MACb,WAAW,YAAY,SAAS,MAAM;AACpC,mBAAW;AAAA,MACb,OAAO;AACL,mBAAW;AAAA,MACb;AAEA,YAAM,iBAAiB,MAAM,IAAI,QAAQ;AAAA,IAC3C;AAAA,IACA,CAAC,OAAO,MAAM,IAAI,KAAK,YAAY,KAAK,QAAQ;AAAA,EAAA;AAGlD,QAAM,kBAAkB,YAAY,MAAM;AAAA,EAE1C,GAAG,CAAA,CAAE;AAEL,QAAM,aAAa;AAAA,IACjB,CAAC,MAAuB;AACtB,QAAE,eAAA;AACF,UAAI,KAAK,YAAY;AACnB,cAAM,QAAQ,IAAI;AAAA,MACpB;AAAA,IACF;AAAA,IACA,CAAC,OAAO,KAAK,UAAU;AAAA,EAAA;AAGzB,QAAM,gBAAgB,YAAY,MAAM;AACtC,UAAM,QAAQ,KAAK;AAAA,EACrB,GAAG,CAAC,KAAK,CAAC;AAGV,QAAM,iBAAiB,YAAY,MAAM;AACvC,UAAM,QAAQ,MAAM,SAAS,MAAM,IAAI,EAAE;AACzC,UAAM,aAAa,KAAK;AAAA,EAC1B,GAAG,CAAC,OAAO,MAAM,EAAE,CAAC;AAGpB,QAAM,sBAAsB,YAAY,MAAM;AAC5C,mBAAe,CAAC,SAAS,CAAC,IAAI;AAAA,EAChC,GAAG,CAAA,CAAE;AAGL,QAAM,gBAAgB,MAAM;AAC1B,UAAM,YAAY,EAAE,GAAGH,SAAO,MAAA;AAE9B,QAAI,aAAa,CAAC,WAAW;AAC3B,aAAO,OAAO,WAAWA,SAAO,UAAU;AAAA,IAC5C;AACA,QAAI,cAAc,CAAC,WAAW;AAC5B,aAAO,OAAO,WAAWA,SAAO,aAAa;AAAA,IAC/C;AACA,QAAI,WAAW;AACb,aAAO,OAAO,WAAWA,SAAO,YAAY;AAAA,IAC9C;AACA,QAAI,gBAAgB,CAAC,cAAc;AACjC,aAAO,OAAO,WAAWA,SAAO,eAAe;AAAA,IACjD;AAEA,WAAO;AAAA,EACT;AAGA,QAAM,gBAAgB,MAAM;AAC1B,QAAI,WAAW;AACb,aAAO,oBAAC,aAAA,EAAY,OAAc,MAAA,CAAc;AAAA,IAClD;AAEA,WAAO,oBAAC,gBAAa,OAAc;AAAA,EACrC;AAGA,QAAM,sBAAsB,MAAM;AAChC,QAAI,CAAC,gBAAgB,aAAc,QAAO;AAE1C,YAAQ,KAAK,UAAA;AAAA,MACX,KAAK;AACH,eACE;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,OAAO,EAAE,GAAGA,SAAO,eAAe,GAAGA,SAAO,oBAAA;AAAA,UAAoB;AAAA,QAAA;AAAA,MAGtE,KAAK;AACH,eACE;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,OAAO,EAAE,GAAGA,SAAO,eAAe,GAAGA,SAAO,mBAAA;AAAA,UAAmB;AAAA,QAAA;AAAA,MAGrE,KAAK;AACH,eAAO,oBAAC,OAAA,EAAI,OAAO,EAAE,GAAGA,SAAO,eAAe,GAAGA,SAAO,oBAAA,GAAuB;AAAA,MACjF;AACE,eAAO;AAAA,IAAA;AAAA,EAEb;AAEA,SACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,OAAOA,SAAO;AAAA,MACd,iBAAe,MAAM;AAAA,MACrB,eAAa,SAAS,MAAM,EAAE;AAAA,MAE9B,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,KAAK;AAAA,YACL,OAAO,cAAA;AAAA,YACP,SAAS;AAAA,YACT,eAAe;AAAA,YACf,cAAc;AAAA,YACd,cAAc;AAAA,YACd,WAAW,CAAC,aAAa,MAAM,OAAO;AAAA,YACtC,aAAa;AAAA,YACb,YAAY;AAAA,YACZ,aAAa;AAAA,YACb,QAAQ;AAAA,YACR,WAAW;AAAA,YAGX,UAAA;AAAA,cAAA;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,OAAO;AAAA,oBACL,GAAGA,SAAO;AAAA,oBACV,GAAI,YAAYA,SAAO,oBAAoB,CAAA;AAAA,kBAAC;AAAA,kBAE9C,aAAa,CAAC,MAAM,EAAE,gBAAA;AAAA,kBACvB,UAAA;AAAA,gBAAA;AAAA,cAAA;AAAA,cAKA,cAAA;AAAA,cAGA,oBAAA;AAAA,cAGA,aAAa,CAAC,aACb;AAAA,gBAAC;AAAA,gBAAA;AAAA,kBACC,OAAO;AAAA,oBACL,UAAU;AAAA,oBACV,OAAO;AAAA,oBACP,KAAK;AAAA,oBACL,SAAS;AAAA,oBACT,UAAU;AAAA,oBACV,QAAQ;AAAA,oBACR,cAAc;AAAA,oBACd,iBAAiB;AAAA,oBACjB,QAAQ;AAAA,kBAAA;AAAA,kBAEV,SAAS,CAAC,MAAM;AACd,sBAAE,gBAAA;AACF,wCAAA;AAAA,kBACF;AAAA,kBACA,OAAM;AAAA,kBACP,UAAA;AAAA,gBAAA;AAAA,cAAA;AAAA,cAMF,mCACE,iBAAA,EAAgB,OAAc,SAAS,MAAM,eAAe,KAAK,EAAA,CAAG;AAAA,YAAA;AAAA,UAAA;AAAA,QAAA;AAAA,QAKxE,MAAM,SAAS,SAAS,KACvB,oBAAC,OAAA,EAAI,OAAOA,SAAO,UAChB,UAAA,MAAM,SAAS,IAAI,CAAC,YAAY;AAC/B,gBAAM,QAAQE,UAAS,OAAO,IAAI,OAAO;AACzC,cAAI,CAAC,MAAO,QAAO;AACnB,iBACE;AAAA,YAAC;AAAA,YAAA;AAAA,cAEC,OAAO;AAAA,cACP,UAAAA;AAAA,cACA;AAAA,cACA,OAAO,QAAQ;AAAA,cACf,MAAM,CAAC,GAAG,MAAM,MAAM,EAAE;AAAA,YAAA;AAAA,YALnB;AAAA,UAAA;AAAA,QAQX,CAAC,EAAA,CACH;AAAA,QAID,aAAa,CAAC,aACb;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,OAAO;AAAA,cACL,GAAGF,SAAO;AAAA,cACV,GAAI,YAAYA,SAAO,mBAAmB,CAAA;AAAA,YAAC;AAAA,YAE7C,SAAS,CAAC,MAAM;AACd,gBAAE,gBAAA;AACF,6BAAA;AAAA,YACF;AAAA,YACD,UAAA;AAAA,UAAA;AAAA,QAAA;AAAA,MAED;AAAA,IAAA;AAAA,EAAA;AAIR;AAUA,SAAS,aAAa,EAAE,SAAgD;;AACtE,QAAM,OAAO,MAAM,UAAQ,WAAM,aAAN,mBAAgB;AAC3C,QAAM,OAAO,MAAM;AAGnB,QAAM,kBAAkB,MAA2B;AACjD,YAAQ,MAAA;AAAA,MACN,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB;AACE,eAAOA,SAAO;AAAA,IAAA;AAAA,EAEpB;AAGA,UAAQ,MAAA;AAAA,IACN,KAAK;AACH,aACE,oBAAC,OAAA,EAAI,OAAOA,SAAO,MACjB,8BAAC,QAAA,EAAM,UAAA,MAAM,WAAW,IAAA,CAAS,GACnC;AAAA,IAGJ,KAAK;AAEH,aACE,oBAAC,SAAI,OAAO,EAAE,UAAU,OAAA,GACtB,8BAAC,OAAA,EAAI,OAAO,EAAE,GAAGA,SAAO,MAAM,YAAY,MAAA,GACvC,UAAA,MAAM,WAAW,eACpB,GACF;AAAA,IAGJ,KAAK;AACH,aACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,OAAO;AAAA,YACL,YAAY;AAAA,YACZ,WAAW;AAAA,YACX,WAAW;AAAA,YACX,SAAS;AAAA,UAAA;AAAA,UAGV,gBAAM,WAAW;AAAA,QAAA;AAAA,MAAA;AAAA,IAIxB,KAAK;AACH,aACE;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,OAAO;AAAA,YACL,SAAS;AAAA,YACT,iBAAiB;AAAA,YACjB,cAAc;AAAA,YACd,WAAW;AAAA,UAAA;AAAA,UAEd,UAAA;AAAA,YAAA;AAAA,YACU,MAAM,WAAW;AAAA,YAAY;AAAA,UAAA;AAAA,QAAA;AAAA,MAAA;AAAA,IAI5C,KAAK;AACH,aACE,oBAAC,OAAA,EAAI,OAAOA,SAAO,MACjB,UAAA,oBAAC,QAAA,EAAM,UAAA,WAAW,MAAM,OAAO,EAAA,CAAE,GACnC;AAAA,IAGJ;AACE,aACE,oBAAC,OAAA,EAAI,OAAO,gBAAA,GACT,UAAA,MAAM,WAAW,oBAAC,QAAA,EAAK,OAAO,EAAE,OAAO,OAAA,GAAU,yBAAW,GAC/D;AAAA,EAAA;AAGR;AAEA,SAAS,WAAW,SAAyB;AAC3C,MAAI;AACF,WAAO,KAAK,UAAU,KAAK,MAAM,OAAO,GAAG,MAAM,CAAC;AAAA,EACpD,QAAQ;AACN,WAAO;AAAA,EACT;AACF;ACnjBA,MAAMA,WAAS;AAAA,EACb,WAAW;AAAA,IACT,UAAU;AAAA,IACV,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,iBAAiB;AAAA,EAAA;AAAA,EAEnB,QAAQ;AAAA,IACN,UAAU;AAAA,IACV,KAAK;AAAA,IACL,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EAAA;AAAA,EAEV,UAAU;AAAA,IACR,UAAU;AAAA,IACV,KAAK;AAAA,IACL,OAAO;AAAA,IACP,SAAS;AAAA,IACT,eAAe;AAAA,IACf,KAAK;AAAA,IACL,QAAQ;AAAA,EAAA;AAAA,EAEV,cAAc;AAAA,IACZ,SAAS;AAAA,IACT,KAAK;AAAA,IACL,iBAAiB;AAAA,IACjB,SAAS;AAAA,IACT,cAAc;AAAA,IACd,WAAW;AAAA,EAAA;AAAA,EAEb,eAAe;AAAA,IACb,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,UAAU;AAAA,EAAA;AAAA,EAEZ,qBAAqB;AAAA,IACnB,iBAAiB;AAAA,IACjB,aAAa;AAAA,EAAA;AAAA,EAEf,QAAQ;AAAA,IACN,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,iBAAiB;AAAA,IACjB,SAAS;AAAA,IACT,cAAc;AAAA,IACd,WAAW;AAAA,IACX,UAAU;AAAA,EAAA;AAAA,EAEZ,aAAa;AAAA,IACX,YAAY;AAAA,IACZ,cAAc;AAAA,EAAA;AAAA,EAEhB,YAAY;AAAA,IACV,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,cAAc;AAAA,EAAA;AAAA,EAEhB,aAAa;AAAA,IACX,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,cAAc;AAAA,EAAA;AAAA,EAahB,aAAa;AAAA,IACX,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,eAAe;AAAA,EAAA;AAEnB;AAMA,MAAM,cAAsC;AAAA;AAAA,EAE1C,cAAc;AAAA;AAAA,EAEd,cAAc;AAAA,EACd,YAAY;AAAA,EACZ,kBAAkB;AAAA;AAAA,EAElB,YAAY;AAAA,EACZ,UAAU;AAAA,EACV,UAAU;AAAA;AAAA,EAEV,UAAU;AAAA,EACV,aAAa;AAAA,EACb,YAAY;AAAA,EACZ,YAAY;AAAA;AAAA,EAEZ,YAAY;AAAA,EACZ,gBAAgB;AAAA,EAChB,gBAAgB;AAClB;AAiBO,SAAS,UAAU,EAAE,SAA6C;AACvE,QAAM,eAAe,OAAuB,IAAI;AAChD,QAAM,YAAY,OAA0B,IAAI;AAEhD,QAAME,YAAW,eAAe,OAAO,CAAC,MAAM,EAAE,QAAQ;AACxD,QAAM,aAAa,eAAe,OAAO,CAAC,MAAM,EAAE,KAAK;AACvD,QAAM,YAAY,eAAe,OAAO,CAAC,MAAM,EAAE,SAAS;AAE1D,QAAM,CAAC,UAAU,WAAW,IAAI,SAAS,EAAE,GAAG,GAAG,GAAG,GAAG,MAAM,EAAA,CAAG;AAChE,QAAM,CAAC,YAAY,aAAa,IAAI,SAAS,KAAK;AAClD,QAAM,CAAC,WAAW,YAAY,IAAI,SAAS,EAAE,GAAG,GAAG,GAAG,GAAG;AACzD,QAAM,CAAC,eAAe,gBAAgB,IAAI,SAAyB,IAAI;AACvE,QAAM,CAAC,YAAY,aAAa,IAAI,SAAS,EAAE,GAAG,GAAG,GAAG,GAAG;AAG3D,QAAM,EAAE,OAAO,MAAA,IAAU,QAAQ,MAAM;AACrC,QAAI,CAACA,WAAU;AACb,aAAO,EAAE,OAAO,oBAAI,OAA2B,OAAO,CAAA,EAAC;AAAA,IACzD;AAEA,WAAO,cAAcA,WAAU,WAAW,QAAQ,UAAU,cAAc;AAAA,EAC5E,GAAG,CAACA,WAAU,WAAW,QAAQ,UAAU,cAAc,CAAC;AAG1D,YAAU,MAAM;AACd,UAAM,SAAS,UAAU;AACzB,UAAM,YAAY,aAAa;AAC/B,QAAI,CAAC,UAAU,CAAC,UAAW;AAE3B,UAAM,MAAM,OAAO,WAAW,IAAI;AAClC,QAAI,CAAC,IAAK;AAGV,UAAM,OAAO,UAAU,sBAAA;AACvB,WAAO,QAAQ,KAAK,QAAQ,OAAO;AACnC,WAAO,SAAS,KAAK,SAAS,OAAO;AACrC,WAAO,MAAM,QAAQ,GAAG,KAAK,KAAK;AAClC,WAAO,MAAM,SAAS,GAAG,KAAK,MAAM;AACpC,QAAI,MAAM,OAAO,kBAAkB,OAAO,gBAAgB;AAG1D,QAAI,UAAU,GAAG,GAAG,KAAK,OAAO,KAAK,MAAM;AAG3C,QAAI,KAAA;AACJ,QAAI,UAAU,SAAS,IAAI,KAAK,QAAQ,GAAG,SAAS,IAAI,KAAK,SAAS,CAAC;AACvE,QAAI,MAAM,SAAS,MAAM,SAAS,IAAI;AAGtC,eAAW,QAAQ,OAAO;AACxB,eAAS,KAAK,MAAM,OAAO,aAAa;AAAA,IAC1C;AAGA,eAAW,QAAQ,MAAM,UAAU;AACjC,eAAS,KAAK,MAAM,UAAU,mBAAmB,KAAK,IAAI,kBAAkB,KAAK,EAAE;AAAA,IACrF;AAEA,QAAI,QAAA;AAAA,EACN,GAAG,CAAC,OAAO,OAAO,UAAU,UAAU,gBAAgB,aAAa,CAAC;AAGpE,QAAM,kBAAkB,YAAY,CAAC,MAAwB;AAC3D,kBAAc,IAAI;AAClB,iBAAa,EAAE,GAAG,EAAE,UAAU,SAAS,GAAG,GAAG,EAAE,UAAU,SAAS,EAAA,CAAG;AAAA,EACvE,GAAG,CAAC,QAAQ,CAAC;AAEb,QAAM,kBAAkB;AAAA,IACtB,CAAC,MAAwB;AACvB,UAAI,YAAY;AACd,oBAAY;AAAA,UACV,GAAG;AAAA,UACH,GAAG,EAAE,UAAU,UAAU;AAAA,UACzB,GAAG,EAAE,UAAU,UAAU;AAAA,QAAA,CAC1B;AAAA,MACH,OAAO;AAEL,cAAM,YAAY,aAAa;AAC/B,YAAI,CAAC,UAAW;AAEhB,cAAM,OAAO,UAAU,sBAAA;AACvB,cAAM,UAAU,EAAE,UAAU,KAAK,OAAO,KAAK,QAAQ,IAAI,SAAS,KAAK,SAAS;AAChF,cAAM,UAAU,EAAE,UAAU,KAAK,MAAM,KAAK,SAAS,IAAI,SAAS,KAAK,SAAS;AAEhF,YAAI,QAAwB;AAC5B,mBAAW,QAAQ,MAAM,UAAU;AACjC,cACE,UAAU,KAAK,IAAI,KAAK,QAAQ,KAChC,UAAU,KAAK,IAAI,KAAK,QAAQ,KAChC,UAAU,KAAK,IAAI,KAAK,SAAS,KACjC,UAAU,KAAK,IAAI,KAAK,SAAS,GACjC;AACA,oBAAQ,KAAK;AACb,0BAAc,EAAE,GAAG,EAAE,SAAS,GAAG,EAAE,SAAS;AAC5C;AAAA,UACF;AAAA,QACF;AACA,yBAAiB,KAAK;AAAA,MACxB;AAAA,IACF;AAAA,IACA,CAAC,YAAY,WAAW,UAAU,KAAK;AAAA,EAAA;AAGzC,QAAM,gBAAgB,YAAY,MAAM;AACtC,kBAAc,KAAK;AAAA,EACrB,GAAG,CAAA,CAAE;AAEL,QAAM,cAAc,YAAY,MAAM;AACpC,QAAI,eAAe;AACjB,YAAM,OAAO,aAAa;AAAA,IAC5B;AAAA,EACF,GAAG,CAAC,OAAO,aAAa,CAAC;AAEzB,QAAM,cAAc;AAAA,IAClB,CAAC,MAAwB;AACvB,QAAE,eAAA;AACF,YAAM,QAAQ,EAAE,SAAS,IAAI,MAAM;AACnC,kBAAY,CAAC,OAAO;AAAA,QAClB,GAAG;AAAA,QACH,MAAM,KAAK,IAAI,KAAK,KAAK,IAAI,GAAG,EAAE,OAAO,KAAK,CAAC;AAAA,MAAA,EAC/C;AAAA,IACJ;AAAA,IACA,CAAA;AAAA,EAAC;AAIH,QAAM,qBAAqB;AAAA,IACzB,CAAC,WAAwB;AACvB,YAAM,eAAe,MAAM;AAAA,IAC7B;AAAA,IACA,CAAC,KAAK;AAAA,EAAA;AAGR,QAAM,eAAe,YAAY,MAAM;AACrC,gBAAY,CAAC,OAAO,EAAE,GAAG,GAAG,MAAM,KAAK,IAAI,GAAG,EAAE,OAAO,GAAG,IAAI;AAAA,EAChE,GAAG,CAAA,CAAE;AAEL,QAAM,gBAAgB,YAAY,MAAM;AACtC,gBAAY,CAAC,OAAO,EAAE,GAAG,GAAG,MAAM,KAAK,IAAI,KAAK,EAAE,OAAO,GAAG,IAAI;AAAA,EAClE,GAAG,CAAA,CAAE;AAEL,QAAM,kBAAkB,YAAY,MAAM;AACxC,gBAAY,EAAE,GAAG,GAAG,GAAG,GAAG,MAAM,GAAG;AAAA,EACrC,GAAG,CAAA,CAAE;AAGL,QAAM,cAAc,gBAAgB,MAAM,IAAI,aAAa,IAAI;AAE/D,SACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,KAAK;AAAA,MACL,OAAOF,SAAO;AAAA,MACd,aAAa;AAAA,MACb,aAAa;AAAA,MACb,WAAW;AAAA,MACX,cAAc;AAAA,MACd,SAAS;AAAA,MACT,SAAS;AAAA,MACT,eAAY;AAAA,MAEZ,UAAA;AAAA,QAAA,oBAAC,UAAA,EAAO,KAAK,WAAW,OAAOA,SAAO,QAAQ;AAAA,QAG9C,qBAAC,OAAA,EAAI,OAAOA,SAAO,UAEjB,UAAA;AAAA,UAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,cACjB,UAAA;AAAA,YAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,QAAO;AAAA,gBACP,eAAe,WAAW;AAAA,gBAC1B,SAAS;AAAA,cAAA;AAAA,YAAA;AAAA,YAEX;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,QAAO;AAAA,gBACP,eAAe,WAAW;AAAA,gBAC1B,SAAS;AAAA,cAAA;AAAA,YAAA;AAAA,YAEX;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,QAAO;AAAA,gBACP,eAAe,WAAW;AAAA,gBAC1B,SAAS;AAAA,cAAA;AAAA,YAAA;AAAA,UACX,GACF;AAAA,UAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,cACjB,UAAA;AAAA,YAAA,oBAAC,YAAO,SAAS,cAAc,OAAOA,SAAO,eAAe,UAAA,KAE5D;AAAA,gCACC,UAAA,EAAO,SAAS,eAAe,OAAOA,SAAO,eAAe,UAAA,KAE7D;AAAA,gCACC,UAAA,EAAO,SAAS,iBAAiB,OAAOA,SAAO,eAAe,UAAA,QAAA,CAE/D;AAAA,UAAA,EAAA,CACF;AAAA,QAAA,GACF;AAAA,QAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,QACjB,UAAA;AAAA,UAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,aAAa,UAAA,cAAU;AAAA,UAC1C,qBAAC,OAAA,EAAI,OAAOA,SAAO,YACjB,UAAA;AAAA,YAAA,oBAAC,OAAA,EAAI,OAAO,EAAE,GAAGA,SAAO,aAAa,iBAAiB,YAAY,aAAA,GAAgB;AAAA,YAClF,oBAAC,UAAK,UAAA,eAAA,CAAY;AAAA,UAAA,GACpB;AAAA,UACA,qBAAC,OAAA,EAAI,OAAOA,SAAO,YACjB,UAAA;AAAA,YAAA,oBAAC,OAAA,EAAI,OAAO,EAAE,GAAGA,SAAO,aAAa,iBAAiB,YAAY,WAAA,GAAc;AAAA,YAChF,oBAAC,UAAK,UAAA,aAAA,CAAU;AAAA,UAAA,GAClB;AAAA,UACA,qBAAC,OAAA,EAAI,OAAOA,SAAO,YACjB,UAAA;AAAA,YAAA,oBAAC,OAAA,EAAI,OAAO,EAAE,GAAGA,SAAO,aAAa,iBAAiB,YAAY,SAAA,GAAY;AAAA,YAC9E,oBAAC,UAAK,UAAA,WAAA,CAAQ;AAAA,UAAA,EAAA,CAChB;AAAA,QAAA,GACF;AAAA,QAGC,eACC;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,OAAO;AAAA,cACL,GAAGA,SAAO;AAAA,cACV,MAAM,WAAW,IAAI;AAAA,cACrB,KAAK,WAAW,IAAI;AAAA,YAAA;AAAA,YAGtB,UAAA;AAAA,cAAA,oBAAC,SAAI,UAAA,oBAAC,UAAA,EAAQ,UAAA,YAAY,MAAM,MAAK,EAAA,CAAS;AAAA,mCAC7C,OAAA,EACE,UAAA;AAAA,gBAAA,YAAY,MAAM,QAAQ,MAAM,GAAG,EAAE;AAAA,gBACrC,YAAY,MAAM,QAAQ,SAAS,KAAK,QAAQ;AAAA,cAAA,GACnD;AAAA,cACA,qBAAC,SAAI,OAAO,EAAE,OAAO,QAAQ,UAAU,SACpC,UAAA;AAAA,gBAAA,YAAY,MAAM,SAAS;AAAA,gBAAO;AAAA,gBAAY,YAAY,MAAM,MAAM;AAAA,gBAAO;AAAA,cAAA,EAAA,CAChF;AAAA,YAAA;AAAA,UAAA;AAAA,QAAA;AAAA,MACF;AAAA,IAAA;AAAA,EAAA;AAIR;AAYA,SAAS,aAAa,EAAE,QAAQ,eAAe,WAA8B;AAC3E,QAAM,SAAsC;AAAA,IAC1C,cAAc;AAAA,IACd,OAAO;AAAA,IACP,OAAO;AAAA,IACP,QAAQ;AAAA,EAAA;AAGV,SACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS,MAAM,QAAQ,MAAM;AAAA,MAC7B,OAAO;AAAA,QACL,GAAGA,SAAO;AAAA,QACV,GAAI,WAAW,gBAAgBA,SAAO,sBAAsB,CAAA;AAAA,MAAC;AAAA,MAG9D,iBAAO,MAAM;AAAA,IAAA;AAAA,EAAA;AAGpB;AAMA,SAAS,cACP,KACA,QACA,YACwD;AACxD,QAAM,4BAAY,IAAA;AAClB,QAAM,QAAqB,CAAA;AAG3B,QAAM,aAAa;AACnB,QAAM,cAAc;AACpB,QAAM,YAAY;AAClB,QAAM,YAAY;AAGlB,UAAQ,QAAA;AAAA,IACN,KAAK;AACH,gCAA0B,KAAK,OAAO,YAAY,aAAa,WAAW,SAAS;AACnF;AAAA,IACF,KAAK;AACH,yBAAmB,KAAK,OAAO,YAAY,WAAW;AACtD;AAAA,IACF,KAAK;AACH,0BAAoB,KAAK,OAAO,YAAY,WAAW;AACvD;AAAA,IACF;AACE,gCAA0B,KAAK,OAAO,YAAY,aAAa,WAAW,SAAS;AAAA,EAAA;AAIvF,MAAI,cAAc,MAAM,IAAI,UAAU,GAAG;AACvC,UAAM,OAAO,MAAM,IAAI,UAAU;AACjC,UAAM,IAAI,YAAY,EAAE,GAAG,MAAM,YAAY,MAAM;AAAA,EACrD;AAGA,aAAW,CAAC,SAAS,KAAK,KAAK,IAAI,QAAQ;AACzC,eAAW,WAAW,MAAM,UAAU;AACpC,YAAM,aAAa,MAAM,IAAI,OAAO;AACpC,YAAM,aAAa,MAAM,IAAI,OAAO;AACpC,UAAI,cAAc,YAAY;AAC5B,cAAM,KAAK;AAAA,UACT,IAAI,GAAG,OAAO,KAAK,OAAO;AAAA,UAC1B,UAAU;AAAA,UACV,UAAU;AAAA,UACV,UAAU;AAAA,UACV,QAAQ;AAAA,YACN,EAAE,GAAG,WAAW,GAAG,GAAG,WAAW,IAAI,WAAW,SAAS,EAAA;AAAA,YACzD,EAAE,GAAG,WAAW,GAAG,GAAG,WAAW,IAAI,WAAW,SAAS,EAAA;AAAA,UAAE;AAAA,UAE7D,eAAe;AAAA,QAAA,CAChB;AAAA,MACH;AAAA,IACF;AAGA,eAAW,QAAQ,MAAM,OAAO;AAC9B,YAAM,aAAa,MAAM,IAAI,OAAO;AACpC,YAAM,aAAa,MAAM,IAAI,KAAK,MAAM;AACxC,UAAI,cAAc,YAAY;AAC5B,cAAM,KAAK;AAAA,UACT,IAAI,GAAG,OAAO,IAAI,KAAK,QAAQ,KAAK,KAAK,MAAM;AAAA,UAC/C,UAAU;AAAA,UACV,UAAU,KAAK;AAAA,UACf,UAAU,KAAK;AAAA,UACf,QAAQ;AAAA,YACN,EAAE,GAAG,WAAW,IAAI,WAAW,QAAQ,GAAG,GAAG,WAAW,EAAA;AAAA,YACxD,EAAE,GAAG,WAAW,IAAI,WAAW,QAAQ,GAAG,GAAG,WAAW,EAAA;AAAA,UAAE;AAAA,UAE5D,eAAe;AAAA,QAAA,CAChB;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAEA,SAAO,EAAE,OAAO,MAAA;AAClB;AAEA,SAAS,0BACP,KACA,OACA,WACA,YACA,UACA,UACM;AAEN,QAAM,6BAAa,IAAA;AACnB,QAAM,qCAAqB,IAAA;AAE3B,WAAS,aAAa,SAAkB,OAAqB;AAC3D,WAAO,IAAI,SAAS,KAAK;AACzB,mBAAe,IAAI,QAAQ,eAAe,IAAI,KAAK,KAAK,KAAK,CAAC;AAE9D,UAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,QAAI,OAAO;AACT,iBAAW,WAAW,MAAM,UAAU;AACpC,qBAAa,SAAS,QAAQ,CAAC;AAAA,MACjC;AAAA,IACF;AAAA,EACF;AAEA,eAAa,IAAI,MAAM,CAAC;AAGxB,QAAM,iCAAiB,IAAA;AAEvB,aAAW,CAAC,SAAS,KAAK,KAAK,QAAQ;AACrC,UAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,QAAI,CAAC,MAAO;AAEZ,UAAM,OAAO,WAAW,IAAI,KAAK,KAAK;AACtC,UAAM,eAAe,eAAe,IAAI,KAAK,KAAK;AAClD,UAAM,IAAI,QAAS,eAAe,MAAM,YAAY,YAAa;AAEjE,UAAM,IAAI,SAAS;AAAA,MACjB,IAAI;AAAA,MACJ;AAAA,MACA,GAAG,SAAS,aAAa;AAAA,MACzB,OAAO;AAAA,MACP,QAAQ;AAAA,MACR;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MACZ,YAAY;AAAA,MACZ,eAAe;AAAA,IAAA,CAChB;AAED,eAAW,IAAI,OAAO,OAAO,YAAY,QAAQ;AAAA,EACnD;AACF;AAEA,SAAS,mBACP,KACA,OACA,WACA,YACM;AAEN,QAAM,gCAAgB,IAAA;AAGtB,MAAI,IAAI;AACR,aAAW,WAAW,IAAI,OAAO,KAAA,GAAQ;AACvC,UAAM,QAAS,IAAI,IAAI,OAAO,OAAQ,IAAI,KAAK;AAC/C,UAAM,SAAS;AACf,cAAU,IAAI,SAAS;AAAA,MACrB,GAAG,KAAK,IAAI,KAAK,IAAI;AAAA,MACrB,GAAG,KAAK,IAAI,KAAK,IAAI;AAAA,MACrB,IAAI;AAAA,MACJ,IAAI;AAAA,IAAA,CACL;AACD;AAAA,EACF;AAGA,WAAS,OAAO,GAAG,OAAO,IAAI,QAAQ;AAEpC,eAAW,CAAC,KAAK,IAAI,KAAK,WAAW;AACnC,iBAAW,CAAC,KAAK,IAAI,KAAK,WAAW;AACnC,YAAI,OAAO,IAAK;AAChB,cAAM,KAAK,KAAK,IAAI,KAAK;AACzB,cAAM,KAAK,KAAK,IAAI,KAAK;AACzB,cAAM,OAAO,KAAK,IAAI,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE,CAAC;AACrD,cAAM,QAAQ,OAAQ,OAAO;AAC7B,cAAM,KAAM,KAAK,OAAQ;AACzB,cAAM,KAAM,KAAK,OAAQ;AACzB,aAAK,MAAM;AACX,aAAK,MAAM;AACX,aAAK,MAAM;AACX,aAAK,MAAM;AAAA,MACb;AAAA,IACF;AAGA,eAAW,CAAC,SAAS,KAAK,KAAK,IAAI,QAAQ;AACzC,YAAM,OAAO,UAAU,IAAI,OAAO;AAClC,UAAI,CAAC,KAAM;AACX,iBAAW,WAAW,MAAM,UAAU;AACpC,cAAM,OAAO,UAAU,IAAI,OAAO;AAClC,YAAI,CAAC,KAAM;AACX,cAAM,KAAK,KAAK,IAAI,KAAK;AACzB,cAAM,KAAK,KAAK,IAAI,KAAK;AACzB,cAAM,OAAO,KAAK,IAAI,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK,EAAE,CAAC;AACrD,cAAM,QAAQ,OAAO;AACrB,cAAM,KAAM,KAAK,OAAQ;AACzB,cAAM,KAAM,KAAK,OAAQ;AACzB,aAAK,MAAM;AACX,aAAK,MAAM;AACX,aAAK,MAAM;AACX,aAAK,MAAM;AAAA,MACb;AAAA,IACF;AAGA,eAAW,OAAO,UAAU,UAAU;AACpC,UAAI,KAAK,IAAI,KAAK;AAClB,UAAI,KAAK,IAAI,KAAK;AAClB,UAAI,MAAM;AACV,UAAI,MAAM;AAAA,IACZ;AAAA,EACF;AAGA,aAAW,CAAC,SAAS,GAAG,KAAK,WAAW;AACtC,UAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,QAAI,CAAC,MAAO;AAEZ,UAAM,IAAI,SAAS;AAAA,MACjB,IAAI;AAAA,MACJ,GAAG,IAAI;AAAA,MACP,GAAG,IAAI;AAAA,MACP,OAAO;AAAA,MACP,QAAQ;AAAA,MACR;AAAA,MACA,OAAO;AAAA,MACP,YAAY;AAAA,MACZ,YAAY;AAAA,MACZ,eAAe;AAAA,IAAA,CAChB;AAAA,EACH;AACF;AAEA,SAAS,oBACP,KACA,OACA,WACA,YACM;AAEN,QAAM,6BAAa,IAAA;AAEnB,WAAS,aAAa,SAAkB,OAAqB;AAC3D,WAAO,IAAI,SAAS,KAAK;AACzB,UAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,QAAI,OAAO;AACT,iBAAW,WAAW,MAAM,UAAU;AACpC,qBAAa,SAAS,QAAQ,CAAC;AAAA,MACjC;AAAA,IACF;AAAA,EACF;AAEA,eAAa,IAAI,MAAM,CAAC;AAGxB,QAAM,8BAAc,IAAA;AACpB,aAAW,CAAC,SAAS,KAAK,KAAK,QAAQ;AACrC,QAAI,CAAC,QAAQ,IAAI,KAAK,GAAG;AACvB,cAAQ,IAAI,OAAO,EAAE;AAAA,IACvB;AACA,YAAQ,IAAI,KAAK,EAAG,KAAK,OAAO;AAAA,EAClC;AAGA,QAAM,aAAa;AAEnB,aAAW,CAAC,OAAO,QAAQ,KAAK,SAAS;AACvC,UAAM,SAAS,QAAQ;AACvB,UAAM,YAAa,IAAI,KAAK,KAAM,SAAS;AAE3C,aAAS,QAAQ,CAAC,SAAS,UAAU;AACnC,YAAM,QAAQ,IAAI,OAAO,IAAI,OAAO;AACpC,UAAI,CAAC,MAAO;AAEZ,YAAM,QAAQ,QAAQ,YAAY,KAAK,KAAK;AAC5C,YAAM,IAAI,SAAS;AAAA,QACjB,IAAI;AAAA,QACJ,GAAG,KAAK,IAAI,KAAK,IAAI;AAAA,QACrB,GAAG,KAAK,IAAI,KAAK,IAAI;AAAA,QACrB,OAAO;AAAA,QACP,QAAQ;AAAA,QACR;AAAA,QACA;AAAA,QACA,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ,eAAe;AAAA,MAAA,CAChB;AAAA,IACH,CAAC;AAAA,EACH;AACF;AAMA,SAAS,SACP,KACA,MACA,YACA,WACM;AACN,QAAM,EAAE,GAAG,GAAG,OAAO,QAAQ,UAAU;AAGvC,MAAI,YAAY,aAAa,YAAY,YAAY,YAAY;AACjE,MAAI,cAAc,aAAa,YAAY;AAC3C,MAAI,YAAY,aAAa,IAAI;AAGjC,QAAM,SAAS;AACf,MAAI,UAAA;AACJ,MAAI,OAAO,IAAI,QAAQ,IAAI,QAAQ,IAAI,SAAS,CAAC;AACjD,MAAI,OAAO,IAAI,QAAQ,IAAI,QAAQ,IAAI,SAAS,CAAC;AACjD,MAAI,iBAAiB,IAAI,QAAQ,GAAG,IAAI,SAAS,GAAG,IAAI,QAAQ,GAAG,IAAI,SAAS,IAAI,MAAM;AAC1F,MAAI,OAAO,IAAI,QAAQ,GAAG,IAAI,SAAS,IAAI,MAAM;AACjD,MAAI,iBAAiB,IAAI,QAAQ,GAAG,IAAI,SAAS,GAAG,IAAI,QAAQ,IAAI,QAAQ,IAAI,SAAS,CAAC;AAC1F,MAAI,OAAO,IAAI,QAAQ,IAAI,QAAQ,IAAI,SAAS,CAAC;AACjD,MAAI,iBAAiB,IAAI,QAAQ,GAAG,IAAI,SAAS,GAAG,IAAI,QAAQ,GAAG,IAAI,SAAS,IAAI,MAAM;AAC1F,MAAI,OAAO,IAAI,QAAQ,GAAG,IAAI,SAAS,IAAI,MAAM;AACjD,MAAI,iBAAiB,IAAI,QAAQ,GAAG,IAAI,SAAS,GAAG,IAAI,QAAQ,IAAI,QAAQ,IAAI,SAAS,CAAC;AAC1F,MAAI,UAAA;AACJ,MAAI,KAAA;AACJ,MAAI,OAAA;AAGJ,QAAM,YAAY,aAAa,MAAM,IAAI;AACzC,MAAI,YAAY;AAChB,MAAI,SAAS,IAAI,QAAQ,GAAG,IAAI,SAAS,GAAG,GAAG,MAAM;AAGrD,MAAI,YAAY;AAChB,MAAI,OAAO;AACX,MAAI,YAAY;AAChB,MAAI,eAAe;AAEnB,QAAM,QAAQ,MAAM,QAAQ,MAAM,GAAG,EAAE,KAAK,MAAM;AAClD,MAAI,SAAS,SAAS,MAAM,QAAQ,SAAS,KAAK,QAAQ,KAAK,GAAG,CAAC;AACrE;AAEA,SAAS,SACP,KACA,MACA,OACA,eACM;AACN,QAAM,SAAS,MAAM,IAAI,KAAK,QAAQ;AACtC,QAAM,SAAS,MAAM,IAAI,KAAK,QAAQ;AACtC,MAAI,CAAC,UAAU,CAAC,OAAQ;AAExB,QAAM,gBAAgB,KAAK,aAAa,iBAAiB,KAAK,aAAa;AAC3E,QAAM,QAAQ,aAAa,KAAK,QAAQ;AAExC,MAAI,cAAc,gBAAgB,QAAQ,GAAG,KAAK;AAClD,MAAI,YAAY,gBAAgB,IAAI;AAGpC,MAAI,UAAA;AACJ,MAAI,OAAO,KAAK,OAAO,CAAC,EAAG,GAAG,KAAK,OAAO,CAAC,EAAG,CAAC;AAE/C,MAAI,KAAK,OAAO,WAAW,GAAG;AAE5B,UAAM,QAAQ,KAAK,OAAO,CAAC,EAAG,IAAI,KAAK,OAAO,CAAC,EAAG,KAAK;AACvD,QAAI;AAAA,MACF,KAAK,OAAO,CAAC,EAAG;AAAA,MAChB;AAAA,MACA,KAAK,OAAO,CAAC,EAAG;AAAA,MAChB;AAAA,MACA,KAAK,OAAO,CAAC,EAAG;AAAA,MAChB,KAAK,OAAO,CAAC,EAAG;AAAA,IAAA;AAAA,EAEpB,OAAO;AACL,aAAS,IAAI,GAAG,IAAI,KAAK,OAAO,QAAQ,KAAK;AAC3C,UAAI,OAAO,KAAK,OAAO,CAAC,EAAG,GAAG,KAAK,OAAO,CAAC,EAAG,CAAC;AAAA,IACjD;AAAA,EACF;AAEA,MAAI,OAAA;AAGJ,QAAM,YAAY,KAAK,OAAO,KAAK,OAAO,SAAS,CAAC;AACpD,QAAM,YAAY,KAAK,OAAO,KAAK,OAAO,SAAS,CAAC,KAAK,KAAK,OAAO,CAAC;AACtE,QAAM,QAAQ,KAAK,MAAM,UAAU,IAAI,UAAU,GAAG,UAAU,IAAI,UAAU,CAAC;AAC7E,QAAM,YAAY;AAElB,MAAI,YAAY,gBAAgB,QAAQ,GAAG,KAAK;AAChD,MAAI,UAAA;AACJ,MAAI,OAAO,UAAU,GAAG,UAAU,CAAC;AACnC,MAAI;AAAA,IACF,UAAU,IAAI,YAAY,KAAK,IAAI,QAAQ,KAAK,KAAK,CAAC;AAAA,IACtD,UAAU,IAAI,YAAY,KAAK,IAAI,QAAQ,KAAK,KAAK,CAAC;AAAA,EAAA;AAExD,MAAI;AAAA,IACF,UAAU,IAAI,YAAY,KAAK,IAAI,QAAQ,KAAK,KAAK,CAAC;AAAA,IACtD,UAAU,IAAI,YAAY,KAAK,IAAI,QAAQ,KAAK,KAAK,CAAC;AAAA,EAAA;AAExD,MAAI,UAAA;AACJ,MAAI,KAAA;AACN;AAEA,SAAS,aAAa,MAAsB;AAC1C,QAAM,SAAiC;AAAA,IACrC,MAAM;AAAA,IACN,MAAM;AAAA,IACN,OAAO;AAAA,IACP,MAAM;AAAA,IACN,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,WAAW;AAAA,EAAA;AAEb,SAAO,OAAO,IAAI,KAAK;AACzB;AAEA,SAAS,aAAa,MAAsB;AAC1C,SAAO,YAAY,IAAI,KAAK;AAC9B;AC5yBA,MAAMA,WAAS;AAAA,EACb,WAAW;AAAA,IACT,SAAS;AAAA,IACT,eAAe;AAAA,IACf,QAAQ;AAAA,IACR,iBAAiB;AAAA,EAAA;AAAA,EAEnB,QAAQ;AAAA,IACN,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,SAAS;AAAA,IACT,cAAc;AAAA,IACd,iBAAiB;AAAA,EAAA;AAAA,EAEnB,aAAa;AAAA,IACX,UAAU;AAAA,IACV,YAAY;AAAA,EAAA;AAAA,EAEd,eAAe;AAAA,IACb,SAAS;AAAA,IACT,KAAK;AAAA,EAAA;AAAA,EAEP,QAAQ;AAAA,IACN,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,UAAU;AAAA,EAAA;AAAA,EAEZ,eAAe;AAAA,IACb,iBAAiB;AAAA,IACjB,aAAa;AAAA,IACb,OAAO;AAAA,EAAA;AAAA,EAOT,kBAAkB;AAAA,IAChB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,cAAc;AAAA,EAAA;AAAA,EAEhB,gBAAgB;AAAA,IACd,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,UAAU;AAAA,IACV,UAAU;AAAA,EAAA;AAAA,EAEZ,SAAS;AAAA,IACP,MAAM;AAAA,IACN,UAAU;AAAA,IACV,SAAS;AAAA,EAAA;AAAA,EAEX,SAAS;AAAA,IACP,SAAS;AAAA,IACT,KAAK;AAAA,IACL,SAAS;AAAA,IACT,iBAAiB;AAAA,IACjB,cAAc;AAAA,IACd,cAAc;AAAA,IACd,UAAU;AAAA,EAAA;AAAA,EAEZ,aAAa;AAAA,IACX,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,EAAA;AAAA,EAEP,cAAc;AAAA,IACZ,SAAS;AAAA,IACT,SAAS;AAAA,IACT,cAAc;AAAA,IACd,UAAU;AAAA,IACV,YAAY;AAAA,EAAA;AAAA,EAEd,YAAY;AAAA,IACV,iBAAiB;AAAA,IACjB,OAAO;AAAA,EAAA;AAAA,EAET,cAAc;AAAA,IACZ,iBAAiB;AAAA,IACjB,OAAO;AAAA,EAAA;AAAA,EAET,eAAe;AAAA,IACb,iBAAiB;AAAA,IACjB,OAAO;AAAA,EAAA;AAAA,EAET,YAAY;AAAA,IACV,iBAAiB;AAAA,IACjB,OAAO;AAAA,EAAA;AAAA,EAET,UAAU;AAAA,IACR,SAAS;AAAA,IACT,eAAe;AAAA,IACf,KAAK;AAAA,EAAA;AAAA,EAEP,UAAU;AAAA,IACR,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,UAAU;AAAA,EAAA;AAAA,EAEZ,gBAAgB;AAAA,IACd,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,SAAS;AAAA,IACT,iBAAiB;AAAA,IACjB,cAAc;AAAA,IACd,QAAQ;AAAA,EAAA;AAAA,EAEV,oBAAoB;AAAA,IAClB,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,EAAA;AAAA,EAEP,YAAY;AAAA,IACV,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,OAAO;AAAA,EAAA;AAAA,EAET,cAAc;AAAA,IACZ,UAAU;AAAA,IACV,OAAO;AAAA,EAAA;AAAA,EAET,iBAAiB;AAAA,IACf,SAAS;AAAA,IACT,KAAK;AAAA,EAAA;AAAA,EAEP,iBAAiB;AAAA,IACf,SAAS;AAAA,EAAA;AAAA,EAEX,UAAU;AAAA,IACR,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,SAAS;AAAA,IACT,cAAc;AAAA,EAAA;AAAA,EAEhB,eAAe;AAAA,IACb,iBAAiB;AAAA,IACjB,OAAO;AAAA,EAAA;AAAA,EAET,iBAAiB;AAAA,IACf,iBAAiB;AAAA,IACjB,OAAO;AAAA,IACP,gBAAgB;AAAA,EAAA;AAAA,EAElB,eAAe;AAAA,IACb,OAAO;AAAA,EAAA;AAAA,EAET,WAAW;AAAA,IACT,SAAS;AAAA,IACT,qBAAqB;AAAA,IACrB,KAAK;AAAA,IACL,iBAAiB;AAAA,EAAA;AAAA,EAEnB,WAAW;AAAA,IACT,iBAAiB;AAAA,IACjB,SAAS;AAAA,EAAA;AAAA,EAEX,gBAAgB;AAAA,IACd,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,cAAc;AAAA,IACd,eAAe;AAAA,EAAA;AAAA,EAEjB,YAAY;AAAA,IACV,SAAS;AAAA,IACT,eAAe;AAAA,IACf,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,UAAU;AAAA,EAAA;AAAA,EAEZ,WAAW;AAAA,IACT,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,cAAc;AAAA,EAAA;AAAA,EAEhB,gBAAgB;AAAA,IACd,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,UAAU;AAAA,EAAA;AAEd;AAiBO,SAAS,WAAW,EAAE,SAA8C;AACzE,QAAM,YAAY,eAAe,OAAO,CAAC,MAAM,EAAE,IAAI;AACrD,QAAME,YAAW,eAAe,OAAO,CAAC,MAAM,EAAE,QAAQ;AAExD,QAAM,CAAC,eAAe,gBAAgB,IAAI,SAAS,KAAK;AACxD,QAAM,CAAC,eAAe,gBAAgB,IAAI,SAAuB,oBAAI,KAAK;AAC1E,QAAM,CAAC,QAAQ,SAAS,IAAI,SAAiC,KAAK;AAGlE,QAAM,YAAY,QAAQ,MAAM;AAC9B,WAAO;AAAA,MACL,EAAE,IAAI,WAAW,aAAa,gBAAA;AAAA,MAC9B,EAAE,IAAI,WAAW,aAAa,gBAAA;AAAA,IAAgB;AAAA,EAElD,GAAG,CAAA,CAAE;AAGL,QAAM,OAAO,QAAQ,MAA2B;AAC9C,QAAI,CAAC,UAAU,eAAe,CAACA,WAAU;AACvC,aAAO;AAAA,IACT;AAGA,WAAO;AAAA,MACL,gBAAgB,UAAU,kBAAkB;AAAA,MAC5C,cAAc,UAAU,mBAAmB;AAAA,MAC3C,gCAAgB,IAAA;AAAA,MAChB,mBAAmB,CAAA;AAAA,MACnB,SAAS,EAAE,OAAO,GAAG,SAAS,GAAG,UAAU,GAAG,OAAO,GAAG,WAAWA,UAAS,OAAO,KAAA;AAAA,IAAK;AAAA,EAE5F,GAAG,CAAC,UAAU,aAAa,UAAU,gBAAgB,UAAU,iBAAiBA,SAAQ,CAAC;AAGzF,QAAM,gBAAgB,QAAQ,MAAM;AAClC,QAAI,CAAC,KAAM,QAAO,CAAA;AAElB,UAAM,QAAQ,MAAM,KAAK,KAAK,WAAW,QAAQ;AAEjD,WAAO,MAAM,OAAO,CAAC,MAAM;AACzB,UAAI,CAAC,iBAAiB,EAAE,eAAe,YAAa,QAAO;AAC3D,UAAI,WAAW,SAAS,EAAE,eAAe,OAAQ,QAAO;AACxD,aAAO;AAAA,IACT,CAAC;AAAA,EACH,GAAG,CAAC,MAAM,eAAe,MAAM,CAAC;AAGhC,QAAM,qBAAqB,YAAY,MAAM;AAC3C,UAAM,aAAa,WAAW,SAAS;AAAA,EACzC,GAAG,CAAC,KAAK,CAAC;AAEV,QAAM,oBAAoB,YAAY,MAAM;AAC1C,UAAM,YAAA;AAAA,EACR,GAAG,CAAC,KAAK,CAAC;AAEV,QAAM,qBAAqB,YAAY,CAAC,YAAqB;AAC3D,qBAAiB,CAAC,SAAS;AACzB,YAAM,OAAO,IAAI,IAAI,IAAI;AACzB,UAAI,KAAK,IAAI,OAAO,GAAG;AACrB,aAAK,OAAO,OAAO;AAAA,MACrB,OAAO;AACL,aAAK,IAAI,OAAO;AAAA,MAClB;AACA,aAAO;AAAA,IACT,CAAC;AAAA,EACH,GAAG,CAAA,CAAE;AAEL,QAAM,oBAAoB;AAAA,IACxB,CAAC,YAAqB;AACpB,YAAM,YAAY,OAAO;AAAA,IAC3B;AAAA,IACA,CAAC,KAAK;AAAA,EAAA;AAGR,QAAM,qBAAqB;AAAA,IACzB,CAAC,YAAqB;AACpB,YAAM,aAAa,OAAO;AAAA,IAC5B;AAAA,IACA,CAAC,KAAK;AAAA,EAAA;AAGR,QAAM,iBAAiB,YAAY,MAAM;AACvC,kBAAc,QAAQ,CAAC,MAAM;AAC3B,UAAI,EAAE,eAAe,aAAa;AAChC,cAAM,YAAY,EAAE,OAAO;AAAA,MAC7B;AAAA,IACF,CAAC;AAAA,EACH,GAAG,CAAC,OAAO,aAAa,CAAC;AAEzB,MAAI,CAAC,UAAU,aAAa;AAC1B,WACE,qBAAC,OAAA,EAAI,OAAOF,SAAO,WACjB,UAAA;AAAA,MAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,QACjB,UAAA,oBAAC,UAAK,OAAOA,SAAO,aAAa,UAAA,cAAA,CAAW,GAC9C;AAAA,MACA,qBAAC,OAAA,EAAI,OAAOA,SAAO,YACjB,UAAA;AAAA,QAAA,oBAAC,OAAE,UAAA,kCAAA,CAA+B;AAAA,QAClC;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,OAAO,EAAE,GAAGA,SAAO,QAAQ,WAAW,OAAA;AAAA,YACtC,SAAS;AAAA,YACV,UAAA;AAAA,UAAA;AAAA,QAAA;AAAA,MAED,EAAA,CACF;AAAA,IAAA,GACF;AAAA,EAEJ;AAEA,8BACG,OAAA,EAAI,OAAOA,SAAO,WAAW,eAAY,eAExC,UAAA;AAAA,IAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,QACjB,UAAA;AAAA,MAAA,oBAAC,QAAA,EAAK,OAAOA,SAAO,aAAa,UAAA,qBAAiB;AAAA,MAClD,qBAAC,OAAA,EAAI,OAAOA,SAAO,eACjB,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,OAAO,EAAE,GAAGA,SAAO,QAAQ,GAAGA,SAAO,cAAA;AAAA,YACrC,SAAS;AAAA,YACV,UAAA;AAAA,UAAA;AAAA,QAAA;AAAA,4BAGA,UAAA,EAAO,OAAOA,SAAO,QAAQ,SAAS,mBAAmB,UAAA,QAAA,CAE1D;AAAA,MAAA,EAAA,CACF;AAAA,IAAA,GACF;AAAA,IAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,kBACjB,UAAA;AAAA,MAAA,oBAAC,UAAK,UAAA,QAAA,CAAK;AAAA,MACX,oBAAC,YAAO,OAAOA,SAAO,gBAAgB,OAAO,UAAU,kBAAkB,IACtE,UAAA,UAAU,IAAI,CAAC,MACd,oBAAC,UAAA,EAAkB,OAAO,EAAE,IACzB,YAAE,YAAA,GADQ,EAAE,EAEf,CACD,EAAA,CACH;AAAA,MACA,oBAAC,UAAK,UAAA,MAAA,CAAG;AAAA,MACT,oBAAC,YAAO,OAAOA,SAAO,gBAAgB,OAAO,UAAU,mBAAmB,IACvE,UAAA,UAAU,IAAI,CAAC,MACd,oBAAC,UAAA,EAAkB,OAAO,EAAE,IACzB,YAAE,YAAA,GADQ,EAAE,EAEf,CACD,EAAA,CACH;AAAA,IAAA,GACF;AAAA,IAGA,qBAAC,OAAA,EAAI,OAAOA,SAAO,WACjB,UAAA;AAAA,MAAA,qBAAC,SAAA,EAAM,OAAOA,SAAO,gBACnB,UAAA;AAAA,QAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,MAAK;AAAA,YACL,SAAS;AAAA,YACT,UAAU,CAAC,MAAM,iBAAiB,EAAE,OAAO,OAAO;AAAA,UAAA;AAAA,QAAA;AAAA,QAClD;AAAA,MAAA,GAEJ;AAAA,MACA;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,OAAO;AAAA,UACP,UAAU,CAAC,MAAM,UAAU,EAAE,OAAO,KAA+B;AAAA,UACnE,OAAO,EAAE,GAAGA,SAAO,gBAAgB,UAAU,QAAA;AAAA,UAE7C,UAAA;AAAA,YAAA,oBAAC,UAAA,EAAO,OAAM,OAAM,UAAA,eAAW;AAAA,YAC/B,oBAAC,UAAA,EAAO,OAAM,SAAQ,UAAA,SAAK;AAAA,YAC3B,oBAAC,UAAA,EAAO,OAAM,WAAU,UAAA,WAAO;AAAA,YAC/B,oBAAC,UAAA,EAAO,OAAM,YAAW,UAAA,YAAQ;AAAA,YACjC,oBAAC,UAAA,EAAO,OAAM,SAAQ,UAAA,QAAA,CAAK;AAAA,UAAA;AAAA,QAAA;AAAA,MAAA;AAAA,IAC7B,GACF;AAAA,IAGC,QACC,qBAAC,OAAA,EAAI,OAAOA,SAAO,SACjB,UAAA;AAAA,MAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,SACjB,UAAA;AAAA,QAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,aACjB,UAAA;AAAA,UAAA,qBAAC,QAAA,EAAK,OAAO,EAAE,GAAGA,SAAO,cAAc,GAAGA,SAAO,WAAA,GAAc,UAAA;AAAA,YAAA;AAAA,YAC3D,KAAK,QAAQ;AAAA,UAAA,GACjB;AAAA,UACA,oBAAC,UAAK,UAAA,QAAA,CAAK;AAAA,QAAA,GACb;AAAA,QACA,qBAAC,OAAA,EAAI,OAAOA,SAAO,aACjB,UAAA;AAAA,UAAA,qBAAC,QAAA,EAAK,OAAO,EAAE,GAAGA,SAAO,cAAc,GAAGA,SAAO,aAAA,GAAgB,UAAA;AAAA,YAAA;AAAA,YAC7D,KAAK,QAAQ;AAAA,UAAA,GACjB;AAAA,UACA,oBAAC,UAAK,UAAA,UAAA,CAAO;AAAA,QAAA,GACf;AAAA,QACA,qBAAC,OAAA,EAAI,OAAOA,SAAO,aACjB,UAAA;AAAA,UAAA,qBAAC,QAAA,EAAK,OAAO,EAAE,GAAGA,SAAO,cAAc,GAAGA,SAAO,cAAA,GAAiB,UAAA;AAAA,YAAA;AAAA,YAC9D,KAAK,QAAQ;AAAA,UAAA,GACjB;AAAA,UACA,oBAAC,UAAK,UAAA,WAAA,CAAQ;AAAA,QAAA,GAChB;AAAA,QACA,qBAAC,OAAA,EAAI,OAAOA,SAAO,aACjB,UAAA;AAAA,UAAA,qBAAC,QAAA,EAAK,OAAO,EAAE,GAAGA,SAAO,cAAc,GAAGA,SAAO,WAAA,GAAc,UAAA;AAAA,YAAA;AAAA,YAC3D,KAAK,QAAQ;AAAA,UAAA,GACjB;AAAA,UACA,oBAAC,UAAK,UAAA,QAAA,CAAK;AAAA,QAAA,EAAA,CACb;AAAA,MAAA,GACF;AAAA,MAGA,oBAAC,SAAI,OAAOA,SAAO,UAChB,UAAA,cAAc,WAAW,IACxB,oBAAC,OAAA,EAAI,OAAOA,SAAO,YACjB,8BAAC,KAAA,EAAE,UAAA,yBAAqB,GAC1B,IAEA,cAAc,IAAI,CAAC,cACjB;AAAA,QAAC;AAAA,QAAA;AAAA,UAEC;AAAA,UACA,YAAY,cAAc,IAAI,UAAU,OAAO;AAAA,UAC/C,UAAU,MAAM,mBAAmB,UAAU,OAAO;AAAA,UACpD,SAAS,MAAM,kBAAkB,UAAU,OAAO;AAAA,UAClD,UAAU,MAAM,mBAAmB,UAAU,OAAO;AAAA,QAAA;AAAA,QAL/C,UAAU;AAAA,MAAA,CAOlB,EAAA,CAEL;AAAA,IAAA,EAAA,CACF;AAAA,EAAA,GAEJ;AAEJ;AAcA,SAAS,SAAS;AAAA,EAChB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAsC;;AACpC,QAAM,EAAE,SAAS,YAAY,UAAU,UAAU,gBAAgB;AAEjE,QAAM,gBAAgB,MAAM;AAC1B,YAAQ,YAAA;AAAA,MACN,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB,KAAK;AACH,eAAOA,SAAO;AAAA,MAChB;AACE,eAAO,CAAA;AAAA,IAAC;AAAA,EAEd;AAEA,QAAM,iBAAiB,MAAM;AAC3B,YAAQ,YAAA;AAAA,MACN,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT,KAAK;AACH,eAAO;AAAA,MACT;AACE,eAAO;AAAA,IAAA;AAAA,EAEb;AAEA,SACE,qBAAC,OAAA,EAAI,OAAOA,SAAO,UACjB,UAAA;AAAA,IAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,gBAAgB,SAAS,UAC1C,UAAA;AAAA,MAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,oBACjB,UAAA;AAAA,QAAA,oBAAC,QAAA,EAAK,OAAO,EAAE,GAAGA,SAAO,cAAc,GAAG,cAAA,EAAc,GACrD,UAAA,eAAA,EAAe,CAClB;AAAA,4BACC,QAAA,EAAK,OAAOA,SAAO,YAAa,UAAA,WAAW,OAAO,GAAE;AAAA,QACrD,oBAAC,UAAK,OAAOA,SAAO,cAChB,YAAA,iBAAY,aAAZ,mBAAuB,SAAQ,UAAA,CACnC;AAAA,MAAA,GACF;AAAA,MACA,qBAAC,OAAA,EAAI,OAAOA,SAAO,iBAChB,UAAA;AAAA,QAAA,eAAe,eACd,qBAAA,UAAA,EACE,UAAA;AAAA,UAAA;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAO,EAAE,GAAGA,SAAO,QAAQ,SAAS,WAAW,UAAU,OAAA;AAAA,cACzD,SAAS,CAAC,MAAM;AACd,kBAAE,gBAAA;AACF,wBAAA;AAAA,cACF;AAAA,cACD,UAAA;AAAA,YAAA;AAAA,UAAA;AAAA,UAGD;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,OAAO,EAAE,GAAGA,SAAO,QAAQ,SAAS,WAAW,UAAU,OAAA;AAAA,cACzD,SAAS,CAAC,MAAM;AACd,kBAAE,gBAAA;AACF,yBAAA;AAAA,cACF;AAAA,cACD,UAAA;AAAA,YAAA;AAAA,UAAA;AAAA,QAED,GACF;AAAA,QAEF,oBAAC,QAAA,EAAK,OAAO,EAAE,UAAU,QAAQ,OAAO,OAAA,GACrC,UAAA,aAAa,MAAM,IAAA,CACtB;AAAA,MAAA,EAAA,CACF;AAAA,IAAA,GACF;AAAA,IAEC,cACC,oBAAC,OAAA,EAAI,OAAOA,SAAO,iBAChB,UAAA,eAAe,cAAc,cAC5B,oBAAC,cAAA,EAAa,UAAU,aAAa,IACnC,eAAe,WAAW,WAC5B,qBAAC,OAAA,EAAI,OAAO,EAAE,GAAGA,SAAO,UAAU,GAAGA,SAAO,cAAA,GAAiB,UAAA;AAAA,MAAA;AAAA,MACxD,SAAS;AAAA,IAAA,EAAA,CACd,IACE,eAAe,aAAa,gCAC7B,OAAA,EAAI,OAAO,EAAE,GAAGA,SAAO,UAAU,GAAGA,SAAO,mBAAmB,UAAA;AAAA,MAAA;AAAA,MAC1D,SAAS;AAAA,IAAA,EAAA,CACd,IAEA,oBAAC,gBAAA,EAAe,UAAoB,UAAoB,EAAA,CAE5D;AAAA,EAAA,GAEJ;AAEJ;AAUA,SAAS,aAAa,EAAE,YAAmD;AACzE,6BACG,OAAA,EACE,UAAA,SAAS,WAAW,IAAI,CAAC,IAAI,UAAU;AACtC,QAAI,QAA6BA,SAAO;AAExC,YAAQ,GAAG,MAAA;AAAA,MACT,KAAK;AACH,gBAAQ,EAAE,GAAGA,SAAO,UAAU,GAAGA,SAAO,cAAA;AACxC;AAAA,MACF,KAAK;AACH,gBAAQ,EAAE,GAAGA,SAAO,UAAU,GAAGA,SAAO,gBAAA;AACxC;AAAA,MACF;AACE,gBAAQ,EAAE,GAAGA,SAAO,UAAU,GAAGA,SAAO,cAAA;AAAA,IAAc;AAG1D,WACE,qBAAC,UAAiB,OACf,UAAA;AAAA,MAAA,GAAG,SAAS,YAAY;AAAA,MACxB,GAAG,SAAS,YAAY;AAAA,MACxB,GAAG;AAAA,IAAA,EAAA,GAHK,KAIX;AAAA,EAEJ,CAAC,EAAA,CACH;AAEJ;AAWA,SAAS,eAAe,EAAE,UAAU,YAAqD;AACvF,SACE,qBAAC,OAAA,EAAI,OAAOA,SAAO,WACjB,UAAA;AAAA,IAAA,qBAAC,OAAA,EAAI,OAAOA,SAAO,WACjB,UAAA;AAAA,MAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,gBAAgB,UAAA,UAAM;AAAA,MACxC,WACC,oBAAC,OAAA,EAAI,OAAO,EAAE,QAAQ,GAAG,UAAU,QAAQ,YAAY,WAAA,GACpD,mBAAS,QAAA,CACZ,IAEA,oBAAC,QAAA,EAAK,OAAO,EAAE,OAAO,QAAQ,WAAW,YAAY,UAAA,cAAA,CAAW;AAAA,IAAA,GAEpE;AAAA,IACA,qBAAC,OAAA,EAAI,OAAOA,SAAO,WACjB,UAAA;AAAA,MAAA,oBAAC,OAAA,EAAI,OAAOA,SAAO,gBAAgB,UAAA,SAAK;AAAA,MACvC,WACC,oBAAC,OAAA,EAAI,OAAO,EAAE,QAAQ,GAAG,UAAU,QAAQ,YAAY,WAAA,GACpD,mBAAS,QAAA,CACZ,IAEA,oBAAC,QAAA,EAAK,OAAO,EAAE,OAAO,QAAQ,WAAW,YAAY,UAAA,cAAA,CAAW;AAAA,IAAA,EAAA,CAEpE;AAAA,EAAA,GACF;AAEJ;AAMA,SAAS,WAAW,IAAoB;AACtC,MAAI,GAAG,UAAU,GAAI,QAAO;AAC5B,SAAO,GAAG,GAAG,MAAM,GAAG,CAAC,CAAC,MAAM,GAAG,MAAM,EAAE,CAAC;AAC5C;AC9mBA,MAAM,SAAS;AAAA,EACb,WAAW;AAAA,IACT,SAAS;AAAA,IACT,eAAe;AAAA,IACf,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,YAAY;AAAA,IACZ,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,iBAAiB;AAAA,EAAA;AAAA,EAEnB,SAAS;AAAA,IACP,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,IACL,SAAS;AAAA,IACT,cAAc;AAAA,IACd,iBAAiB;AAAA,EAAA;AAAA,EAEnB,cAAc;AAAA,IACZ,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,KAAK;AAAA,EAAA;AAAA,EAEP,eAAe;AAAA,IACb,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,iBAAiB;AAAA,IACjB,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,EAAA;AAAA,EAEd,qBAAqB;AAAA,IACnB,iBAAiB;AAAA,IACjB,aAAa;AAAA,EAAA;AAAA,EAEf,uBAAuB;AAAA,IACrB,SAAS;AAAA,IACT,QAAQ;AAAA,EAAA;AAAA,EAEV,gBAAgB;AAAA,IACd,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,iBAAiB;AAAA,IACjB,QAAQ;AAAA,EAAA;AAAA,EAEV,SAAS;AAAA,IACP,MAAM;AAAA,IACN,UAAU;AAAA,IACV,SAAS;AAAA,EAAA;AAAA,EAEX,cAAc;AAAA,IACZ,UAAU;AAAA,IACV,QAAQ;AAAA,EAAA;AAAA,EAEV,WAAW;AAAA,IACT,SAAS;AAAA,IACT,qBAAqB;AAAA,IACrB,KAAK;AAAA,IACL,QAAQ;AAAA,EAAA;AAAA,EAEV,WAAW;AAAA,IACT,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,cAAc;AAAA,EAAA;AAAA,EAEhB,YAAY;AAAA,IACV,SAAS;AAAA,IACT,eAAe;AAAA,IACf,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,QAAQ;AAAA,IACR,OAAO;AAAA,EAAA;AAAA,EAET,WAAW;AAAA,IACT,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,gBAAgB;AAAA,IAChB,SAAS;AAAA,IACT,WAAW;AAAA,IACX,iBAAiB;AAAA,IACjB,UAAU;AAAA,IACV,OAAO;AAAA,EAAA;AAEX;AA+CO,SAAS,OAAO;AAAA,EACrB,UAAU;AAAA,EACV;AAAA,EACA,OAAO;AAAA,EACP;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF,GAAoC;AAElC,QAAM,gBAAgB,eAAe,MAAM;AAC3C,QAAM,QAAQ,iBAAiB;AAG/B,QAAME,YAAW,eAAe,OAAO,CAAC,MAAM,EAAE,QAAQ;AACxD,QAAM,OAAO,eAAe,OAAO,CAAC,MAAM,EAAE,IAAI;AAChD,QAAM,UAAU,eAAe,OAAO,CAAC,MAAM,EAAE,OAAO;AACtD,QAAM,UAAU,eAAe,OAAO,CAAC,MAAM,EAAE,OAAO;AACtD,QAAM,YAAY,eAAe,OAAO,CAAC,MAAM,EAAE,SAAS;AAG1D,uBAAqB,OAAO,MAAM,OAAO,uBAAuB;AAGhE,YAAU,MAAM;AACd,QAAI,mBAAmB,CAACA,WAAU;AAChC,YAAM,aAAa,eAAe;AAAA,IACpC;AAAA,EACF,GAAG,CAAC,iBAAiBA,WAAU,KAAK,CAAC;AAGrC,YAAU,MAAM;AACd,QAAIA,aAAY,UAAU;AACxB,eAASA,SAAQ;AAAA,IACnB;AAAA,EACF,GAAG,CAACA,WAAU,QAAQ,CAAC;AAGvB,QAAM,mBAAmB;AAAA,IACvB,CAAC,YAAwB;AACvB,YAAM,QAAQ,OAAO;AAAA,IACvB;AAAA,IACA,CAAC,KAAK;AAAA,EAAA;AAIR,QAAM,aAAa,YAAY,MAAM;AACnC,QAAI,QAAQ,SAAS;AACnB,YAAM,KAAA;AAAA,IACR;AAAA,EACF,GAAG,CAAC,OAAO,QAAQ,OAAO,CAAC;AAE3B,QAAM,aAAa,YAAY,MAAM;AACnC,QAAI,QAAQ,SAAS;AACnB,YAAM,KAAA;AAAA,IACR;AAAA,EACF,GAAG,CAAC,OAAO,QAAQ,OAAO,CAAC;AAG3B,QAAM,aAAa,YAAY,YAAY;AACzC,QAAIA,aAAY,QAAQ;AACtB,YAAM,OAAOA,SAAQ;AAAA,IACvB;AACA,UAAM,MAAM,aAAA;AAAA,EACd,GAAG,CAAC,OAAOA,WAAU,MAAM,CAAC;AAG5B,QAAM,gBAAgB,MAAM;AAC1B,QAAI,CAACA,WAAU;AACb,aACE,qBAAC,OAAA,EAAI,OAAO,OAAO,YACjB,UAAA;AAAA,QAAA,oBAAC,OAAE,UAAA,qBAAA,CAAkB;AAAA,QACrB;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,SAAS,MAAM,MAAM,eAAe,cAAc;AAAA,YAClD,OAAO,EAAE,GAAG,OAAO,eAAe,WAAW,MAAA;AAAA,YAC9C,UAAA;AAAA,UAAA;AAAA,QAAA;AAAA,MAED,GACF;AAAA,IAEJ;AAEA,YAAQ,MAAA;AAAA,MACN,KAAK;AACH,eACE,oBAAC,SAAI,OAAO,OAAO,cACjB,UAAA,oBAAC,cAAA,EAAa,OAAc,EAAA,CAC9B;AAAA,MAGJ,KAAK;AACH,eAAO,oBAAC,aAAU,OAAc;AAAA,MAElC,KAAK;AACH,eAAO,oBAAC,cAAW,OAAc;AAAA,MAEnC,KAAK;AACH,eACE,qBAAC,OAAA,EAAI,OAAO,OAAO,WACjB,UAAA;AAAA,UAAA,oBAAC,OAAA,EAAI,OAAO,OAAO,WACjB,8BAAC,OAAA,EAAI,OAAO,EAAE,SAAS,UACrB,UAAA,oBAAC,cAAA,EAAa,MAAA,CAAc,GAC9B,GACF;AAAA,UACA,oBAAC,SAAI,OAAO,OAAO,WACjB,UAAA,oBAAC,WAAA,EAAU,OAAc,EAAA,CAC3B;AAAA,QAAA,GACF;AAAA,MAGJ;AACE,eAAO,oBAAC,gBAAa,OAAc;AAAA,IAAA;AAAA,EAEzC;AAEA,SACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC;AAAA,MACA,OAAO,EAAE,GAAG,OAAO,WAAW,GAAG,MAAA;AAAA,MACjC,eAAY;AAAA,MAGZ,UAAA;AAAA,QAAA,qBAAC,OAAA,EAAI,OAAO,OAAO,SAEjB,UAAA;AAAA,UAAA,qBAAC,OAAA,EAAI,OAAO,OAAO,cACjB,UAAA;AAAA,YAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,OAAM;AAAA,gBACN,MAAK;AAAA,gBACL,aAAa;AAAA,gBACb,SAAS;AAAA,cAAA;AAAA,YAAA;AAAA,YAEX;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,OAAM;AAAA,gBACN,MAAK;AAAA,gBACL,aAAa;AAAA,gBACb,SAAS;AAAA,cAAA;AAAA,YAAA;AAAA,YAEX;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,OAAM;AAAA,gBACN,MAAK;AAAA,gBACL,aAAa;AAAA,gBACb,SAAS;AAAA,cAAA;AAAA,YAAA;AAAA,YAEX;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,OAAM;AAAA,gBACN,MAAK;AAAA,gBACL,aAAa;AAAA,gBACb,SAAS;AAAA,cAAA;AAAA,YAAA;AAAA,UACX,GACF;AAAA,UAEA,oBAAC,OAAA,EAAI,OAAO,OAAO,eAAA,CAAgB;AAAA,UAGnC,qBAAC,OAAA,EAAI,OAAO,OAAO,cACjB,UAAA;AAAA,YAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,SAAS;AAAA,gBACT,UAAU,CAAC,QAAQ;AAAA,gBACnB,OAAO;AAAA,kBACL,GAAG,OAAO;AAAA,kBACV,GAAI,QAAQ,UAAU,CAAA,IAAK,OAAO;AAAA,gBAAA;AAAA,gBAEpC,OAAM;AAAA,gBACP,UAAA;AAAA,cAAA;AAAA,YAAA;AAAA,YAGD;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,SAAS;AAAA,gBACT,UAAU,CAAC,QAAQ;AAAA,gBACnB,OAAO;AAAA,kBACL,GAAG,OAAO;AAAA,kBACV,GAAI,QAAQ,UAAU,CAAA,IAAK,OAAO;AAAA,gBAAA;AAAA,gBAEpC,OAAM;AAAA,gBACP,UAAA;AAAA,cAAA;AAAA,YAAA;AAAA,UAED,GACF;AAAA,UAEA,oBAAC,OAAA,EAAI,OAAO,OAAO,eAAA,CAAgB;AAAA,UAGnC;AAAA,YAAC;AAAA,YAAA;AAAA,cACC,SAAS;AAAA,cACT,UAAU,CAAC;AAAA,cACX,OAAO;AAAA,gBACL,GAAG,OAAO;AAAA,gBACV,GAAI,UAAU,CAAA,IAAK,OAAO;AAAA,cAAA;AAAA,cAE5B,OAAM;AAAA,cACP,UAAA;AAAA,YAAA;AAAA,UAAA;AAAA,QAED,GACF;AAAA,4BAGC,OAAA,EAAI,OAAO,OAAO,SAAU,2BAAgB;AAAA,QAG7C,qBAAC,OAAA,EAAI,OAAO,OAAO,WACjB,UAAA;AAAA,UAAA,qBAAC,OAAA,EACE,UAAA;AAAA,YAAAA,YAAW,GAAGA,UAAS,OAAO,IAAI,YAAY;AAAA,YAC9C,WAAW;AAAA,UAAA,GACd;AAAA,UACA,oBAAC,SACE,UAAA,aACC,qBAAC,UAAK,OAAO,EAAE,OAAO,UAAA,GAAa,UAAA;AAAA,YAAA;AAAA,YACzB,UAAU;AAAA,UAAA,EAAA,CACpB,EAAA,CAEJ;AAAA,QAAA,EAAA,CACF;AAAA,MAAA;AAAA,IAAA;AAAA,EAAA;AAGN;AAaA,SAAS,WAAW,EAAE,OAAO,MAAM,aAAa,WAA4B;AAC1E,QAAM,WAAW,SAAS;AAC1B,SACE;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,SAAS,MAAM,QAAQ,IAAI;AAAA,MAC3B,OAAO;AAAA,QACL,GAAG,OAAO;AAAA,QACV,GAAI,WAAW,OAAO,sBAAsB,CAAA;AAAA,MAAC;AAAA,MAG9C,UAAA;AAAA,IAAA;AAAA,EAAA;AAGP;AAUA,SAAS,aAAa,EAAE,SAAgD;AACtE,QAAMA,YAAW,eAAe,OAAO,CAAC,MAAM,EAAE,QAAQ;AAExD,MAAI,CAACA,WAAU;AACb,WAAO,oBAAC,SAAI,UAAA,cAAA,CAAW;AAAA,EACzB;AAEA,QAAM,YAAYA,UAAS,OAAO,IAAIA,UAAS,IAAI;AACnD,MAAI,CAAC,WAAW;AACd,WAAO,oBAAC,SAAI,UAAA,6BAAA,CAA0B;AAAA,EACxC;AAEA,SACE,qBAAC,OAAA,EAAI,eAAY,iBACd,UAAA;AAAA,IAAA,UAAU,SAAS,IAAI,CAAC,YAAY;AACnC,YAAM,QAAQA,UAAS,OAAO,IAAI,OAAO;AACzC,UAAI,CAAC,MAAO,QAAO;AACnB,aACE;AAAA,QAAC;AAAA,QAAA;AAAA,UAEC,OAAO;AAAA,UACP,UAAAA;AAAA,UACA;AAAA,UACA,OAAO;AAAA,UACP,MAAM,CAACA,UAAS,IAAI;AAAA,QAAA;AAAA,QALf;AAAA,MAAA;AAAA,IAQX,CAAC;AAAA,IAEA,UAAU,SAAS,WAAW,0BAC5B,OAAA,EAAI,OAAO,OAAO,YACjB,UAAA;AAAA,MAAA,oBAAC,OAAE,UAAA,iBAAA,CAAc;AAAA,MACjB;AAAA,QAAC;AAAA,QAAA;AAAA,UACC,SAAS,MAAM,MAAM,SAASA,UAAS,MAAM,iBAAiB;AAAA,UAC9D,OAAO,EAAE,GAAG,OAAO,eAAe,WAAW,MAAA;AAAA,UAC9C,UAAA;AAAA,QAAA;AAAA,MAAA;AAAA,IAED,EAAA,CACF;AAAA,EAAA,GAEJ;AAEJ;","x_google_ignoreList":[4]}